# 结绳社区-插件扩展设计方案

## 1. 概述

本文档旨在为"结绳"应用设计一套内置的社区插件扩展系统。该扩展的核心目标是提升用户在应用内的创作与分享体验，允许用户无需离开应用即可浏览社区资源、上传、更新自己的项目资源，并管理个人社区账户。系统设计遵循**用户体验优先**和**热加载**原则，为未来支持社区资源的动态安装（伪Git工作流）奠定基础。

## 2. 设计理念

1.  **无缝集成**: 扩展深度集成于结绳应用内，作为一项原生功能提供给用户。
2.  **用户友好**: 操作流程直观简洁，表单智能预填，减少用户输入负担。
3.  **动态化**: 插件模块支持热加载，框架具备可扩展性，便于未来迭代新功能。
4.  **社区驱动**: 鼓励用户分享和更新资源，形成一个活跃的内置资源生态。

## 3. 架构与框架设计

### 3.1 插件框架 (Plugin Framework)

-   **热加载机制**: 主应用提供一套插件接口规范。社区扩展作为一个独立的模块包，可在应用启动时或用户主动触发时动态加载，而不需要重新启动整个应用。
-   **通信桥梁**: 建立应用内核与插件之间的安全通信协议。
    -   **内核 -> 插件**: 提供当前项目信息（如名称、路径、版本等）、用户认证状态等。
    -   **插件 -> 内核**: 调用应用的文件打包、网络请求等原生能力。
-   **UI集成点**: 插件UI将嵌入应用主界面右上角的"工具箱"下拉菜单中。

## 4. 功能模块详细设计

### 4.1 入口：工具箱 (Toolbox Menu)

在结绳应用主界面的右上角工具栏中，新增一个"社区"或"插件"图标（例如：地球图标或拼图图标）。
点击后下拉菜单显示以下功能项：
1.  **资源社区**
2.  **提交资源**
3.  **更新资源** (条件性显示)
4.  **个人中心**

### 4.2 功能一：资源社区

-   **目标**: 让用户浏览社区中其他用户分享的资源。
-   **UI设计**: 一个独立的视图页面。
    -   **顶部**: 搜索栏、资源分类筛选下拉框（如：模板、组件、脚本、教程等）。
    -   **主体**: 资源列表卡片布局。每个卡片显示资源图标、标题、作者、简介、点赞数和更新时间。
    -   **底部**: 分页控制器或"加载更多"按钮。
-   **交互逻辑**:
    1.  点击卡片跳转到该资源的详情页面（可内嵌WebView或原生渲染社区帖子）。
    2.  详情页应包含资源更详细的描述、更新日志、评论区和"下载"或"安装"按钮（为后续动态安装功能预留）。

### 4.3 功能二：提交资源

-   **目标**: 将当前正在编辑的项目打包并分享到社区。
-   **触发条件**: 用户从工具箱菜单点击"提交资源"。
-   **流程与UI设计**:
    1.  **状态检查**: 首先检查用户登录状态，若未登录，则引导至个人中心的登录界面。
    2.  **智能预填**: 插件自动获取当前项目的`项目名称`，并将其填入表单的"标题"字段。
    3.  **弹出上传模态窗**: 表单包含以下字段：
        -   `标题`(必填): 已预填，用户可修改。
        -   `版本号`(必填): 默认初始版本号（如`1.0.0`），遵循语义化版本规范。
        -   `分类`(必填): 下拉选择框（如：游戏模板、UI组件、工具脚本、学习示例）。
        -   `系统要求`(选填): 描述运行此资源所需的结绳版本或环境。
        -   `内容介绍`(必填): 富文本编辑器，支持图文混排，用于详细描述资源功能和使用方法。
        -   `上传文件`(必填): 文件选择按钮。点击后，插件调用应用内核接口，将当前项目目录打包为一个`.zip`或特定格式文件，并自动填入此处。用户也可手动选择其他文件（但强烈建议自动打包）。
    4.  **提交**: 用户填写完毕并点击"提交"后，插件将表单数据和文件包一并上传至社区服务器。
    5.  **状态反馈**: 上传成功后在项目根目录创建一个特殊的配置文件（如`.cordcommunity`），记录此次上传的`资源ID`、`版本号`等信息。**这将用于锁定"提交"按钮并启用"更新"功能。**

### 4.4 功能三：更新资源

-   **目标**: 允许用户更新已提交到社区的资源。
-   **显示逻辑**: 该菜单项**仅在当前项目目录中存在上文中提到的配置文件时才会显示**，否则隐藏。
-   **流程与UI设计**:
    1.  用户点击"更新资源"。
    2.  插件读取本地配置文件，获取到该资源在社区的`资源ID`。
    3.  插件自动查询社区服务器，获取该资源的最新信息，并**弹出一个与"提交资源"类似的表单模态窗**，但具有以下区别：
        -   所有字段（标题、分类、介绍等）均用上一次提交的信息自动填充。
        -   `版本号`字段自动建议一个比当前线上版本更高的版本（如线上是`1.2.0`，则建议`1.2.1`(patch)、`1.3.0`(minor)或`2.0.0`(major)），用户必须修改版本号才能提交更新。
        -   `文件上传`字段会自动填入根据当前项目重新打包生成的新文件包。
    4.  用户修改需要更新的信息（特别是版本号和文件）后，点击"更新"提交。
    5.  社区服务器会将该提交记录为一次新版本更新，而不是创建一个新资源。

### 4.5 功能四：个人中心

-   **目标**: 管理用户身份并展示其在社区的成就。
-   **UI设计**: 一个独立的视图页面。
-   **核心功能**:
    -   **状态显示**:
        -   若已登录：显示用户头像、昵称、个人简介、`上传资源数`、`发布帖子数`等统计信息。
        -   若未登录：显示登录表单和"注册"提示。
    -   **登录/登出**:
        -   `登录`: 提供`用户名/邮箱`和`密码`输入框。**不提供"注册"按钮**。
        -   `注册提示`: 在登录界面显眼位置放置文字提示，如"尚未拥有社区账户？请前往结绳社区官网完成注册"，并附带官网链接。
        -   `登出`: 用户点击后清除本地和内存中的认证凭证。
    -   **数据同步**: 用户信息在其点击进入个人中心时自动从社区服务器拉取并更新。

## 5. 非功能性设计要点

-   **安全性**: 所有与服务器的通信必须使用HTTPS。对用户密码进行哈希处理后再传输。
-   **性能**: 资源列表和文件上传需支持分页和断点续传，避免阻塞主线程。
-   **错误处理**: 对网络异常、服务器错误、文件过大等情况提供清晰友好的用户提示。
-   **本地缓存**: 适当缓存资源列表、用户信息等数据，提升二次访问速度并减少流量消耗。

## 6. 未来扩展性

-   **伪Git动态使用**: 本文档中描述的"更新"机制和本地配置文件是实现此功能的基础。未来可扩展为版本对比、变更历史查看和回滚。
-   **资源动态安装**: 在"资源社区"详情页，"下载"按钮可变为"安装"。点击后，插件将下载的资源包解压到用户指定的项目目录中，并自动配置相关依赖。
-   **插件市场**: 本扩展本身可作为基础框架，未来允许社区开发者提交更多不同功能的插件，形成一个真正的插件市场。