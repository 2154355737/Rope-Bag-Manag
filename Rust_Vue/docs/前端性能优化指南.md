# ç»³åŒ…ç®¡ç†ç³»ç»Ÿ - å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†ç»³åŒ…ç®¡ç†ç³»ç»Ÿå‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³å®è·µå’Œå…·ä½“å®æ–½æ–¹æ¡ˆï¼Œç¡®ä¿åº”ç”¨åœ¨å„ç§è®¾å¤‡å’Œç½‘ç»œç¯å¢ƒä¸‹éƒ½èƒ½æä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ æ€§èƒ½ç›®æ ‡

### æ ¸å¿ƒæŒ‡æ ‡
- **é¦–å±åŠ è½½æ—¶é—´** < 2ç§’
- **é¡µé¢åˆ‡æ¢æ—¶é—´** < 500ms
- **äº¤äº’å“åº”æ—¶é—´** < 100ms
- **Lighthouse è¯„åˆ†** > 90åˆ†
- **å†…å­˜ä½¿ç”¨** < 50MB (ç©ºé—²çŠ¶æ€)

### ç”¨æˆ·ä½“éªŒç›®æ ‡
- æµç•…çš„é¡µé¢åˆ‡æ¢åŠ¨ç”»
- å¿«é€Ÿçš„æœç´¢å’Œç­›é€‰å“åº”
- ä¼˜ç§€çš„ç§»åŠ¨ç«¯ä½“éªŒ
- ç¨³å®šçš„é•¿æ—¶é—´ä½¿ç”¨æ€§èƒ½

## ğŸ—ï¸ æ„å»ºä¼˜åŒ–

### 1. Vite é…ç½®ä¼˜åŒ–

å½“å‰é¡¹ç›®çš„ Vite é…ç½®å·²ç»åŒ…å«äº†å¾ˆå¥½çš„ä¼˜åŒ–ï¼š

```typescript
// vite.config.ts - å·²æœ‰çš„ä¼˜åŒ–é…ç½®
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        // æ‰‹åŠ¨åˆ†å‰²ä»£ç å— - å·²é…ç½®
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router'],
          'element-plus': ['element-plus'],
          'echarts': ['echarts', 'vue-echarts'],
          'utils': ['axios', 'lucide-vue-next']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  optimizeDeps: {
    include: [
      'vue', 'vue-router', 'element-plus', 
      'echarts', 'axios', 'lucide-vue-next'
    ]
  }
})
```

### 2. è¿›ä¸€æ­¥çš„æ„å»ºä¼˜åŒ–å»ºè®®

```typescript
// å»ºè®®çš„é¢å¤–ä¼˜åŒ–é…ç½®
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // ç°æœ‰é…ç½®ä¿æŒä¸å˜
          'vue-vendor': ['vue', 'vue-router'],
          'element-plus': ['element-plus'],
          'echarts': ['echarts', 'vue-echarts'],
          'utils': ['axios', 'lucide-vue-next'],
          
          // æ–°å¢ï¼šä¸šåŠ¡æ¨¡å—åˆ†ç¦»
          'admin': [
            './src/views/admin/Dashboard.vue',
            './src/views/admin/UserManage.vue',
            './src/views/admin/PackageManage.vue'
          ],
          'auth': [
            './src/views/auth/Login.vue',
            './src/views/auth/Register.vue'
          ]
        }
      }
    },
    
    // å‹ç¼©é…ç½®
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    },
    
    // å¯ç”¨ gzip å‹ç¼©
    reportCompressedSize: true
  }
})
```

## ğŸš€ ä»£ç å±‚é¢ä¼˜åŒ–

### 1. ç»„ä»¶æ‡’åŠ è½½ä¼˜åŒ–

```typescript
// è·¯ç”±æ‡’åŠ è½½ - å·²æœ‰çš„è‰¯å¥½å®è·µ
const routes = [
  {
    path: '/admin',
    component: () => import('../views/admin/Dashboard.vue')
  }
]

// ç»„ä»¶çº§æ‡’åŠ è½½å»ºè®®
import { defineAsyncComponent } from 'vue'

// é‡é‡çº§ç»„ä»¶æ‡’åŠ è½½
const EChartsComponent = defineAsyncComponent({
  loader: () => import('./EChartsComponent.vue'),
  loadingComponent: LoadingSpinner,
  errorComponent: ErrorComponent,
  delay: 200,
  timeout: 3000
})
```

### 2. è™šæ‹Ÿæ»šåŠ¨å®ç°

```vue
<!-- å¤§åˆ—è¡¨ä¼˜åŒ– -->
<template>
  <div class="virtual-list-container">
    <RecycleScroller
      class="scroller"
      :items="items"
      :item-size="82"
      key-field="id"
      v-slot="{ item }"
    >
      <ResourceCard :resource="item" />
    </RecycleScroller>
  </div>
</template>

<script setup lang="ts">
import { RecycleScroller } from 'vue-virtual-scroller'
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
</script>
```

### 3. è®¡ç®—å±æ€§å’Œå“åº”å¼ä¼˜åŒ–

```typescript
// âœ… ä¼˜åŒ–ï¼šä½¿ç”¨ computed ç¼“å­˜å¤æ‚è®¡ç®—
const filteredResources = computed(() => {
  return resources.value.filter(resource => 
    resource.title.toLowerCase().includes(searchQuery.value.toLowerCase())
  )
})

// âœ… ä¼˜åŒ–ï¼šä½¿ç”¨ shallowRef å‡å°‘æ·±åº¦å“åº”å¼
import { shallowRef } from 'vue'
const largeDataSet = shallowRef([])

// âœ… ä¼˜åŒ–ï¼šä½¿ç”¨ markRaw æ ‡è®°ä¸éœ€è¦å“åº”å¼çš„å¯¹è±¡
import { markRaw } from 'vue'
const chartInstance = markRaw(echarts.init(chartRef.value))
```

### 4. äº‹ä»¶å¤„ç†ä¼˜åŒ–

```typescript
// é˜²æŠ–æœç´¢
import { debounce } from 'lodash-es'

const handleSearch = debounce((query: string) => {
  searchResources(query)
}, 300)

// èŠ‚æµæ»šåŠ¨äº‹ä»¶
import { throttle } from 'lodash-es'

const handleScroll = throttle((event: Event) => {
  updateScrollPosition(event)
}, 16) // 60fps
```

## ğŸ–¼ï¸ èµ„æºä¼˜åŒ–

### 1. å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥

```vue
<template>
  <!-- å“åº”å¼å›¾ç‰‡ -->
  <picture>
    <source 
      media="(max-width: 768px)" 
      :srcset="`${resource.cover}?w=400&q=80`"
    >
    <source 
      media="(max-width: 1200px)" 
      :srcset="`${resource.cover}?w=800&q=85`"
    >
    <img 
      :src="`${resource.cover}?w=1200&q=90`"
      :alt="resource.title"
      loading="lazy"
      decoding="async"
    >
  </picture>
  
  <!-- å ä½ç¬¦å’Œæ¸è¿›å¼åŠ è½½ -->
  <div class="image-container">
    <img 
      v-if="!imageLoaded"
      :src="placeholderImage"
      class="placeholder"
    >
    <img 
      v-show="imageLoaded"
      :src="resource.cover"
      @load="imageLoaded = true"
      class="main-image"
    >
  </div>
</template>
```

### 2. å­—ä½“ä¼˜åŒ–

```css
/* å­—ä½“é¢„åŠ è½½ */
@font-face {
  font-family: 'CustomFont';
  src: url('./assets/fonts/custom-font.woff2') format('woff2');
  font-display: swap; /* æå‡å­—ä½“åŠ è½½æ€§èƒ½ */
}

/* å­—ä½“å­é›†åŒ– */
@font-face {
  font-family: 'Chinese';
  src: url('./assets/fonts/chinese-subset.woff2') format('woff2');
  unicode-range: U+4E00-9FFF; /* ä¸­æ–‡å­—ç¬¦èŒƒå›´ */
}
```

## ğŸ“Š çŠ¶æ€ç®¡ç†ä¼˜åŒ–

### 1. Pinia Store ä¼˜åŒ–

```typescript
// stores/resources.ts
export const useResourceStore = defineStore('resources', () => {
  const resources = ref<Resource[]>([])
  const resourcesMap = computed(() => {
    // ä½¿ç”¨ Map æé«˜æŸ¥æ‰¾æ€§èƒ½
    const map = new Map()
    resources.value.forEach(resource => {
      map.set(resource.id, resource)
    })
    return map
  })
  
  // åˆ†é¡µåŠ è½½
  const loadResources = async (page: number, pageSize: number) => {
    if (isLoading.value) return
    
    isLoading.value = true
    try {
      const response = await api.get('/resources', {
        params: { page, pageSize }
      })
      
      if (page === 1) {
        resources.value = response.data
      } else {
        resources.value.push(...response.data)
      }
    } finally {
      isLoading.value = false
    }
  }
  
  return {
    resources: readonly(resources),
    resourcesMap,
    loadResources
  }
})
```

### 2. ç¼“å­˜ç­–ç•¥

```typescript
// utils/cache.ts
class CacheManager {
  private cache = new Map()
  private maxSize = 100
  
  set(key: string, value: any, ttl = 5 * 60 * 1000) {
    // LRU ç¼“å­˜å®ç°
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value
      this.cache.delete(firstKey)
    }
    
    this.cache.set(key, {
      value,
      expiry: Date.now() + ttl
    })
  }
  
  get(key: string) {
    const item = this.cache.get(key)
    if (!item) return null
    
    if (Date.now() > item.expiry) {
      this.cache.delete(key)
      return null
    }
    
    return item.value
  }
}

export const cacheManager = new CacheManager()
```

## ğŸŒ ç½‘ç»œä¼˜åŒ–

### 1. API è¯·æ±‚ä¼˜åŒ–

```typescript
// utils/apiOptimization.ts
class ApiOptimizer {
  private requestQueue = new Map()
  
  // è¯·æ±‚å»é‡
  async request(url: string, config?: AxiosRequestConfig) {
    const key = `${config?.method || 'GET'}_${url}_${JSON.stringify(config?.params)}`
    
    if (this.requestQueue.has(key)) {
      return this.requestQueue.get(key)
    }
    
    const promise = api.get(url, config)
    this.requestQueue.set(key, promise)
    
    try {
      const result = await promise
      return result
    } finally {
      this.requestQueue.delete(key)
    }
  }
  
  // æ‰¹é‡è¯·æ±‚
  async batchRequest(requests: Array<{ url: string; config?: AxiosRequestConfig }>) {
    return Promise.allSettled(
      requests.map(({ url, config }) => this.request(url, config))
    )
  }
}

export const apiOptimizer = new ApiOptimizer()
```

### 2. é¢„åŠ è½½ç­–ç•¥

```typescript
// utils/preloader.ts
export class Preloader {
  // é¢„åŠ è½½å…³é”®è·¯ç”±
  static preloadRoutes() {
    const criticalRoutes = [
      () => import('../views/main/Home.vue'),
      () => import('../views/admin/Dashboard.vue')
    ]
    
    // åœ¨é¡µé¢ç©ºé—²æ—¶é¢„åŠ è½½
    if ('requestIdleCallback' in window) {
      requestIdleCallback(() => {
        criticalRoutes.forEach(route => route())
      })
    }
  }
  
  // é¢„åŠ è½½èµ„æº
  static preloadResources(urls: string[]) {
    urls.forEach(url => {
      const link = document.createElement('link')
      link.rel = 'prefetch'
      link.href = url
      document.head.appendChild(link)
    })
  }
}
```

## ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–

### 1. è§¦æ‘¸ä¼˜åŒ–

```css
/* ä¼˜åŒ–è§¦æ‘¸å“åº” */
.touch-target {
  min-height: 44px; /* iOS æ¨èçš„æœ€å°è§¦æ‘¸ç›®æ ‡ */
  min-width: 44px;
  touch-action: manipulation; /* ç¦ç”¨åŒå‡»ç¼©æ”¾ */
}

/* æ»šåŠ¨ä¼˜åŒ– */
.scroll-container {
  -webkit-overflow-scrolling: touch; /* iOS å¹³æ»‘æ»šåŠ¨ */
  overscroll-behavior: contain; /* é˜²æ­¢æ»šåŠ¨é“¾ */
}
```

### 2. å“åº”å¼ä¼˜åŒ–

```typescript
// composables/useResponsive.ts
export function useResponsive() {
  const isMobile = ref(false)
  const isTablet = ref(false)
  const isDesktop = ref(false)
  
  const updateDevice = () => {
    const width = window.innerWidth
    isMobile.value = width < 768
    isTablet.value = width >= 768 && width < 1024
    isDesktop.value = width >= 1024
  }
  
  onMounted(() => {
    updateDevice()
    window.addEventListener('resize', throttle(updateDevice, 100))
  })
  
  return {
    isMobile: readonly(isMobile),
    isTablet: readonly(isTablet),
    isDesktop: readonly(isDesktop)
  }
}
```

## ğŸ” æ€§èƒ½ç›‘æ§

### 1. æ€§èƒ½æŒ‡æ ‡æ”¶é›†

```typescript
// utils/performance.ts
export class PerformanceMonitor {
  // æ”¶é›†æ ¸å¿ƒ Web Vitals
  static collectWebVitals() {
    // FCP - First Contentful Paint
    new PerformanceObserver((list) => {
      list.getEntries().forEach((entry) => {
        if (entry.name === 'first-contentful-paint') {
          console.log('FCP:', entry.startTime)
        }
      })
    }).observe({ entryTypes: ['paint'] })
    
    // LCP - Largest Contentful Paint
    new PerformanceObserver((list) => {
      const entries = list.getEntries()
      const lastEntry = entries[entries.length - 1]
      console.log('LCP:', lastEntry.startTime)
    }).observe({ entryTypes: ['largest-contentful-paint'] })
    
    // CLS - Cumulative Layout Shift
    new PerformanceObserver((list) => {
      let clsValue = 0
      list.getEntries().forEach((entry) => {
        if (!entry.hadRecentInput) {
          clsValue += entry.value
        }
      })
      console.log('CLS:', clsValue)
    }).observe({ entryTypes: ['layout-shift'] })
  }
  
  // è·¯ç”±æ€§èƒ½ç›‘æ§
  static monitorRoutePerformance() {
    const router = useRouter()
    
    router.beforeEach((to, from, next) => {
      performance.mark(`route-start-${to.path}`)
      next()
    })
    
    router.afterEach((to) => {
      nextTick(() => {
        performance.mark(`route-end-${to.path}`)
        performance.measure(
          `route-${to.path}`,
          `route-start-${to.path}`,
          `route-end-${to.path}`
        )
      })
    })
  }
}
```

### 2. å†…å­˜æ³„æ¼æ£€æµ‹

```typescript
// utils/memoryMonitor.ts
export class MemoryMonitor {
  private static instance: MemoryMonitor
  private timers: Set<number> = new Set()
  private observers: Set<any> = new Set()
  
  // æ¸…ç†å®šæ—¶å™¨
  addTimer(id: number) {
    this.timers.add(id)
  }
  
  clearTimer(id: number) {
    clearInterval(id)
    this.timers.delete(id)
  }
  
  // æ¸…ç†è§‚å¯Ÿè€…
  addObserver(observer: any) {
    this.observers.add(observer)
  }
  
  removeObserver(observer: any) {
    observer.disconnect?.()
    this.observers.delete(observer)
  }
  
  // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
  cleanup() {
    this.timers.forEach(id => clearInterval(id))
    this.observers.forEach(observer => observer.disconnect?.())
    this.timers.clear()
    this.observers.clear()
  }
}
```

## ğŸ› ï¸ å¼€å‘å·¥å…·ä¼˜åŒ–

### 1. å¼€å‘ç¯å¢ƒé…ç½®

```typescript
// vite.config.ts - å¼€å‘ç¯å¢ƒä¼˜åŒ–
export default defineConfig({
  server: {
    hmr: {
      overlay: false // å‡å°‘å¼€å‘æ—¶çš„å¹²æ‰°
    }
  },
  
  // å¼€å‘æ—¶çš„ä¼˜åŒ–
  define: {
    __DEV__: JSON.stringify(process.env.NODE_ENV === 'development')
  }
})
```

### 2. æ„å»ºåˆ†æ

```bash
# å®‰è£…æ„å»ºåˆ†æå·¥å…·
npm install --save-dev rollup-plugin-visualizer

# åˆ†ææ„å»ºäº§ç‰©
npm run build -- --analyze
```

## ğŸ“ˆ æ€§èƒ½æ£€æŸ¥æ¸…å•

### æ„å»ºä¼˜åŒ–
- [ ] ä»£ç åˆ†å‰²é…ç½®æ­£ç¡®
- [ ] ä¾èµ–é¢„æ„å»ºé…ç½®å®Œæ•´
- [ ] ç”Ÿäº§ç¯å¢ƒå‹ç¼©å¯ç”¨
- [ ] é™æ€èµ„æºä¼˜åŒ–

### ä»£ç ä¼˜åŒ–
- [ ] ç»„ä»¶æ‡’åŠ è½½å®ç°
- [ ] è®¡ç®—å±æ€§æ­£ç¡®ä½¿ç”¨
- [ ] äº‹ä»¶å¤„ç†é˜²æŠ–èŠ‚æµ
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥

### èµ„æºä¼˜åŒ–
- [ ] å›¾ç‰‡æ‡’åŠ è½½å’Œå‹ç¼©
- [ ] å­—ä½“ä¼˜åŒ–
- [ ] CSS å’Œ JS å‹ç¼©
- [ ] ç¼“å­˜ç­–ç•¥å®æ–½

### ç”¨æˆ·ä½“éªŒ
- [ ] é¦–å±åŠ è½½æ—¶é—´ < 2s
- [ ] é¡µé¢åˆ‡æ¢æµç•…
- [ ] ç§»åŠ¨ç«¯ä¼˜åŒ–
- [ ] æ— éšœç¢æ”¯æŒ

## ğŸ¯ æŒç»­ä¼˜åŒ–

### å®šæœŸæ£€æŸ¥
1. **æ¯å‘¨æ€§èƒ½ç›‘æ§**: æ£€æŸ¥å…³é”®æŒ‡æ ‡å˜åŒ–
2. **æ¯æœˆä»£ç å®¡æŸ¥**: è¯†åˆ«æ€§èƒ½é—®é¢˜
3. **å­£åº¦æ¶æ„è¯„ä¼°**: è¯„ä¼°æ˜¯å¦éœ€è¦é‡æ„

### å·¥å…·æ¨è
- **Lighthouse**: ç»¼åˆæ€§èƒ½è¯„ä¼°
- **WebPageTest**: è¯¦ç»†çš„åŠ è½½åˆ†æ
- **Vue DevTools**: Vue åº”ç”¨è°ƒè¯•
- **Chrome DevTools**: æ€§èƒ½åˆ†æ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ  
**ç»´æŠ¤å›¢é˜Ÿ**: å‰ç«¯å¼€å‘ç»„ 