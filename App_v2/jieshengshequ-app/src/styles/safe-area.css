/* 安全区域基础样式 */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

.safe-area-left {
  padding-left: env(safe-area-inset-left);
}

.safe-area-right {
  padding-right: env(safe-area-inset-right);
}

/* 自定义安全区域支持 - 自动检测模式 */
.safe-area-container {
  /* 默认使用系统安全区域 */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

/* 手动配置模式：使用CSS变量控制是否应用系统值 */
.safe-area-container {
  padding-top: calc(
    var(--safe-area-system-top, env(safe-area-inset-top)) + 
    var(--custom-safe-area-top, 0px)
  );
  padding-bottom: calc(
    var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + 
    var(--custom-safe-area-bottom, 0px)
  );
  padding-left: calc(
    var(--safe-area-system-left, env(safe-area-inset-left)) + 
    var(--custom-safe-area-left, 0px)
  );
  padding-right: calc(
    var(--safe-area-system-right, env(safe-area-inset-right)) + 
    var(--custom-safe-area-right, 0px)
  );
}

/* 主内容区域 */
.main-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  /* 确保主内容区域有底部间距，避免被底部导航栏遮挡 */
  padding-bottom: 80px; /* 导航栏高度 + 安全区域 */
}

/* 现代化主内容区域 - 与安全区域配合 */
.modern-main-content {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  /* 确保与安全区域样式兼容 */
  position: relative;
  /* 确保主内容区域有底部间距，避免被底部导航栏遮挡 */
  /* 导航栏高度(64px) + 导航栏底部的安全区域（支持负值，可控制系统值）*/
  padding-bottom: calc(64px + var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px));
}

/* 固定底部导航栏 - 标准版本 */
.fixed-bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 50;
  /* 导航栏位置调整：向上偏移安全区域高度，让安全区域显示在导航栏下方（支持负值，可控制系统值）*/
  bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px));
  /* 移除导航栏内部的底部padding */
  padding-bottom: 0;
}

/* 现代化底部导航栏 - 改进版 */
.modern-bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 50;
  /* 导航栏位置调整：向上偏移安全区域高度，让安全区域显示在导航栏下方（支持负值，可控制系统值）*/
  bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px));
  /* 移除导航栏内部的底部padding */
  padding-bottom: 0;
  /* 设置变换原点为底部，确保移动时以底部为锚点 */
  transform-origin: bottom;
}

/* Android手动模式强制覆盖 */
.android-manual-safe-area .modern-bottom-nav,
.android-manual-safe-area .fixed-bottom-nav {
  /* Android手动模式：强制使用自定义值，完全忽略系统值 */
  bottom: var(--custom-safe-area-bottom, 0px) !important;
}

.android-manual-safe-area .modern-main-content {
  /* Android手动模式：主内容区域强制使用自定义值 */
  padding-bottom: calc(64px + var(--custom-safe-area-bottom, 0px)) !important;
}

.android-manual-safe-area.keyboard-open .modern-main-content,
.android-manual-safe-area.keyboard-open .main-content {
  /* Android手动模式：键盘弹出时强制使用自定义值 */
  padding-bottom: calc(64px + var(--custom-safe-area-bottom, 0px) + var(--keyboard-height, 0px)) !important;
}

.android-manual-safe-area.keyboard-open .modern-bottom-nav,
.android-manual-safe-area.keyboard-open .fixed-bottom-nav {
  /* Android手动模式：键盘弹出时强制使用自定义值 */
  bottom: calc(var(--custom-safe-area-bottom, 0px) + var(--keyboard-height, 0px)) !important;
}

/* 手动配置模式下的底部导航栏 - 移除重复的padding设置 */
.fixed-bottom-nav,
.modern-bottom-nav {
  /* 确保所有底部导航栏都以底部为变换原点 */
  transform-origin: bottom;
  /* 导航栏的位置由bottom属性控制，不再使用padding-bottom */
}

/* App容器 */
.app-container {
  min-height: 100vh;
  min-height: 100dvh; /* 动态视口高度 */
}

/* 现代化App容器 */
.modern-app-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: 100dvh;
  position: relative;
}

/* 预览模式样式 - 改进版 */
.safe-area-preview::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: calc(var(--safe-area-system-top, env(safe-area-inset-top)) + var(--custom-safe-area-top, 0px));
  background: rgba(255, 0, 0, 0.15);
  border-bottom: 2px dashed rgba(255, 0, 0, 0.6);
  z-index: 9999;
  pointer-events: none;
  transition: all 0.3s ease;
}

.safe-area-preview::after {
  content: '';
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px));
  background: rgba(255, 0, 0, 0.15);
  border-top: 2px dashed rgba(255, 0, 0, 0.6);
  z-index: 9999;
  pointer-events: none;
  transition: all 0.3s ease;
}

/* 预览模式指示器 - 移除重复样式，由JS控制 */
.safe-area-indicator {
  /* 样式由JS动态设置 */
}

/* 导航栏适配 - 基于bottom定位（支持手动模式禁用系统值）*/
.nav-none .fixed-bottom-nav,
.nav-none .modern-bottom-nav {
  bottom: var(--custom-safe-area-bottom, 0px);
}

.nav-gesture .fixed-bottom-nav,
.nav-gesture .modern-bottom-nav {
  bottom: max(
    var(--navigation-bar-height, 0px), 
    calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px))
  );
}

.nav-buttons .fixed-bottom-nav,
.nav-buttons .modern-bottom-nav {
  bottom: max(
    var(--navigation-bar-height, 0px), 
    calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px))
  );
}

/* 键盘弹出时的适配 */
.keyboard-open .main-content,
.keyboard-open .modern-main-content {
  /* 确保主内容区域的高度正确计算，考虑键盘高度 */
  height: calc(100vh - var(--keyboard-height, 0px));
  max-height: calc(100vh - var(--keyboard-height, 0px));
  /* 确保可以滚动 */
  overflow-y: auto;
  /* 键盘弹出时，主内容区域的底部padding需要考虑：导航栏高度 + 安全区域 + 键盘高度（支持负值，可控制系统值）*/
  padding-bottom: calc(64px + var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px) + var(--keyboard-height, 0px)) !important;
}

/* 键盘弹出时，调整视口高度 */
.keyboard-open,
.modern-keyboard-open {
  --viewport-height: calc(100vh - var(--keyboard-height, 0px));
}

/* 键盘弹出时的页面容器调整 */
.keyboard-open .app-container,
.modern-keyboard-open .modern-app-container {
  height: 100vh;
  min-height: 100vh;
  max-height: 100vh;
  overflow: hidden; /* 防止整个页面滚动，只让主内容区域滚动 */
}

/* 键盘弹出时，底部导航栏需要上移 - 以底部为锚点 */
.keyboard-open .fixed-bottom-nav,
.modern-keyboard-open .modern-bottom-nav {
  /* 使用bottom定位，在原有安全区域基础上再加上键盘高度（支持负值，可控制系统值）*/
  bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px) + var(--keyboard-height, 0px));
  transition: bottom 0.25s ease-out;
}

/* 输入框聚焦时的样式增强 */
input:focus,
textarea:focus {
  scroll-margin-bottom: 100px; /* 确保有足够的滚动边距 */
}

/* 表单容器的键盘适配 */
.form-container {
  transition: padding-bottom 0.25s ease-out;
}

.keyboard-open .form-container,
.modern-keyboard-open .form-container {
  padding-bottom: var(--keyboard-height, 0px);
}

/* 滚动容器的键盘适配 */
.scroll-container {
  transition: height 0.25s ease-out;
}

.keyboard-open .scroll-container,
.modern-keyboard-open .scroll-container {
  height: calc(100vh - var(--keyboard-height, 0px));
  max-height: calc(100vh - var(--keyboard-height, 0px));
}

/* 平台特定样式 */
.platform-android .safe-area-container {
  /* Android 特定的安全区域处理 */
}

.platform-ios .safe-area-container {
  /* iOS 特定的安全区域处理 */
}

.platform-web .safe-area-container {
  /* Web 平台的安全区域处理 */
}

/* 手动配置模式下的Web平台特定处理 */
.platform-web .safe-area-container {
  /* Web平台通常不需要系统安全区域，但支持自定义配置 */
  padding-top: var(--custom-safe-area-top, 0px);
  padding-bottom: var(--custom-safe-area-bottom, 0px);
  padding-left: var(--custom-safe-area-left, 0px);
  padding-right: var(--custom-safe-area-right, 0px);
}

/* Web平台的底部导航栏 */
.platform-web .fixed-bottom-nav,
.platform-web .modern-bottom-nav {
  bottom: var(--custom-safe-area-bottom, 0px);
}

/* Android 特定的键盘适配 */
.platform-android.keyboard-open,
.platform-android.modern-keyboard-open {
  /* Android 键盘可能有不同的行为 */
}

/* iOS 特定的键盘适配 */
.platform-ios.keyboard-open,
.platform-ios.modern-keyboard-open {
  /* iOS 键盘行为 */
}

/* 调试模式样式 */
.debug-mode .safe-area-container {
  /* outline: 2px dashed rgba(0, 255, 0, 0.3); */
}

.debug-mode .modern-bottom-nav {
  /* 调试模式下显示底部导航栏边界 */
  /* outline: 2px dashed rgba(0, 0, 255, 0.3); */
}

/* 响应式适配 */
@media (orientation: landscape) {
  .safe-area-container {
    padding-left: calc(var(--safe-area-system-left, env(safe-area-inset-left)) + var(--custom-safe-area-left, 0px));
    padding-right: calc(var(--safe-area-system-right, env(safe-area-inset-right)) + var(--custom-safe-area-right, 0px));
  }
  
  /* 横屏时键盘高度通常较小 */
  .keyboard-open .main-content,
  .modern-keyboard-open .modern-main-content {
    height: calc(100vh - var(--keyboard-height, 0px));
  }
  
  /* 横屏时的预览模式左右边距 */
  .safe-area-preview::before,
  .safe-area-preview::after {
    left: calc(var(--safe-area-system-left, env(safe-area-inset-left)) + var(--custom-safe-area-left, 0px));
    right: calc(var(--safe-area-system-right, env(safe-area-inset-right)) + var(--custom-safe-area-right, 0px));
  }
}

/* 深色模式下的预览样式 */
.dark .safe-area-preview::before,
.dark .safe-area-preview::after {
  background: rgba(255, 255, 0, 0.15);
  border-color: rgba(255, 255, 0, 0.6);
}

/* 键盘动画 - 基于bottom定位，考虑安全区域（支持负值，可控制系统值）*/
@keyframes keyboard-show {
  from {
    bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px));
  }
  to {
    bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px) + var(--keyboard-height, 0px));
  }
}

@keyframes keyboard-hide {
  from {
    bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px) + var(--keyboard-height, 0px));
  }
  to {
    bottom: calc(var(--safe-area-system-bottom, env(safe-area-inset-bottom)) + var(--custom-safe-area-bottom, 0px));
  }
}

/* 键盘动画应用 - 优化为基于bottom定位 */
.keyboard-animating-up .fixed-bottom-nav,
.keyboard-animating-up .modern-bottom-nav {
  animation: keyboard-show 0.25s ease-out forwards;
}

.keyboard-animating-down .fixed-bottom-nav,
.keyboard-animating-down .modern-bottom-nav {
  animation: keyboard-hide 0.25s ease-out forwards;
}

/* 安全区域过渡动画 */
.safe-area-container,
.modern-bottom-nav,
.fixed-bottom-nav {
  transition: padding 0.3s ease;
}

/* 预览模式过渡 */
.safe-area-preview::before,
.safe-area-preview::after {
  transition: all 0.3s ease;
} 