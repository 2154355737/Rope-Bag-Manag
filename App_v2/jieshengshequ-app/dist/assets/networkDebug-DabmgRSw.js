var l=Object.defineProperty;var i=(t,o,e)=>o in t?l(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var r=(t,o,e)=>i(t,typeof o!="symbol"?o+"":o,e);class c{static async testConnection(){console.log("🔍 开始网络连接诊断..."),await this.testBasicConnectivity(),await this.testApiServer(),await this.testApiEndpoints(),console.log("✅ 网络连接诊断完成")}static async testBasicConnectivity(){console.log("📡 测试基础网络连接...");try{const o=await fetch("https://www.baidu.com",{method:"HEAD",mode:"no-cors",cache:"no-cache"});console.log("✅ 互联网连接正常")}catch(o){console.error("❌ 互联网连接失败:",o)}}static async testApiServer(){console.log("🔌 测试API服务器连接...");try{const e=await fetch("http://39.105.113.219:15201",{method:"HEAD",mode:"cors",cache:"no-cache",headers:{Accept:"application/json"}});console.log(`✅ 服务器响应: ${e.status} ${e.statusText}`),console.log("📋 响应头:",Object.fromEntries(e.headers.entries()))}catch(o){console.error("❌ 服务器连接失败:",o),o instanceof TypeError&&o.message.includes("fetch")&&(console.error("🚨 可能的原因:"),console.error("   1. 服务器未启动或不可访问"),console.error("   2. 网络防火墙阻止了连接"),console.error("   3. CORS配置问题"),console.error("   4. Android网络安全策略限制"))}}static async testApiEndpoints(){console.log("🎯 测试API端点...");const o=["/health","/categories","/posts"];for(const e of o)try{const s=`${this.apiBase}${e}`;console.log(`📍 测试端点: ${s}`);const n=await fetch(s,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},cache:"no-cache"});if(console.log(`✅ ${e}: ${n.status} ${n.statusText}`),n.ok){const a=await n.text();console.log(`📦 ${e} 响应长度: ${a.length} 字符`)}}catch(s){console.error(`❌ ${e} 失败:`,s)}}static getNetworkInfo(){console.log("📱 设备网络信息:"),console.log("   User Agent:",navigator.userAgent),console.log("   Platform:",navigator.platform),console.log("   Online:",navigator.onLine),window.Capacitor?(console.log("📱 Capacitor环境:",window.Capacitor.getPlatform()),console.log("📱 原生平台:",window.Capacitor.isNativePlatform())):console.log("🌐 Web环境")}static async testCORS(){console.log("🔒 测试CORS配置...");try{const o=await fetch(`${this.apiBase}/health`,{method:"OPTIONS",headers:{Origin:window.location.origin,"Access-Control-Request-Method":"GET","Access-Control-Request-Headers":"Content-Type, Authorization"}});console.log("✅ CORS预检成功:",o.status),console.log("📋 CORS头:",{"Access-Control-Allow-Origin":o.headers.get("Access-Control-Allow-Origin"),"Access-Control-Allow-Methods":o.headers.get("Access-Control-Allow-Methods"),"Access-Control-Allow-Headers":o.headers.get("Access-Control-Allow-Headers")})}catch(o){console.error("❌ CORS预检失败:",o)}}}r(c,"apiBase","http://39.105.113.219:15201/api/v1");typeof window<"u"&&setTimeout(()=>{c.getNetworkInfo(),c.testConnection(),c.testCORS()},2e3);export{c as NetworkDebugger};
