# ç»³åŒ…ç®¡ç†å™¨åç«¯å¯¹æ¥è¯´æ˜

## ğŸ“‹ å¯¹æ¥æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°†Vue_treeç®¡ç†åå°æ¨¡æ¿ä¸ç»³åŒ…ç®¡ç†å™¨åç«¯è¿›è¡Œå¯¹æ¥ï¼Œå®ç°ç»Ÿä¸€çš„ç™»å½•è®¤è¯å’Œç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ”§ å·²å®Œæˆçš„é…ç½®ä¿®æ”¹

### 1. Viteä»£ç†é…ç½®

**æ–‡ä»¶**: `vite.config.ts`

å·²ä¿®æ”¹å¼€å‘æœåŠ¡å™¨é…ç½®ï¼Œæ·»åŠ äº†å¯¹ç»³åŒ…ç®¡ç†å™¨åç«¯çš„ä»£ç†ï¼š

```typescript
server: {
  proxy: {
    // APIä»£ç† - åŒ¹é… /api å¼€å¤´çš„æ‰€æœ‰è¯·æ±‚
    '/api': {
      target: 'http://127.0.0.1:15201',
      changeOrigin: true,
      rewrite: (path) => path
    },
    // æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ä»£ç† - åŒ¹é… /uploads å¼€å¤´çš„æ‰€æœ‰è¯·æ±‚
    '/uploads': {
      target: 'http://127.0.0.1:15201',
      changeOrigin: true,
      rewrite: (path) => path
    }
  }
}
```

### 2. APIè·¯å¾„æ›´æ–°

**æ–‡ä»¶**: `src/api/sys/user.ts`

æ›´æ–°äº†APIè·¯å¾„ä»¥åŒ¹é…ç»³åŒ…ç®¡ç†å™¨åç«¯ï¼š

```typescript
enum Api {
  Login = '/api/v1/auth/login',        // ç™»å½•æ¥å£
  Logout = '/api/v1/auth/logout',      // é€€å‡ºæ¥å£
  GetUserInfo = '/api/v1/auth/user-info', // è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£
}
```

### 3. ç”¨æˆ·æ•°æ®æ¨¡å‹é€‚é…

**æ–‡ä»¶**: `src/api/sys/model/userModel.ts`

æ‰©å±•äº†ç”¨æˆ·æ¨¡å‹ä»¥å…¼å®¹ç»³åŒ…ç®¡ç†å™¨çš„æ•°æ®ç»“æ„ï¼š

```typescript
export interface LoginResultModel {
  userId: string | number
  token: string
  role: RoleInfo
  user?: {
    id: number
    username: string
    email: string
    nickname?: string
    role: string
    star: number
    ban_status: string
    created_at: string
    updated_at: string
  }
}
```

### 4. ç”¨æˆ·Storeé€‚é…

**æ–‡ä»¶**: `src/store/modules/user.ts`

ä¿®æ”¹äº†ç™»å½•å’Œè·å–ç”¨æˆ·ä¿¡æ¯çš„é€»è¾‘ï¼Œä»¥å¤„ç†ç»³åŒ…ç®¡ç†å™¨åç«¯çš„å“åº”æ ¼å¼ï¼š

- ç™»å½•å“åº”æ ¼å¼ï¼š`{ code: 0, message: "ç™»å½•æˆåŠŸ", data: { token, user } }`
- ç”¨æˆ·ä¿¡æ¯å“åº”æ ¼å¼ï¼š`{ code: 0, message: "success", data: { ç”¨æˆ·ä¿¡æ¯ } }`

### 5. HTTPå“åº”å¤„ç†

**æ–‡ä»¶**: `src/utils/http/axios/index.ts`

ä¿®æ”¹äº†HTTPå“åº”å¤„ç†é€»è¾‘ï¼Œå…¼å®¹ç»³åŒ…ç®¡ç†å™¨çš„å“åº”æ ¼å¼ï¼š

```typescript
// å…¼å®¹ç»³åŒ…ç®¡ç†å™¨åç«¯çš„å“åº”æ ¼å¼ (code: 0 è¡¨ç¤ºæˆåŠŸ)
const hasSuccess = data && Reflect.has(data, 'code') && (code === ResultEnum.SUCCESS || code === 0)
if (hasSuccess) {
  // ç»³åŒ…ç®¡ç†å™¨åç«¯ä½¿ç”¨ data å­—æ®µï¼ŒåŸæ¨¡æ¿ä½¿ç”¨ result å­—æ®µ
  return data.data || result || data
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨ç»³åŒ…ç®¡ç†å™¨åç«¯

```bash
cd rope-manager-backend
cargo run
```

ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://127.0.0.1:15201`

### 2. å¯åŠ¨Vue_treeå‰ç«¯

```bash
cd Vue_tree
npm install  # é¦–æ¬¡è¿è¡Œéœ€è¦å®‰è£…ä¾èµ–
npm run dev
```

### 3. ç™»å½•æµ‹è¯•

1. è®¿é—®å‰ç«¯åœ°å€ï¼ˆé€šå¸¸æ˜¯ `http://localhost:3100`ï¼‰
2. ä½¿ç”¨ç»³åŒ…ç®¡ç†å™¨çš„ç”¨æˆ·è´¦å·ç™»å½•
3. ç³»ç»Ÿå°†è‡ªåŠ¨å¤„ç†è®¤è¯å’Œç”¨æˆ·ä¿¡æ¯è·å–

## ğŸ” è®¤è¯æµç¨‹

### ç™»å½•æµç¨‹
1. ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. å‰ç«¯è°ƒç”¨ `/api/v1/auth/login` æ¥å£
3. åç«¯éªŒè¯ç”¨æˆ·å‡­æ®ï¼Œè¿”å›JWT tokenå’Œç”¨æˆ·ä¿¡æ¯
4. å‰ç«¯ä¿å­˜tokenåˆ°localStorageå’ŒCookie
5. è‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°ä¸»é¡µ

### æƒé™å¤„ç†
- ç»³åŒ…ç®¡ç†å™¨æ”¯æŒçš„è§’è‰²ï¼š`admin`ã€`elder`ã€`moderator`ã€`user`
- å‰ç«¯ä¼šæ ¹æ®ç”¨æˆ·è§’è‰²è‡ªåŠ¨è®¾ç½®æƒé™å’Œèœå•æ˜¾ç¤º

## ğŸ“Š æ•°æ®æ˜ å°„

### ç»³åŒ…ç®¡ç†å™¨ç”¨æˆ· â†’ Vue_treeç”¨æˆ·æ¨¡å‹

| ç»³åŒ…ç®¡ç†å™¨å­—æ®µ | Vue_treeå­—æ®µ | è¯´æ˜ |
|-------------|-------------|------|
| id | userId | ç”¨æˆ·ID |
| username | username | ç”¨æˆ·å |
| nickname | realName | æ˜¾ç¤ºåç§° |
| email | - | é‚®ç®±åœ°å€ |
| role | roles | ç”¨æˆ·è§’è‰² |
| star | - | ç”¨æˆ·æ˜Ÿçº§ |
| ban_status | - | å°ç¦çŠ¶æ€ |

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CORSé”™è¯¯**
   - ç¡®ä¿ç»³åŒ…ç®¡ç†å™¨åç«¯å·²é…ç½®å…è®¸å‰ç«¯åŸŸåçš„CORS
   - æ£€æŸ¥ `config.toml` ä¸­çš„CORSè®¾ç½®

2. **ç™»å½•å¤±è´¥**
   - æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - æŸ¥çœ‹æµè§ˆå™¨ç½‘ç»œé¢æ¿ç¡®è®¤APIè°ƒç”¨
   - æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®

3. **ä»£ç†ä¸ç”Ÿæ•ˆ**
   - ç¡®ä¿åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œ
   - æ£€æŸ¥vite.config.tsä¸­çš„ä»£ç†é…ç½®
   - é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹ç½‘ç»œè¯·æ±‚**
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
   console.log('APIè¯·æ±‚:', response)
   ```

2. **æŸ¥çœ‹ç”¨æˆ·çŠ¶æ€**
   ```javascript
   // åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ç”¨æˆ·çŠ¶æ€
   console.log('ç”¨æˆ·ä¿¡æ¯:', userStore.getUserInfo)
   console.log('Token:', userStore.getToken)
   ```

## ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ ç”¨æˆ·ç®¡ç†é¡µé¢å¯¹æ¥
- [ ] æ·»åŠ èµ„æºåŒ…ç®¡ç†é¡µé¢å¯¹æ¥  
- [ ] æ·»åŠ ç³»ç»Ÿè®¾ç½®é¡µé¢å¯¹æ¥
- [ ] æ·»åŠ æ•°æ®ç»Ÿè®¡å›¾è¡¨å¯¹æ¥

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åç«¯æ—¥å¿—ï¼š`rope-manager-backend/logs/`
2. å‰ç«¯æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
3. ç½‘ç»œè¯·æ±‚å“åº”çŠ¶æ€

---

**å¯¹æ¥å®Œæˆæ—¥æœŸ**: 2024å¹´1æœˆ27æ—¥  
**ç»´æŠ¤è€…**: AIåŠ©æ‰‹ 