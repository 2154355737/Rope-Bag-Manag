# ç»³åŒ…ç®¡ç†å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ä¸åŒç¯å¢ƒä¸­éƒ¨ç½²ç»³åŒ…ç®¡ç†å™¨ç³»ç»Ÿã€‚ç³»ç»Ÿæ”¯æŒå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ï¼Œæä¾›äº†å¤šç§éƒ¨ç½²æ–¹å¼ä»¥æ»¡è¶³ä¸åŒéœ€æ±‚ã€‚

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

### æ ‡å‡†éƒ¨ç½²æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Nginx åå‘ä»£ç†â”‚    â”‚   Vue å‰ç«¯åº”ç”¨   â”‚    â”‚   Rust åç«¯æœåŠ¡  â”‚
â”‚   (ç«¯å£: 80)    â”‚â”€â”€â”€â”€â”‚  (é™æ€æ–‡ä»¶)      â”‚â”€â”€â”€â”€â”‚  (ç«¯å£: 15201)   â”‚
â”‚                 â”‚    â”‚                 â”‚      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â”‚                       â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   é™æ€èµ„æºæ–‡ä»¶    â”‚    â”‚   SQLite æ•°æ®åº“  â”‚
                         â”‚   (html/)        â”‚    â”‚   (data.db)     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### âš¡ ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒçš„å¿«é€Ÿéƒ¨ç½²ï¼š

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <é¡¹ç›®åœ°å€>
cd ç»³åŒ…ç®¡ç†å™¨

# 2. ä¸€é”®å¯åŠ¨å…¨æ ˆæœåŠ¡
start_fullstack.bat

# 3. è®¿é—®åº”ç”¨
# å¼€å‘ç¯å¢ƒ: http://localhost:5173
# ç”Ÿäº§ç¯å¢ƒ: http://localhost
```

### ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²

å¦‚éœ€æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥æ‰‹åŠ¨éƒ¨ç½²å„ä¸ªç»„ä»¶ï¼š

#### æ­¥éª¤ 1: åç«¯éƒ¨ç½²
```bash
cd rope-manager-backend

# ç¼–è¯‘é¡¹ç›®
cargo build --release

# é…ç½®ç¯å¢ƒ
copy config.example.toml config.toml
# ç¼–è¾‘ config.toml è®¾ç½®æ•°æ®åº“ã€é‚®ä»¶ç­‰é…ç½®

# å¯åŠ¨æœåŠ¡
target/release/rope-manager-backend
# æˆ–å¼€å‘æ¨¡å¼: cargo run
```

#### æ­¥éª¤ 2: å‰ç«¯æ„å»º
```bash
cd Rust_Vue

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
# è¾“å‡ºåˆ° dist/ ç›®å½•
```

#### æ­¥éª¤ 3: Nginxéƒ¨ç½²
```bash
cd nginx-1.28.0

# éƒ¨ç½²å‰ç«¯æ–‡ä»¶
deploy_frontend.bat

# å¯åŠ¨nginx
nginx_manager.bat start
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ

#### åç«¯é…ç½® (config.toml)
```toml
[server]
host = "127.0.0.1"
port = 15201
database_url = "data.db"

[auth]
jwt_secret = "dev-secret-key-change-in-production"
jwt_expiration = 86400

[mail]
smtp_enabled = false
smtp_server = "smtp.example.com"
smtp_port = 587
smtp_username = ""
smtp_password = ""
```

#### å‰ç«¯é…ç½® (.env.development)
```bash
VITE_API_BASE_URL=/api
VITE_APP_TITLE=ç»³åŒ…ç®¡ç†å™¨ - å¼€å‘ç¯å¢ƒ
VITE_DEBUG_API=true
```

### ç”Ÿäº§ç¯å¢ƒ

#### åç«¯é…ç½® (config.toml)
```toml
[server]
host = "127.0.0.1"
port = 15201
database_url = "data.db"

[auth]
jwt_secret = "super-secure-production-secret-key"
jwt_expiration = 86400

[mail]
smtp_enabled = true
smtp_server = "smtp.your-domain.com"
smtp_port = 587
smtp_username = "noreply@your-domain.com"
smtp_password = "your-smtp-password"
smtp_from = "ç»³åŒ…ç®¡ç†å™¨ <noreply@your-domain.com>"

[logging]
level = "info"
file = "logs/app.log"

[security]
cors_origins = ["http://your-domain.com"]
max_file_size = 104857600  # 100MB
```

#### å‰ç«¯é…ç½® (.env.production)
```bash
VITE_API_BASE_URL=/api
VITE_APP_TITLE=ç»³åŒ…ç®¡ç†å™¨
VITE_DEBUG_API=false
```

#### Nginxé…ç½®ä¼˜åŒ–
```nginx
# nginx.conf
worker_processes auto;

events {
    worker_connections 1024;
    multi_accept on;
}

http {
    # åŸºç¡€é…ç½®
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    
    # å®‰å…¨é…ç½®
    server_tokens off;
    client_max_body_size 100M;
    
    server {
        listen 80;
        server_name your-domain.com;
        
        # å®‰å…¨å¤´
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
        
        # é™æ€æ–‡ä»¶
        location / {
            root html;
            index index.html;
            try_files $uri $uri/ /index.html;
            
            # ç¼“å­˜é…ç½®
            location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
                expires 1y;
                add_header Cache-Control "public, immutable";
            }
        }
        
        # APIä»£ç†
        location /api/ {
            proxy_pass http://127.0.0.1:15201;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # è¶…æ—¶é…ç½®
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
        }
        
        # æ–‡ä»¶ä¸Šä¼ 
        location /uploads/ {
            proxy_pass http://127.0.0.1:15201;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            
            # æ–‡ä»¶ä¼ è¾“ä¼˜åŒ–
            proxy_request_buffering off;
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }
        
        # å¥åº·æ£€æŸ¥
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾ç½®

### åˆå§‹åŒ–æ•°æ®åº“

```bash
# ä½¿ç”¨æä¾›çš„åˆå§‹åŒ–è„šæœ¬
cd rope-manager-backend
sqlite3 data.db < ../complete_database_init.sql

# æˆ–è€…å¯åŠ¨åº”ç”¨è‡ªåŠ¨åˆå§‹åŒ–
cargo run
```

### æ•°æ®åº“å¤‡ä»½

```bash
# æ‰‹åŠ¨å¤‡ä»½
cp data.db "backup/data_$(date +%Y%m%d_%H%M%S).db"

# ä½¿ç”¨å†…ç½®å¤‡ä»½åŠŸèƒ½
curl -X POST http://127.0.0.1:15201/api/v1/admin/backup \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"backup_type":"manual","description":"æ‰‹åŠ¨å¤‡ä»½"}'
```

### æ•°æ®è¿ç§»

```bash
# æ£€æŸ¥æ•°æ®åº“ç»“æ„
cargo run --bin check_db_schema

# æ‰§è¡Œè¿ç§»è„šæœ¬
sqlite3 data.db < sql/migrate_xxx.sql
```

## ğŸ”’ å®‰å…¨é…ç½®

### SSL/HTTPSé…ç½®

#### 1. è·å–SSLè¯ä¹¦

**ä½¿ç”¨Let's Encrypt (æ¨è):**
```bash
# å®‰è£…certbot
# Windows: ä¸‹è½½certbot-auto
# Linux: apt-get install certbot

# è·å–è¯ä¹¦
certbot certonly --standalone -d your-domain.com
```

**è‡ªç­¾åè¯ä¹¦ (æµ‹è¯•ç”¨):**
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout nginx.key -out nginx.crt
```

#### 2. Nginx SSLé…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    # å…¶ä»–é…ç½®...
}
```

### é˜²ç«å¢™é…ç½®

```bash
# Windowsé˜²ç«å¢™
netsh advfirewall firewall add rule name="Rope Manager Backend" dir=in action=allow protocol=TCP localport=15201
netsh advfirewall firewall add rule name="Nginx HTTP" dir=in action=allow protocol=TCP localport=80
netsh advfirewall firewall add rule name="Nginx HTTPS" dir=in action=allow protocol=TCP localport=443

# Linux iptables
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
iptables -A INPUT -p tcp --dport 15201 -s 127.0.0.1 -j ACCEPT
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–

#### 1. ç¼–è¯‘ä¼˜åŒ–
```toml
# Cargo.toml
[profile.release]
lto = true
codegen-units = 1
panic = 'abort'
```

#### 2. æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_packages_category ON packages(category);
CREATE INDEX idx_packages_status ON packages(status);
CREATE INDEX idx_comments_package_id ON comments(package_id);
CREATE INDEX idx_user_actions_user_id ON user_actions(user_id);

-- å®šæœŸç»´æŠ¤
VACUUM;
REINDEX;
```

#### 3. å†…å­˜é…ç½®
```toml
# config.toml
[performance]
max_connections = 100
worker_threads = 4
keep_alive_timeout = 30
```

### å‰ç«¯ä¼˜åŒ–

#### 1. æ„å»ºä¼˜åŒ–
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus'],
          'echarts': ['echarts', 'vue-echarts'],
          'utils': ['axios', 'lucide-vue-next']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  }
})
```

#### 2. CDNé…ç½®
```html
<!-- ä½¿ç”¨CDNåŠ é€Ÿ -->
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="preconnect" href="//cdn.jsdelivr.net">
```

### Nginxä¼˜åŒ–

```nginx
# å·¥ä½œè¿›ç¨‹ä¼˜åŒ–
worker_processes auto;
worker_connections 2048;

# ç¼“å­˜é…ç½®
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=1g inactive=60m;

location /api/ {
    proxy_cache api_cache;
    proxy_cache_valid 200 10m;
    proxy_cache_key $scheme$request_method$host$request_uri;
}

# é™æ€æ–‡ä»¶ç¼“å­˜
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    gzip_static on;
}
```

## ğŸ³ Dockeréƒ¨ç½²

### Docker Composeé…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build:
      context: ./rope-manager-backend
      dockerfile: Dockerfile
    ports:
      - "15201:15201"
    volumes:
      - ./data:/app/data
      - ./uploads:/app/uploads
      - ./logs:/app/logs
    environment:
      - RUST_LOG=info
    restart: unless-stopped

  frontend:
    build:
      context: ./Rust_Vue
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./certs:/etc/nginx/certs
    depends_on:
      - backend
    restart: unless-stopped
```

### Dockerfileç¤ºä¾‹

#### åç«¯Dockerfile
```dockerfile
# rope-manager-backend/Dockerfile
FROM rust:1.70-slim as builder

WORKDIR /app
COPY . .
RUN cargo build --release

FROM debian:bullseye-slim
RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY --from=builder /app/target/release/rope-manager-backend /usr/local/bin/
COPY --from=builder /app/config.toml .

EXPOSE 15201
CMD ["rope-manager-backend"]
```

#### å‰ç«¯Dockerfile
```dockerfile
# Rust_Vue/Dockerfile
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### ç³»ç»Ÿç›‘æ§

#### 1. æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f rope-manager-backend/logs/app.log
tail -f nginx-1.28.0/logs/access.log
tail -f nginx-1.28.0/logs/error.log

# æ—¥å¿—è½®è½¬é…ç½®
# /etc/logrotate.d/rope-manager
/path/to/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
}
```

#### 2. æ€§èƒ½ç›‘æ§
```bash
# ç³»ç»Ÿèµ„æºç›‘æ§
htop
iotop
netstat -tlnp

# åº”ç”¨ç›‘æ§
ps aux | grep rope-manager
ps aux | grep nginx
```

#### 3. å¥åº·æ£€æŸ¥
```bash
# APIå¥åº·æ£€æŸ¥
curl http://localhost/health
curl http://127.0.0.1:15201/api/health

# æ•°æ®åº“æ£€æŸ¥
sqlite3 data.db ".schema"
```

### å®šæœŸç»´æŠ¤

#### 1. æ•°æ®åº“ç»´æŠ¤
```bash
# æ¯å‘¨æ‰§è¡Œæ•°æ®åº“ä¼˜åŒ–
sqlite3 data.db "VACUUM; REINDEX;"

# æ¸…ç†è¿‡æœŸæ•°æ®
sqlite3 data.db "DELETE FROM user_actions WHERE created_at < datetime('now', '-30 days');"
```

#### 2. æ—¥å¿—æ¸…ç†
```bash
# æ¸…ç†æ—§æ—¥å¿—
find logs/ -name "*.log" -mtime +30 -delete

# æ¸…ç†nginxæ—¥å¿—
nginx_manager.bat logs clean
```

#### 3. å¤‡ä»½è®¡åˆ’
```bash
# æ¯æ—¥å¤‡ä»½è„šæœ¬
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
cp data.db "backups/data_${DATE}.db"
find backups/ -name "*.db" -mtime +7 -delete
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | find "15201"
netstat -ano | find ":80"

# è§£å†³æ–¹æ³•
# - å…³é—­å ç”¨ç«¯å£çš„ç¨‹åº
# - ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£å·
```

#### 2. æƒé™é—®é¢˜
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la data.db
ls -la uploads/

# ä¿®å¤æƒé™
chmod 644 data.db
chmod -R 755 uploads/
```

#### 3. å†…å­˜ä¸è¶³
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
ps aux --sort=-%mem | head

# ä¼˜åŒ–é…ç½®
# å‡å°‘worker_connections
# å¯ç”¨swap
```

#### 4. æ•°æ®åº“é”å®š
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
lsof data.db

# è§£å†³æ–¹æ³•
# é‡å¯åº”ç”¨
# æ£€æŸ¥é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
```

### è°ƒè¯•æŠ€å·§

#### 1. å¼€å¯è¯¦ç»†æ—¥å¿—
```bash
# åç«¯è¯¦ç»†æ—¥å¿—
RUST_LOG=debug cargo run

# Nginxè°ƒè¯•
nginx -t  # æµ‹è¯•é…ç½®
nginx -s reload  # é‡è½½é…ç½®
```

#### 2. APIæµ‹è¯•
```bash
# æµ‹è¯•APIè¿é€šæ€§
curl -v http://127.0.0.1:15201/api/health

# æµ‹è¯•è®¤è¯
curl -X POST http://127.0.0.1:15201/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©

1. **æŸ¥çœ‹æ—¥å¿—**: é¦–å…ˆæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶
2. **è¿è¡Œè¯Šæ–­**: ä½¿ç”¨æä¾›çš„ç®¡ç†è„šæœ¬è¿›è¡Œè¯Šæ–­
3. **æŸ¥é˜…æ–‡æ¡£**: å‚è€ƒå¼€å‘æ–‡æ¡£å’ŒAPIæ–‡æ¡£
4. **ç¤¾åŒºæ”¯æŒ**: åœ¨é¡¹ç›®ä»“åº“æäº¤Issue

### è”ç³»æ–¹å¼

- **é¡¹ç›®ä»“åº“**: [GitHubé“¾æ¥]
- **æŠ€æœ¯æ–‡æ¡£**: [æ–‡æ¡£é“¾æ¥]
- **é‚®ä»¶æ”¯æŒ**: support@your-domain.com

---

**éƒ¨ç½²æŒ‡å—ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ20æ—¥  
**ç»´æŠ¤è€…**: ç»³åŒ…ç®¡ç†å™¨å¼€å‘å›¢é˜Ÿ 