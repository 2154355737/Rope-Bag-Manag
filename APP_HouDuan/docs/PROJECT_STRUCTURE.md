# ç»³åŒ…ç®¡ç†å™¨åç«¯é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ æ•´ç†åçš„ç›®å½•ç»“æ„

```
rope-manager-backend/
â”œâ”€â”€ ğŸ“ src/                        # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ api/                       # APIè·¯ç”±
â”‚   â”œâ”€â”€ middleware/                # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ repositories/              # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ main.rs                    # ç¨‹åºå…¥å£
â”‚
â”œâ”€â”€ ğŸ“ tools/                      # å·¥å…·è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ database/              # æ•°æ®åº“ç›¸å…³å·¥å…·
â”‚   â”‚   â”œâ”€â”€ check_db_schema.rs    # æ•°æ®åº“æ¶æ„æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ check_db_structure.rs # æ•°æ®åº“ç»“æ„æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ patch_database.rs     # æ•°æ®åº“è¡¥ä¸å·¥å…·
â”‚   â”‚   â”œâ”€â”€ migrate_db.rs         # æ•°æ®åº“è¿ç§»å·¥å…·
â”‚   â”‚   â”œâ”€â”€ fix_*.rs              # å„ç§ä¿®å¤å·¥å…·
â”‚   â”‚   â””â”€â”€ init_security_tables.rs # å®‰å…¨è¡¨åˆå§‹åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ admin/                 # ç®¡ç†å‘˜å·¥å…·
â”‚   â”‚   â”œâ”€â”€ generate_admin_password.rs # ç”Ÿæˆç®¡ç†å‘˜å¯†ç 
â”‚   â”‚   â”œâ”€â”€ verify_password.rs    # å¯†ç éªŒè¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ check_user_actions.rs # ç”¨æˆ·è¡Œä¸ºæ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ debug_user_actions.rs # ç”¨æˆ·è¡Œä¸ºè°ƒè¯•
â”‚   â”‚   â””â”€â”€ update_tag_counts.rs  # æ›´æ–°æ ‡ç­¾è®¡æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ test/                  # æµ‹è¯•å·¥å…·
â”‚   â”‚   â”œâ”€â”€ test_*.rs            # å„ç§åŠŸèƒ½æµ‹è¯•è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ simple_test.rs       # ç®€å•æµ‹è¯•
â”‚   â”‚   â””â”€â”€ smtp_test_tool.rs    # é‚®ä»¶æµ‹è¯•å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ tags/                  # æ ‡ç­¾ç®¡ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ check_english_tags.py # æ£€æŸ¥è‹±æ–‡æ ‡ç­¾
â”‚   â”‚   â””â”€â”€ complete_replace_tags.py # æ ‡ç­¾æ›¿æ¢å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ scripts/               # éƒ¨ç½²å’Œå¯åŠ¨è„šæœ¬
â”‚       â”œâ”€â”€ start.bat            # æ™®é€šå¯åŠ¨
â”‚       â”œâ”€â”€ start_release.bat    # å‘å¸ƒç‰ˆå¯åŠ¨
â”‚       â”œâ”€â”€ start_with_logs.bat  # å¸¦æ—¥å¿—å¯åŠ¨
â”‚       â”œâ”€â”€ start_with_security.bat # å¸¦å®‰å…¨æ£€æŸ¥å¯åŠ¨
â”‚       â”œâ”€â”€ patch_database.bat   # æ•°æ®åº“è¡¥ä¸è„šæœ¬
â”‚       â”œâ”€â”€ run_publish_migration.bat # å‘å¸ƒè¿ç§»è„šæœ¬
â”‚       â”œâ”€â”€ è‡ªåŠ¨éƒ¨ç½².bat        # è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
â”‚       â””â”€â”€ test_logs.sh         # æ—¥å¿—æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“ sql/                       # æ•°æ®åº“è„šæœ¬ï¼ˆé‡æ–°ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ ğŸ“ init/                 # åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ create_missing_tables.sql # åˆ›å»ºç¼ºå¤±è¡¨
â”‚   â”‚   â”œâ”€â”€ create_security_tables.sql # åˆ›å»ºå®‰å…¨è¡¨
â”‚   â”‚   â””â”€â”€ create_view_tracking_tables.sql # åˆ›å»ºè§†å›¾è·Ÿè¸ªè¡¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ migrations/           # è¿ç§»è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ apply_migration.sql  # åº”ç”¨è¿ç§»
â”‚   â”‚   â”œâ”€â”€ migrate_*.sql        # å„ç§è¿ç§»è„šæœ¬
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ patches/              # è¡¥ä¸ä¿®å¤è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ check_and_fix_db.sql # æ£€æŸ¥å’Œä¿®å¤æ•°æ®åº“
â”‚   â”‚   â”œâ”€â”€ fix_packages_table.sql # ä¿®å¤åŒ…è¡¨
â”‚   â”‚   â”œâ”€â”€ fix_user_actions_table.sql # ä¿®å¤ç”¨æˆ·è¡Œä¸ºè¡¨
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ test/                 # æµ‹è¯•æ•°æ®è„šæœ¬
â”‚       â”œâ”€â”€ create_sample_data.sql # åˆ›å»ºç¤ºä¾‹æ•°æ®
â”‚       â”œâ”€â”€ create_test_posts.sql # åˆ›å»ºæµ‹è¯•å¸–å­
â”‚       â”œâ”€â”€ add_admin_test_data.sql # æ·»åŠ ç®¡ç†å‘˜æµ‹è¯•æ•°æ®
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ docs/                      # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ DATABASE_PATCH_README.md # æ•°æ®åº“è¡¥ä¸è¯´æ˜
â”‚   â”œâ”€â”€ README_DOWNLOAD_SECURITY.md # ä¸‹è½½å®‰å…¨è¯´æ˜
â”‚   â”œâ”€â”€ README_EMAIL_SETUP.md    # é‚®ä»¶è®¾ç½®è¯´æ˜
â”‚   â”œâ”€â”€ LOGGING_GUIDE.md         # æ—¥å¿—æŒ‡å—
â”‚   â”œâ”€â”€ IPå°ç¦ç³»ç»Ÿå®ç°æ€»ç»“.md   # IPå°ç¦ç³»ç»Ÿæ–‡æ¡£
â”‚   â”œâ”€â”€ åŠŸèƒ½æ›´æ–°æ€»ç»“.md         # åŠŸèƒ½æ›´æ–°æ–‡æ¡£
â”‚   â””â”€â”€ ...ï¼ˆå…¶ä»–åŠŸèƒ½æ€»ç»“æ–‡æ¡£ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ data/                      # æ•°æ®æ–‡ä»¶
â”œâ”€â”€ ğŸ“ logs/                      # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ ğŸ“ backups/                   # å¤‡ä»½æ–‡ä»¶
â”œâ”€â”€ ğŸ“ uploads/                   # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ ğŸ“ sqlite-tools/              # SQLiteå·¥å…·
â”œâ”€â”€ ğŸ“ fq/                        # ç‰¹æ®Šæ•°æ®ç›®å½•
â”œâ”€â”€ ğŸ“ temp/                      # ä¸´æ—¶æ–‡ä»¶
â”œâ”€â”€ ğŸ“ target/                    # Rustç¼–è¯‘è¾“å‡º
â”œâ”€â”€ ğŸ“ target2/                   # å¤‡ç”¨ç¼–è¯‘è¾“å‡º
â”‚
â”œâ”€â”€ ğŸ“„ Cargo.toml                 # Rusté¡¹ç›®é…ç½®
â”œâ”€â”€ ğŸ“„ config.toml                # è¿è¡Œæ—¶é…ç½®
â”œâ”€â”€ ğŸ“„ openapi.yaml              # APIæ–‡æ¡£
â”œâ”€â”€ ğŸ“„ data.db                   # ä¸»æ•°æ®åº“
â”œâ”€â”€ ğŸ“„ data.db.backup            # æ•°æ®åº“å¤‡ä»½
â”œâ”€â”€ ğŸ“„ headers.json              # è¯·æ±‚å¤´é…ç½®
â””â”€â”€ ğŸ“„ PROJECT_STRUCTURE.md      # æœ¬æ–‡æ¡£
```

## ğŸ¯ å·¥å…·ä½¿ç”¨è¯´æ˜

### æ•°æ®åº“å·¥å…· (`tools/database/`)
- **æ£€æŸ¥ç±»**: `check_db_*.rs` - ç”¨äºæ£€æŸ¥æ•°æ®åº“çŠ¶æ€
- **ä¿®å¤ç±»**: `fix_*.rs` - ç”¨äºä¿®å¤æ•°æ®åº“é—®é¢˜
- **è¿ç§»ç±»**: `migrate_db.rs`, `patch_database.rs` - ç”¨äºæ•°æ®åº“è¿ç§»å’Œè¡¥ä¸

### ç®¡ç†å‘˜å·¥å…· (`tools/admin/`)
- **å¯†ç ç®¡ç†**: `generate_admin_password.rs`, `verify_password.rs`
- **ç”¨æˆ·ç®¡ç†**: `check_user_actions.rs`, `debug_user_actions.rs`
- **ç³»ç»Ÿç»´æŠ¤**: `update_tag_counts.rs`

### æµ‹è¯•å·¥å…· (`tools/test/`)
- **åŠŸèƒ½æµ‹è¯•**: `test_*.rs` - å„ç§åŠŸèƒ½æ¨¡å—çš„æµ‹è¯•
- **è¿æ¥æµ‹è¯•**: `test_alist_connection.rs`, `test_163_mail.rs`
- **APIæµ‹è¯•**: `test_api_endpoints.rs`, `test_auth.rs`

### å¯åŠ¨è„šæœ¬ (`tools/scripts/`)
- **å¼€å‘ç¯å¢ƒ**: `start.bat`
- **ç”Ÿäº§ç¯å¢ƒ**: `start_release.bat`
- **è°ƒè¯•æ¨¡å¼**: `start_with_logs.bat`
- **å®‰å…¨æ¨¡å¼**: `start_with_security.bat`

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å¼€å‘ç¯å¢ƒ
```bash
cd tools/scripts
./start.bat
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
cd tools/scripts
./start_release.bat
```

### æ•°æ®åº“ç»´æŠ¤
```bash
cd tools/scripts
./patch_database.bat
```

## ğŸ“‹ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è„šæœ¬æ‰§è¡Œé¡ºåº**:
   - é¦–å…ˆæ‰§è¡Œ `sql/init/` ä¸­çš„åˆå§‹åŒ–è„šæœ¬
   - ç„¶åæ‰§è¡Œ `sql/migrations/` ä¸­çš„è¿ç§»è„šæœ¬
   - æœ€åæ ¹æ®éœ€è¦æ‰§è¡Œ `sql/patches/` ä¸­çš„è¡¥ä¸è„šæœ¬

2. **å·¥å…·è„šæœ¬ä½¿ç”¨**:
   - æ•°æ®åº“ç›¸å…³å·¥å…·åœ¨ `tools/database/` ç›®å½•
   - ç®¡ç†å‘˜å·¥å…·åœ¨ `tools/admin/` ç›®å½•
   - æµ‹è¯•å·¥å…·åœ¨ `tools/test/` ç›®å½•

3. **æ–‡æ¡£å‚è€ƒ**:
   - æ‰€æœ‰é¡¹ç›®æ–‡æ¡£éƒ½åœ¨ `docs/` ç›®å½•ä¸­
   - å…·ä½“åŠŸèƒ½è¯´æ˜è¯·æŸ¥çœ‹å¯¹åº”çš„READMEæ–‡ä»¶

4. **å¤‡ä»½é‡è¦æ€§**:
   - æ‰§è¡Œä»»ä½•æ•°æ®åº“æ“ä½œå‰ï¼Œè¯·ç¡®ä¿æ•°æ®åº“å·²å¤‡ä»½
   - å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨ `backups/` ç›®å½•ä¸­

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è¡¥ä¸è¯´æ˜](docs/DATABASE_PATCH_README.md)
- [ä¸‹è½½å®‰å…¨é…ç½®](docs/README_DOWNLOAD_SECURITY.md)
- [é‚®ä»¶è®¾ç½®æŒ‡å—](docs/README_EMAIL_SETUP.md)
- [æ—¥å¿—ä½¿ç”¨æŒ‡å—](docs/LOGGING_GUIDE.md)
- [åŠŸèƒ½æ›´æ–°æ€»ç»“](docs/åŠŸèƒ½æ›´æ–°æ€»ç»“.md)