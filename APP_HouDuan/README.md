# ç»³åŒ…ç®¡ç†å™¨åç«¯æœåŠ¡ - é‡æ„ç‰ˆæœ¬

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ç»³åŒ…ç®¡ç†å™¨çš„å…¨æ–°åç«¯å®ç°ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„Rustæ¶æ„è®¾è®¡ï¼Œæä¾›é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„APIæœåŠ¡ã€‚

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Actix-Web 4.x
- **æ•°æ®åº“**: SQLite with SQLx
- **è®¤è¯**: JWT
- **æ—¥å¿—**: Tracing
- **é…ç½®**: Config crate
- **ç¼“å­˜**: Redis
- **éªŒè¯**: Validator

## æ¶æ„ç‰¹æ€§

- ğŸ—ï¸ **æ¸…æ™°çš„åˆ†å±‚æ¶æ„**: Domainã€Infrastructureã€APIä¸‰å±‚åˆ†ç¦»
- ğŸ”§ **ä¾èµ–æ³¨å…¥**: ç»Ÿä¸€çš„æœåŠ¡å®¹å™¨ç®¡ç†
- âš¡ **é«˜æ€§èƒ½**: SQLiteè¿æ¥æ± ã€Redisç¼“å­˜
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨**: å®Œæ•´çš„Rustç±»å‹ç³»ç»Ÿ
- ğŸ“ **å®Œå–„æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿—è®°å½•
- ğŸ”’ **å®‰å…¨è®¾è®¡**: JWTè®¤è¯ã€æƒé™æ§åˆ¶

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ core/           # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ domain/     # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ services/   # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ ports/      # æ¥å£å®šä¹‰
â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ database/   # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ cache/      # ç¼“å­˜å®ç°
â”‚   â”œâ”€â”€ storage/    # æ–‡ä»¶å­˜å‚¨
â”‚   â””â”€â”€ email/      # é‚®ä»¶æœåŠ¡
â”œâ”€â”€ api/           # API å±‚
â”‚   â”œâ”€â”€ handlers/   # è¯·æ±‚å¤„ç†å™¨
â”‚   â”œâ”€â”€ middleware/ # ä¸­é—´ä»¶
â”‚   â””â”€â”€ routes/     # è·¯ç”±å®šä¹‰
â””â”€â”€ shared/        # å…±äº«ç»„ä»¶
    â”œâ”€â”€ errors/     # é”™è¯¯å®šä¹‰
    â”œâ”€â”€ utils/      # å·¥å…·å‡½æ•°
    â””â”€â”€ types/      # é€šç”¨ç±»å‹
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Rust 1.70+
- SQLite 3.35+
- Redis 6.0+ (å¯é€‰)

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd APP_HouDuan
```

### é…ç½®ç¯å¢ƒ

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

### è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼
cargo run

# å‘å¸ƒæ¨¡å¼
cargo run --release
```

### æ•°æ®åº“è¿ç§»

æ•°æ®åº“ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–å’Œè¿ç§»ã€‚

## APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—®ä»¥ä¸‹ç«¯ç‚¹ï¼š

- å¥åº·æ£€æŸ¥: `GET /health`
- APIåŸºç¡€è·¯å¾„: `/api/v1`

### ä¸»è¦åŠŸèƒ½æ¨¡å—

1. **ç”¨æˆ·ç®¡ç†** (`/api/v1/users`)
   - ç”¨æˆ·æ³¨å†Œã€ç™»å½•
   - ç”¨æˆ·èµ„æ–™ç®¡ç†
   - æƒé™æ§åˆ¶

2. **èµ„æºåŒ…ç®¡ç†** (`/api/v1/packages`)
   - èµ„æºä¸Šä¼ ã€ä¸‹è½½
   - èµ„æºæœç´¢ã€åˆ†ç±»
   - ç‰ˆæœ¬ç®¡ç†

3. **è¯„è®ºç³»ç»Ÿ** (`/api/v1/comments`)
   - è¯„è®ºå‘å¸ƒã€å›å¤
   - ç‚¹èµã€ä¸¾æŠ¥

4. **é€šçŸ¥ç³»ç»Ÿ** (`/api/v1/notifications`)
   - æ¶ˆæ¯æ¨é€
   - é‚®ä»¶é€šçŸ¥

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `RUN_MODE` | è¿è¡Œæ¨¡å¼ | `development` |
| `APP_SERVER__HOST` | æœåŠ¡å™¨åœ°å€ | `127.0.0.1` |
| `APP_SERVER__PORT` | æœåŠ¡å™¨ç«¯å£ | `15201` |
| `APP_DATABASE__URL` | æ•°æ®åº“è¿æ¥ | `sqlite:./data/app.db` |

### é…ç½®æ–‡ä»¶

- `config/default.toml` - é»˜è®¤é…ç½®
- `config/development.toml` - å¼€å‘ç¯å¢ƒ
- `config/production.toml` - ç”Ÿäº§ç¯å¢ƒ

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

- éµå¾ªRustå®˜æ–¹ä»£ç é£æ ¼
- ä½¿ç”¨`cargo fmt`æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨`cargo clippy`æ£€æŸ¥ä»£ç è´¨é‡

### æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
cargo test

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture
```

### æ•°æ®åº“æ“ä½œ

æ•°æ®åº“è¿ç§»æ–‡ä»¶ä½äº`migrations/`ç›®å½•ä¸‹ï¼ŒæŒ‰åºå·å‘½åã€‚

## éƒ¨ç½²

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t jieshen-backend .

# è¿è¡Œå®¹å™¨
docker run -p 15201:15201 jieshen-backend
```

### ç³»ç»ŸæœåŠ¡

åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œã€‚

## æ€§èƒ½ä¼˜åŒ–

- SQLiteè¿æ¥æ± ä¼˜åŒ–
- Redisç¼“å­˜ç­–ç•¥
- é™æ€æ–‡ä»¶CDN
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

## å®‰å…¨ç‰¹æ€§

- JWT Tokenè®¤è¯
- å¯†ç BCryptåŠ å¯†
- SQLæ³¨å…¥é˜²æŠ¤
- XSSé˜²æŠ¤
- CORSé…ç½®

## ç›‘æ§å’Œæ—¥å¿—

- ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- é”™è¯¯è¿½è¸ª
- å¥åº·æ£€æŸ¥ç«¯ç‚¹

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»ºPull Request

## è®¸å¯è¯

MIT License

## æ›´æ–°æ—¥å¿—

### v2.0.0
- å…¨æ–°æ¶æ„è®¾è®¡
- é‡æ„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½
- å®Œå–„é”™è¯¯å¤„ç† 

## æ—¥å¿—ä¸è°ƒè¯•

åç«¯å·²ç»Ÿä¸€æ¥å…¥ `tracing` æ—¥å¿—ç³»ç»Ÿï¼Œå¹¶ä¸ºæ‰€æœ‰ HTTP è¯·æ±‚æ·»åŠ äº†è¯·æ±‚è·Ÿè¸ªä¸­é—´ä»¶ï¼š

- è‡ªåŠ¨ç”Ÿæˆå¹¶è¿”å› `X-Request-Id` å“åº”å¤´ï¼Œæ–¹ä¾¿ç«¯åˆ°ç«¯è¿½è¸ª
- è®°å½•æ–¹æ³•ã€è·¯å¾„ã€çŠ¶æ€ç ã€è€—æ—¶ã€è¿œç«¯åœ°å€ã€User-Agent
- é”™è¯¯å“åº”ï¼ˆ4xx/5xxï¼‰ä¼šè¾“å‡ºå‘Šè­¦/é”™è¯¯çº§åˆ«æ—¥å¿—
- æ”¯æŒæ§åˆ¶å°ç¾åŒ–è¾“å‡ºä¸æ–‡ä»¶ JSON è¾“å‡ºï¼ˆå¯é…ç½®ï¼‰

é…ç½®é¡¹ä½äº `config/*.toml` çš„ `[logging]` éƒ¨åˆ†ï¼š

```toml
[logging]
level = "info"            # ç­‰çº§ï¼šerror,warn,info,debug,traceï¼Œä¹Ÿå¯ç”¨ RUST_LOG è¦†ç›–
file_enabled = true        # æ˜¯å¦å†™å…¥æ–‡ä»¶ï¼ˆæ¯æ—¥æ»šåŠ¨ï¼‰
file_path = "./logs"      # æ—¥å¿—ç›®å½•
console_enabled = true     # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°
json_format = false        # æ˜¯å¦ä½¿ç”¨ JSON æ ¼å¼ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒå¼€å¯ï¼‰
with_file_info = true      # æ˜¯å¦æ‰“å°æ–‡ä»¶ä¸è¡Œå·
with_thread_ids = true     # æ˜¯å¦æ‰“å°çº¿ç¨‹ID
with_timestamps = true     # æ˜¯å¦æ˜¾ç¤ºæ—¶é—´æˆ³ï¼ˆå¯åœ¨æœ¬åœ°è°ƒè¯•å…³é—­ï¼‰
```

æ³¨æ„ï¼šå½“å‰å®ç°ä¼˜å…ˆçº§ä¸ºæ–‡ä»¶è¾“å‡º > æ§åˆ¶å°è¾“å‡ºã€‚å½“ `file_enabled=true` ä¸”é…ç½®äº† `file_path` æ—¶ï¼Œæ—¥å¿—ä¼šå†™å…¥ `server.log`ï¼ˆæ¯æ—¥æ»šåŠ¨ï¼‰ã€‚å¦åˆ™è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚

ä¸­é—´ä»¶ï¼š`api/middleware/mod.rs` ä¸­çš„ `RequestTracing` å·²åœ¨å…¥å£ `main.rs` æŒ‚è½½ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

å¸¸è§é—®é¢˜ï¼š
- è‹¥éœ€è¦æ›´è¯¦ç»†ç»„ä»¶æ—¥å¿—ï¼Œå¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`RUST_LOG=debug` æˆ–åœ¨é…ç½®ä¸­è®¾ç½® `level="debug"`ã€‚
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š`json_format=true`ã€`file_enabled=true`ï¼Œå¹¶ç”±æ—¥å¿—é‡‡é›†å™¨ï¼ˆå¦‚ filebeatï¼‰æ¥å…¥ã€‚ 