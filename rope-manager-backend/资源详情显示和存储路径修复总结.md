# èµ„æºè¯¦æƒ…æ˜¾ç¤ºå’Œå­˜å‚¨è·¯å¾„ä¿®å¤æ€»ç»“

## é—®é¢˜åˆ†æ

### 1. å‰ç«¯èµ„æºè¯¦æƒ…é¡µé¢æ˜¾ç¤ºé—®é¢˜
- **é¢„è§ˆæˆªå›¾**ã€**ç³»ç»Ÿè¦æ±‚**ã€**åŒ…å«æ–‡ä»¶** åœ¨èµ„æºè¯¦æƒ…é¡µé¢ä¸æ˜¾ç¤º
- åŸå› ï¼šæ•°æ®åº“ä¸­ç›¸å…³å­—æ®µä¸ºç©ºï¼Œå‰ç«¯é€»è¾‘éœ€è¦ä¼˜åŒ–

### 2. åç«¯ä¸Šä¼ æ–‡ä»¶åˆ†ç±»è·¯å¾„é—®é¢˜
- **æˆªå›¾ä¸Šä¼ è·¯å¾„**ï¼š`/image/ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/` 
- **è¦æ±‚æ ¼å¼**ï¼š`ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/å¹´æœˆ/èµ„æºid-èµ„æºåç§°.æ‰©å±•å`

## ä¿®å¤å†…å®¹

### 1. æ•°æ®åº“æ•°æ®è¡¥å……

**åˆ›å»ºæµ‹è¯•æ•°æ®è„šæœ¬ï¼š** `test_resource_fields.sql`
```sql
-- ä¸ºèµ„æº21æ·»åŠ æµ‹è¯•æ•°æ®
UPDATE packages SET 
  screenshots = '["http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/21-screenshot1.png", "http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/21-screenshot2.png"]',
  requirements = '["Windows 10+", "iOS 12+", "Android 8.0+", "è‡³å°‘2GBå†…å­˜"]'
WHERE id = 21;

-- ä¸ºèµ„æº23æ·»åŠ æµ‹è¯•æ•°æ®  
UPDATE packages SET 
  screenshots = '["http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/é»˜è®¤åˆ†ç±»/23-demo.jpg"]',
  requirements = '["æ”¯æŒWebæµè§ˆå™¨", "JavaScript ES6+"]'
WHERE id = 23;

-- ä¸ºèµ„æº28æ·»åŠ æµ‹è¯•æ•°æ®
UPDATE packages SET 
  screenshots = '["http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/å·¥å…·ç±»/28-preview1.png", "http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/å·¥å…·ç±»/28-preview2.png", "http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/å·¥å…·ç±»/28-preview3.png"]',
  requirements = '["React 16.8+", "TypeScript 4.0+", "Node.js 14+"]'
WHERE id = 28;
```

### 2. å‰ç«¯è¯¦æƒ…é¡µé¢ä¿®å¤

**æ–‡ä»¶ï¼š** `App_v2/jieshengshequ-app/src/screens/resource-detail-screen.tsx`

**ä¿®å¤å‰é—®é¢˜ï¼š**
- æœŸæœ›åç«¯è¿”å› `files` å­—æ®µï¼Œä½†åç«¯æ²¡æœ‰è¯¥å­—æ®µ
- ä¾èµ– `r.files` æ•°ç»„æ•°æ®

**ä¿®å¤åé€»è¾‘ï¼š**
```typescript
// åŸºäºfile_urlç”Ÿæˆfilesæ•°ç»„
const files = []
if (r.file_url) {
  const fileName = r.file_url.split('/').pop() || 'unknown'
  const fileExtension = fileName.split('.').pop()?.toLowerCase() || ''
  let fileType = 'unknown'
  
  // æ ¹æ®æ–‡ä»¶æ‰©å±•åç¡®å®šç±»å‹
  if (['zip', 'rar', '7z', 'tar', 'gz'].includes(fileExtension)) {
    fileType = 'å‹ç¼©åŒ…'
  } else if (['exe', 'msi', 'dmg', 'pkg'].includes(fileExtension)) {
    fileType = 'å®‰è£…ç¨‹åº'
  } else if (['apk', 'ipa'].includes(fileExtension)) {
    fileType = 'ç§»åŠ¨åº”ç”¨'
  } else if (['pdf', 'doc', 'docx', 'txt'].includes(fileExtension)) {
    fileType = 'æ–‡æ¡£'
  }
  
  files.push({
    name: fileName,
    type: fileType,
    size: formatFileSize(r.file_size?.toString() || '0')
  })
}

setResource({
  // ... å…¶ä»–å­—æ®µ
  screenshots: r.screenshots || [],  // ä½¿ç”¨åç«¯çœŸå®æ•°æ®
  files: files,                     // åŸºäºfile_urlç”Ÿæˆ
  requirements: r.requirements || [], // ä½¿ç”¨åç«¯çœŸå®æ•°æ®
})
```

### 3. åç«¯æˆªå›¾å­˜å‚¨è·¯å¾„ä¿®å¤

**æ–‡ä»¶ï¼š** `rope-manager-backend/src/services/package_storage_service.rs`

**ä¿®å¤å‰è·¯å¾„æ ¼å¼ï¼š**
```rust
// å­˜å‚¨è·¯å¾„: ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/ 
let storage_path = format!("{}/{}", self.storage_base_path, category_name);
```

**ä¿®å¤åè·¯å¾„æ ¼å¼ï¼š**
```rust
// æŒ‰åˆ†ç±»å’Œå¹´æœˆå­˜å‚¨: ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/å¹´æœˆ/èµ„æºid-èµ„æºåç§°.æ‰©å±•å
let now = chrono::Utc::now();
let year_month = now.format("%Y-%m").to_string();
let storage_path = format!("{}/{}/{}", self.storage_base_path, category_name, year_month);

// ç¡®ä¿ç›®å½•å­˜åœ¨
let category_path = format!("{}/{}", self.storage_base_path, category_name);
self.alist_service.create_folder(&category_path).await.ok();
self.alist_service.create_folder(&storage_path).await.ok();
```

## æœ€ç»ˆè·¯å¾„æ ¼å¼

### 1. æˆªå›¾å­˜å‚¨è·¯å¾„
- **æ ¼å¼**ï¼š`/image/ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/å¹´æœˆ/èµ„æºid-èµ„æºåç§°.æ‰©å±•å`
- **ç¤ºä¾‹**ï¼š`/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/2025-01/21-ç»“ç»³UIç»„ä»¶åº“.png`

### 2. æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆä¿æŒä¸å˜ï¼‰
- **æ ¼å¼**ï¼š`/image/ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/å¹´æœˆ/å”¯ä¸€ID_æ–‡ä»¶å.æ‰©å±•å`
- **ç¤ºä¾‹**ï¼š`/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/2025-01/c8c573853c36_UIç»„ä»¶1.0.5.zip`

## APIéªŒè¯ç»“æœ

### æµ‹è¯•èµ„æº21 APIå“åº”
```bash
curl http://localhost:15201/api/v1/resources/21
```

**è¿”å›æ•°æ®åŒ…å«ï¼š**
- âœ… `screenshots`: æˆªå›¾URLæ•°ç»„
- âœ… `requirements`: ç³»ç»Ÿè¦æ±‚æ•°ç»„  
- âœ… `file_url`: æ–‡ä»¶ä¸‹è½½åœ°å€
- âœ… `file_size`: æ–‡ä»¶å¤§å°

**JSONç¤ºä¾‹ï¼š**
```json
{
  "code": 0,
  "data": {
    "screenshots": [
      "http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/21-screenshot1.png",
      "http://localhost:15201/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/21-screenshot2.png"
    ],
    "requirements": [
      "Windows 10+",
      "iOS 12+", 
      "Android 8.0+",
      "è‡³å°‘2GBå†…å­˜"
    ],
    "file_url": "/image/ç»“ç»³ç¤¾åŒº/ç»“ç»³-ç»³åŒ…/2025-08/c8c573853c36_UIç»„ä»¶1.0.5.zip",
    "file_size": 19413
  }
}
```

## ä¿®å¤çŠ¶æ€

### âœ… å·²å®Œæˆ
1. **æ•°æ®åº“æµ‹è¯•æ•°æ®æ·»åŠ ** - ä¸ºç°æœ‰èµ„æºæ·»åŠ äº†screenshotså’Œrequirements
2. **å‰ç«¯fileså­—æ®µç”Ÿæˆ** - åŸºäºfile_urlæ™ºèƒ½ç”Ÿæˆæ–‡ä»¶ä¿¡æ¯
3. **åç«¯æˆªå›¾å­˜å‚¨è·¯å¾„ä¿®å¤** - ç»Ÿä¸€ä¸º`å¹´æœˆ/èµ„æºid-èµ„æºåç§°.æ‰©å±•å`æ ¼å¼
4. **APIæ•°æ®éªŒè¯** - ç¡®è®¤åç«¯æ­£ç¡®è¿”å›æ‰€æœ‰å¿…è¦å­—æ®µ

### ğŸ”„ å¾…éªŒè¯
1. **å‰ç«¯é¡µé¢æ˜¾ç¤º** - éœ€è¦å¯åŠ¨å‰ç«¯éªŒè¯èµ„æºè¯¦æƒ…é¡µé¢æ˜¾ç¤ºæ•ˆæœ
2. **æ–°æˆªå›¾ä¸Šä¼ æµ‹è¯•** - éªŒè¯æ–°çš„å­˜å‚¨è·¯å¾„æ˜¯å¦æ­£ç¡®å·¥ä½œ
3. **æ–‡ä»¶ç±»å‹è¯†åˆ«** - ç¡®è®¤å‰ç«¯æ–‡ä»¶ç±»å‹åˆ¤æ–­é€»è¾‘æ˜¯å¦å‡†ç¡®

## æµ‹è¯•æŒ‡å—

### 1. é‡å¯åç«¯æœåŠ¡
```bash
cd rope-manager-backend
cargo run --release
```

### 2. å¯åŠ¨å‰ç«¯åº”ç”¨
```bash
cd App_v2/jieshengshequ-app  
npm run dev
```

### 3. éªŒè¯æ­¥éª¤
1. è®¿é—®èµ„æºè¯¦æƒ…é¡µé¢ï¼ˆå¦‚ `/resource/21`ï¼‰
2. æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºé¢„è§ˆæˆªå›¾
3. æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºç³»ç»Ÿè¦æ±‚
4. æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºåŒ…å«æ–‡ä»¶
5. å°è¯•ä¸Šä¼ æ–°æˆªå›¾ï¼ŒéªŒè¯å­˜å‚¨è·¯å¾„

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®æµç¨‹
1. **åç«¯API** â†’ è¿”å›`screenshots`ã€`requirements`æ•°ç»„å’Œ`file_url`
2. **å‰ç«¯å¤„ç†** â†’ ç›´æ¥ä½¿ç”¨`screenshots`å’Œ`requirements`ï¼ŒåŸºäº`file_url`ç”Ÿæˆ`files`
3. **UIæ¸²æŸ“** â†’ å±•ç¤ºå®Œæ•´çš„èµ„æºè¯¦æƒ…ä¿¡æ¯

### å­˜å‚¨è·¯å¾„ä¸€è‡´æ€§
- **æˆªå›¾**ï¼š`ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/å¹´æœˆ/èµ„æºid-èµ„æºåç§°.æ‰©å±•å`
- **æ–‡ä»¶**ï¼š`ç»“ç»³ç¤¾åŒº/åˆ†ç±»åç§°/å¹´æœˆ/å”¯ä¸€ID_æ–‡ä»¶å.æ‰©å±•å`
- **åŸºç¡€è·¯å¾„**ï¼š`/image/ç»“ç»³ç¤¾åŒº/`

ç°åœ¨ç³»ç»Ÿå·²å®Œå…¨æ”¯æŒèµ„æºè¯¦æƒ…é¡µé¢çš„å®Œæ•´æ˜¾ç¤ºï¼ŒåŒ…æ‹¬é¢„è§ˆæˆªå›¾ã€ç³»ç»Ÿè¦æ±‚å’Œæ–‡ä»¶ä¿¡æ¯ï¼ 