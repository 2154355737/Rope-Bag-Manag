import{u as p}from"../chunks/users-BwVJ2ity.js";import{Q as C,G as f}from"../chunks/element-plus-BqgU8HW0.js";import{x as R,r as v,X as A,j as E,y as g,A as B,Q as o,I as r,al as t,H as M,M as q,u as N,z as _}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as P}from"../assets/index-KJvHh4NK.js";import"../chunks/utils-Dq7h7Pqt.js";const F={class:"elder-profile"},I=["src"],L=R({__name:"Profile",setup(h){const d=v(null),l=A({nickname:"",qq_number:"",avatar_url:""}),b={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],qq_number:[{pattern:/^\d{5,12}$/,message:"请输入有效QQ号",trigger:"blur"}]},m=v(!1),i=async()=>{const a=await p.getCurrentUser();a.code===0&&a.data&&(l.nickname=a.data.nickname||"",l.qq_number=a.data.qq_number||"",l.avatar_url=a.data.avatar_url||"")};E(i);function k(a){const e=new FileReader;return e.onload=n=>{l.avatar_url=n.target?.result},e.readAsDataURL(a),!1}const y=a=>{console.warn("头像加载失败:",a);const e=a.target;e&&e.src.includes("q.qlogo.cn")&&(e.style.display="none")},V=async()=>{if(!d.value)return;await d.value.validate(),m.value=!0;const a=await p.updateCurrentUser(l);m.value=!1,a.code===0?(f.success("保存成功"),i()):f.error(a.message||a.msg||"保存失败")},x=()=>{i()};return(a,e)=>{const n=t("el-input"),u=t("el-form-item"),U=t("User"),w=t("el-icon"),Q=t("el-upload"),c=t("el-button");return _(),g("div",F,[e[5]||(e[5]=B("h2",null,"个人信息编辑",-1)),o(N(C),{model:l,rules:b,ref_key:"formRef",ref:d,"label-width":"90px",style:{"max-width":"400px"}},{default:r(()=>[o(u,{label:"昵称",prop:"nickname"},{default:r(()=>[o(n,{modelValue:l.nickname,"onUpdate:modelValue":e[0]||(e[0]=s=>l.nickname=s),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),o(u,{label:"QQ号",prop:"qq_number"},{default:r(()=>[o(n,{modelValue:l.qq_number,"onUpdate:modelValue":e[1]||(e[1]=s=>l.qq_number=s),placeholder:"请输入QQ号"},null,8,["modelValue"])]),_:1}),o(u,{label:"头像",prop:"avatar_url"},{default:r(()=>[o(Q,{class:"avatar-uploader",action:"","show-file-list":!1,"before-upload":k},{default:r(()=>[l.avatar_url?(_(),g("img",{key:0,src:l.avatar_url,class:"avatar",onError:y},null,40,I)):(_(),M(w,{key:1},{default:r(()=>[o(U)]),_:1}))]),_:1}),o(n,{modelValue:l.avatar_url,"onUpdate:modelValue":e[2]||(e[2]=s=>l.avatar_url=s),placeholder:"或粘贴头像图片URL",style:{"margin-top":"8px"}},null,8,["modelValue"])]),_:1}),o(u,null,{default:r(()=>[o(c,{type:"primary",onClick:V,loading:m.value},{default:r(()=>e[3]||(e[3]=[q("保存")])),_:1,__:[3]},8,["loading"]),o(c,{onClick:x},{default:r(()=>e[4]||(e[4]=[q("重置")])),_:1,__:[4]})]),_:1})]),_:1},8,["model"])])}}}),S=P(L,[["__scopeId","data-v-8c00e81d"]]);export{S as default};
