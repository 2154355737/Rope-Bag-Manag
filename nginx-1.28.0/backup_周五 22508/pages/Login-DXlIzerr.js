import{x as Z,r as c,X as O,y as q,A as s,P as ee,a6 as se,C as oe,Q as l,I as a,u as m,al as f,V as z,M as y,H as h,K as A,O as F,ax as le,z as w}from"../chunks/vue-vendor-BleHOoLr.js";import{b as $,u as S,k as ae,O as K,P,G as d}from"../chunks/element-plus-BqgU8HW0.js";import{b as re,s as te,d as ne,g as ie,e as de,i as ue,f as G,_ as ce}from"../assets/index-KJvHh4NK.js";import{a as T}from"../chunks/auth--cnCfblh.js";import"../chunks/utils-Dq7h7Pqt.js";const me={class:"login-desktop"},fe={class:"background-decoration"},ge={class:"floating-particles"},pe={class:"login-container"},ve={class:"login-decoration"},_e={class:"decoration-content"},be={class:"logo-section"},ye={class:"logo-icon"},ke={class:"feature-list"},we={class:"feature-item"},xe={class:"feature-item"},Ve={class:"feature-item"},Ce={class:"feature-item"},Re={class:"login-form-section"},Ee={class:"form-container"},Le={class:"form-group"},ze={class:"form-group"},Fe={class:"form-options"},Se={class:"form-group"},Te={class:"form-group"},Ie={class:"code-input-group"},Ue={class:"register-link-container",style:{"text-align":"center","margin-top":"16px"}},Ne=Z({__name:"Login",setup(Me){const b=le(),x=c(),V=c(),u=c(!1),C=c(!1),k=c(!1),R=c("password"),p=c(0);c(!1),c(""),c("");const t=O({username:"",password:""}),n=O({email:"",code:""}),H={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±",trigger:"blur"},{min:3,max:50,message:"ç”¨æˆ·åé•¿åº¦åœ¨ 3 åˆ° 50 ä¸ªå­—ç¬¦",trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:6,max:20,message:"å¯†ç é•¿åº¦åœ¨ 6 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}]},Q={email:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±åœ°å€",trigger:"blur"},{type:"email",message:"è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼",trigger:"blur"}],code:[{required:!0,message:"è¯·è¾“å…¥éªŒè¯ç ",trigger:"blur"},{len:6,message:"éªŒè¯ç ä¸º6ä½æ•°å­—",trigger:"blur"}]};function I(o){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)}function W(){p.value=60;const o=setInterval(()=>{p.value--,p.value<=0&&clearInterval(o)},1e3)}async function X(){if(!I(n.email)){d.error("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼");return}try{C.value=!0;const o=await T.sendLoginCode({email:n.email});o.code===0?(d.success("éªŒè¯ç å·²å‘é€ï¼Œè¯·æŸ¥æ”¶é‚®ä»¶"),W()):d.error(o.message||"å‘é€éªŒè¯ç å¤±è´¥")}catch(o){console.error("å‘é€éªŒè¯ç å¤±è´¥:",o),d.error("å‘é€éªŒè¯ç å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{C.value=!1}}async function U(){if(V.value)try{await V.value.validate(),u.value=!0;const o=await T.loginByEmail({email:n.email,code:n.code});o.code===0?N(o,n.email):d.error(o.message||"éªŒè¯ç ç™»å½•å¤±è´¥")}catch(o){console.error("éªŒè¯ç ç™»å½•å¤±è´¥:",o),d.error("éªŒè¯ç ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{u.value=!1}}function N(o,e){console.log("ğŸ‰ å¼€å§‹å¤„ç†ç™»å½•æˆåŠŸ:",o);const i=o.data?.token??"",g=o.data?.user;console.log("ğŸ“ ç™»å½•æ•°æ®:",{token:i?"å­˜åœ¨":"æ— ",user:g}),te(i),ne(g?.username||e,i,g),setTimeout(()=>{const v=ie(),L=de(),_=ue();console.log("âœ… ç™»å½•çŠ¶æ€éªŒè¯:",{savedUserInfo:v,savedToken:L?"å­˜åœ¨":"æ— ",isLoggedInStatus:_})},100),k.value&&R.value==="password"?G(!0,{username:t.username,password:t.password}):G(!1),d.success("ç™»å½•æˆåŠŸ"),setTimeout(()=>{g?.role==="admin"?(console.log("ğŸš€ è·³è½¬åˆ°ç®¡ç†å‘˜åå°"),b.push("/admin")):g?.role==="elder"?(console.log("ğŸš€ è·³è½¬åˆ°é•¿è€åå°"),b.push("/elder")):(console.log("ğŸš€ è·³è½¬åˆ°ç”¨æˆ·åå°"),b.push("/user"))},500)}async function M(){if(x.value)try{await x.value.validate(),u.value=!0;const o=await T.login({username:t.username,password:t.password});if(o.code===0){N(o,t.username);return}else d.error(o.message||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ")}catch(o){if(console.error("ç™»å½•å¤±è´¥:",o),o.response&&o.response.data&&o.response.data.message)d.error(o.response.data.message);else{const e=o instanceof Error?o.message:String(o);e.includes("fetch")||e.includes("network")||e.includes("Failed to fetch")||e.includes("ERR_NETWORK")||e.includes("ERR_CONNECTION_REFUSED")||e.includes("Service unavailable")?d.error("æœåŠ¡è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"):d.error("ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}finally{u.value=!1}}const E=re();E&&(t.username=E.username||"",t.password=E.password||"",k.value=!0);function j(){b.push("/register")}function J(){b.push("/forgot-password")}return(o,e)=>{const i=f("el-icon"),g=f("Document"),v=f("el-input"),L=f("el-checkbox"),_=f("el-button"),B=f("el-form"),D=f("el-tab-pane"),Y=f("el-tabs");return w(),q("div",me,[s("div",fe,[e[6]||(e[6]=s("div",{class:"decoration-circle circle-1"},null,-1)),e[7]||(e[7]=s("div",{class:"decoration-circle circle-2"},null,-1)),e[8]||(e[8]=s("div",{class:"decoration-circle circle-3"},null,-1)),e[9]||(e[9]=s("div",{class:"decoration-circle circle-4"},null,-1)),s("div",ge,[(w(),q(ee,null,se(12,r=>s("div",{class:"particle",key:r,style:oe({animationDelay:`${r*.2}s`})},null,4)),64))])]),s("div",pe,[s("div",ve,[s("div",_e,[s("div",be,[s("div",ye,[l(i,{size:64},{default:a(()=>[l(m($))]),_:1})]),e[10]||(e[10]=s("h1",{class:"app-title"},"ç»³åŒ…ç®¡ç†ç³»ç»Ÿ",-1)),e[11]||(e[11]=s("p",{class:"app-subtitle"},"ä¸“ä¸šçš„ç»³åŒ…ç®¡ç†è§£å†³æ–¹æ¡ˆ",-1))]),s("div",ke,[s("div",we,[l(i,null,{default:a(()=>[l(m(S))]),_:1}),e[12]||(e[12]=s("span",null,"ç”¨æˆ·æƒé™ç®¡ç†",-1))]),s("div",xe,[l(i,null,{default:a(()=>[l(m($))]),_:1}),e[13]||(e[13]=s("span",null,"ç»³åŒ…ä¿¡æ¯ç®¡ç†",-1))]),s("div",Ve,[l(i,null,{default:a(()=>[l(g)]),_:1}),e[14]||(e[14]=s("span",null,"ç³»ç»Ÿæ—¥å¿—è®°å½•",-1))]),s("div",Ce,[l(i,null,{default:a(()=>[l(m(ae))]),_:1}),e[15]||(e[15]=s("span",null,"æ•°æ®ç»Ÿè®¡åˆ†æ",-1))])])]),e[16]||(e[16]=s("div",{class:"decoration-bg"},[s("div",{class:"bg-circle circle-1"}),s("div",{class:"bg-circle circle-2"}),s("div",{class:"bg-circle circle-3"})],-1))]),s("div",Re,[s("div",Ee,[e[23]||(e[23]=s("div",{class:"form-header"},[s("h2",{class:"form-title"},"æ¬¢è¿ç™»å½•"),s("p",{class:"form-subtitle"},"é€‰æ‹©æ‚¨çš„ç™»å½•æ–¹å¼")],-1)),l(Y,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=r=>R.value=r),class:"login-tabs"},{default:a(()=>[l(D,{label:"å¯†ç ç™»å½•",name:"password"},{default:a(()=>[l(B,{ref_key:"loginFormRef",ref:x,model:t,rules:H,class:"login-form",onSubmit:z(M,["prevent"])},{default:a(()=>[s("div",Le,[e[17]||(e[17]=s("label",{class:"form-label"},"ç”¨æˆ·å/é‚®ç®±",-1)),l(v,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=r=>t.username=r),placeholder:"è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±",size:"large",class:"form-input","prefix-icon":m(S),clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",ze,[e[18]||(e[18]=s("label",{class:"form-label"},"å¯†ç ",-1)),l(v,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=r=>t.password=r),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ",size:"large",class:"form-input","prefix-icon":m(K),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",Fe,[l(L,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=r=>k.value=r),class:"remember-checkbox"},{default:a(()=>e[19]||(e[19]=[y(" è®°ä½æˆ‘ ")])),_:1,__:[19]},8,["modelValue"]),s("a",{href:"#",class:"forgot-link",onClick:z(J,["prevent"])},"å¿˜è®°å¯†ç ï¼Ÿ")]),l(_,{type:"primary",size:"large",class:"login-btn",loading:u.value,onClick:M},{default:a(()=>[u.value?A("",!0):(w(),h(i,{key:0},{default:a(()=>[l(m(P))]),_:1})),y(" "+F(u.value?"ç™»å½•ä¸­...":"ç™»å½•"),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1}),l(D,{label:"éªŒè¯ç ç™»å½•",name:"code"},{default:a(()=>[l(B,{ref_key:"codeFormRef",ref:V,model:n,rules:Q,class:"login-form",onSubmit:z(U,["prevent"])},{default:a(()=>[s("div",Se,[e[20]||(e[20]=s("label",{class:"form-label"},"é‚®ç®±åœ°å€",-1)),l(v,{modelValue:n.email,"onUpdate:modelValue":e[3]||(e[3]=r=>n.email=r),placeholder:"è¯·è¾“å…¥é‚®ç®±åœ°å€",size:"large",class:"form-input","prefix-icon":m(S),clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",Te,[e[21]||(e[21]=s("label",{class:"form-label"},"éªŒè¯ç ",-1)),s("div",Ie,[l(v,{modelValue:n.code,"onUpdate:modelValue":e[4]||(e[4]=r=>n.code=r),placeholder:"è¯·è¾“å…¥éªŒè¯ç ",size:"large",class:"form-input code-input","prefix-icon":m(K),clearable:""},null,8,["modelValue","prefix-icon"]),l(_,{type:"primary",size:"large",loading:C.value,disabled:!I(n.email)||p.value>0,onClick:X,class:"send-code-btn"},{default:a(()=>[y(F(p.value>0?`${p.value}såé‡å‘`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["loading","disabled"])])]),l(_,{type:"primary",size:"large",class:"login-btn",loading:u.value,onClick:U},{default:a(()=>[u.value?A("",!0):(w(),h(i,{key:0},{default:a(()=>[l(m(P))]),_:1})),y(" "+F(u.value?"ç™»å½•ä¸­...":"éªŒè¯ç ç™»å½•"),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]),s("div",Ue,[l(_,{type:"success",link:"",onClick:j},{default:a(()=>e[22]||(e[22]=[y("æ³¨å†Œè´¦å·")])),_:1,__:[22]})]),e[24]||(e[24]=s("div",{class:"login-footer"},[s("p",{class:"footer-text"},"Â© 2024 ç»³åŒ…ç®¡ç†ç³»ç»Ÿ. All rights reserved."),s("p",{class:"footer-version"},"Version 1.0.0")],-1))])])])])}}}),Ae=ce(Ne,[["__scopeId","data-v-f6f3c74d"]]);export{Ae as default};
