import{_ as U}from"../assets/index-KJvHh4NK.js";import{a as V}from"../chunks/admin-DRO2yTpX.js";import{Q as A,G as u}from"../chunks/element-plus-BqgU8HW0.js";import{x as C,r as _,X as E,j as L,y as k,Q as l,I as s,u as R,al as i,A as r,M as S,O as y,z as B}from"../chunks/vue-vendor-BleHOoLr.js";import"../chunks/utils-Dq7h7Pqt.js";const D={class:"mail-settings"},I={class:"card-header"},N=C({__name:"MailSettings",setup(O){const g=_(null),p=_(!1),f=_(!1),d=_(""),t=E({smtp_server:"",smtp_port:465,username:"",password:"",from_name:"绳包管理器",enabled:!1,use_ssl:!0,auth_required:!0}),T={smtp_server:[{required:!0,message:"请输入SMTP服务器地址",trigger:"blur"}],smtp_port:[{required:!0,message:"请输入SMTP端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围：1-65535",trigger:"blur"}],username:[{required:!0,message:"请输入发送邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入SMTP密码",trigger:"blur"}],from_name:[{required:!0,message:"请输入发送方名称",trigger:"blur"}]};L(()=>{x()});async function x(){try{const o=await V.getMailSettings();o.code===0&&o.data&&Object.assign(t,o.data)}catch(o){console.error("加载邮件设置失败:",o)}}async function w(){if(g.value)try{await g.value.validate(),p.value=!0;const o=await V.updateMailSettings(t);o.code===0?u.success("邮件配置保存成功"):u.error(o.message||"保存失败")}catch(o){u.error("保存失败："+(o.message||"未知错误"))}finally{p.value=!1}}async function M(){if(!d.value){u.warning("请输入测试邮箱地址");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.value)){u.warning("请输入有效的邮箱地址");return}try{f.value=!0;const o=await V.sendTestEmail(d.value);o.code===0?u.success("测试邮件发送成功，请检查邮箱"):u.error(o.message||"发送失败")}catch(o){u.error("发送失败："+(o.message||"未知错误"))}finally{f.value=!1}}return(o,e)=>{const b=i("el-button"),v=i("el-switch"),n=i("el-form-item"),m=i("el-input"),P=i("el-input-number"),q=i("el-divider"),c=i("el-card"),Q=i("el-alert");return B(),k("div",D,[l(c,null,{header:s(()=>[r("div",I,[e[9]||(e[9]=r("span",null,"邮件服务配置",-1)),l(b,{type:"primary",onClick:w,loading:p.value},{default:s(()=>[S(y(p.value?"保存中...":"保存配置"),1)]),_:1},8,["loading"])])]),default:s(()=>[l(R(A),{model:t,rules:T,ref_key:"formRef",ref:g,"label-width":"120px"},{default:s(()=>[l(n,{label:"启用邮件服务"},{default:s(()=>[l(v,{modelValue:t.enabled,"onUpdate:modelValue":e[0]||(e[0]=a=>t.enabled=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),e[10]||(e[10]=r("div",{class:"form-tip"},"开启后才能发送邮件",-1))]),_:1,__:[10]}),l(n,{label:"SMTP服务器",prop:"smtp_server"},{default:s(()=>[l(m,{modelValue:t.smtp_server,"onUpdate:modelValue":e[1]||(e[1]=a=>t.smtp_server=a),placeholder:"如: smtp.qq.com"},null,8,["modelValue"])]),_:1}),l(n,{label:"SMTP端口",prop:"smtp_port"},{default:s(()=>[l(P,{modelValue:t.smtp_port,"onUpdate:modelValue":e[2]||(e[2]=a=>t.smtp_port=a),min:1,max:65535},null,8,["modelValue"]),e[11]||(e[11]=r("div",{class:"form-tip"},"常用端口：25(非加密)、465(SSL)、587(STARTTLS)",-1))]),_:1,__:[11]}),l(n,{label:"SSL/TLS加密"},{default:s(()=>[l(v,{modelValue:t.use_ssl,"onUpdate:modelValue":e[3]||(e[3]=a=>t.use_ssl=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),e[12]||(e[12]=r("div",{class:"form-tip"},"465端口通常需要SSL，587端口使用STARTTLS",-1))]),_:1,__:[12]}),l(n,{label:"SMTP认证"},{default:s(()=>[l(v,{modelValue:t.auth_required,"onUpdate:modelValue":e[4]||(e[4]=a=>t.auth_required=a),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"]),e[13]||(e[13]=r("div",{class:"form-tip"},"大部分SMTP服务器都需要认证",-1))]),_:1,__:[13]}),l(n,{label:"发送邮箱",prop:"username"},{default:s(()=>[l(m,{modelValue:t.username,"onUpdate:modelValue":e[5]||(e[5]=a=>t.username=a),placeholder:"发送邮件的邮箱地址"},null,8,["modelValue"])]),_:1}),l(n,{label:"SMTP密码",prop:"password"},{default:s(()=>[l(m,{modelValue:t.password,"onUpdate:modelValue":e[6]||(e[6]=a=>t.password=a),type:"password",placeholder:"SMTP授权码(不是登录密码)","show-password":""},null,8,["modelValue"]),e[14]||(e[14]=r("div",{class:"form-tip"},"QQ邮箱请使用授权码，不是登录密码",-1))]),_:1,__:[14]}),l(n,{label:"发送方名称",prop:"from_name"},{default:s(()=>[l(m,{modelValue:t.from_name,"onUpdate:modelValue":e[7]||(e[7]=a=>t.from_name=a),placeholder:"邮件中显示的发送方名称"},null,8,["modelValue"])]),_:1}),l(q,null,{default:s(()=>e[15]||(e[15]=[S("测试邮件")])),_:1,__:[15]}),l(n,{label:"测试邮箱"},{default:s(()=>[l(m,{modelValue:d.value,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value=a),placeholder:"输入测试邮箱地址",style:{width:"300px"}},null,8,["modelValue"]),l(b,{type:"success",onClick:M,loading:f.value,style:{"margin-left":"10px"}},{default:s(()=>[S(y(f.value?"发送中...":"发送测试邮件"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),l(c,{style:{"margin-top":"20px"}},{header:s(()=>e[16]||(e[16]=[r("span",null,"邮件功能说明",-1)])),default:s(()=>[l(Q,{title:"邮件服务用途",type:"info",closable:!1,description:"邮件服务用于发送注册验证码、密码重置链接、新资源通知等功能。"}),e[17]||(e[17]=r("div",{style:{"margin-top":"15px"}},[r("h4",null,"QQ邮箱配置步骤："),r("ol",null,[r("li",null,'登录QQ邮箱，进入"设置" -> "账户"'),r("li",null,'开启"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"'),r("li",null,"获取授权码（不是QQ密码）"),r("li",null,"SMTP服务器填写：smtp.qq.com，端口：465"),r("li",null,"用户名填写完整的QQ邮箱地址"),r("li",null,"密码填写获取的授权码")])],-1))]),_:1,__:[17]})])}}}),$=U(N,[["__scopeId","data-v-91c313ba"]]);export{$ as default};
