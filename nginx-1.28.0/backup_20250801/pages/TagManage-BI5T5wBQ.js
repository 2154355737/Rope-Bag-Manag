import{b as P,a as j,c as q,u as G,d as K}from"../chunks/tags-D8eGBSYx.js";import{G as r,E as L}from"../chunks/element-plus-BqgU8HW0.js";import{x as Q,r as u,j as S,y as M,Q as l,I as o,al as m,K as H,C as J,M as p,A as U,z as A}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as O}from"../assets/index-KJvHh4NK.js";import"../chunks/utils-Dq7h7Pqt.js";const W={class:"tag-manage"},X={class:"header"},Y={class:"header-buttons"},Z=Q({__name:"TagManage",setup(h){const w=u([]),v=u(""),b=u(!1),f=async()=>{b.value=!0;try{console.log("🔍 [TagManage] 开始加载标签, search:",v.value);const t=v.value?await P({search:v.value}):await j();console.log("🔍 [TagManage] API响应:",t);const e=t.data||t;if(console.log("🔍 [TagManage] 实际API数据:",e),e.code===0&&e.data){const n=Array.isArray(e.data)?e.data:e.data.list||[];console.log("🔍 [TagManage] 解析后的标签列表:",n),w.value=n,n.length===0&&console.warn("⚠️ [TagManage] 标签列表为空")}else console.error("❌ [TagManage] API返回错误:",e),r.error(e.msg||"获取标签失败")}catch(t){console.error("❌ [TagManage] 请求异常:",t),r.error("获取标签失败")}finally{b.value=!1}};S(()=>{f()});const D=()=>{console.log("🔄 [TagManage] 手动刷新标签"),f()},_=u(!1),s=u({name:"",description:"",color:""}),y=u(),k={name:[{required:!0,message:"请输入名称",trigger:"blur"}]},F=()=>{s.value={name:"",description:"",color:""},_.value=!0},I=async()=>{if(y.value){await y.value.validate();try{const t=await q(s.value);t.code===0?(r.success("创建成功"),_.value=!1,f()):r.error(t.msg||"创建失败")}catch(t){console.error("创建标签失败",t),r.error("创建失败")}}},V=u(!1),d=u({}),T=u(),$=t=>{d.value={...t},V.value=!0},E=async()=>{if(T.value){await T.value.validate();try{const{id:t,...e}=d.value,n=await G(t,e);n.code===0?(r.success("更新成功"),V.value=!1,f()):r.error(n.msg||"更新失败")}catch(t){console.error("更新标签失败",t),r.error("更新失败")}}},R=t=>{L.confirm(`确定删除标签 "${t.name}" ?`,"提示",{type:"warning"}).then(async()=>{const e=await K(t.id);e.code===0?(r.success("删除成功"),f()):r.error(e.msg||"删除失败")}).catch(()=>{})};return(t,e)=>{const n=m("el-input"),i=m("el-button"),g=m("el-table-column"),z=m("el-table"),B=m("el-card"),c=m("el-form-item"),C=m("el-form"),x=m("el-dialog");return A(),M("div",W,[l(B,null,{header:o(()=>[U("div",X,[l(n,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),placeholder:"搜索标签",clearable:"",style:{"max-width":"220px"},onChange:f},null,8,["modelValue"]),U("div",Y,[l(i,{onClick:D},{default:o(()=>e[11]||(e[11]=[p("刷新")])),_:1,__:[11]}),l(i,{type:"primary",onClick:F},{default:o(()=>e[12]||(e[12]=[p("新增标签")])),_:1,__:[12]})])])]),default:o(()=>[l(z,{data:w.value,style:{width:"100%"},loading:b.value},{default:o(()=>[l(g,{prop:"id",label:"ID",width:"80"}),l(g,{prop:"name",label:"名称"}),l(g,{prop:"description",label:"描述"}),l(g,{prop:"color",label:"颜色",width:"120"},{default:o(({row:a})=>[a.color?(A(),M("div",{key:0,style:J({background:a.color,width:"24px",height:"24px",borderRadius:"4px"})},null,4)):H("",!0)]),_:1}),l(g,{prop:"use_count",label:"使用次数",width:"120"}),l(g,{prop:"created_at",label:"创建时间"}),l(g,{label:"操作",width:"180"},{default:o(({row:a})=>[l(i,{size:"small",onClick:N=>$(a)},{default:o(()=>e[13]||(e[13]=[p("编辑")])),_:2,__:[13]},1032,["onClick"]),l(i,{size:"small",type:"danger",onClick:N=>R(a)},{default:o(()=>e[14]||(e[14]=[p("删除")])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])]),_:1}),l(x,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=a=>_.value=a),title:"新增标签"},{footer:o(()=>[l(i,{onClick:e[4]||(e[4]=a=>_.value=!1)},{default:o(()=>e[15]||(e[15]=[p("取消")])),_:1,__:[15]}),l(i,{type:"primary",onClick:I},{default:o(()=>e[16]||(e[16]=[p("确定")])),_:1,__:[16]})]),default:o(()=>[l(C,{ref_key:"addFormRef",ref:y,model:s.value,rules:k,"label-width":"80px"},{default:o(()=>[l(c,{label:"名称",prop:"name"},{default:o(()=>[l(n,{modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.name=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"描述",prop:"description"},{default:o(()=>[l(n,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.description=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"颜色",prop:"color"},{default:o(()=>[l(n,{modelValue:s.value.color,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.color=a),placeholder:"#409EFF"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(x,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),title:"编辑标签"},{footer:o(()=>[l(i,{onClick:e[9]||(e[9]=a=>V.value=!1)},{default:o(()=>e[17]||(e[17]=[p("取消")])),_:1,__:[17]}),l(i,{type:"primary",onClick:E},{default:o(()=>e[18]||(e[18]=[p("保存")])),_:1,__:[18]})]),default:o(()=>[l(C,{ref_key:"editFormRef",ref:T,model:d.value,rules:k,"label-width":"80px"},{default:o(()=>[l(c,{label:"名称",prop:"name"},{default:o(()=>[l(n,{modelValue:d.value.name,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.name=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"描述",prop:"description"},{default:o(()=>[l(n,{modelValue:d.value.description,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.description=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"颜色",prop:"color"},{default:o(()=>[l(n,{modelValue:d.value.color,"onUpdate:modelValue":e[8]||(e[8]=a=>d.value.color=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ne=O(Z,[["__scopeId","data-v-a8f4aa94"]]);export{ne as default};
