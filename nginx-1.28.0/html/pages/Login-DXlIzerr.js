import{x as Z,r as c,X as O,y as q,A as s,P as ee,a6 as se,C as oe,Q as l,I as a,u as m,al as f,V as z,M as y,H as h,K as A,O as F,ax as le,z as w}from"../chunks/vue-vendor-BleHOoLr.js";import{b as $,u as S,k as ae,O as K,P,G as d}from"../chunks/element-plus-BqgU8HW0.js";import{b as re,s as te,d as ne,g as ie,e as de,i as ue,f as G,_ as ce}from"../assets/index-KJvHh4NK.js";import{a as T}from"../chunks/auth--cnCfblh.js";import"../chunks/utils-Dq7h7Pqt.js";const me={class:"login-desktop"},fe={class:"background-decoration"},ge={class:"floating-particles"},pe={class:"login-container"},ve={class:"login-decoration"},_e={class:"decoration-content"},be={class:"logo-section"},ye={class:"logo-icon"},ke={class:"feature-list"},we={class:"feature-item"},xe={class:"feature-item"},Ve={class:"feature-item"},Ce={class:"feature-item"},Re={class:"login-form-section"},Ee={class:"form-container"},Le={class:"form-group"},ze={class:"form-group"},Fe={class:"form-options"},Se={class:"form-group"},Te={class:"form-group"},Ie={class:"code-input-group"},Ue={class:"register-link-container",style:{"text-align":"center","margin-top":"16px"}},Ne=Z({__name:"Login",setup(Me){const b=le(),x=c(),V=c(),u=c(!1),C=c(!1),k=c(!1),R=c("password"),p=c(0);c(!1),c(""),c("");const t=O({username:"",password:""}),n=O({email:"",code:""}),H={username:[{required:!0,message:"请输入用户名或邮箱",trigger:"blur"},{min:3,max:50,message:"用户名长度在 3 到 50 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},Q={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位数字",trigger:"blur"}]};function I(o){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)}function W(){p.value=60;const o=setInterval(()=>{p.value--,p.value<=0&&clearInterval(o)},1e3)}async function X(){if(!I(n.email)){d.error("请输入正确的邮箱格式");return}try{C.value=!0;const o=await T.sendLoginCode({email:n.email});o.code===0?(d.success("验证码已发送，请查收邮件"),W()):d.error(o.message||"发送验证码失败")}catch(o){console.error("发送验证码失败:",o),d.error("发送验证码失败，请稍后重试")}finally{C.value=!1}}async function U(){if(V.value)try{await V.value.validate(),u.value=!0;const o=await T.loginByEmail({email:n.email,code:n.code});o.code===0?N(o,n.email):d.error(o.message||"验证码登录失败")}catch(o){console.error("验证码登录失败:",o),d.error("验证码登录失败，请稍后重试")}finally{u.value=!1}}function N(o,e){console.log("🎉 开始处理登录成功:",o);const i=o.data?.token??"",g=o.data?.user;console.log("📝 登录数据:",{token:i?"存在":"无",user:g}),te(i),ne(g?.username||e,i,g),setTimeout(()=>{const v=ie(),L=de(),_=ue();console.log("✅ 登录状态验证:",{savedUserInfo:v,savedToken:L?"存在":"无",isLoggedInStatus:_})},100),k.value&&R.value==="password"?G(!0,{username:t.username,password:t.password}):G(!1),d.success("登录成功"),setTimeout(()=>{g?.role==="admin"?(console.log("🚀 跳转到管理员后台"),b.push("/admin")):g?.role==="elder"?(console.log("🚀 跳转到长老后台"),b.push("/elder")):(console.log("🚀 跳转到用户后台"),b.push("/user"))},500)}async function M(){if(x.value)try{await x.value.validate(),u.value=!0;const o=await T.login({username:t.username,password:t.password});if(o.code===0){N(o,t.username);return}else d.error(o.message||"登录失败，请检查用户名和密码")}catch(o){if(console.error("登录失败:",o),o.response&&o.response.data&&o.response.data.message)d.error(o.response.data.message);else{const e=o instanceof Error?o.message:String(o);e.includes("fetch")||e.includes("network")||e.includes("Failed to fetch")||e.includes("ERR_NETWORK")||e.includes("ERR_CONNECTION_REFUSED")||e.includes("Service unavailable")?d.error("服务连接失败，请检查网络连接"):d.error("登录失败，请稍后重试")}}finally{u.value=!1}}const E=re();E&&(t.username=E.username||"",t.password=E.password||"",k.value=!0);function j(){b.push("/register")}function J(){b.push("/forgot-password")}return(o,e)=>{const i=f("el-icon"),g=f("Document"),v=f("el-input"),L=f("el-checkbox"),_=f("el-button"),B=f("el-form"),D=f("el-tab-pane"),Y=f("el-tabs");return w(),q("div",me,[s("div",fe,[e[6]||(e[6]=s("div",{class:"decoration-circle circle-1"},null,-1)),e[7]||(e[7]=s("div",{class:"decoration-circle circle-2"},null,-1)),e[8]||(e[8]=s("div",{class:"decoration-circle circle-3"},null,-1)),e[9]||(e[9]=s("div",{class:"decoration-circle circle-4"},null,-1)),s("div",ge,[(w(),q(ee,null,se(12,r=>s("div",{class:"particle",key:r,style:oe({animationDelay:`${r*.2}s`})},null,4)),64))])]),s("div",pe,[s("div",ve,[s("div",_e,[s("div",be,[s("div",ye,[l(i,{size:64},{default:a(()=>[l(m($))]),_:1})]),e[10]||(e[10]=s("h1",{class:"app-title"},"绳包管理系统",-1)),e[11]||(e[11]=s("p",{class:"app-subtitle"},"专业的绳包管理解决方案",-1))]),s("div",ke,[s("div",we,[l(i,null,{default:a(()=>[l(m(S))]),_:1}),e[12]||(e[12]=s("span",null,"用户权限管理",-1))]),s("div",xe,[l(i,null,{default:a(()=>[l(m($))]),_:1}),e[13]||(e[13]=s("span",null,"绳包信息管理",-1))]),s("div",Ve,[l(i,null,{default:a(()=>[l(g)]),_:1}),e[14]||(e[14]=s("span",null,"系统日志记录",-1))]),s("div",Ce,[l(i,null,{default:a(()=>[l(m(ae))]),_:1}),e[15]||(e[15]=s("span",null,"数据统计分析",-1))])])]),e[16]||(e[16]=s("div",{class:"decoration-bg"},[s("div",{class:"bg-circle circle-1"}),s("div",{class:"bg-circle circle-2"}),s("div",{class:"bg-circle circle-3"})],-1))]),s("div",Re,[s("div",Ee,[e[23]||(e[23]=s("div",{class:"form-header"},[s("h2",{class:"form-title"},"欢迎登录"),s("p",{class:"form-subtitle"},"选择您的登录方式")],-1)),l(Y,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=r=>R.value=r),class:"login-tabs"},{default:a(()=>[l(D,{label:"密码登录",name:"password"},{default:a(()=>[l(B,{ref_key:"loginFormRef",ref:x,model:t,rules:H,class:"login-form",onSubmit:z(M,["prevent"])},{default:a(()=>[s("div",Le,[e[17]||(e[17]=s("label",{class:"form-label"},"用户名/邮箱",-1)),l(v,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=r=>t.username=r),placeholder:"请输入用户名或邮箱",size:"large",class:"form-input","prefix-icon":m(S),clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",ze,[e[18]||(e[18]=s("label",{class:"form-label"},"密码",-1)),l(v,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=r=>t.password=r),type:"password",placeholder:"请输入密码",size:"large",class:"form-input","prefix-icon":m(K),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",Fe,[l(L,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=r=>k.value=r),class:"remember-checkbox"},{default:a(()=>e[19]||(e[19]=[y(" 记住我 ")])),_:1,__:[19]},8,["modelValue"]),s("a",{href:"#",class:"forgot-link",onClick:z(J,["prevent"])},"忘记密码？")]),l(_,{type:"primary",size:"large",class:"login-btn",loading:u.value,onClick:M},{default:a(()=>[u.value?A("",!0):(w(),h(i,{key:0},{default:a(()=>[l(m(P))]),_:1})),y(" "+F(u.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1}),l(D,{label:"验证码登录",name:"code"},{default:a(()=>[l(B,{ref_key:"codeFormRef",ref:V,model:n,rules:Q,class:"login-form",onSubmit:z(U,["prevent"])},{default:a(()=>[s("div",Se,[e[20]||(e[20]=s("label",{class:"form-label"},"邮箱地址",-1)),l(v,{modelValue:n.email,"onUpdate:modelValue":e[3]||(e[3]=r=>n.email=r),placeholder:"请输入邮箱地址",size:"large",class:"form-input","prefix-icon":m(S),clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",Te,[e[21]||(e[21]=s("label",{class:"form-label"},"验证码",-1)),s("div",Ie,[l(v,{modelValue:n.code,"onUpdate:modelValue":e[4]||(e[4]=r=>n.code=r),placeholder:"请输入验证码",size:"large",class:"form-input code-input","prefix-icon":m(K),clearable:""},null,8,["modelValue","prefix-icon"]),l(_,{type:"primary",size:"large",loading:C.value,disabled:!I(n.email)||p.value>0,onClick:X,class:"send-code-btn"},{default:a(()=>[y(F(p.value>0?`${p.value}s后重发`:"发送验证码"),1)]),_:1},8,["loading","disabled"])])]),l(_,{type:"primary",size:"large",class:"login-btn",loading:u.value,onClick:U},{default:a(()=>[u.value?A("",!0):(w(),h(i,{key:0},{default:a(()=>[l(m(P))]),_:1})),y(" "+F(u.value?"登录中...":"验证码登录"),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"]),s("div",Ue,[l(_,{type:"success",link:"",onClick:j},{default:a(()=>e[22]||(e[22]=[y("注册账号")])),_:1,__:[22]})]),e[24]||(e[24]=s("div",{class:"login-footer"},[s("p",{class:"footer-text"},"© 2024 绳包管理系统. All rights reserved."),s("p",{class:"footer-version"},"Version 1.0.0")],-1))])])])])}}}),Ae=ce(Ne,[["__scopeId","data-v-f6f3c74d"]]);export{Ae as default};
