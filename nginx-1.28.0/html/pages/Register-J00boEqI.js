import{x as I,r as _,X as N,y as T,az as B,A as a,Q as r,I as o,al as f,u as i,M as d,O as z,V,ax as F,z as M}from"../chunks/vue-vendor-BleHOoLr.js";import{u as C,l as R,m as U,a as Z,j,a1 as D,$ as K,a0 as L,K as n}from"../chunks/element-plus-Cc1YNc_4.js";import{u as O,_ as X}from"../assets/index-B_N-aWSj.js";import{a as $}from"../chunks/auth-BPpt1DgZ.js";import"../chunks/utils-Dq7h7Pqt.js";const G={class:"register-container"},H={class:"register-card"},J={class:"register-form-section"},W={class:"form-section"},Y={class:"section-header"},ee={class:"form-row"},re={class:"form-section"},se={class:"section-header"},ae={class:"form-row"},le={class:"form-section"},oe={class:"section-header"},te={class:"code-input-group"},ie={class:"agreement-section"},ne={class:"login-link"},de={class:"footer"},ue={class:"theme-toggle"},me=I({__name:"Register",setup(ce){const y=F(),w=_(),v=_(!1),x=_(!1),p=_(0),b=_(!1),s=N({username:"",password:"",confirmPassword:"",nickname:"",qq_number:"",email:"",code:""}),A={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/,message:"用户名只能包含字母、数字、下划线和中文",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-zA-Z])(?=.*\d)/,message:"密码必须包含字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(l,e,u)=>{e!==s.password?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}],nickname:[{max:20,message:"昵称长度不能超过 20 个字符",trigger:"blur"}],qq_number:[{pattern:/^[1-9][0-9]{4,11}$/,message:"请输入有效的QQ号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位数字",trigger:"blur"}]};function k(l){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)}function P(){p.value=60;const l=setInterval(()=>{p.value--,p.value<=0&&clearInterval(l)},1e3)}async function Q(){if(!s.email){n.warning("请先输入邮箱");return}if(!k(s.email)){n.error("请输入正确的邮箱格式");return}try{x.value=!0;const l=await $.sendRegisterCode({email:s.email});l.code===0?(n.success("验证码已发送，请查收邮件"),P()):n.error(l.message||"发送失败")}catch(l){console.error("发送验证码失败:",l),n.error("发送验证码失败，请稍后重试")}finally{x.value=!1}}async function q(){if(w.value){if(!b.value){n.warning("请先同意用户协议和隐私政策");return}try{await w.value.validate(),v.value=!0;const l=await $.register({username:s.username,password:s.password,nickname:s.nickname||null,qq_number:s.qq_number||null,email:s.email,verification_code:s.code});l.code===0?(n.success("注册成功！正在跳转到登录页面..."),await O.logRegister(s.username,!0,`用户注册成功: ${s.email}`).catch(e=>console.error("记录注册行为失败:",e)),setTimeout(()=>{y.push("/login")},1500)):n.error(l.message||"注册失败")}catch(l){console.error("注册失败:",l),l.response&&l.response.data&&l.response.data.message?n.error(l.response.data.message):l.message?n.error(l.message):n.error("注册失败，请重试")}finally{v.value=!1}}}function S(){y.push("/login")}return(l,e)=>{const u=f("el-icon"),m=f("el-input"),c=f("el-form-item"),g=f("el-button"),h=f("el-checkbox"),E=f("el-form");return M(),T("div",G,[e[21]||(e[21]=B('<div class="animated-background" data-v-5bca60c1><div class="gradient-circle circle-1" data-v-5bca60c1></div><div class="gradient-circle circle-2" data-v-5bca60c1></div><div class="gradient-circle circle-3" data-v-5bca60c1></div><div class="pattern-grid" data-v-5bca60c1></div></div>',1)),a("div",H,[a("div",J,[e[19]||(e[19]=a("div",{class:"register-header"},[a("h2",{class:"register-title"},"创建账号"),a("p",{class:"register-subtitle"},"加入智圆社区，开启知识分享之旅")],-1)),r(E,{ref_key:"registerFormRef",ref:w,model:s,rules:A,class:"register-form",onSubmit:V(q,["prevent"])},{default:o(()=>[a("div",W,[a("div",Y,[r(u,null,{default:o(()=>[r(i(C))]),_:1}),e[10]||(e[10]=a("h3",null,"基本信息",-1))]),r(c,{prop:"username"},{default:o(()=>[r(m,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=t=>s.username=t),placeholder:"用户名",size:"large",clearable:"","prefix-icon":i(C)},null,8,["modelValue","prefix-icon"])]),_:1}),a("div",ee,[r(c,{prop:"password"},{default:o(()=>[r(m,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=t=>s.password=t),type:"password",placeholder:"密码",size:"large","show-password":"",clearable:"","prefix-icon":i(R)},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,{prop:"confirmPassword"},{default:o(()=>[r(m,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>s.confirmPassword=t),type:"password",placeholder:"确认密码",size:"large","show-password":"",clearable:"","prefix-icon":i(R)},null,8,["modelValue","prefix-icon"])]),_:1})])]),a("div",re,[a("div",se,[r(u,null,{default:o(()=>[r(i(U))]),_:1}),e[11]||(e[11]=a("h3",null,"联系信息",-1))]),r(c,{prop:"email"},{default:o(()=>[r(m,{modelValue:s.email,"onUpdate:modelValue":e[3]||(e[3]=t=>s.email=t),placeholder:"邮箱地址",size:"large",clearable:"","prefix-icon":i(U)},null,8,["modelValue","prefix-icon"])]),_:1}),a("div",ae,[r(c,{prop:"nickname"},{default:o(()=>[r(m,{modelValue:s.nickname,"onUpdate:modelValue":e[4]||(e[4]=t=>s.nickname=t),placeholder:"昵称（可选）",size:"large",clearable:"","prefix-icon":i(Z)},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,{prop:"qq_number"},{default:o(()=>[r(m,{modelValue:s.qq_number,"onUpdate:modelValue":e[5]||(e[5]=t=>s.qq_number=t),placeholder:"QQ号（可选）",size:"large",clearable:"","prefix-icon":i(j)},null,8,["modelValue","prefix-icon"])]),_:1})])]),a("div",le,[a("div",oe,[r(u,null,{default:o(()=>[r(i(D))]),_:1}),e[12]||(e[12]=a("h3",null,"安全验证",-1))]),r(c,{prop:"code"},{default:o(()=>[a("div",te,[r(m,{modelValue:s.code,"onUpdate:modelValue":e[6]||(e[6]=t=>s.code=t),placeholder:"验证码",size:"large",clearable:"","prefix-icon":i(K)},null,8,["modelValue","prefix-icon"]),r(g,{type:"primary",class:"code-button",loading:x.value,disabled:p.value>0||!k(s.email),onClick:Q},{default:o(()=>[d(z(p.value>0?`${p.value}s`:"发送验证码"),1)]),_:1},8,["loading","disabled"])])]),_:1})]),a("div",ie,[r(h,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=t=>b.value=t),size:"large"},{default:o(()=>[e[15]||(e[15]=d(" 我已阅读并同意 ")),r(g,{type:"primary",text:"",onClick:e[7]||(e[7]=V(()=>{},["prevent"]))},{default:o(()=>e[13]||(e[13]=[d("《用户协议》")])),_:1,__:[13]}),e[16]||(e[16]=d(" 和 ")),r(g,{type:"primary",text:"",onClick:e[8]||(e[8]=V(()=>{},["prevent"]))},{default:o(()=>e[14]||(e[14]=[d("《隐私政策》")])),_:1,__:[14]})]),_:1,__:[15,16]},8,["modelValue"])]),r(g,{type:"primary",size:"large",class:"submit-button",loading:v.value,disabled:!b.value,onClick:q},{default:o(()=>[d(z(v.value?"注册中...":"立即注册"),1)]),_:1},8,["loading","disabled"])]),_:1},8,["model"]),a("div",ne,[e[18]||(e[18]=d(" 已有账号? ")),r(g,{type:"primary",text:"",onClick:S},{default:o(()=>e[17]||(e[17]=[d("立即登录")])),_:1,__:[17]})])])]),a("div",de,[a("div",ue,[r(g,{type:"primary",text:""},{default:o(()=>[r(u,null,{default:o(()=>[r(i(L))]),_:1})]),_:1})]),e[20]||(e[20]=a("div",{class:"copyright"},"© 2024 智圆社区 版本1.2.0",-1))])])}}}),be=X(me,[["__scopeId","data-v-5bca60c1"]]);export{be as default};
