import{x as we,c as R,ay as ze,r as _,X as xe,j as be,y as m,A as s,az as J,P,a6 as O,C as Ie,Q as a,H as g,K as p,I as o,M as d,u as f,al as y,O as u,ax as Se,z as n}from"../chunks/vue-vendor-BleHOoLr.js";import{u as X,j as De,J as Me,C as Pe,f as G,t as B,K as Ae,L as Te,M as qe,H as r,E as Ee}from"../chunks/element-plus-hGoKm610.js";import{T as Fe}from"../chunks/ThemeSwitcher-BZoZDXTQ.js";import{g as A,_ as Ne}from"../assets/index-C28i2SJl.js";import{p as W}from"../chunks/packages-CAyrDzlu.js";import{c as I}from"../chunks/comments-DzfIAI4A.js";import{c as Ve}from"../chunks/categories-BRHoYYyG.js";import"../chunks/utils-Dq7h7Pqt.js";const $e={class:"resource-detail-container"},Le={class:"dynamic-background"},Re={class:"floating-particles"},Be={class:"header"},Ue={class:"header-content"},je={class:"actions"},He={class:"main"},Qe={class:"main-content"},Ke={key:0,class:"loading-container"},Je={key:1,class:"not-found"},Oe={class:"resource-header"},Xe={class:"resource-title-area"},Ge={class:"resource-title"},We={class:"resource-meta"},Ye={class:"meta-item"},Ze={class:"meta-item"},et={class:"meta-item"},tt={class:"meta-item"},at={class:"resource-content"},st={class:"resource-description"},ot={class:"description-content"},lt={class:"resource-actions"},nt={class:"comments-section"},rt={key:0,class:"no-comments"},it={key:1,class:"comment-list"},ct={class:"comment-header"},dt={class:"comment-meta"},ut={class:"comment-author"},vt={key:1,class:"comment-qq ml-1"},ft={class:"comment-time"},mt={class:"comment-content"},_t={class:"comment-actions"},pt={key:2,class:"pagination"},gt={class:"comment-form"},yt={class:"form-actions"},ht=we({__name:"ResourceDetail",setup(kt){const Y=ze(),z=Se(),h=R(()=>Number(Y.params.id)||0),T=_(!0),i=_(null),C=_([]),q=_([]),E=_(""),S=_(0),x=_(1),D=_(10),U=_(!1),F=_(!1),N=_(!1),k=xe({content:"",parentId:null}),w=R(()=>localStorage.getItem("isLoggedIn")==="true");R(()=>{const e=A();return e?e.id:null});const j=e=>new Date(e).toLocaleDateString("zh-CN"),Z=e=>e?{admin:"ç®¡ç†å‘˜",moderator:"ç‰ˆä¸»",elder:"é•¿è€",user:"ç”¨æˆ·"}[e]||e:"",V=()=>{z.push("/home")},ee=()=>{z.push("/login")},te=()=>{const e=A();if(!e){z.push("/login");return}e.role==="admin"||e.role==="moderator"?z.push("/admin"):e.role==="elder"?z.push("/elder"):e.role==="user"?z.push("/user"):z.push("/403")},H=async()=>{if(h.value)try{T.value=!0;const e=await W.getPackage(h.value);e.code===0&&e.data?(i.value=e.data,i.value.category_id&&await ae(i.value.category_id)):(r.error(e.message||"åŠ è½½èµ„æºå¤±è´¥"),i.value=null)}catch(e){console.error("åŠ è½½èµ„æºå‡ºé”™:",e),r.error("åŠ è½½èµ„æºæ—¶å‘ç”Ÿé”™è¯¯"),i.value=null}finally{T.value=!1}},b=async()=>{if(h.value)try{const e=await I.getPackageComments(h.value,{page:x.value,size:D.value});e.code===0&&e.data?(C.value=e.data.list||[],S.value=e.data.total||0):(console.warn("åŠ è½½è¯„è®ºè¿”å›žé”™è¯¯:",e.message),C.value=[],S.value=0)}catch(e){console.error("åŠ è½½è¯„è®ºå‡ºé”™:",e),C.value=[],S.value=0}},Q=async()=>{try{const e=await Ve.getCategories();e.code===0&&e.data&&(q.value=e.data.list||[])}catch(e){console.error("åŠ è½½åˆ†ç±»å‡ºé”™:",e)}},ae=async e=>{q.value.length===0&&await Q();const t=q.value.find(c=>c.id===e);E.value=t?t.name:"æœªåˆ†ç±»"},se=e=>e&&{1:"#409EFF",2:"#67C23A",3:"#E6A23C",4:"#F56C6C",5:"#909399"}[e]||"#409EFF",oe=async()=>{if(h.value)try{const e=await W.downloadPackage(h.value);e.code===0?(e.data&&typeof e.data=="string"&&window.open(e.data,"_blank"),r.success("ä¸‹è½½å¼€å§‹"),H()):r.error(e.message||"ä¸‹è½½å¤±è´¥")}catch(e){console.error("ä¸‹è½½å¤±è´¥:",e),r.error("ä¸‹è½½èµ„æºæ—¶å‘ç”Ÿé”™è¯¯")}},le=async()=>{if(!w.value){r.warning("è¯·å…ˆç™»å½•åŽå†ç‚¹èµž");return}if(h.value)try{F.value=!0,{code:0,message:"ç‚¹èµžæˆåŠŸ"}.code===0&&(r.success("ç‚¹èµžæˆåŠŸ"),U.value=!0,i.value&&(i.value.like_count+=1))}catch(e){console.error("ç‚¹èµžå¤±è´¥:",e),r.error("ç‚¹èµžæ—¶å‘ç”Ÿé”™è¯¯")}finally{F.value=!1}},ne=async()=>{if(!w.value){r.warning("è¯·å…ˆç™»å½•åŽå†å‘è¡¨è¯„è®º");return}if(!k.content.trim()){r.warning("è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º");return}if(h.value)try{N.value=!0;const e=await I.createComment({content:k.content.trim(),target_id:h.value,target_type:"Package",parent_id:k.parentId??void 0});e.code===0?(r.success("è¯„è®ºå‘å¸ƒæˆåŠŸ"),k.content="",k.parentId=null,b()):r.error(e.message||"å‘å¸ƒè¯„è®ºå¤±è´¥")}catch(e){console.error("å‘å¸ƒè¯„è®ºå¤±è´¥:",e),r.error("å‘å¸ƒè¯„è®ºæ—¶å‘ç”Ÿé”™è¯¯")}finally{N.value=!1}},re=async e=>{try{const t=await I.likeComment(e,!0);if(t.code===0){r.success("ç‚¹èµžæˆåŠŸ");const c=C.value.find(v=>v.id===e);c&&(c.likes=t.data??c.likes+1)}else r.error(t.message||"ç‚¹èµžå¤±è´¥")}catch(t){console.error("ç‚¹èµžå¤±è´¥:",t),r.error("ç‚¹èµžæ—¶å‘ç”Ÿé”™è¯¯")}},ie=e=>{k.parentId=e,setTimeout(()=>{document.querySelector(".comment-form")?.scrollIntoView({behavior:"smooth"})},100)},ce=async e=>{try{await Ee.confirm("ç¡®å®šè¦åˆ é™¤æ­¤è¯„è®ºå—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const t=await I.deleteComment(e);t.code===0?(r.success("åˆ é™¤æˆåŠŸ"),b()):r.error(t.message||"åˆ é™¤å¤±è´¥")}catch(t){t!=="cancel"&&(console.error("åˆ é™¤è¯„è®ºå¤±è´¥:",t),r.error("åˆ é™¤è¯„è®ºæ—¶å‘ç”Ÿé”™è¯¯"))}},de=e=>{if(!w.value)return!1;const t=A();return t?t.role==="admin"||t.role==="moderator"?!0:e.user_id===t.id:!1},ue=e=>{if(!w.value)return!1;const t=A();return!t||!i.value?!1:t.role==="Admin"||t.role==="Elder"||t.username===i.value.author},ve=async e=>{try{const t=await I.pinComment(e.id,!e.pinned);t.code===0?(r.success(e.pinned?"å–æ¶ˆç½®é¡¶æˆåŠŸ":"ç½®é¡¶æˆåŠŸ"),e.pinned=!e.pinned):r.error(t.message||"æ“ä½œå¤±è´¥")}catch(t){console.error("ç½®é¡¶å¤±è´¥:",t),r.error("ç½®é¡¶æ—¶å‘ç”Ÿé”™è¯¯")}},fe=e=>i.value?(console.log("æ£€æŸ¥ä½œè€…èº«ä»½:",{comment_author:e.username,resource_author:i.value.author,is_match:e.username===i.value.author}),e.username===i.value.author):!1,me=e=>{D.value=e,x.value=1,b()},_e=e=>{x.value=e,b()},pe=e=>{const t=Math.random()*6+3,c=Math.random()*100,v=Math.random()*12,$=Math.random()*8+12;return{width:`${t}px`,height:`${t}px`,left:`${c}%`,animationDelay:`${v}s`,animationDuration:`${$}s`}};return be(async()=>{await Promise.all([H(),b(),Q()])}),(e,t)=>{const c=y("el-icon"),v=y("el-button"),$=y("el-skeleton"),ge=y("el-empty"),M=y("el-tag"),K=y("el-divider"),ye=y("el-avatar"),he=y("el-pagination"),ke=y("el-alert"),Ce=y("el-input");return n(),m("div",$e,[s("div",Le,[t[3]||(t[3]=J('<div class="gradient-layer" data-v-c8cdff81></div><div class="geometric-shapes" data-v-c8cdff81><div class="shape triangle-1" data-v-c8cdff81></div><div class="shape triangle-2" data-v-c8cdff81></div><div class="shape circle-1" data-v-c8cdff81></div><div class="shape circle-2" data-v-c8cdff81></div><div class="shape square-1" data-v-c8cdff81></div><div class="shape circle-3" data-v-c8cdff81></div><div class="shape triangle-3" data-v-c8cdff81></div><div class="shape square-2" data-v-c8cdff81></div></div>',2)),s("div",Re,[(n(),m(P,null,O(20,l=>s("div",{class:"particle",key:l,style:Ie(pe())},null,4)),64))]),t[4]||(t[4]=J('<div class="ripple-effects" data-v-c8cdff81><div class="ripple ripple-1" data-v-c8cdff81></div><div class="ripple ripple-2" data-v-c8cdff81></div><div class="ripple ripple-3" data-v-c8cdff81></div><div class="ripple ripple-4" data-v-c8cdff81></div><div class="ripple ripple-5" data-v-c8cdff81></div></div>',1))]),s("header",Be,[s("div",Ue,[s("div",{class:"logo",onClick:V},t[5]||(t[5]=[s("div",{class:"logo-icon"},"ðŸ“š",-1),s("div",{class:"logo-text"},[s("h1",null,"èµ„æºç¤¾åŒº"),s("p",null,"åˆ†äº«ã€å‘çŽ°ã€å­¦ä¹ ")],-1)])),s("div",je,[a(Fe),w.value?p("",!0):(n(),g(v,{key:0,type:"primary",size:"large",onClick:ee},{default:o(()=>[a(c,null,{default:o(()=>[a(f(X))]),_:1}),t[6]||(t[6]=d(" ç™»å½• "))]),_:1,__:[6]})),w.value?(n(),g(v,{key:1,type:"success",size:"large",onClick:te},{default:o(()=>[a(c,null,{default:o(()=>[a(f(De))]),_:1}),t[7]||(t[7]=d(" ç®¡ç†åŽå° "))]),_:1,__:[7]})):p("",!0)])])]),s("main",He,[s("div",Qe,[a(v,{class:"back-btn",onClick:V,type:"default",plain:""},{default:o(()=>[a(c,null,{default:o(()=>[a(f(Me))]),_:1}),t[8]||(t[8]=d(" è¿”å›žåˆ—è¡¨ "))]),_:1,__:[8]}),T.value?(n(),m("div",Ke,[a($,{rows:10,animated:""})])):i.value?(n(),m(P,{key:2},[s("div",Oe,[s("div",Xe,[s("h1",Ge,u(i.value.name),1),E.value?(n(),g(M,{key:0,class:"resource-category",size:"large",color:se(i.value.category_id)},{default:o(()=>[d(u(E.value),1)]),_:1},8,["color"])):p("",!0)]),s("div",We,[s("span",Ye,[a(c,null,{default:o(()=>[a(f(X))]),_:1}),d(" ä½œè€…: "+u(i.value.author),1)]),s("span",Ze,[a(c,null,{default:o(()=>[a(f(Pe))]),_:1}),d(" å‘å¸ƒæ—¶é—´: "+u(j(i.value.created_at)),1)]),s("span",et,[a(c,null,{default:o(()=>[a(f(G))]),_:1}),d(" ä¸‹è½½æ¬¡æ•°: "+u(i.value.download_count),1)]),s("span",tt,[a(c,null,{default:o(()=>[a(f(B))]),_:1}),d(" ç‚¹èµžæ•°: "+u(i.value.like_count),1)])])]),a(K),s("div",at,[s("div",st,[t[10]||(t[10]=s("h2",null,"èµ„æºæè¿°",-1)),s("div",ot,u(i.value.description||"æš‚æ— æè¿°ä¿¡æ¯"),1)]),s("div",lt,[a(v,{type:"primary",size:"large",onClick:oe},{default:o(()=>[a(c,null,{default:o(()=>[a(f(G))]),_:1}),t[11]||(t[11]=d(" ä¸‹è½½èµ„æº "))]),_:1,__:[11]}),a(v,{type:"default",size:"large",onClick:le,loading:F.value},{default:o(()=>[a(c,null,{default:o(()=>[a(f(B))]),_:1}),d(" "+u(U.value?"å·²ç‚¹èµž":"ç‚¹èµž"),1)]),_:1},8,["loading"])])]),a(K),s("div",nt,[s("h2",null,"ç”¨æˆ·è¯„è®º ("+u(C.value.length)+")",1),C.value.length===0?(n(),m("div",rt,t[12]||(t[12]=[s("p",null,"æš‚æ— è¯„è®ºï¼Œæˆä¸ºç¬¬ä¸€ä¸ªè¯„è®ºçš„ç”¨æˆ·å§ï¼",-1)]))):(n(),m("div",it,[(n(!0),m(P,null,O(C.value,l=>(n(),m("div",{key:l.id,class:"comment-item"},[s("div",ct,[a(ye,{src:l.author_avatar,size:"small",class:"comment-avatar"},{default:o(()=>[d(u((l.author_name||"åŒ¿").charAt(0)),1)]),_:2},1032,["src"]),s("div",dt,[s("span",ut,[d(u(l.author_name||"åŒ¿åç”¨æˆ·")+" ",1),fe(l)?(n(),g(M,{key:0,size:"small",type:"warning",class:"ml-1"},{default:o(()=>t[13]||(t[13]=[d("ä½œè€…")])),_:1,__:[13]})):p("",!0),l.pinned?(n(),g(M,{key:1,size:"small",type:"primary",class:"ml-1"},{default:o(()=>t[14]||(t[14]=[d("ç½®é¡¶")])),_:1,__:[14]})):p("",!0)]),l.author_role?(n(),g(M,{key:0,size:"small",type:"success",class:"ml-1"},{default:o(()=>[d(u(Z(l.author_role)),1)]),_:2},1024)):p("",!0),l.author_qq?(n(),m("span",vt,"QQ: "+u(l.author_qq),1)):p("",!0)]),s("div",ft,u(j(l.created_at)),1)]),s("div",mt,u(l.content),1),s("div",_t,[a(v,{link:"",size:"small",onClick:L=>re(l.id)},{default:o(()=>[a(c,null,{default:o(()=>[a(f(B))]),_:1}),d(" ç‚¹èµž ("+u(l.likes||0)+") ",1)]),_:2},1032,["onClick"]),w.value?(n(),g(v,{key:0,link:"",size:"small",onClick:L=>ie(l.id)},{default:o(()=>[a(c,null,{default:o(()=>[a(f(Ae))]),_:1}),t[15]||(t[15]=d(" å›žå¤ "))]),_:2,__:[15]},1032,["onClick"])):p("",!0),de(l)?(n(),g(v,{key:1,link:"",size:"small",onClick:L=>ce(l.id)},{default:o(()=>[a(c,null,{default:o(()=>[a(f(Te))]),_:1}),t[16]||(t[16]=d(" åˆ é™¤ "))]),_:2,__:[16]},1032,["onClick"])):p("",!0),ue()?(n(),g(v,{key:2,link:"",size:"small",onClick:L=>ve(l)},{default:o(()=>[a(c,null,{default:o(()=>[a(f(qe))]),_:1}),d(" "+u(l.pinned?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"),1)]),_:2},1032,["onClick"])):p("",!0)])]))),128))])),C.value.length>0?(n(),m("div",pt,[a(he,{"current-page":x.value,"onUpdate:currentPage":t[0]||(t[0]=l=>x.value=l),"page-size":D.value,"onUpdate:pageSize":t[1]||(t[1]=l=>D.value=l),total:S.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:me,onCurrentChange:_e,background:""},null,8,["current-page","page-size","total"])])):p("",!0),s("div",gt,[t[18]||(t[18]=s("h3",null,"å‘è¡¨è¯„è®º",-1)),w.value?(n(),m(P,{key:1},[a(Ce,{modelValue:k.content,"onUpdate:modelValue":t[2]||(t[2]=l=>k.content=l),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥æ‚¨çš„è¯„è®º",maxlength:500,"show-word-limit":""},null,8,["modelValue"]),s("div",yt,[a(v,{type:"primary",onClick:ne,loading:N.value,disabled:!k.content},{default:o(()=>t[17]||(t[17]=[d(" æäº¤è¯„è®º ")])),_:1,__:[17]},8,["loading","disabled"])])],64)):(n(),g(ke,{key:0,title:"è¯·å…ˆç™»å½•åŽå†å‘è¡¨è¯„è®º",type:"warning",closable:!1,"show-icon":""}))])])],64)):(n(),m("div",Je,[a(ge,{description:"èµ„æºä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤"}),a(v,{type:"primary",onClick:V},{default:o(()=>t[9]||(t[9]=[d("è¿”å›žé¦–é¡µ")])),_:1,__:[9]})]))])])])}}}),Mt=Ne(ht,[["__scopeId","data-v-c8cdff81"]]);export{Mt as default};
