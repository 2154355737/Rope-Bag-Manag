import{x as le,r as _,c as k,j as se,y as p,A as o,Q as a,I as s,al as n,u as v,P as N,a6 as K,H as S,O as i,a4 as ne,K as M,M as V,ax as re,z as u}from"../chunks/vue-vendor-BleHOoLr.js";import{y as ue,L as ce,v as ie,u as de,f as _e,M as pe,K as m}from"../chunks/element-plus-Cc1YNc_4.js";import{c as ve}from"../chunks/categories-BGQr79qD.js";import{p as A}from"../chunks/packages-DTwnlaPG.js";import{f as me}from"../chunks/format-CUgNVY1-.js";import{h as fe}from"../chunks/downloadErrorHandler-m_fOD5Af.js";import{_ as ge}from"../assets/index-B_N-aWSj.js";import"../chunks/utils-Dq7h7Pqt.js";const ye={class:"category-page"},he={class:"category-container"},Ce={class:"category-count"},we={class:"resource-toolbar"},ke={class:"search-box"},be={class:"sort-options"},xe={key:0,class:"category-info"},ze={key:0},Se={key:1,class:"category-info"},Ve={class:"resources-container"},Re={key:1,class:"resources-list"},Pe={class:"resource-header"},Be={class:"resource-description"},Ue={class:"resource-meta"},Ie={class:"meta-item"},Ne={class:"meta-item"},Ke={class:"meta-item"},Me={class:"resource-actions"},Ae={key:2,class:"pagination"},De=le({__name:"Category",setup(Ee){const D=re(),y=_(!1),f=_([]),h=_([]),r=_(null),C=_(""),R=_("latest"),d=_(1),g=_(12),b=async()=>{try{y.value=!0;const t={};r.value&&(t.category_id=r.value),C.value&&(t.search=C.value);const e=await A.getPackages(t);e.code===0&&e.data?h.value=e.data.list:m.error("获取资源数据失败")}catch(t){console.error("获取资源数据错误:",t),m.error("获取资源数据出错")}finally{y.value=!1}},E=async()=>{try{y.value=!0;const t=await ve.getCategories();t.code===0&&t.data?(f.value=t.data.list||[],console.log("获取到的分类数据:",f.value)):m.error("获取分类数据失败")}catch(t){console.error("获取分类数据错误:",t),m.error("获取分类数据出错")}finally{y.value=!1}},w=k(()=>r.value&&f.value.find(t=>t.id===r.value)||null),P=k(()=>r.value?h.value.filter(t=>t.category_id===r.value):h.value),x=k(()=>{const t=(d.value-1)*g.value,e=t+g.value;return P.value.slice(t,e)}),L=k(()=>P.value.length),$=t=>h.value.filter(e=>e.category_id===t).length,j=t=>{if(!t)return"未分类";const e=f.value.find(c=>c.id===t);return e?e.name:"未分类"},F=t=>{t==="all"?r.value=null:r.value=parseInt(t),d.value=1,b()},Q=()=>{d.value=1},H=()=>{d.value=1},O=t=>{g.value=t,d.value=1},T=t=>{d.value=t},q=t=>{D.push(`/resource/${t}`)},G=async t=>{try{const e=await A.downloadPackage(t);if(e.code===0&&e.data){const c=typeof e.data=="string"?e.data:e.data.url;window.open(c,"_blank"),m.success("开始下载资源")}else m.error("下载资源失败")}catch(e){fe(e,"下载资源失败")}};return se(async()=>{await E(),await b();const e=new URLSearchParams(window.location.search).get("category");e&&(r.value=parseInt(e),b())}),(t,e)=>{const c=n("el-icon"),B=n("el-menu-item"),J=n("el-menu"),U=n("el-col"),W=n("el-input"),z=n("el-option"),X=n("el-select"),Y=n("el-empty"),Z=n("el-tag"),I=n("el-button"),ee=n("el-card"),te=n("el-pagination"),ae=n("el-row");return u(),p("div",ye,[e[9]||(e[9]=o("h1",{class:"page-title"},"资源分类",-1)),o("div",he,[a(ae,{gutter:20},{default:s(()=>[a(U,{span:6,class:"category-sidebar"},{default:s(()=>[e[5]||(e[5]=o("h3",null,"所有分类",-1)),a(J,{"default-active":r.value?r.value.toString():"",class:"category-menu",onSelect:F},{default:s(()=>[a(B,{index:"all"},{default:s(()=>[a(c,null,{default:s(()=>[a(v(ue))]),_:1}),e[4]||(e[4]=o("span",null,"全部资源",-1))]),_:1,__:[4]}),(u(!0),p(N,null,K(f.value,l=>(u(),S(B,{key:l.id,index:l.id.toString()},{default:s(()=>[a(c,null,{default:s(()=>[a(v(ce))]),_:1}),o("span",null,i(l.name),1),o("span",Ce,"("+i($(l.id))+")",1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1,__:[5]}),a(U,{span:18},{default:s(()=>[o("div",we,[o("div",ke,[a(W,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),placeholder:"搜索当前分类资源...",clearable:"",onKeyup:ne(H,["enter"])},{prefix:s(()=>[a(c,null,{default:s(()=>[a(v(ie))]),_:1})]),_:1},8,["modelValue"])]),o("div",be,[a(X,{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=l=>R.value=l),placeholder:"排序方式",onChange:Q},{default:s(()=>[a(z,{label:"最新上传",value:"latest"}),a(z,{label:"下载最多",value:"downloads"}),a(z,{label:"点赞最多",value:"likes"})]),_:1},8,["modelValue"])])]),w.value?(u(),p("div",xe,[o("h2",null,i(w.value.name),1),w.value.description?(u(),p("p",ze,i(w.value.description),1)):M("",!0)])):(u(),p("div",Se,e[6]||(e[6]=[o("h2",null,"全部资源",-1),o("p",null,"显示所有分类的资源",-1)]))),o("div",Ve,[x.value.length===0?(u(),S(Y,{key:0,description:"该分类下暂无资源"})):(u(),p("div",Re,[(u(!0),p(N,null,K(x.value,l=>(u(),S(ee,{key:l.id,class:"resource-card"},{default:s(()=>[o("div",Pe,[o("h3",null,i(l.name),1),a(Z,{size:"small"},{default:s(()=>[V(i(j(l.category_id)),1)]),_:2},1024)]),o("p",Be,i(l.description||"暂无描述"),1),o("div",Ue,[o("div",Ie,[a(c,null,{default:s(()=>[a(v(de))]),_:1}),o("span",null,i(l.author),1)]),o("div",Ne,[a(c,null,{default:s(()=>[a(v(_e))]),_:1}),o("span",null,i(l.download_count)+" 次下载",1)]),o("div",Ke,[a(c,null,{default:s(()=>[a(v(pe))]),_:1}),o("span",null,i(v(me)(l.created_at)),1)])]),o("div",Me,[a(I,{type:"primary",size:"small",onClick:oe=>q(l.id)},{default:s(()=>e[7]||(e[7]=[V(" 查看详情 ")])),_:2,__:[7]},1032,["onClick"]),a(I,{type:"success",size:"small",onClick:oe=>G(l.id)},{default:s(()=>e[8]||(e[8]=[V(" 下载 ")])),_:2,__:[8]},1032,["onClick"])])]),_:2},1024))),128))])),x.value.length>0?(u(),p("div",Ae,[a(te,{"current-page":d.value,"onUpdate:currentPage":e[2]||(e[2]=l=>d.value=l),"page-size":g.value,"onUpdate:pageSize":e[3]||(e[3]=l=>g.value=l),total:L.value,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[12,24,48],onSizeChange:O,onCurrentChange:T,background:""},null,8,["current-page","page-size","total"])])):M("",!0)])]),_:1})]),_:1})])])}}}),qe=ge(De,[["__scopeId","data-v-8736b0d1"]]);export{qe as default};
