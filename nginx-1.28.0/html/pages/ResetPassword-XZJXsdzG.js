import{x as k,r as g,X as v,j as y,ay as x,ax as R,y as q,A as c,Q as r,I as a,al as p,M as _,O as C,u as h,z as U}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as E}from"../assets/index-C3B7XhMB.js";import{a as I}from"../chunks/auth-nPQHqB8E.js";import{I as u,R as B}from"../chunks/element-plus-D5w7-vkF.js";import"../chunks/utils-Dq7h7Pqt.js";const M={class:"reset-password-container"},N={class:"reset-form-card"},A=k({__name:"ResetPassword",setup(S){const i=R(),f=x(),m=g(null),d=g(!1),e=v({email:"",token:"",newPassword:"",confirmPassword:""}),b={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"邮箱格式不正确",trigger:"blur"}],token:[{required:!0,message:"重置令牌不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,o,l)=>{o!==e.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]};y(()=>{e.token=f.query.token||"";const s=f.query.email||"";e.email=s?decodeURIComponent(s):"",(!e.token||!e.email)&&(u.error("重置链接无效或已过期"),i.push("/forgot-password"))});async function P(){if(m.value)try{await m.value.validate(),d.value=!0;const s=await I.resetPassword({email:e.email,token:e.token,new_password:e.newPassword});s.code===0?(u.success("密码重置成功，请使用新密码登录"),i.push("/login")):u.error(s.message||"密码重置失败")}catch(s){console.error("密码重置失败:",s),u.error(s.message||"密码重置失败")}finally{d.value=!1}}function V(){i.push("/login")}return(s,o)=>{const l=p("el-input"),n=p("el-form-item"),w=p("el-button");return U(),q("div",M,[c("div",N,[o[5]||(o[5]=c("h2",null,"重置密码",-1)),r(h(B),{model:e,rules:b,ref_key:"formRef",ref:m,"label-width":"100px"},{default:a(()=>[r(n,{label:"邮箱",prop:"email"},{default:a(()=>[r(l,{modelValue:e.email,"onUpdate:modelValue":o[0]||(o[0]=t=>e.email=t),placeholder:"请输入注册邮箱",disabled:!0},null,8,["modelValue"])]),_:1}),r(n,{label:"重置令牌",prop:"token"},{default:a(()=>[r(l,{modelValue:e.token,"onUpdate:modelValue":o[1]||(o[1]=t=>e.token=t),placeholder:"从邮件中获取的重置令牌",disabled:!0},null,8,["modelValue"])]),_:1}),r(n,{label:"新密码",prop:"newPassword"},{default:a(()=>[r(l,{modelValue:e.newPassword,"onUpdate:modelValue":o[2]||(o[2]=t=>e.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),r(n,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[r(l,{modelValue:e.confirmPassword,"onUpdate:modelValue":o[3]||(o[3]=t=>e.confirmPassword=t),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1}),r(n,null,{default:a(()=>[r(w,{type:"primary",loading:d.value,onClick:P},{default:a(()=>[_(C(d.value?"重置中...":"重置密码"),1)]),_:1},8,["loading"]),r(w,{onClick:V},{default:a(()=>o[4]||(o[4]=[_("返回登录")])),_:1,__:[4]})]),_:1})]),_:1},8,["model"])])])}}}),O=E(A,[["__scopeId","data-v-29d7c685"]]);export{O as default};
