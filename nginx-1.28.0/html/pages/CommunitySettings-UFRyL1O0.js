import{j as E,c as M,a4 as N,n as H,S as R,a5 as T,Y as z,H as d,E as A}from"../chunks/element-plus-hGoKm610.js";import{s as k}from"../chunks/settings-fijZrfco.js";import{x as D,r as V,X as C,j as G,y as S,A as a,Q as t,I as s,u as p,al as m,M as U,K as I,O as g,z as j}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as F}from"../assets/index-C28i2SJl.js";import"../chunks/utils-Dq7h7Pqt.js";const K={class:"admin-page community-settings"},X={class:"page-header"},Y={class:"header-content"},J={class:"header-left"},L={class:"header-icon"},P={class:"header-actions"},W={class:"settings-content"},Z={class:"card-header"},$={class:"card-header"},ee={class:"card-header"},te={class:"card-header"},le={class:"preview-section"},se={class:"preview-item"},ae={class:"preview-item"},oe={class:"preview-item"},ie={key:0,class:"preview-item"},ne={class:"announcement-preview"},re={class:"preview-item"},ue=D({__name:"CommunitySettings",setup(de){const y=V(!1),f=V(!1),w=V(),e=C({site_title:"",site_subtitle:"",site_description:"",welcome_message:"",announcement:"",footer_text:"",contact_email:"",github_link:"",qq_group:"",wechat_group:""}),n=C({site_title:"",site_subtitle:"",site_description:"",welcome_message:"",announcement:"",footer_text:"",contact_email:"",github_link:"",qq_group:"",wechat_group:""}),v={site_title:[{required:!0,message:"请输入网站标题",trigger:"blur"},{min:1,max:50,message:"标题长度应在1-50个字符之间",trigger:"blur"}],site_subtitle:[{required:!0,message:"请输入网站副标题",trigger:"blur"},{min:1,max:100,message:"副标题长度应在1-100个字符之间",trigger:"blur"}],site_description:[{required:!0,message:"请输入网站描述",trigger:"blur"},{min:1,max:200,message:"描述长度应在1-200个字符之间",trigger:"blur"}],welcome_message:[{required:!0,message:"请输入欢迎消息",trigger:"blur"},{min:1,max:500,message:"欢迎消息长度应在1-500个字符之间",trigger:"blur"}],contact_email:[{required:!0,message:"请输入联系邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],footer_text:[{required:!0,message:"请输入页脚文本",trigger:"blur"},{min:1,max:100,message:"页脚文本长度应在1-100个字符之间",trigger:"blur"}]},B=async()=>{y.value=!0;try{const o=await k.getCommunitySettings();o.code===0&&o.data?(Object.assign(e,o.data),Object.assign(n,o.data)):d.error(o.message||"加载设置失败")}catch(o){console.error("加载社区设置出错:",o),d.error("加载设置时发生错误")}finally{y.value=!1}},O=async()=>{if(w.value){try{await w.value.validate()}catch{d.warning("请检查表单输入");return}f.value=!0;try{const o={};if(e.site_title!==n.site_title&&(o.site_title=e.site_title),e.site_subtitle!==n.site_subtitle&&(o.site_subtitle=e.site_subtitle),e.site_description!==n.site_description&&(o.site_description=e.site_description),e.welcome_message!==n.welcome_message&&(o.welcome_message=e.welcome_message),e.announcement!==n.announcement&&(o.announcement=e.announcement||""),e.footer_text!==n.footer_text&&(o.footer_text=e.footer_text),e.contact_email!==n.contact_email&&(o.contact_email=e.contact_email),e.github_link!==n.github_link&&(o.github_link=e.github_link||""),e.qq_group!==n.qq_group&&(o.qq_group=e.qq_group||""),e.wechat_group!==n.wechat_group&&(o.wechat_group=e.wechat_group||""),Object.keys(o).length===0){d.info("没有需要更新的设置");return}const l=await k.updateCommunitySettings(o);l.code===0?(d.success("社区设置保存成功"),Object.assign(n,e)):d.error(l.message||"保存设置失败")}catch(o){console.error("保存社区设置出错:",o),d.error("保存设置时发生错误")}finally{f.value=!1}}},Q=async()=>{try{await A.confirm("确定要重置所有设置到原始状态吗？","重置确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Object.assign(e,n),d.success("设置已重置")}catch{}};return G(()=>{B()}),(o,l)=>{const _=m("el-icon"),q=m("el-button"),r=m("el-input"),u=m("el-form-item"),c=m("el-col"),h=m("el-row"),x=m("el-form"),b=m("el-card");return j(),S("div",K,[a("div",X,[a("div",Y,[a("div",J,[a("div",L,[t(_,{size:32},{default:s(()=>[t(p(E))]),_:1})]),l[10]||(l[10]=a("div",{class:"header-info"},[a("h1",{class:"page-title"},"社区设置"),a("p",{class:"page-subtitle"},"管理社区主页的显示内容和基本信息")],-1))]),a("div",P,[t(q,{type:"primary",onClick:O,loading:f.value},{default:s(()=>[t(_,null,{default:s(()=>[t(p(M))]),_:1}),l[11]||(l[11]=U(" 保存设置 "))]),_:1,__:[11]},8,["loading"]),t(q,{onClick:Q,disabled:f.value},{default:s(()=>[t(_,null,{default:s(()=>[t(p(N))]),_:1}),l[12]||(l[12]=U(" 重置 "))]),_:1,__:[12]},8,["disabled"])])])]),a("div",W,[t(b,{shadow:"never"},{header:s(()=>[a("div",Z,[t(_,null,{default:s(()=>[t(p(H))]),_:1}),l[13]||(l[13]=a("span",null,"基本信息",-1))])]),default:s(()=>[t(x,{ref_key:"formRef",ref:w,model:e,rules:v,"label-width":"120px","label-position":"left"},{default:s(()=>[t(h,{gutter:24},{default:s(()=>[t(c,{span:12},{default:s(()=>[t(u,{label:"网站标题",prop:"site_title"},{default:s(()=>[t(r,{modelValue:e.site_title,"onUpdate:modelValue":l[0]||(l[0]=i=>e.site_title=i),placeholder:"请输入网站标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:s(()=>[t(u,{label:"网站副标题",prop:"site_subtitle"},{default:s(()=>[t(r,{modelValue:e.site_subtitle,"onUpdate:modelValue":l[1]||(l[1]=i=>e.site_subtitle=i),placeholder:"请输入网站副标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{label:"网站描述",prop:"site_description"},{default:s(()=>[t(r,{modelValue:e.site_description,"onUpdate:modelValue":l[2]||(l[2]=i=>e.site_description=i),type:"textarea",rows:3,placeholder:"请输入网站描述","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]),_:1}),t(u,{label:"欢迎消息",prop:"welcome_message"},{default:s(()=>[t(r,{modelValue:e.welcome_message,"onUpdate:modelValue":l[3]||(l[3]=i=>e.welcome_message=i),type:"textarea",rows:4,placeholder:"请输入欢迎消息","show-word-limit":"",maxlength:"500"},null,8,["modelValue"])]),_:1}),t(u,{label:"网站公告"},{default:s(()=>[t(r,{modelValue:e.announcement,"onUpdate:modelValue":l[4]||(l[4]=i=>e.announcement=i),type:"textarea",rows:3,placeholder:"请输入网站公告（留空则不显示公告）","show-word-limit":"",maxlength:"300"},null,8,["modelValue"]),l[14]||(l[14]=a("div",{class:"form-tip"}," 公告将在社区主页顶部显示，留空则隐藏公告栏 ",-1))]),_:1,__:[14]})]),_:1},8,["model"])]),_:1}),t(b,{shadow:"never",style:{"margin-top":"20px"}},{header:s(()=>[a("div",$,[t(_,null,{default:s(()=>[t(p(R))]),_:1}),l[15]||(l[15]=a("span",null,"联系方式",-1))])]),default:s(()=>[t(x,{model:e,rules:v,"label-width":"120px","label-position":"left"},{default:s(()=>[t(h,{gutter:24},{default:s(()=>[t(c,{span:12},{default:s(()=>[t(u,{label:"联系邮箱",prop:"contact_email"},{default:s(()=>[t(r,{modelValue:e.contact_email,"onUpdate:modelValue":l[5]||(l[5]=i=>e.contact_email=i),placeholder:"请输入联系邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:s(()=>[t(u,{label:"GitHub 链接"},{default:s(()=>[t(r,{modelValue:e.github_link,"onUpdate:modelValue":l[6]||(l[6]=i=>e.github_link=i),placeholder:"请输入GitHub项目链接（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(h,{gutter:24},{default:s(()=>[t(c,{span:12},{default:s(()=>[t(u,{label:"QQ 群"},{default:s(()=>[t(r,{modelValue:e.qq_group,"onUpdate:modelValue":l[7]||(l[7]=i=>e.qq_group=i),placeholder:"请输入QQ群号（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:s(()=>[t(u,{label:"微信群"},{default:s(()=>[t(r,{modelValue:e.wechat_group,"onUpdate:modelValue":l[8]||(l[8]=i=>e.wechat_group=i),placeholder:"请输入微信群信息（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(b,{shadow:"never",style:{"margin-top":"20px"}},{header:s(()=>[a("div",ee,[t(_,null,{default:s(()=>[t(p(T))]),_:1}),l[16]||(l[16]=a("span",null,"页脚设置",-1))])]),default:s(()=>[t(x,{model:e,rules:v,"label-width":"120px","label-position":"left"},{default:s(()=>[t(u,{label:"页脚文本",prop:"footer_text"},{default:s(()=>[t(r,{modelValue:e.footer_text,"onUpdate:modelValue":l[9]||(l[9]=i=>e.footer_text=i),type:"textarea",rows:2,placeholder:"请输入页脚文本","show-word-limit":"",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),t(b,{shadow:"never",style:{"margin-top":"20px"}},{header:s(()=>[a("div",te,[t(_,null,{default:s(()=>[t(p(z))]),_:1}),l[17]||(l[17]=a("span",null,"设置预览",-1))])]),default:s(()=>[a("div",le,[a("div",se,[l[18]||(l[18]=a("label",null,"网站标题：",-1)),a("span",null,g(e.site_title||"未设置"),1)]),a("div",ae,[l[19]||(l[19]=a("label",null,"网站副标题：",-1)),a("span",null,g(e.site_subtitle||"未设置"),1)]),a("div",oe,[l[20]||(l[20]=a("label",null,"网站描述：",-1)),a("span",null,g(e.site_description||"未设置"),1)]),e.announcement?(j(),S("div",ie,[l[21]||(l[21]=a("label",null,"网站公告：",-1)),a("span",ne,g(e.announcement),1)])):I("",!0),a("div",re,[l[22]||(l[22]=a("label",null,"联系邮箱：",-1)),a("span",null,g(e.contact_email||"未设置"),1)])])]),_:1})])])}}}),fe=F(ue,[["__scopeId","data-v-1cfec4ab"]]);export{fe as default};
