import{x as fe,r as c,X as me,c as ye,j as he,y as d,A as s,Q as l,H as g,I as o,M as r,u as v,al as _,K as m,a4 as be,P as k,a6 as w,O as u,J as ke,ar as Ve,ax as Ce,z as n}from"../chunks/vue-vendor-BleHOoLr.js";import{W as ze,u as we,v as xe,X as De,R as Pe,V as Te,A as X,D as Ue,j as Fe,o as Be,Y as Se,K as A,E as $e}from"../chunks/element-plus-Cc1YNc_4.js";import{g as Ae,_ as Me}from"../assets/index-B_N-aWSj.js";import{c as Ee}from"../chunks/categories-BGQr79qD.js";import{g as Ke,c as Ne}from"../chunks/posts-B23axQf4.js";import{g as Re,a as Ye}from"../chunks/tags-BVMB1T7b.js";import{f as je}from"../chunks/format-CUgNVY1-.js";import"../chunks/utils-Dq7h7Pqt.js";const He={class:"posts-page"},Ie={class:"page-header"},qe={class:"header-container"},Le={class:"header-content"},Qe={class:"header-actions"},Xe={class:"main-content"},Je={class:"content-container"},Oe={class:"filter-section"},We={class:"filter-card"},Ge={class:"search-area"},Ze={class:"search-input-wrapper"},et={class:"filters-area"},tt={class:"filter-group"},at={class:"filter-group"},lt={class:"filter-group"},st={key:0,class:"tags-section"},ot={class:"tags-card"},nt={class:"tags-header"},rt={class:"tags-title"},it={class:"tags-list"},dt={class:"posts-section"},ut={class:"posts-container"},ct={key:0,class:"empty-state"},_t={class:"empty-card"},pt={class:"empty-icon"},gt={class:"empty-description"},vt={key:1,class:"posts-grid"},ft=["onClick"],mt={class:"post-header"},yt={class:"post-meta"},ht={class:"author-info"},bt={class:"author-details"},kt={class:"author-name"},Vt={class:"post-time"},Ct={class:"post-badges"},zt={class:"post-content"},wt={class:"post-title"},xt={class:"post-excerpt"},Dt={key:0,class:"post-tags"},Pt={key:0,class:"more-tags"},Tt={class:"post-footer"},Ut={class:"post-stats"},Ft={class:"stat-item"},Bt={class:"stat-item"},St={class:"stat-item"},$t={class:"post-category"},At={key:0,class:"pagination-section"},Mt={class:"pagination-wrapper"},Et={class:"pagination-info"},Kt={class:"info-text"},Nt={class:"create-form-container"},Rt={class:"dialog-footer"},Yt=fe({__name:"Posts",setup(jt){const J=a=>je(a,"YYYY-MM-DD HH:mm"),M=a=>a<1e3?a.toString():a<1e4?(a/1e3).toFixed(1)+"K":a<1e6?(a/1e4).toFixed(1)+"万":(a/1e6).toFixed(1)+"M",O=Ce(),U=c(!1),F=c(!1),E=c([]),K=c([]),N=c([]),I=c([]),B=c(0),V=c(1),S=c(12),y=c(""),R=c(),Y=c(),j=c("created_at"),h=c(!1),x=c(),i=me({title:"",content:"",category_id:void 0,tags:[],status:"Draft"}),W={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{min:10,message:"内容至少 10 个字符",trigger:"blur"}]},q=ye(()=>!!Ae()),D=async()=>{U.value=!0;try{const a={page:V.value,page_size:S.value,search:y.value||void 0,category_id:R.value,status:Y.value,sort_by:j.value},e=await Ke(a);e.code===0&&e.data&&(E.value=e.data.list,B.value=e.data.total)}catch(a){console.error("加载帖子失败:",a),A.error("加载帖子失败")}finally{U.value=!1}},G=async()=>{try{const a=await Ee.getCategories();a.code===0&&a.data&&(K.value=a.data?.list||a.data||[])}catch(a){console.error("加载分类失败:",a)}},Z=async()=>{try{const a=await Re();a.code===0&&a.data&&(N.value=a.data)}catch(a){console.error("加载热门标签失败:",a)}},ee=async()=>{try{const a=await Ye();a.code===0&&a.data&&(I.value=a.data)}catch(a){console.error("加载所有标签失败:",a)}},b=()=>{V.value=1,D()},te=a=>{S.value=a,V.value=1,D()},ae=a=>{V.value=a,D()},le=a=>{y.value=a,b()},se=a=>{O.push(`/posts/${a}`)},oe=a=>a.length>120?a.substring(0,120)+"...":a,ne=a=>{const e=["primary","success","warning","danger","info"];return e[a%e.length]},re=a=>{if(a===void 0)return"info";const e=["primary","success","warning","danger","info"];return e[a%e.length]},ie=async()=>{if(x.value)try{await x.value.validate(),F.value=!0;const a=await Ne(i);a.code===0?(A.success("帖子发布成功"),h.value=!1,L(),D()):A.error(a.msg||"发布失败")}catch(a){console.error("发布帖子失败:",a),A.error("发布帖子失败")}finally{F.value=!1}},de=()=>{$e.confirm("确定要取消发布吗？未保存的内容将丢失。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.value=!1,L()}).catch(()=>{})},L=()=>{i.title="",i.content="",i.category_id=void 0,i.tags=[],i.status="Draft",x.value&&x.value.resetFields()};return he(()=>{D(),G(),Z(),ee()}),(a,e)=>{const p=_("el-icon"),C=_("el-button"),H=_("el-input"),f=_("el-option"),P=_("el-select"),z=_("el-tag"),ue=_("el-avatar"),ce=_("el-pagination"),T=_("el-form-item"),Q=_("el-radio"),_e=_("el-radio-group"),pe=_("el-form"),ge=_("el-dialog"),ve=Ve("loading");return n(),d("div",He,[s("header",Ie,[s("div",qe,[s("div",Le,[e[18]||(e[18]=s("div",{class:"header-main"},[s("h1",{class:"page-title"},"社区帖子"),s("p",{class:"page-description"},"分享你的想法，与社区成员交流互动")],-1)),s("div",Qe,[q.value?(n(),g(C,{key:0,type:"primary",size:"large",onClick:e[0]||(e[0]=t=>h.value=!0),class:"create-btn"},{default:o(()=>[l(p,null,{default:o(()=>[l(v(ze))]),_:1}),e[16]||(e[16]=r(" 发布帖子 "))]),_:1,__:[16]})):(n(),g(C,{key:1,type:"primary",size:"large",onClick:e[1]||(e[1]=t=>a.$router.push("/login")),class:"login-btn"},{default:o(()=>[l(p,null,{default:o(()=>[l(v(we))]),_:1}),e[17]||(e[17]=r(" 登录发帖 "))]),_:1,__:[17]}))])])])]),s("main",Xe,[s("div",Je,[s("div",Oe,[s("div",We,[s("div",Ge,[s("div",Ze,[l(H,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),placeholder:"搜索帖子标题、内容...",clearable:"",size:"large",class:"search-input",onKeyup:be(b,["enter"]),onClear:b},{prefix:o(()=>[l(p,null,{default:o(()=>[l(v(xe))]),_:1})]),_:1},8,["modelValue"]),l(C,{type:"primary",size:"large",onClick:b,class:"search-btn"},{default:o(()=>e[19]||(e[19]=[r(" 搜索 ")])),_:1,__:[19]})])]),s("div",et,[s("div",tt,[e[20]||(e[20]=s("label",{class:"filter-label"},"分类筛选",-1)),l(P,{modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=t=>R.value=t),placeholder:"选择分类",clearable:"",size:"large",onChange:b,class:"filter-select"},{default:o(()=>[(n(!0),d(k,null,w(K.value,t=>(n(),g(f,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s("div",at,[e[21]||(e[21]=s("label",{class:"filter-label"},"状态筛选",-1)),l(P,{modelValue:Y.value,"onUpdate:modelValue":e[4]||(e[4]=t=>Y.value=t),placeholder:"选择状态",clearable:"",size:"large",onChange:b,class:"filter-select"},{default:o(()=>[l(f,{label:"已发布",value:"Published"}),l(f,{label:"草稿",value:"Draft"}),l(f,{label:"已归档",value:"Archived"})]),_:1},8,["modelValue"])]),s("div",lt,[e[22]||(e[22]=s("label",{class:"filter-label"},"排序方式",-1)),l(P,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=t=>j.value=t),size:"large",onChange:b,class:"filter-select"},{default:o(()=>[l(f,{label:"最新发布",value:"created_at"}),l(f,{label:"最多浏览",value:"view_count"}),l(f,{label:"最多点赞",value:"like_count"}),l(f,{label:"最多评论",value:"comment_count"})]),_:1},8,["modelValue"])])])]),N.value.length>0?(n(),d("div",st,[s("div",ot,[s("div",nt,[s("h3",rt,[l(p,null,{default:o(()=>[l(v(De))]),_:1}),e[23]||(e[23]=r(" 热门标签 "))])]),s("div",it,[(n(!0),d(k,null,w(N.value,t=>(n(),g(z,{key:t.id,type:ne(t.id),size:"large",effect:"light",class:"tag-item",onClick:$=>le(t.name)},{default:o(()=>[r(u(t.name),1)]),_:2},1032,["type","onClick"]))),128))])])])):m("",!0)]),s("div",dt,[ke((n(),d("div",ut,[E.value.length===0&&!U.value?(n(),d("div",ct,[s("div",_t,[s("div",pt,[l(p,null,{default:o(()=>[l(v(Pe))]),_:1})]),e[25]||(e[25]=s("h3",{class:"empty-title"},"暂无帖子",-1)),s("p",gt,u(y.value?"没有找到匹配的帖子":"还没有人发布帖子，来发布第一个吧！"),1),q.value&&!y.value?(n(),g(C,{key:0,type:"primary",onClick:e[6]||(e[6]=t=>h.value=!0)},{default:o(()=>e[24]||(e[24]=[r(" 发布帖子 ")])),_:1,__:[24]})):m("",!0)])])):(n(),d("div",vt,[(n(!0),d(k,null,w(E.value,t=>(n(),d("article",{key:t.id,class:"post-card",onClick:$=>se(t.id)},[s("header",mt,[s("div",yt,[s("div",ht,[l(ue,{size:32,class:"author-avatar"},{default:o(()=>[r(u(t.author_name?.charAt(0)||"U"),1)]),_:2},1024),s("div",bt,[s("span",kt,u(t.author_name),1),s("span",Vt,u(J(t.created_at)),1)])]),s("div",Ct,[t.is_pinned?(n(),g(z,{key:0,type:"warning",size:"small",effect:"dark"},{default:o(()=>[l(p,null,{default:o(()=>[l(v(Te))]),_:1}),e[26]||(e[26]=r(" 置顶 "))]),_:1,__:[26]})):m("",!0),t.is_featured?(n(),g(z,{key:1,type:"success",size:"small",effect:"dark"},{default:o(()=>[l(p,null,{default:o(()=>[l(v(X))]),_:1}),e[27]||(e[27]=r(" 精选 "))]),_:1,__:[27]})):m("",!0),t.status==="Draft"?(n(),g(z,{key:2,type:"info",size:"small",effect:"light"},{default:o(()=>e[28]||(e[28]=[r(" 草稿 ")])),_:1,__:[28]})):m("",!0)])])]),s("div",zt,[s("h3",wt,u(t.title),1),s("p",xt,u(oe(t.content)),1),t.tags&&t.tags.length>0?(n(),d("div",Dt,[(n(!0),d(k,null,w(t.tags.slice(0,3),$=>(n(),g(z,{key:$,size:"small",effect:"plain",class:"post-tag"},{default:o(()=>[r(u($),1)]),_:2},1024))),128)),t.tags.length>3?(n(),d("span",Pt," +"+u(t.tags.length-3),1)):m("",!0)])):m("",!0)]),s("footer",Tt,[s("div",Ut,[s("div",Ft,[l(p,null,{default:o(()=>[l(v(Ue))]),_:1}),s("span",null,u(M(t.view_count)),1)]),s("div",Bt,[l(p,null,{default:o(()=>[l(v(Fe))]),_:1}),s("span",null,u(M(t.comment_count)),1)]),s("div",St,[l(p,null,{default:o(()=>[l(v(X))]),_:1}),s("span",null,u(M(t.like_count)),1)])]),s("div",$t,[t.category_name?(n(),g(z,{key:0,type:re(t.category_id),size:"small",effect:"light"},{default:o(()=>[r(u(t.category_name),1)]),_:2},1032,["type"])):m("",!0)])])],8,ft))),128))]))])),[[ve,U.value]])]),B.value>0?(n(),d("div",At,[s("div",Mt,[s("div",Et,[s("span",Kt,[r(" 共 "+u(B.value)+" 个帖子 ",1),y.value?(n(),d(k,{key:0},[r(' ，搜索 "'+u(y.value)+'" ',1)],64)):m("",!0)])]),l(ce,{"current-page":V.value,"onUpdate:currentPage":e[7]||(e[7]=t=>V.value=t),"page-size":S.value,"onUpdate:pageSize":e[8]||(e[8]=t=>S.value=t),"page-sizes":[12,24,48],total:B.value,layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:te,onCurrentChange:ae,class:"pagination"},null,8,["current-page","page-size","total"])])])):m("",!0)])]),l(ge,{modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=t=>h.value=t),title:"发布新帖子",width:"800px","before-close":de,class:"create-dialog"},{footer:o(()=>[s("div",Rt,[l(C,{onClick:e[14]||(e[14]=t=>h.value=!1),size:"large"},{default:o(()=>e[31]||(e[31]=[r(" 取消 ")])),_:1,__:[31]}),l(C,{type:"primary",onClick:ie,loading:F.value,size:"large"},{default:o(()=>[r(u(F.value?"发布中...":"发布帖子"),1)]),_:1},8,["loading"])])]),default:o(()=>[s("div",Nt,[l(pe,{ref_key:"createFormRef",ref:x,model:i,rules:W,"label-width":"80px",class:"create-form"},{default:o(()=>[l(T,{label:"标题",prop:"title"},{default:o(()=>[l(H,{modelValue:i.title,"onUpdate:modelValue":e[9]||(e[9]=t=>i.title=t),placeholder:"请输入帖子标题",maxlength:"100","show-word-limit":"",size:"large"},null,8,["modelValue"])]),_:1}),l(T,{label:"分类",prop:"category_id"},{default:o(()=>[l(P,{modelValue:i.category_id,"onUpdate:modelValue":e[10]||(e[10]=t=>i.category_id=t),placeholder:"选择分类",clearable:"",size:"large",style:{width:"100%"}},{default:o(()=>[(n(!0),d(k,null,w(K.value,t=>(n(),g(f,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(T,{label:"标签"},{default:o(()=>[l(P,{modelValue:i.tags,"onUpdate:modelValue":e[11]||(e[11]=t=>i.tags=t),multiple:"",filterable:"","allow-create":"",placeholder:"选择或创建标签",size:"large",style:{width:"100%"}},{default:o(()=>[(n(!0),d(k,null,w(I.value,t=>(n(),g(f,{key:t.id,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(T,{label:"内容",prop:"content"},{default:o(()=>[l(H,{modelValue:i.content,"onUpdate:modelValue":e[12]||(e[12]=t=>i.content=t),type:"textarea",rows:8,placeholder:"请输入帖子内容...",maxlength:"2000","show-word-limit":"",resize:"vertical"},null,8,["modelValue"])]),_:1}),l(T,{label:"状态"},{default:o(()=>[l(_e,{modelValue:i.status,"onUpdate:modelValue":e[13]||(e[13]=t=>i.status=t),size:"large"},{default:o(()=>[l(Q,{value:"Draft"},{default:o(()=>[l(p,null,{default:o(()=>[l(v(Be))]),_:1}),e[29]||(e[29]=r(" 草稿 "))]),_:1,__:[29]}),l(Q,{value:"Published"},{default:o(()=>[l(p,null,{default:o(()=>[l(v(Se))]),_:1}),e[30]||(e[30]=r(" 发布 "))]),_:1,__:[30]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}}),Wt=Me(Yt,[["__scopeId","data-v-326b8201"]]);export{Wt as default};
