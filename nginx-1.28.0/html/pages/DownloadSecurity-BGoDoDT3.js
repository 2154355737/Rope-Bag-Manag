import{c as O,K as d}from"../chunks/element-plus-Cc1YNc_4.js";import{a as k}from"../chunks/admin-DseeQ8_4.js";import{x as z,r as w,j as H,y as c,Q as t,I as a,H as g,K as L,al as i,A as s,O as p,P as Q,a6 as q,M as C,u as G,z as _}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as J}from"../assets/index-B_N-aWSj.js";import"../chunks/utils-Dq7h7Pqt.js";const R={class:"download-security"},W={class:"card-header"},X={class:"stat-item"},Y={class:"stat-number"},Z={class:"stat-item"},ee={class:"stat-number"},te={class:"stat-item"},ae={class:"stat-number"},le={class:"stat-item"},se={class:"stat-number"},oe={key:0,class:"no-data"},ne={key:1,class:"anomaly-chart"},re={class:"type-name"},ie={class:"type-count"},de={class:"monitor-content"},_e={key:1,class:"no-anomalies"},ue=z({__name:"DownloadSecurity",setup(me){const r=w({}),o=w({enable_rate_limiting:!0,enable_anomaly_detection:!0,enable_statistical_analysis:!0,max_downloads_per_user_per_hour:10,max_downloads_per_ip_per_hour:20,max_downloads_per_resource_per_day:50,suspicious_pattern_threshold:.8,statistical_anomaly_threshold:2}),S=w([]),y=w(!1),M=async()=>{try{y.value=!0;const l=await k.getDownloadSecurityStats();l.code===0?r.value=l.data:d.warning("获取安全统计失败: "+l.message)}catch(l){console.error("获取安全统计失败:",l),l.response?.status===403?d.warning("权限不足，请确保您有管理员权限"):l.response?.status===404?d.warning("API接口不可用，请检查后端服务是否正常运行"):d.error("获取安全统计失败: "+(l.message||"网络错误"))}finally{y.value=!1}},U=async()=>{try{const l=await k.getDownloadSecurityConfig();l.code===0?o.value=l.data:d.warning("获取安全配置失败: "+l.message)}catch(l){console.error("获取安全配置失败:",l),l.response?.status===403?d.warning("权限不足，请确保您有管理员权限"):l.response?.status===404?d.warning("API接口不可用，请检查后端服务是否正常运行"):d.error("获取安全配置失败: "+(l.message||"网络错误"))}},D=async()=>{try{(await k.updateDownloadSecurityConfig(o.value)).code===0&&d.success("配置保存成功")}catch(l){console.error("保存配置失败:",l),d.error("保存配置失败")}},F=()=>{o.value={enable_rate_limiting:!0,enable_anomaly_detection:!0,enable_statistical_analysis:!0,max_downloads_per_user_per_hour:10,max_downloads_per_ip_per_hour:20,max_downloads_per_resource_per_day:50,suspicious_pattern_threshold:.8,statistical_anomaly_threshold:2},d.info("配置已重置")},I=()=>{M(),U()},N=l=>{const e=String(l);return{rate_limit_exceeded:"频率限制超限",suspicious_pattern:"可疑模式",statistical_anomaly:"统计异常"}[e]||e},P=l=>{const e=r.value.total_anomalies||1;return Math.round(l/e*100)},B=l=>{const e=String(l);return{rate_limit_exceeded:"#E6A23C",suspicious_pattern:"#F56C6C",statistical_anomaly:"#909399"}[e]||"#409EFF"};return H(()=>{M(),U()}),(l,e)=>{const v=i("el-button"),m=i("el-card"),b=i("el-col"),E=i("el-row"),f=i("el-alert"),T=i("el-empty"),$=i("el-progress"),x=i("el-switch"),u=i("el-form-item"),V=i("el-input-number"),A=i("el-slider"),j=i("el-form"),K=i("el-icon");return _(),c("div",R,[t(m,{class:"security-card"},{header:a(()=>[s("div",W,[e[8]||(e[8]=s("span",null,"下载安全监控",-1)),t(v,{type:"primary",onClick:I,loading:y.value},{default:a(()=>[C(p(y.value?"加载中...":"刷新数据"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(E,{gutter:20,class:"stats-overview"},{default:a(()=>[t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[s("div",X,[s("div",Y,p(r.value.total_anomalies||0),1),e[9]||(e[9]=s("div",{class:"stat-label"},"总异常数",-1)),e[10]||(e[10]=s("div",{class:"stat-desc"},"24小时内检测到的异常",-1))])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[s("div",Z,[s("div",ee,p(r.value.by_severity?.critical||0),1),e[11]||(e[11]=s("div",{class:"stat-label"},"严重异常",-1)),e[12]||(e[12]=s("div",{class:"stat-desc"},"需要立即处理",-1))])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[s("div",te,[s("div",ae,p(r.value.by_severity?.high||0),1),e[13]||(e[13]=s("div",{class:"stat-label"},"高危异常",-1)),e[14]||(e[14]=s("div",{class:"stat-desc"},"需要关注处理",-1))])]),_:1})]),_:1}),t(b,{span:6},{default:a(()=>[t(m,{class:"stat-card"},{default:a(()=>[s("div",le,[s("div",se,p(r.value.by_severity?.medium||0),1),e[15]||(e[15]=s("div",{class:"stat-label"},"中等异常",-1)),e[16]||(e[16]=s("div",{class:"stat-desc"},"建议监控",-1))])]),_:1})]),_:1})]),_:1}),y.value?(_(),g(f,{key:0,title:"正在加载数据",description:"正在从服务器获取防刷量系统的最新数据...",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}})):!r.value.total_anomalies&&r.value.total_anomalies!==0?(_(),g(f,{key:1,title:"暂无数据",description:"防刷量系统正在运行，但尚未检测到异常。这是正常现象，说明系统运行良好。",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}})):r.value.total_anomalies===0?(_(),g(f,{key:2,title:"系统运行正常",description:"24小时内未检测到任何异常，防刷量系统运行良好。",type:"success",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}})):r.value.total_anomalies>0?(_(),g(f,{key:3,title:`检测到 ${r.value.total_anomalies} 个异常`,description:"系统已检测到异常行为，建议及时查看和处理。",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"])):L("",!0),t(m,{class:"anomaly-types"},{header:a(()=>e[17]||(e[17]=[s("span",null,"异常类型分布",-1)])),default:a(()=>[!r.value.by_type||Object.keys(r.value.by_type).length===0?(_(),c("div",oe,[t(T,{description:"暂无异常数据"})])):(_(),c("div",ne,[(_(!0),c(Q,null,q(r.value.by_type,(n,h)=>(_(),c("div",{key:h,class:"anomaly-type-item"},[s("div",re,p(N(h)),1),s("div",ie,p(n),1),t($,{percentage:P(n),color:B(h),"stroke-width":8},null,8,["percentage","color"])]))),128))]))]),_:1}),t(m,{class:"security-config"},{header:a(()=>e[18]||(e[18]=[s("span",null,"安全配置",-1)])),default:a(()=>[t(j,{model:o.value,"label-width":"200px"},{default:a(()=>[t(u,{label:"启用频率限制"},{default:a(()=>[t(x,{modelValue:o.value.enable_rate_limiting,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.enable_rate_limiting=n)},null,8,["modelValue"])]),_:1}),t(u,{label:"启用异常检测"},{default:a(()=>[t(x,{modelValue:o.value.enable_anomaly_detection,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.enable_anomaly_detection=n)},null,8,["modelValue"])]),_:1}),t(u,{label:"启用统计分析"},{default:a(()=>[t(x,{modelValue:o.value.enable_statistical_analysis,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.enable_statistical_analysis=n)},null,8,["modelValue"])]),_:1}),t(u,{label:"用户每小时最大下载次数"},{default:a(()=>[t(V,{modelValue:o.value.max_downloads_per_user_per_hour,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.max_downloads_per_user_per_hour=n),min:1,max:100},null,8,["modelValue"])]),_:1}),t(u,{label:"IP每小时最大下载次数"},{default:a(()=>[t(V,{modelValue:o.value.max_downloads_per_ip_per_hour,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.max_downloads_per_ip_per_hour=n),min:1,max:200},null,8,["modelValue"])]),_:1}),t(u,{label:"资源每天最大下载次数"},{default:a(()=>[t(V,{modelValue:o.value.max_downloads_per_resource_per_day,"onUpdate:modelValue":e[5]||(e[5]=n=>o.value.max_downloads_per_resource_per_day=n),min:1,max:1e3},null,8,["modelValue"])]),_:1}),t(u,{label:"可疑模式阈值"},{default:a(()=>[t(A,{modelValue:o.value.suspicious_pattern_threshold,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.suspicious_pattern_threshold=n),min:.1,max:1,step:.1,"format-tooltip":n=>`${(n*100).toFixed(0)}%`},null,8,["modelValue","format-tooltip"])]),_:1}),t(u,{label:"统计异常阈值"},{default:a(()=>[t(A,{modelValue:o.value.statistical_anomaly_threshold,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.statistical_anomaly_threshold=n),min:1,max:5,step:.1},null,8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(v,{type:"primary",onClick:D},{default:a(()=>e[19]||(e[19]=[C("保存配置")])),_:1,__:[19]}),t(v,{onClick:F},{default:a(()=>e[20]||(e[20]=[C("重置配置")])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),_:1}),t(m,{class:"real-time-monitor"},{header:a(()=>e[21]||(e[21]=[s("span",null,"实时监控",-1)])),default:a(()=>[s("div",de,[S.value.length>0?(_(),g(f,{key:0,title:`最近发现 ${S.value.length} 个异常`,type:"warning",closable:!1,"show-icon":""},null,8,["title"])):(_(),c("div",_e,[t(K,null,{default:a(()=>[t(G(O))]),_:1}),e[22]||(e[22]=s("span",null,"暂无异常检测",-1)),e[23]||(e[23]=s("div",{class:"monitor-desc"}," 系统正在实时监控下载行为，包括频率限制、可疑模式检测和统计异常分析 ",-1))]))])]),_:1})]),_:1})])}}}),ge=J(ue,[["__scopeId","data-v-617cc838"]]);export{ge as default};
