import{R as ne,X as ie,ab as de,u as B,ac as re,W as ue,f as ce,L as N,Y as _e,H as v,E as P}from"../chunks/element-plus-hGoKm610.js";import{f as x,_ as pe}from"../assets/index-D3Kp6etV.js";import{x as ve,r as f,X as T,c as E,j as me,y as Y,A as t,Q as s,I as l,u,al as c,M as _,O as i,J as fe,ar as ge,H as be,K as R,z as S}from"../chunks/vue-vendor-BleHOoLr.js";import"../chunks/utils-Dq7h7Pqt.js";const ye={class:"admin-page user-actions"},he={class:"page-header"},we={class:"header-content"},Ce={class:"header-left"},De={class:"header-icon"},Ve={class:"header-actions"},Ae={class:"stats-section"},ke={class:"stats-grid"},Se={class:"stat-card"},ze={class:"stat-icon"},xe={class:"stat-content"},Ye={class:"stat-number"},Ue={class:"stat-card"},Le={class:"stat-icon"},Ie={class:"stat-content"},Me={class:"stat-number"},He={class:"stat-card"},Be={class:"stat-icon"},Ne={class:"stat-content"},Pe={class:"stat-number"},Te={class:"stat-card"},Ee={class:"stat-icon"},Re={class:"stat-content"},$e={class:"stat-number"},je={class:"search-section"},Qe={class:"search-left"},Xe={class:"search-right"},qe={class:"table-section"},Je={class:"pagination-section"},Ke={key:0,class:"action-detail"},Oe={class:"detail-item"},We={class:"detail-item"},Fe={class:"detail-item"},Ge={class:"detail-item"},Ze={class:"detail-item"},et={class:"detail-item"},tt={class:"detail-item"},st={class:"detail-item"},at={class:"detail-item"},lt={key:0,class:"detail-item"},ot={class:"detail-item"},nt=ve({__name:"UserActions",setup(it){const z=f(!1),h=f([]),b=f([]),w=f(1),C=f(20),U=f(0),D=f(!1),d=f(null),r=T({user_id:"",action_type:"",start_time:"",end_time:""}),V=T({total_actions:0,active_users:0}),$=E(()=>h.value.filter(a=>a.success).length),j=E(()=>{const a=new Date;return a.setHours(0,0,0,0),h.value.filter(e=>new Date(e.created_at)>=a).length});async function g(){z.value=!0;try{const a={page:w.value.toString(),page_size:C.value.toString()};r.user_id&&(a.user_id=r.user_id),r.action_type&&(a.action_type=r.action_type),r.start_time&&(a.start_time=r.start_time),r.end_time&&(a.end_time=r.end_time);const n=await x.getUserActions(a);n.code===0?(h.value=n.data?.actions||[],U.value=n.data?.total||0,Q()):v.error(n.message||"加载行为记录失败")}catch(a){console.error("加载行为记录失败:",a),v.error("加载行为记录失败")}finally{z.value=!1}}function Q(){const a=h.value;V.total_actions=a.length;const e=new Set(a.map(n=>n.user_id));V.active_users=e.size}function A(){w.value=1,g()}function X(){g()}function q(){v.info("导出功能开发中...")}function J(a){b.value=a}function K(a){C.value=a,g()}function O(a){w.value=a,g()}function W(a){d.value=a,D.value=!0}async function F(a){try{await P.confirm("确定要删除这条行为记录吗？","确认删除");const e=await x.deleteUserAction(a.id);e.code===0?(v.success("行为记录删除成功"),g()):v.error(e.message||"删除失败")}catch(e){e!=="cancel"&&v.error("删除失败")}}async function G(){if(b.value.length===0){v.warning("请选择要删除的行为记录");return}try{await P.confirm(`确定要删除选中的 ${b.value.length} 条行为记录吗？`,"确认删除");const a=b.value.map(n=>n.id),e=await x.batchDeleteUserActions(a);e.code===0?(v.success("批量删除成功"),b.value=[],g()):v.error(e.message||"批量删除失败")}catch(a){a!=="cancel"&&v.error("批量删除失败")}}function L(a){return{Login:"success",Logout:"info",Register:"primary",Upload:"warning",Download:"danger",Comment:"info",Like:"success",Share:"primary",Settings:"info",Admin:"danger",PageView:"info",View:"primary",Navigation:"success",BrowseCategory:"warning"}[a]||"info"}function I(a){return{Login:"登录",Logout:"登出",Register:"注册",Upload:"上传",Download:"下载",Comment:"评论",Like:"点赞",Share:"分享",Settings:"设置",Admin:"管理员",PageView:"页面浏览",View:"查看",Navigation:"导航",BrowseCategory:"浏览分类"}[a]||a}function M(a){if(!a)return"-";try{return new Date(a).toLocaleString()}catch{return a}}return me(()=>{g()}),(a,e)=>{const n=c("el-icon"),y=c("el-button"),Z=c("el-input"),p=c("el-option"),ee=c("el-select"),H=c("el-date-picker"),m=c("el-table-column"),k=c("el-tag"),te=c("el-table"),se=c("el-pagination"),ae=c("el-dialog"),le=ge("loading");return S(),Y("div",ye,[t("div",he,[t("div",we,[t("div",Ce,[t("div",De,[s(n,{size:32},{default:l(()=>[s(u(ne))]),_:1})]),e[8]||(e[8]=t("div",{class:"header-info"},[t("h1",{class:"page-title"},"用户行为记录"),t("p",{class:"page-subtitle"},"记录和分析用户在系统中的各种行为操作")],-1))]),t("div",Ve,[s(y,{onClick:X},{default:l(()=>[s(n,null,{default:l(()=>[s(u(ie))]),_:1}),e[9]||(e[9]=_(" 刷新 "))]),_:1,__:[9]})])])]),t("div",Ae,[t("div",ke,[t("div",Se,[t("div",ze,[s(n,{size:24},{default:l(()=>[s(u(de))]),_:1})]),t("div",xe,[t("div",Ye,i(V.total_actions),1),e[10]||(e[10]=t("div",{class:"stat-label"},"总行为数",-1))])]),t("div",Ue,[t("div",Le,[s(n,{size:24},{default:l(()=>[s(u(B))]),_:1})]),t("div",Ie,[t("div",Me,i(V.active_users),1),e[11]||(e[11]=t("div",{class:"stat-label"},"活跃用户",-1))])]),t("div",He,[t("div",Be,[s(n,{size:24},{default:l(()=>[s(u(re))]),_:1})]),t("div",Ne,[t("div",Pe,i($.value),1),e[12]||(e[12]=t("div",{class:"stat-label"},"成功操作",-1))])]),t("div",Te,[t("div",Ee,[s(n,{size:24},{default:l(()=>[s(u(ue))]),_:1})]),t("div",Re,[t("div",$e,i(j.value),1),e[13]||(e[13]=t("div",{class:"stat-label"},"今日行为",-1))])])])]),t("div",je,[t("div",Qe,[s(Z,{modelValue:r.user_id,"onUpdate:modelValue":e[0]||(e[0]=o=>r.user_id=o),placeholder:"输入用户ID",clearable:"",style:{width:"150px"},onInput:A},{prefix:l(()=>[s(n,null,{default:l(()=>[s(u(B))]),_:1})]),_:1},8,["modelValue"]),s(ee,{modelValue:r.action_type,"onUpdate:modelValue":e[1]||(e[1]=o=>r.action_type=o),placeholder:"行为类型",clearable:"",style:{width:"150px"},onChange:A},{default:l(()=>[s(p,{label:"登录",value:"Login"}),s(p,{label:"登出",value:"Logout"}),s(p,{label:"注册",value:"Register"}),s(p,{label:"上传",value:"Upload"}),s(p,{label:"下载",value:"Download"}),s(p,{label:"评论",value:"Comment"}),s(p,{label:"点赞",value:"Like"}),s(p,{label:"分享",value:"Share"}),s(p,{label:"设置",value:"Settings"}),s(p,{label:"管理操作",value:"Admin"})]),_:1},8,["modelValue"]),s(H,{modelValue:r.start_time,"onUpdate:modelValue":e[2]||(e[2]=o=>r.start_time=o),type:"datetime",placeholder:"开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"200px"},onChange:A},null,8,["modelValue"]),s(H,{modelValue:r.end_time,"onUpdate:modelValue":e[3]||(e[3]=o=>r.end_time=o),type:"datetime",placeholder:"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"200px"},onChange:A},null,8,["modelValue"])]),t("div",Xe,[s(y,{type:"success",onClick:q},{default:l(()=>[s(n,null,{default:l(()=>[s(u(ce))]),_:1}),e[14]||(e[14]=_(" 导出数据 "))]),_:1,__:[14]}),s(y,{type:"danger",onClick:G,disabled:b.value.length===0},{default:l(()=>[s(n,null,{default:l(()=>[s(u(N))]),_:1}),e[15]||(e[15]=_(" 批量删除 "))]),_:1,__:[15]},8,["disabled"])])]),t("div",qe,[fe((S(),be(te,{data:h.value,style:{width:"100%"},"header-cell-style":{background:"var(--bg-secondary)",color:"var(--text-primary)"},"row-style":{background:"var(--bg-card)"},border:"",stripe:"",onSelectionChange:J},{default:l(()=>[s(m,{type:"selection",width:"55"}),s(m,{prop:"id",label:"ID",width:"80"}),s(m,{prop:"user_id",label:"用户ID",width:"100"}),s(m,{prop:"action_type",label:"行为类型",width:"100"},{default:l(({row:o})=>[s(k,{type:L(o.action_type)},{default:l(()=>[_(i(I(o.action_type)),1)]),_:2},1032,["type"])]),_:1}),s(m,{prop:"details",label:"描述","min-width":"250","show-overflow-tooltip":""}),s(m,{prop:"ip_address",label:"IP地址",width:"150"}),s(m,{prop:"created_at",label:"时间",width:"180"},{default:l(({row:o})=>[_(i(M(o.created_at)),1)]),_:1}),s(m,{prop:"success",label:"结果",width:"100"},{default:l(({row:o})=>[s(k,{type:o.success?"success":"danger"},{default:l(()=>[_(i(o.success?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),s(m,{label:"操作",width:"150",fixed:"right"},{default:l(({row:o})=>[s(y,{size:"small",onClick:oe=>W(o)},{default:l(()=>[s(n,null,{default:l(()=>[s(u(_e))]),_:1}),e[16]||(e[16]=_(" 详情 "))]),_:2,__:[16]},1032,["onClick"]),s(y,{size:"small",type:"danger",onClick:oe=>F(o)},{default:l(()=>[s(n,null,{default:l(()=>[s(u(N))]),_:1}),e[17]||(e[17]=_(" 删除 "))]),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,z.value]]),t("div",Je,[s(se,{"current-page":w.value,"onUpdate:currentPage":e[4]||(e[4]=o=>w.value=o),"page-size":C.value,"onUpdate:pageSize":e[5]||(e[5]=o=>C.value=o),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),s(ae,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=o=>D.value=o),title:"行为详情",width:"600px"},{footer:l(()=>[s(y,{onClick:e[6]||(e[6]=o=>D.value=!1)},{default:l(()=>e[29]||(e[29]=[_("关闭")])),_:1,__:[29]})]),default:l(()=>[d.value?(S(),Y("div",Ke,[t("div",Oe,[e[18]||(e[18]=t("label",null,"记录ID:",-1)),t("span",null,i(d.value.id),1)]),t("div",We,[e[19]||(e[19]=t("label",null,"用户ID:",-1)),t("span",null,i(d.value.user_id),1)]),t("div",Fe,[e[20]||(e[20]=t("label",null,"行为类型:",-1)),s(k,{type:L(d.value.action_type)},{default:l(()=>[_(i(I(d.value.action_type)),1)]),_:1},8,["type"])]),t("div",Ge,[e[21]||(e[21]=t("label",null,"目标类型:",-1)),t("span",null,i(d.value.target_type),1)]),t("div",Ze,[e[22]||(e[22]=t("label",null,"目标ID:",-1)),t("span",null,i(d.value.target_id),1)]),t("div",et,[e[23]||(e[23]=t("label",null,"行为描述:",-1)),t("span",null,i(d.value.details),1)]),t("div",tt,[e[24]||(e[24]=t("label",null,"IP地址:",-1)),t("span",null,i(d.value.ip_address),1)]),t("div",st,[e[25]||(e[25]=t("label",null,"用户代理:",-1)),t("span",null,i(d.value.user_agent),1)]),t("div",at,[e[26]||(e[26]=t("label",null,"操作结果:",-1)),s(k,{type:d.value.success?"success":"danger"},{default:l(()=>[_(i(d.value.success?"成功":"失败"),1)]),_:1},8,["type"])]),d.value.error_message?(S(),Y("div",lt,[e[27]||(e[27]=t("label",null,"错误信息:",-1)),t("span",null,i(d.value.error_message),1)])):R("",!0),t("div",ot,[e[28]||(e[28]=t("label",null,"时间:",-1)),t("span",null,i(M(d.value.created_at)),1)])])):R("",!0)]),_:1},8,["modelValue"])])}}}),_t=pe(nt,[["__scopeId","data-v-728f2de3"]]);export{_t as default};
