import{x as le,r as _,c as w,j as se,y as p,A as o,Q as a,I as s,al as n,u as v,P as U,a6 as A,H as S,O as c,a4 as ne,K,M as V,ax as re,z as u}from"../chunks/vue-vendor-BleHOoLr.js";import{x as ue,I as ce,q as ie,u as de,f as _e,C as pe,H as m}from"../chunks/element-plus-hGoKm610.js";import{c as ve}from"../chunks/categories-BRHoYYyG.js";import{p as M}from"../chunks/packages-CAyrDzlu.js";import{f as me}from"../chunks/format-B9owEeWI.js";import{_ as fe}from"../assets/index-C28i2SJl.js";import"../chunks/utils-Dq7h7Pqt.js";const ge={class:"category-page"},ye={class:"category-container"},he={class:"category-count"},Ce={class:"resource-toolbar"},ke={class:"search-box"},we={class:"sort-options"},xe={key:0,class:"category-info"},be={key:0},ze={key:1,class:"category-info"},Se={class:"resources-container"},Ve={key:1,class:"resources-list"},Re={class:"resource-header"},Pe={class:"resource-description"},Be={class:"resource-meta"},Ie={class:"meta-item"},Ne={class:"meta-item"},Ue={class:"meta-item"},Ae={class:"resource-actions"},Ke={key:2,class:"pagination"},Me=le({__name:"Category",setup($e){const $=re(),y=_(!1),f=_([]),h=_([]),r=_(null),C=_(""),R=_("latest"),i=_(1),g=_(12),x=async()=>{try{y.value=!0;const t={};r.value&&(t.category_id=r.value),C.value&&(t.search=C.value);const e=await M.getPackages(t);e.code===0&&e.data?h.value=e.data.list:m.error("获取资源数据失败")}catch(t){console.error("获取资源数据错误:",t),m.error("获取资源数据出错")}finally{y.value=!1}},j=async()=>{try{y.value=!0;const t=await ve.getCategories();t.code===0&&t.data?(f.value=t.data.list||[],console.log("获取到的分类数据:",f.value)):m.error("获取分类数据失败")}catch(t){console.error("获取分类数据错误:",t),m.error("获取分类数据出错")}finally{y.value=!1}},k=w(()=>r.value&&f.value.find(t=>t.id===r.value)||null),P=w(()=>r.value?h.value.filter(t=>t.category_id===r.value):h.value),b=w(()=>{const t=(i.value-1)*g.value,e=t+g.value;return P.value.slice(t,e)}),D=w(()=>P.value.length),E=t=>h.value.filter(e=>e.category_id===t).length,F=t=>{if(!t)return"未分类";const e=f.value.find(d=>d.id===t);return e?e.name:"未分类"},H=t=>{t==="all"?r.value=null:r.value=parseInt(t),i.value=1,x()},L=()=>{i.value=1},Q=()=>{i.value=1},q=t=>{g.value=t,i.value=1},O=t=>{i.value=t},T=t=>{$.push(`/resource/${t}`)},G=async t=>{try{const e=await M.downloadPackage(t);e.code===0&&e.data?(window.open(e.data,"_blank"),m.success("开始下载资源")):m.error("下载资源失败")}catch(e){console.error("下载资源错误:",e),m.error("下载资源出错")}};return se(async()=>{await j(),await x();const e=new URLSearchParams(window.location.search).get("category");e&&(r.value=parseInt(e),x())}),(t,e)=>{const d=n("el-icon"),B=n("el-menu-item"),J=n("el-menu"),I=n("el-col"),W=n("el-input"),z=n("el-option"),X=n("el-select"),Y=n("el-empty"),Z=n("el-tag"),N=n("el-button"),ee=n("el-card"),te=n("el-pagination"),ae=n("el-row");return u(),p("div",ge,[e[9]||(e[9]=o("h1",{class:"page-title"},"资源分类",-1)),o("div",ye,[a(ae,{gutter:20},{default:s(()=>[a(I,{span:6,class:"category-sidebar"},{default:s(()=>[e[5]||(e[5]=o("h3",null,"所有分类",-1)),a(J,{"default-active":r.value?r.value.toString():"",class:"category-menu",onSelect:H},{default:s(()=>[a(B,{index:"all"},{default:s(()=>[a(d,null,{default:s(()=>[a(v(ue))]),_:1}),e[4]||(e[4]=o("span",null,"全部资源",-1))]),_:1,__:[4]}),(u(!0),p(U,null,A(f.value,l=>(u(),S(B,{key:l.id,index:l.id.toString()},{default:s(()=>[a(d,null,{default:s(()=>[a(v(ce))]),_:1}),o("span",null,c(l.name),1),o("span",he,"("+c(E(l.id))+")",1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1,__:[5]}),a(I,{span:18},{default:s(()=>[o("div",Ce,[o("div",ke,[a(W,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),placeholder:"搜索当前分类资源...",clearable:"",onKeyup:ne(Q,["enter"])},{prefix:s(()=>[a(d,null,{default:s(()=>[a(v(ie))]),_:1})]),_:1},8,["modelValue"])]),o("div",we,[a(X,{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=l=>R.value=l),placeholder:"排序方式",onChange:L},{default:s(()=>[a(z,{label:"最新上传",value:"latest"}),a(z,{label:"下载最多",value:"downloads"}),a(z,{label:"点赞最多",value:"likes"})]),_:1},8,["modelValue"])])]),k.value?(u(),p("div",xe,[o("h2",null,c(k.value.name),1),k.value.description?(u(),p("p",be,c(k.value.description),1)):K("",!0)])):(u(),p("div",ze,e[6]||(e[6]=[o("h2",null,"全部资源",-1),o("p",null,"显示所有分类的资源",-1)]))),o("div",Se,[b.value.length===0?(u(),S(Y,{key:0,description:"该分类下暂无资源"})):(u(),p("div",Ve,[(u(!0),p(U,null,A(b.value,l=>(u(),S(ee,{key:l.id,class:"resource-card"},{default:s(()=>[o("div",Re,[o("h3",null,c(l.name),1),a(Z,{size:"small"},{default:s(()=>[V(c(F(l.category_id)),1)]),_:2},1024)]),o("p",Pe,c(l.description||"暂无描述"),1),o("div",Be,[o("div",Ie,[a(d,null,{default:s(()=>[a(v(de))]),_:1}),o("span",null,c(l.author),1)]),o("div",Ne,[a(d,null,{default:s(()=>[a(v(_e))]),_:1}),o("span",null,c(l.download_count)+" 次下载",1)]),o("div",Ue,[a(d,null,{default:s(()=>[a(v(pe))]),_:1}),o("span",null,c(v(me)(l.created_at)),1)])]),o("div",Ae,[a(N,{type:"primary",size:"small",onClick:oe=>T(l.id)},{default:s(()=>e[7]||(e[7]=[V(" 查看详情 ")])),_:2,__:[7]},1032,["onClick"]),a(N,{type:"success",size:"small",onClick:oe=>G(l.id)},{default:s(()=>e[8]||(e[8]=[V(" 下载 ")])),_:2,__:[8]},1032,["onClick"])])]),_:2},1024))),128))])),b.value.length>0?(u(),p("div",Ke,[a(te,{"current-page":i.value,"onUpdate:currentPage":e[2]||(e[2]=l=>i.value=l),"page-size":g.value,"onUpdate:pageSize":e[3]||(e[3]=l=>g.value=l),total:D.value,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[12,24,48],onSizeChange:q,onCurrentChange:O,background:""},null,8,["current-page","page-size","total"])])):K("",!0)])]),_:1})]),_:1})])])}}}),qe=fe(Me,[["__scopeId","data-v-391a3b76"]]);export{qe as default};
