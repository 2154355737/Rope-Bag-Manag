import{x as ae,r as f,c as K,j as oe,y as u,A as e,Q as s,I as o,M as r,al as _,u as n,O as d,H as N,K as w,P as j,a6 as le,ay as ne,ax as ie,z as c}from"../chunks/vue-vendor-BleHOoLr.js";import{N as re,O as de,P as E,Q as ce,f as T,A as V,J as H,R as ue,D as _e,o as ve,u as me,M as pe,h as fe,H as he,j as ge,K as v}from"../chunks/element-plus-Cc1YNc_4.js";import{T as ye}from"../chunks/ThemeSwitcher-D6lf2E-3.js";import{c as O}from"../chunks/comments-CGKKo5_6.js";import{g as ke,_ as we}from"../assets/index-B_N-aWSj.js";import{p as Q}from"../chunks/packages-DTwnlaPG.js";import{f as I,a as be}from"../chunks/format-CUgNVY1-.js";import"../chunks/utils-Dq7h7Pqt.js";const Ce={class:"resource-detail-page"},xe={class:"page-header"},ze={class:"header-container"},Le={class:"nav-left"},Re={class:"nav-center"},Me={class:"breadcrumb"},Ne={class:"breadcrumb-item current"},Te={class:"nav-right"},Ve={class:"main-content"},Ie={class:"content-container"},Ae={key:0,class:"loading-container"},De={class:"loading-card"},Fe={key:1,class:"error-container"},Pe={class:"error-card"},Se={class:"error-icon"},$e={class:"resource-main-section"},Be={class:"resource-hero-card"},Ue={class:"resource-header"},Ke={class:"resource-title-area"},je={class:"resource-title"},Ee={class:"resource-badges"},He={class:"resource-stats"},Oe={class:"stat-item"},Qe={class:"stat-icon"},Je={class:"stat-content"},qe={class:"stat-value"},Ge={class:"stat-item"},We={class:"stat-icon"},Xe={class:"stat-content"},Ye={class:"stat-value"},Ze={class:"stat-item"},et={class:"stat-icon"},tt={class:"stat-content"},st={class:"stat-value"},at={class:"resource-description"},ot={class:"description-header"},lt={class:"section-title"},nt={class:"description-content"},it={key:0,class:"description-text"},rt={key:1,class:"description-empty"},dt={class:"resource-details"},ct={class:"details-grid"},ut={class:"detail-item"},_t={class:"detail-icon"},vt={class:"detail-content"},mt={class:"detail-value"},pt={class:"detail-item"},ft={class:"detail-icon"},ht={class:"detail-content"},gt={class:"detail-value"},yt={key:0,class:"detail-item"},kt={class:"detail-icon"},wt={class:"detail-content"},bt={class:"detail-value"},Ct={class:"detail-item"},xt={class:"detail-icon"},zt={class:"detail-content"},Lt={class:"detail-value"},Rt={class:"resource-actions"},Mt={class:"comments-section"},Nt={class:"comments-card"},Tt={class:"comments-header"},Vt={class:"section-title"},It={class:"comment-count"},At={key:0,class:"comment-form"},Dt={class:"comment-actions"},Ft={key:1,class:"login-prompt"},Pt={class:"comments-list"},St={key:0,class:"empty-comments"},$t={key:1},Bt={class:"comment-avatar"},Ut={class:"comment-content"},Kt={class:"comment-header"},jt={class:"comment-author"},Et={class:"comment-time"},Ht={class:"comment-text"},Ot=ae({__name:"ResourceDetail",setup(Qt){const b=a=>a<1e3?a.toString():a<1e4?(a/1e3).toFixed(1)+"K":a<1e6?(a/1e4).toFixed(1)+"万":(a/1e6).toFixed(1)+"M",J=ne(),A=ie(),C=f(!0),y=f(!1),x=f(!1),z=f(!1),l=f(null),k=f([]),g=f(""),p=f(!1),L=K(()=>!!ke()),D=K(()=>l.value?.category_name||"未分类"),F=async()=>{const a=J.params.id;if(!a){A.push("/home");return}try{C.value=!0;const t=await Q.getPackage(parseInt(a));t.code===0&&t.data?(l.value=t.data,await P(),await q()):l.value=null}catch(t){console.error("加载资源失败:",t),l.value=null}finally{C.value=!1}},P=async()=>{if(l.value)try{const a=await O.getComments(l.value.id);a.code===0&&a.data&&(k.value=a.data.list||[])}catch(a){console.error("加载评论失败:",a)}},q=async()=>{if(!(!l.value||!L.value))try{p.value=!1}catch(a){console.error("检查点赞状态失败:",a)}},S=async()=>{if(l.value)try{y.value=!0;const a=await Q.downloadPackage(l.value.id);a.code===0?(a.data&&typeof a.data=="string"&&window.open(a.data,"_blank"),v.success("下载开始"),F()):v.error(a.message||"下载失败")}catch(a){console.error("下载失败:",a),v.error("下载失败，请重试")}finally{y.value=!1}},$=async()=>{if(l.value){if(!L.value){v.warning("请先登录"),A.push("/login");return}try{x.value=!0,p.value=!p.value,l.value.like_count+=p.value?1:-1,v.success(p.value?"点赞成功":"取消点赞")}catch(a){console.error("点赞操作失败:",a),v.error("操作失败，请重试")}finally{x.value=!1}}},B=async()=>{if(!l.value)return;const a=window.location.href,t=`${l.value.name} - 智圆社区`;if(navigator.share)try{await navigator.share({title:t,url:a})}catch{console.log("分享取消")}else try{await navigator.clipboard.writeText(a),v.success("链接已复制到剪贴板")}catch{v.error("复制失败")}},G=async()=>{if(!(!l.value||!g.value.trim()))try{z.value=!0;const a=await O.createComment({target_id:l.value.id,target_type:"Package",content:g.value.trim()});a.code===0?(v.success("评论发表成功"),g.value="",await P()):v.error(a.message||"评论发表失败")}catch(a){console.error("发表评论失败:",a),v.error("评论发表失败，请重试")}finally{z.value=!1}},W=a=>({1:"primary",2:"success",3:"warning",4:"danger",5:"info"})[a]||"default";return oe(()=>{F()}),(a,t)=>{const i=_("el-icon"),h=_("el-button"),R=_("router-link"),M=_("el-dropdown-item"),X=_("el-dropdown-menu"),Y=_("el-dropdown"),Z=_("el-skeleton"),U=_("el-tag"),ee=_("el-input"),te=_("el-empty"),se=_("el-avatar");return c(),u("div",Ce,[e("header",xe,[e("div",ze,[e("div",Le,[s(h,{onClick:t[0]||(t[0]=m=>a.$router.go(-1)),type:"primary",plain:"",size:"large",class:"back-button"},{default:o(()=>[s(i,null,{default:o(()=>[s(n(re))]),_:1}),t[3]||(t[3]=r(" 返回 "))]),_:1,__:[3]})]),e("div",Re,[e("div",Me,[s(R,{to:"/",class:"breadcrumb-item home"},{default:o(()=>[s(i,null,{default:o(()=>[s(n(de))]),_:1})]),_:1}),s(i,{class:"breadcrumb-separator"},{default:o(()=>[s(n(E))]),_:1}),s(R,{to:"/home",class:"breadcrumb-item"},{default:o(()=>t[4]||(t[4]=[r("首页")])),_:1,__:[4]}),s(i,{class:"breadcrumb-separator"},{default:o(()=>[s(n(E))]),_:1}),e("span",Ne,d(l.value?.name||"资源详情"),1)])]),e("div",Te,[l.value?(c(),N(Y,{key:0,trigger:"click"},{dropdown:o(()=>[s(X,null,{default:o(()=>[s(M,{onClick:S},{default:o(()=>[s(i,null,{default:o(()=>[s(n(T))]),_:1}),t[6]||(t[6]=r("下载资源 "))]),_:1,__:[6]}),s(M,{onClick:$},{default:o(()=>[s(i,null,{default:o(()=>[s(n(V))]),_:1}),r(d(p.value?"取消点赞":"点赞"),1)]),_:1}),s(M,{onClick:B},{default:o(()=>[s(i,null,{default:o(()=>[s(n(H))]),_:1}),t[7]||(t[7]=r("分享 "))]),_:1,__:[7]})]),_:1})]),default:o(()=>[s(h,{type:"primary",plain:"",size:"large",class:"action-button"},{default:o(()=>[t[5]||(t[5]=r(" 操作 ")),s(i,null,{default:o(()=>[s(n(ce))]),_:1})]),_:1,__:[5]})]),_:1})):w("",!0),s(ye)])])]),e("main",Ve,[e("div",Ie,[C.value?(c(),u("div",Ae,[e("div",De,[s(Z,{rows:8,animated:""})])])):l.value?(c(),u(j,{key:2},[e("div",$e,[e("div",Be,[e("div",Ue,[e("div",Ke,[e("h1",je,d(l.value.name),1),e("div",Ee,[D.value?(c(),N(U,{key:0,type:W(l.value.category_id),size:"large",effect:"light",class:"category-badge"},{default:o(()=>[r(d(D.value),1)]),_:1},8,["type"])):w("",!0),l.value.status==="featured"?(c(),N(U,{key:1,type:"warning",size:"large",effect:"light"},{default:o(()=>t[11]||(t[11]=[r(" 精选 ")])),_:1,__:[11]})):w("",!0)])]),e("div",He,[e("div",Oe,[e("div",Qe,[s(i,null,{default:o(()=>[s(n(_e))]),_:1})]),e("div",Je,[e("span",qe,d(b(l.value.view_count)),1),t[12]||(t[12]=e("span",{class:"stat-label"},"浏览",-1))])]),e("div",Ge,[e("div",We,[s(i,null,{default:o(()=>[s(n(T))]),_:1})]),e("div",Xe,[e("span",Ye,d(b(l.value.download_count)),1),t[13]||(t[13]=e("span",{class:"stat-label"},"下载",-1))])]),e("div",Ze,[e("div",et,[s(i,null,{default:o(()=>[s(n(V))]),_:1})]),e("div",tt,[e("span",st,d(b(l.value.like_count)),1),t[14]||(t[14]=e("span",{class:"stat-label"},"点赞",-1))])])])]),e("div",at,[e("div",ot,[e("h3",lt,[s(i,null,{default:o(()=>[s(n(ve))]),_:1}),t[15]||(t[15]=r(" 资源描述 "))])]),e("div",nt,[l.value.description?(c(),u("p",it,d(l.value.description),1)):(c(),u("p",rt," 暂无描述信息 "))])]),e("div",dt,[e("div",ct,[e("div",ut,[e("div",_t,[s(i,null,{default:o(()=>[s(n(me))]),_:1})]),e("div",vt,[t[16]||(t[16]=e("span",{class:"detail-label"},"上传者",-1)),e("span",mt,d(l.value.uploader_name||"未知"),1)])]),e("div",pt,[e("div",ft,[s(i,null,{default:o(()=>[s(n(pe))]),_:1})]),e("div",ht,[t[17]||(t[17]=e("span",{class:"detail-label"},"上传时间",-1)),e("span",gt,d(n(I)(l.value.created_at)),1)])]),l.value.file_size?(c(),u("div",yt,[e("div",kt,[s(i,null,{default:o(()=>[s(n(fe))]),_:1})]),e("div",wt,[t[18]||(t[18]=e("span",{class:"detail-label"},"文件大小",-1)),e("span",bt,d(n(be)(l.value.file_size)),1)])])):w("",!0),e("div",Ct,[e("div",xt,[s(i,null,{default:o(()=>[s(n(he))]),_:1})]),e("div",zt,[t[19]||(t[19]=e("span",{class:"detail-label"},"更新时间",-1)),e("span",Lt,d(n(I)(l.value.updated_at)),1)])])])]),e("div",Rt,[s(h,{type:"primary",size:"large",onClick:S,loading:y.value,class:"primary-action"},{default:o(()=>[s(i,null,{default:o(()=>[s(n(T))]),_:1}),r(" "+d(y.value?"下载中...":"立即下载"),1)]),_:1},8,["loading"]),s(h,{type:p.value?"warning":"default",size:"large",onClick:$,loading:x.value,class:"secondary-action"},{default:o(()=>[s(i,null,{default:o(()=>[s(n(V))]),_:1}),r(" "+d(p.value?"已点赞":"点赞"),1)]),_:1},8,["type","loading"]),s(h,{type:"default",size:"large",onClick:B,class:"secondary-action"},{default:o(()=>[s(i,null,{default:o(()=>[s(n(H))]),_:1}),t[20]||(t[20]=r(" 分享 "))]),_:1,__:[20]})])])]),e("div",Mt,[e("div",Nt,[e("div",Tt,[e("h3",Vt,[s(i,null,{default:o(()=>[s(n(ge))]),_:1}),t[21]||(t[21]=r(" 用户评论 ")),e("span",It,"("+d(k.value.length)+")",1)]),L.value?(c(),u("div",At,[s(ee,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=m=>g.value=m),type:"textarea",rows:3,placeholder:"写下你的评论...",maxlength:"500","show-word-limit":"",class:"comment-input"},null,8,["modelValue"]),e("div",Dt,[s(h,{type:"primary",onClick:G,loading:z.value,disabled:!g.value.trim()},{default:o(()=>t[22]||(t[22]=[r(" 发表评论 ")])),_:1,__:[22]},8,["loading","disabled"])])])):(c(),u("div",Ft,[e("p",null,[t[24]||(t[24]=r("请先 ")),s(R,{to:"/login",class:"login-link"},{default:o(()=>t[23]||(t[23]=[r("登录")])),_:1,__:[23]}),t[25]||(t[25]=r(" 后发表评论"))])]))]),e("div",Pt,[k.value.length===0?(c(),u("div",St,[s(te,{description:"暂无评论","image-size":80})])):(c(),u("div",$t,[(c(!0),u(j,null,le(k.value,m=>(c(),u("div",{key:m.id,class:"comment-item"},[e("div",Bt,[s(se,{size:40},{default:o(()=>[r(d(m.user_name?.charAt(0)||"U"),1)]),_:2},1024)]),e("div",Ut,[e("div",Kt,[e("span",jt,d(m.user_name),1),e("span",Et,d(n(I)(m.created_at)),1)]),e("div",Ht,d(m.content),1)])]))),128))]))])])])],64)):(c(),u("div",Fe,[e("div",Pe,[e("div",Se,[s(i,null,{default:o(()=>[s(n(ue))]),_:1})]),t[9]||(t[9]=e("h3",{class:"error-title"},"资源不存在",-1)),t[10]||(t[10]=e("p",{class:"error-description"},"抱歉，您访问的资源不存在或已被删除",-1)),s(h,{type:"primary",onClick:t[1]||(t[1]=m=>a.$router.push("/home"))},{default:o(()=>t[8]||(t[8]=[r(" 返回首页 ")])),_:1,__:[8]})])]))])])])}}}),ts=we(Ot,[["__scopeId","data-v-2577da07"]]);export{ts as default};
