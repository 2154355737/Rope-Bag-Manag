import{_ as U}from"../assets/index-B_N-aWSj.js";import{a as V}from"../chunks/admin-DseeQ8_4.js";import{a2 as A,K as u}from"../chunks/element-plus-Cc1YNc_4.js";import{x as C,r as _,X as E,j as L,y as k,Q as l,I as r,u as R,al as i,A as o,M as S,O as y,z as B}from"../chunks/vue-vendor-BleHOoLr.js";import"../chunks/utils-Dq7h7Pqt.js";const D={class:"mail-settings"},I={class:"card-header"},N=C({__name:"MailSettings",setup(O){const g=_(null),p=_(!1),f=_(!1),m=_(""),t=E({smtp_server:"",smtp_port:465,username:"",password:"",from_name:"绳包管理器",enabled:!1,use_ssl:!0,auth_required:!0}),T={smtp_server:[{required:!0,message:"请输入SMTP服务器地址",trigger:"blur"}],smtp_port:[{required:!0,message:"请输入SMTP端口",trigger:"blur"},{type:"number",min:1,max:65535,message:"端口范围：1-65535",trigger:"blur"}],username:[{required:!0,message:"请输入发送邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入SMTP密码",trigger:"blur"}],from_name:[{required:!0,message:"请输入发送方名称",trigger:"blur"}]};L(()=>{x()});async function x(){try{const a=await V.getMailSettings();a.code===0&&a.data&&Object.assign(t,a.data)}catch(a){console.error("加载邮件设置失败:",a)}}async function w(){if(g.value)try{await g.value.validate(),p.value=!0;const a=await V.updateMailSettings(t);a.code===0?u.success("邮件配置保存成功"):u.error(a.msg||a.message||"保存失败")}catch(a){u.error("保存失败："+(a.message||"未知错误"))}finally{p.value=!1}}async function M(){if(!m.value){u.warning("请输入测试邮箱地址");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.value)){u.warning("请输入有效的邮箱地址");return}try{f.value=!0;const a=await V.sendTestEmail(m.value);a.code===0?u.success("测试邮件发送成功，请检查邮箱"):u.error(a.msg||a.message||"发送失败")}catch(a){u.error("发送失败："+(a.message||"未知错误"))}finally{f.value=!1}}return(a,e)=>{const b=i("el-button"),v=i("el-switch"),n=i("el-form-item"),d=i("el-input"),P=i("el-input-number"),q=i("el-divider"),c=i("el-card"),Q=i("el-alert");return B(),k("div",D,[l(c,null,{header:r(()=>[o("div",I,[e[9]||(e[9]=o("span",null,"邮件服务配置",-1)),l(b,{type:"primary",onClick:w,loading:p.value},{default:r(()=>[S(y(p.value?"保存中...":"保存配置"),1)]),_:1},8,["loading"])])]),default:r(()=>[l(R(A),{model:t,rules:T,ref_key:"formRef",ref:g,"label-width":"120px"},{default:r(()=>[l(n,{label:"启用邮件服务"},{default:r(()=>[l(v,{modelValue:t.enabled,"onUpdate:modelValue":e[0]||(e[0]=s=>t.enabled=s),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),e[10]||(e[10]=o("div",{class:"form-tip"},"开启后才能发送邮件",-1))]),_:1,__:[10]}),l(n,{label:"SMTP服务器",prop:"smtp_server"},{default:r(()=>[l(d,{modelValue:t.smtp_server,"onUpdate:modelValue":e[1]||(e[1]=s=>t.smtp_server=s),placeholder:"如: smtp.qq.com"},null,8,["modelValue"])]),_:1}),l(n,{label:"SMTP端口",prop:"smtp_port"},{default:r(()=>[l(P,{modelValue:t.smtp_port,"onUpdate:modelValue":e[2]||(e[2]=s=>t.smtp_port=s),min:1,max:65535},null,8,["modelValue"]),e[11]||(e[11]=o("div",{class:"form-tip"},"常用端口：25(非加密)、465(SSL)、587(STARTTLS)",-1))]),_:1,__:[11]}),l(n,{label:"SSL/TLS加密"},{default:r(()=>[l(v,{modelValue:t.use_ssl,"onUpdate:modelValue":e[3]||(e[3]=s=>t.use_ssl=s),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),e[12]||(e[12]=o("div",{class:"form-tip"},"465端口通常需要SSL，587端口使用STARTTLS",-1))]),_:1,__:[12]}),l(n,{label:"SMTP认证"},{default:r(()=>[l(v,{modelValue:t.auth_required,"onUpdate:modelValue":e[4]||(e[4]=s=>t.auth_required=s),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"]),e[13]||(e[13]=o("div",{class:"form-tip"},"大部分SMTP服务器都需要认证",-1))]),_:1,__:[13]}),l(n,{label:"发送邮箱",prop:"username"},{default:r(()=>[l(d,{modelValue:t.username,"onUpdate:modelValue":e[5]||(e[5]=s=>t.username=s),placeholder:"发送邮件的邮箱地址"},null,8,["modelValue"])]),_:1}),l(n,{label:"SMTP密码",prop:"password"},{default:r(()=>[l(d,{modelValue:t.password,"onUpdate:modelValue":e[6]||(e[6]=s=>t.password=s),type:"password",placeholder:"SMTP授权码(不是登录密码)","show-password":""},null,8,["modelValue"]),e[14]||(e[14]=o("div",{class:"form-tip"},"QQ邮箱请使用授权码，不是登录密码",-1))]),_:1,__:[14]}),l(n,{label:"发送方名称",prop:"from_name"},{default:r(()=>[l(d,{modelValue:t.from_name,"onUpdate:modelValue":e[7]||(e[7]=s=>t.from_name=s),placeholder:"邮件中显示的发送方名称"},null,8,["modelValue"])]),_:1}),l(q,null,{default:r(()=>e[15]||(e[15]=[S("测试邮件")])),_:1,__:[15]}),l(n,{label:"测试邮箱"},{default:r(()=>[l(d,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=s=>m.value=s),placeholder:"输入测试邮箱地址",style:{width:"300px"}},null,8,["modelValue"]),l(b,{type:"success",onClick:M,loading:f.value,style:{"margin-left":"10px"}},{default:r(()=>[S(y(f.value?"发送中...":"发送测试邮件"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),l(c,{style:{"margin-top":"20px"}},{header:r(()=>e[16]||(e[16]=[o("span",null,"邮件功能说明",-1)])),default:r(()=>[l(Q,{title:"邮件服务用途",type:"info",closable:!1,description:"邮件服务用于发送注册验证码、密码重置链接、新资源通知等功能。"}),e[17]||(e[17]=o("div",{style:{"margin-top":"15px"}},[o("h4",null,"QQ邮箱配置步骤："),o("ol",null,[o("li",null,'登录QQ邮箱，进入"设置" -> "账户"'),o("li",null,'开启"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"'),o("li",null,"获取授权码（不是QQ密码）"),o("li",null,"SMTP服务器填写：smtp.qq.com，端口：465"),o("li",null,"用户名填写完整的QQ邮箱地址"),o("li",null,"密码填写获取的授权码")])],-1))]),_:1,__:[17]})])}}}),$=U(N,[["__scopeId","data-v-a842a947"]]);export{$ as default};
