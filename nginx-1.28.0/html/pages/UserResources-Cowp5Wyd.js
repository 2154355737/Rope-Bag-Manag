import{x as be,r as y,X as F,c as D,j as we,y as w,A as s,Q as l,I as t,M as c,al as r,u as m,O as p,a4 as Ve,J as he,ar as ke,K as Ce,P as T,a6 as L,H as X,z as _}from"../chunks/vue-vendor-BleHOoLr.js";import{l as Ue,a6 as xe,T as G,f as W,P as q,ag as Re,t as ze,H as f,E as Ae}from"../chunks/element-plus-hGoKm610.js";import{p as K}from"../chunks/packages-CAyrDzlu.js";import{g as Se,_ as Fe}from"../assets/index-C28i2SJl.js";import{u as De}from"../chunks/users-D39iNwN1.js";import{c as Pe}from"../chunks/categories-BRHoYYyG.js";import"../chunks/utils-Dq7h7Pqt.js";const Ee={class:"user-resource-manage"},Ie={class:"page-header"},Me={class:"header-content"},$e={class:"stat-content"},Be={class:"stat-icon"},je={class:"stat-info"},Ne={class:"stat-number"},Te={class:"stat-content"},Le={class:"stat-icon"},qe={class:"stat-info"},Ke={class:"stat-number"},He={class:"stat-content"},Oe={class:"stat-icon"},Je={class:"stat-info"},Qe={class:"stat-number"},Xe={class:"stat-content"},Ge={class:"stat-icon"},We={class:"stat-info"},Ye={class:"stat-number"},Ze={key:0,class:"empty-state"},el={key:1,class:"resource-grid"},ll={class:"resource-header"},tl=["onClick"],al={class:"resource-info"},ol={class:"info-item"},sl={class:"value"},nl={class:"info-item"},dl={class:"value"},rl={class:"info-item"},il={class:"resource-description"},ul={class:"resource-stats"},cl={class:"stat-item"},pl={class:"stat-item"},ml={class:"stat-item"},_l={key:2,class:"pagination-wrapper"},fl={class:"dialog-footer"},vl={class:"dialog-footer"},gl=be({__name:"UserResources",setup(yl){const P=y(null),E=y(null),A=y(!1),I=y(!1),M=y(!1),U=y(!1),R=y(!1),H=Se(),k=y([]),z=y([]),$=y(null),V=F({page:1,pageSize:12,total:0}),h=F({status:"",search:""}),n=F({name:"",author:H?.username||"",version:"",description:"",category_id:void 0,file_url:""}),d=F({name:"",version:"",description:"",category_id:void 0,file_url:""}),O={name:[{required:!0,message:"è¯·è¾“å…¥èµ„æºåç§°",trigger:"blur"},{min:2,max:50,message:"åç§°é•¿åº¦åœ¨ 2 åˆ° 50 ä¸ªå­—ç¬¦ä¹‹é—´",trigger:"blur"}],author:[{required:!0,message:"è¯·è¾“å…¥ä½œè€…åç§°",trigger:"blur"}],description:[{max:500,message:"æè¿°ä¸èƒ½è¶…è¿‡ 500 ä¸ªå­—ç¬¦",trigger:"blur"}],file_url:[{required:!0,message:"è¯·è¾“å…¥æ–‡ä»¶é“¾æŽ¥",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€",trigger:"blur"}]},B=D(()=>k.value.length),Y=D(()=>k.value.filter(o=>o.status==="Active").length),Z=D(()=>k.value.filter(o=>o.status==="Pending").length),ee=D(()=>k.value.reduce((o,e)=>o+e.download_count,0)),b=async()=>{A.value=!0;try{const o={page:V.page,pageSize:V.pageSize,status:h.status||void 0};console.log("ðŸ“¤ åŠ è½½ç”¨æˆ·èµ„æºå‚æ•°:",o);const e=await De.getMyResources(o);e.code===0?(console.log("âœ… ç”¨æˆ·èµ„æºåŠ è½½æˆåŠŸ:",e.data),k.value=e.data?.list||[],V.total=e.data?.total||0):(console.warn("âŒ ç”¨æˆ·èµ„æºåŠ è½½å¤±è´¥:",e),f.error(e.message||"åŠ è½½èµ„æºå¤±è´¥"))}catch(o){console.error("ðŸš« åŠ è½½èµ„æºåˆ—è¡¨å¤±è´¥:",o),f.error("åŠ è½½èµ„æºåˆ—è¡¨å¤±è´¥")}finally{A.value=!1}},le=()=>{h.status="",h.search="",V.page=1,b()},te=(o,e)=>{switch(o){case"edit":ae(e);break;case"view":window.open(`/resource/${e.id}`,"_blank");break;case"delete":ne(e);break}},ae=o=>{$.value=o,d.name=o.name,d.version=o.version||"",d.description=o.description||"",d.category_id=o.category_id||void 0,d.file_url=o.file_url,R.value=!0},oe=async()=>{if(P.value)try{await P.value.validate(),I.value=!0;const o=n.category_id?z.value.find(v=>v.id===n.category_id)?.name:void 0,e={title:n.name,description:n.description,category:o,file_url:n.file_url||""};console.log("ðŸ“¤ æ™®é€šç”¨æˆ·æäº¤èµ„æºæ•°æ®:",e);const u=await K.userSubmitResource(e);u.code===0?(f.success("èµ„æºä¸Šä¼ æˆåŠŸï¼Œç­‰å¾…å®¡æ ¸"),U.value=!1,de(),b()):f.error(u.message||"ä¸Šä¼ å¤±è´¥")}catch(o){console.error("ä¸Šä¼ èµ„æºå¤±è´¥:",o),f.error("ä¸Šä¼ å¤±è´¥")}finally{I.value=!1}},se=async()=>{if(!(!E.value||!$.value))try{await E.value.validate(),M.value=!0;const o=await K.updatePackage($.value.id,d);o.code===0?(f.success("èµ„æºæ›´æ–°æˆåŠŸ"),R.value=!1,b()):f.error(o.message||"æ›´æ–°å¤±è´¥")}catch(o){console.error("æ›´æ–°èµ„æºå¤±è´¥:",o),f.error("æ›´æ–°å¤±è´¥")}finally{M.value=!1}},ne=async o=>{try{await Ae.confirm(`ç¡®å®šè¦åˆ é™¤èµ„æº "${o.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const e=await K.deletePackage(o.id);e.code===0?(f.success("åˆ é™¤æˆåŠŸ"),b()):f.error(e.message||"åˆ é™¤å¤±è´¥")}catch(e){e!=="cancel"&&(console.error("åˆ é™¤èµ„æºå¤±è´¥:",e),f.error("åˆ é™¤å¤±è´¥"))}},de=()=>{Object.assign(n,{name:"",author:H?.username||"",version:"",description:"",category_id:void 0,file_url:""})},re=o=>({Active:"success",Pending:"warning",Rejected:"danger",Inactive:"info"})[o]||"info",ie=o=>({Active:"å·²å‘å¸ƒ",Pending:"å®¡æ ¸ä¸­",Rejected:"å·²æ‹’ç»",Inactive:"å·²ä¸‹æž¶"})[o]||o,ue=o=>new Date(o).toLocaleDateString("zh-CN"),ce=async()=>{try{console.log("æ­£åœ¨åŠ è½½åˆ†ç±»æ•°æ®...");const o=await Pe.getCategories();console.log("åˆ†ç±»APIå“åº”:",o),o.code===0&&o.data?(z.value=Array.isArray(o.data)?o.data:o.data.list||[],console.log("åŠ è½½åˆ°çš„åˆ†ç±»:",z.value)):console.error("åˆ†ç±»APIè¿”å›žé”™è¯¯:",o)}catch(o){console.error("åŠ è½½åˆ†ç±»å¤±è´¥:",o)}};return we(()=>{ce(),b()}),(o,e)=>{const u=r("el-button"),v=r("el-icon"),x=r("el-card"),S=r("el-col"),pe=r("el-row"),C=r("el-option"),j=r("el-select"),i=r("el-form-item"),g=r("el-input"),me=r("el-empty"),N=r("el-dropdown-item"),_e=r("el-dropdown-menu"),fe=r("el-dropdown"),ve=r("el-tag"),ge=r("el-pagination"),J=r("el-dialog"),ye=ke("loading");return _(),w("div",Ee,[s("div",Ie,[s("div",Me,[e[22]||(e[22]=s("h2",null,"æˆ‘çš„èµ„æº",-1)),l(u,{type:"primary",icon:"Plus",onClick:e[0]||(e[0]=a=>U.value=!0)},{default:t(()=>e[21]||(e[21]=[c(" ä¸Šä¼ èµ„æº ")])),_:1,__:[21]})])]),l(pe,{gutter:20,class:"stats-row"},{default:t(()=>[l(S,{span:6},{default:t(()=>[l(x,{shadow:"hover",class:"stat-card"},{default:t(()=>[s("div",$e,[s("div",Be,[l(v,{color:"#409EFF"},{default:t(()=>[l(m(Ue))]),_:1})]),s("div",je,[s("div",Ne,p(B.value),1),e[23]||(e[23]=s("div",{class:"stat-label"},"æ€»èµ„æºæ•°",-1))])])]),_:1})]),_:1}),l(S,{span:6},{default:t(()=>[l(x,{shadow:"hover",class:"stat-card"},{default:t(()=>[s("div",Te,[s("div",Le,[l(v,{color:"#67C23A"},{default:t(()=>[l(m(xe))]),_:1})]),s("div",qe,[s("div",Ke,p(Y.value),1),e[24]||(e[24]=s("div",{class:"stat-label"},"å·²å‘å¸ƒ",-1))])])]),_:1})]),_:1}),l(S,{span:6},{default:t(()=>[l(x,{shadow:"hover",class:"stat-card"},{default:t(()=>[s("div",He,[s("div",Oe,[l(v,{color:"#E6A23C"},{default:t(()=>[l(m(G))]),_:1})]),s("div",Je,[s("div",Qe,p(Z.value),1),e[25]||(e[25]=s("div",{class:"stat-label"},"å®¡æ ¸ä¸­",-1))])])]),_:1})]),_:1}),l(S,{span:6},{default:t(()=>[l(x,{shadow:"hover",class:"stat-card"},{default:t(()=>[s("div",Xe,[s("div",Ge,[l(v,{color:"#F56C6C"},{default:t(()=>[l(m(W))]),_:1})]),s("div",We,[s("div",Ye,p(ee.value),1),e[26]||(e[26]=s("div",{class:"stat-label"},"æ€»ä¸‹è½½é‡",-1))])])]),_:1})]),_:1})]),_:1}),l(x,{shadow:"hover",class:"filter-card"},{default:t(()=>[l(m(q),{model:h,inline:!0,class:"search-form"},{default:t(()=>[l(i,{label:"çŠ¶æ€ç­›é€‰:"},{default:t(()=>[l(j,{modelValue:h.status,"onUpdate:modelValue":e[1]||(e[1]=a=>h.status=a),placeholder:"å…¨éƒ¨çŠ¶æ€",clearable:"",style:{width:"120px"}},{default:t(()=>[l(C,{label:"å…¨éƒ¨",value:""}),l(C,{label:"å·²å‘å¸ƒ",value:"Active"}),l(C,{label:"å®¡æ ¸ä¸­",value:"Pending"}),l(C,{label:"å·²æ‹’ç»",value:"Rejected"}),l(C,{label:"å·²ä¸‹æž¶",value:"Inactive"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"æœç´¢:"},{default:t(()=>[l(g,{modelValue:h.search,"onUpdate:modelValue":e[2]||(e[2]=a=>h.search=a),placeholder:"è¾“å…¥èµ„æºåç§°",clearable:"",style:{width:"200px"},onKeyup:Ve(b,["enter"])},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(u,{type:"primary",icon:"Search",onClick:b},{default:t(()=>e[27]||(e[27]=[c("æœç´¢")])),_:1,__:[27]}),l(u,{icon:"Refresh",onClick:le},{default:t(()=>e[28]||(e[28]=[c("é‡ç½®")])),_:1,__:[28]})]),_:1})]),_:1},8,["model"])]),_:1}),l(x,{shadow:"hover",class:"resource-list-card"},{default:t(()=>[he((_(),w("div",null,[k.value.length===0&&!A.value?(_(),w("div",Ze,[l(me,{description:"è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•èµ„æº"},{default:t(()=>[l(u,{type:"primary",onClick:e[3]||(e[3]=a=>U.value=!0)},{default:t(()=>e[29]||(e[29]=[c(" ç«‹å³ä¸Šä¼  ")])),_:1,__:[29]})]),_:1})])):(_(),w("div",el,[(_(!0),w(T,null,L(k.value,a=>(_(),w("div",{key:a.id,class:"resource-card"},[s("div",ll,[s("div",{class:"resource-title",onClick:Q=>o.$router.push(`/resource/${a.id}`)},p(a.name),9,tl),l(fe,{onCommand:Q=>te(Q,a)},{dropdown:t(()=>[l(_e,null,{default:t(()=>[l(N,{command:"edit"},{default:t(()=>e[30]||(e[30]=[c("ç¼–è¾‘")])),_:1,__:[30]}),l(N,{command:"view"},{default:t(()=>e[31]||(e[31]=[c("æŸ¥çœ‹")])),_:1,__:[31]}),l(N,{command:"delete",divided:""},{default:t(()=>e[32]||(e[32]=[c("åˆ é™¤")])),_:1,__:[32]})]),_:1})]),default:t(()=>[l(u,{type:"text",size:"small"},{default:t(()=>[l(v,null,{default:t(()=>[l(m(Re))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),s("div",al,[s("div",ol,[e[33]||(e[33]=s("span",{class:"label"},"ä½œè€…:",-1)),s("span",sl,p(a.author),1)]),s("div",nl,[e[34]||(e[34]=s("span",{class:"label"},"ç‰ˆæœ¬:",-1)),s("span",dl,p(a.version||"æœªè®¾ç½®"),1)]),s("div",rl,[e[35]||(e[35]=s("span",{class:"label"},"çŠ¶æ€:",-1)),l(ve,{type:re(a.status),size:"small"},{default:t(()=>[c(p(ie(a.status)),1)]),_:2},1032,["type"])])]),s("div",il,p(a.description||"æš‚æ— æè¿°"),1),s("div",ul,[s("div",cl,[l(v,null,{default:t(()=>[l(m(W))]),_:1}),s("span",null,p(a.download_count),1)]),s("div",pl,[l(v,null,{default:t(()=>[l(m(ze))]),_:1}),s("span",null,p(a.like_count||0),1)]),s("div",ml,[l(v,null,{default:t(()=>[l(m(G))]),_:1}),s("span",null,p(ue(a.created_at)),1)])])]))),128))])),B.value>0?(_(),w("div",_l,[l(ge,{"current-page":V.page,"onUpdate:currentPage":e[4]||(e[4]=a=>V.page=a),"page-size":V.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>V.pageSize=a),"page-sizes":[10,20,50],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])])):Ce("",!0)])),[[ye,A.value]])]),_:1}),l(J,{modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=a=>U.value=a),title:"ä¸Šä¼ æ–°èµ„æº",width:"600px","close-on-click-modal":!1},{footer:t(()=>[s("div",fl,[l(u,{onClick:e[12]||(e[12]=a=>U.value=!1)},{default:t(()=>e[36]||(e[36]=[c("å–æ¶ˆ")])),_:1,__:[36]}),l(u,{type:"primary",onClick:oe,loading:I.value},{default:t(()=>e[37]||(e[37]=[c(" æäº¤ä¸Šä¼  ")])),_:1,__:[37]},8,["loading"])])]),default:t(()=>[l(m(q),{model:n,rules:O,ref_key:"uploadFormRef",ref:P,"label-width":"80px"},{default:t(()=>[l(i,{label:"èµ„æºåç§°",prop:"name"},{default:t(()=>[l(g,{modelValue:n.name,"onUpdate:modelValue":e[6]||(e[6]=a=>n.name=a),placeholder:"è¯·è¾“å…¥èµ„æºåç§°"},null,8,["modelValue"])]),_:1}),l(i,{label:"ä½œè€…",prop:"author"},{default:t(()=>[l(g,{modelValue:n.author,"onUpdate:modelValue":e[7]||(e[7]=a=>n.author=a),placeholder:"å½“å‰ç”¨æˆ·",disabled:""},null,8,["modelValue"])]),_:1}),l(i,{label:"ç‰ˆæœ¬",prop:"version"},{default:t(()=>[l(g,{modelValue:n.version,"onUpdate:modelValue":e[8]||(e[8]=a=>n.version=a),placeholder:"è¯·è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1}),l(i,{label:"åˆ†ç±»",prop:"category_id"},{default:t(()=>[l(j,{modelValue:n.category_id,"onUpdate:modelValue":e[9]||(e[9]=a=>n.category_id=a),placeholder:"è¯·é€‰æ‹©åˆ†ç±»",style:{width:"100%"}},{default:t(()=>[(_(!0),w(T,null,L(z.value,a=>(_(),X(C,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"èµ„æºæè¿°",prop:"description"},{default:t(()=>[l(g,{modelValue:n.description,"onUpdate:modelValue":e[10]||(e[10]=a=>n.description=a),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥èµ„æºæè¿°"},null,8,["modelValue"])]),_:1}),l(i,{label:"æ–‡ä»¶é“¾æŽ¥",prop:"file_url"},{default:t(()=>[l(g,{modelValue:n.file_url,"onUpdate:modelValue":e[11]||(e[11]=a=>n.file_url=a),placeholder:"è¯·è¾“å…¥æ–‡ä»¶ä¸‹è½½é“¾æŽ¥"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(J,{modelValue:R.value,"onUpdate:modelValue":e[20]||(e[20]=a=>R.value=a),title:"ç¼–è¾‘èµ„æº",width:"600px","close-on-click-modal":!1},{footer:t(()=>[s("div",vl,[l(u,{onClick:e[19]||(e[19]=a=>R.value=!1)},{default:t(()=>e[38]||(e[38]=[c("å–æ¶ˆ")])),_:1,__:[38]}),l(u,{type:"primary",onClick:se,loading:M.value},{default:t(()=>e[39]||(e[39]=[c(" ä¿å­˜ä¿®æ”¹ ")])),_:1,__:[39]},8,["loading"])])]),default:t(()=>[l(m(q),{model:d,rules:O,ref_key:"editFormRef",ref:E,"label-width":"80px"},{default:t(()=>[l(i,{label:"èµ„æºåç§°",prop:"name"},{default:t(()=>[l(g,{modelValue:d.name,"onUpdate:modelValue":e[14]||(e[14]=a=>d.name=a),placeholder:"è¯·è¾“å…¥èµ„æºåç§°"},null,8,["modelValue"])]),_:1}),l(i,{label:"ç‰ˆæœ¬",prop:"version"},{default:t(()=>[l(g,{modelValue:d.version,"onUpdate:modelValue":e[15]||(e[15]=a=>d.version=a),placeholder:"è¯·è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1}),l(i,{label:"åˆ†ç±»",prop:"category_id"},{default:t(()=>[l(j,{modelValue:d.category_id,"onUpdate:modelValue":e[16]||(e[16]=a=>d.category_id=a),placeholder:"è¯·é€‰æ‹©åˆ†ç±»",style:{width:"100%"}},{default:t(()=>[(_(!0),w(T,null,L(z.value,a=>(_(),X(C,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"èµ„æºæè¿°",prop:"description"},{default:t(()=>[l(g,{modelValue:d.description,"onUpdate:modelValue":e[17]||(e[17]=a=>d.description=a),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥èµ„æºæè¿°"},null,8,["modelValue"])]),_:1}),l(i,{label:"æ–‡ä»¶é“¾æŽ¥",prop:"file_url"},{default:t(()=>[l(g,{modelValue:d.file_url,"onUpdate:modelValue":e[18]||(e[18]=a=>d.file_url=a),placeholder:"è¯·è¾“å…¥æ–‡ä»¶ä¸‹è½½é“¾æŽ¥"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),xl=Fe(gl,[["__scopeId","data-v-406803bf"]]);export{xl as default};
