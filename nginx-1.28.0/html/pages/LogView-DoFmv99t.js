import{x as te,r as i,w as le,j as se,y as k,A as t,J as ae,Q as l,I as s,u as v,al as r,M as _,O as d,ar as oe,K as O,ax as ne,z as V}from"../chunks/vue-vendor-BleHOoLr.js";import{l as B,Y as ie,a0 as de,a1 as ue,a2 as re,q as ce,M as ve,f as _e,F as pe,I as p}from"../chunks/element-plus-D5w7-vkF.js";import{_ as fe}from"../assets/index-C3B7XhMB.js";import{a as me}from"../chunks/admin--Q-2AwKL.js";import{l as D}from"../chunks/logs-DaFOSsr9.js";import"../chunks/utils-Dq7h7Pqt.js";const ge={class:"admin-page log-view-desktop"},be={class:"page-header"},he={class:"header-content"},ye={class:"header-left"},we={class:"header-icon"},ke={class:"header-actions"},Ve={class:"stats-section"},Ce={class:"stats-grid"},Re={class:"stat-card"},xe={class:"stat-icon"},Le={class:"stat-content"},ze={class:"stat-number"},Ne={class:"stat-card"},Oe={class:"stat-icon"},Ie={class:"stat-content"},Se={class:"stat-number"},Ue={class:"stat-card"},Ae={class:"stat-icon"},De={class:"stat-content"},Ee={class:"stat-number"},Me={class:"stat-card"},$e={class:"stat-icon"},Fe={class:"stat-content"},Ye={class:"stat-number"},je={class:"search-section"},Be={class:"search-left"},Te={class:"search-right"},We={class:"table-section"},Je={class:"message-cell"},qe={key:0,class:"empty-logs"},Ke={class:"pagination-section"},Qe={key:0,class:"log-detail"},Ge={class:"detail-item"},He={class:"detail-value"},Pe={class:"detail-item"},Xe={class:"detail-item"},Ze={class:"detail-value"},et={class:"detail-item"},tt={class:"detail-message"},lt={key:0,class:"detail-item"},st={class:"detail-stack"},at={key:1,class:"detail-item"},ot={class:"detail-meta"},nt={class:"confirm-content"},it={class:"dialog-footer"},dt=te({name:"LogView",__name:"LogView",setup(ut){ne();const m=i([]),L=i(!1),y=i(1),I=i(20),z=i(0),C=i(""),g=i(""),b=i(null);i("");const R=i(!1),u=i(null),h=i(!1),S=i(""),U=i(()=>{}),E=i(0),M=i(0),$=i(0);function T(a){u.value=a,R.value=!0}function W(a){S.value="确定要删除这条日志吗？",U.value=async()=>{try{const e=await D.deleteLog(a.id);e.code===0?(p.success("日志已删除"),R.value=!1,f(y.value)):p.error(e.message||"删除失败")}catch(e){console.error("删除日志失败:",e),p.error("删除日志失败")}finally{h.value=!1}},h.value=!0}function J(a){I.value=a,f(1)}function F(a){switch(a){case"ERROR":return"danger";case"WARN":return"warning";case"INFO":default:return"success"}}async function f(a=1){y.value=a,L.value=!0;try{const e=await me.getLogs({page:y.value,pageSize:I.value,level:g.value||void 0,search:C.value||void 0});e.code===0&&e.data?(m.value=e.data.list||[],z.value=e.data.total||0,E.value=m.value.filter(n=>n.level==="INFO").length,M.value=m.value.filter(n=>n.level==="WARN").length,$.value=m.value.filter(n=>n.level==="ERROR").length):p.warning(e.message||"获取日志数据失败")}catch(e){console.error("加载日志失败:",e),p.error("日志加载失败，请稍后重试"),m.value=[],z.value=0}finally{L.value=!1}}function q(){f(y.value)}function A(){f(1)}async function K(){try{const a={};C.value&&(a.search=C.value),g.value&&(a.level=g.value),b.value&&b.value[0]&&b.value[1]&&(a.start_date=b.value[0],a.end_date=b.value[1]);const e=await D.exportLogs(a),n=new Blob([e],{type:"text/plain"}),c=URL.createObjectURL(n),x=document.createElement("a");x.href=c,x.download=`system_logs_${new Date().toISOString().split("T")[0]}.txt`,x.click(),URL.revokeObjectURL(c),p.success("日志导出成功")}catch(a){console.error("导出日志失败:",a),p.error("导出失败，请稍后重试")}}async function Q(){S.value="确定要清空所有日志吗？此操作不可恢复！",U.value=async()=>{try{const a={};g.value&&(a.level=g.value);const e=await D.clearLogs(a);e.code===0&&e.data?(p.success(`成功清除${e.data.deleted_count||0}条日志`),f(1)):p.error(e.message||"清空失败")}catch(a){console.error("清空日志失败:",a),p.error("清空日志失败")}finally{h.value=!1}},h.value=!0}return le(y,a=>f(a)),se(()=>f(1)),(a,e)=>{const n=r("el-icon"),c=r("el-button"),x=r("el-input"),N=r("el-option"),G=r("el-select"),H=r("el-date-picker"),w=r("el-table-column"),Y=r("el-tag"),P=r("el-table"),X=r("el-empty"),Z=r("el-pagination"),j=r("el-dialog"),ee=oe("loading");return V(),k("div",ge,[t("div",be,[t("div",he,[t("div",ye,[t("div",we,[l(n,{size:32},{default:s(()=>[l(v(B))]),_:1})]),e[8]||(e[8]=t("div",{class:"header-info"},[t("h1",{class:"page-title"},"日志查看"),t("p",{class:"page-subtitle"},"查看和管理系统运行日志")],-1))]),t("div",ke,[l(c,{onClick:q},{default:s(()=>[l(n,null,{default:s(()=>[l(v(ie))]),_:1}),e[9]||(e[9]=_(" 刷新 "))]),_:1,__:[9]})])])]),t("div",Ve,[t("div",Ce,[t("div",Re,[t("div",xe,[l(n,{size:24},{default:s(()=>[l(v(B))]),_:1})]),t("div",Le,[t("div",ze,d(z.value),1),e[10]||(e[10]=t("div",{class:"stat-label"},"总日志",-1))])]),t("div",Ne,[t("div",Oe,[l(n,{size:24},{default:s(()=>[l(v(de))]),_:1})]),t("div",Ie,[t("div",Se,d(E.value),1),e[11]||(e[11]=t("div",{class:"stat-label"},"信息",-1))])]),t("div",Ue,[t("div",Ae,[l(n,{size:24},{default:s(()=>[l(v(ue))]),_:1})]),t("div",De,[t("div",Ee,d(M.value),1),e[12]||(e[12]=t("div",{class:"stat-label"},"警告",-1))])]),t("div",Me,[t("div",$e,[l(n,{size:24},{default:s(()=>[l(v(re))]),_:1})]),t("div",Fe,[t("div",Ye,d($.value),1),e[13]||(e[13]=t("div",{class:"stat-label"},"错误",-1))])])])]),t("div",je,[t("div",Be,[l(x,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=o=>C.value=o),placeholder:"搜索日志内容...",clearable:"",style:{width:"250px"},onInput:A},{prefix:s(()=>[l(n,null,{default:s(()=>[l(v(ce))]),_:1})]),_:1},8,["modelValue"]),l(G,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o),placeholder:"日志等级",clearable:"",style:{width:"150px"},onChange:A},{default:s(()=>[l(N,{label:"全部",value:""}),l(N,{label:"INFO",value:"INFO"}),l(N,{label:"WARN",value:"WARN"}),l(N,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"]),l(H,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"350px"},"value-format":"YYYY-MM-DD",onChange:A},null,8,["modelValue"])]),t("div",Te,[l(c,{onClick:Q,type:"danger"},{default:s(()=>[l(n,null,{default:s(()=>[l(v(ve))]),_:1}),e[14]||(e[14]=_(" 清空日志 "))]),_:1,__:[14]}),l(c,{onClick:K,type:"success"},{default:s(()=>[l(n,null,{default:s(()=>[l(v(_e))]),_:1}),e[15]||(e[15]=_(" 导出日志 "))]),_:1,__:[15]})])]),ae((V(),k("div",We,[l(P,{data:m.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"var(--bg-secondary)",color:"var(--text-primary)"},"row-style":{background:"var(--bg-card)"}},{default:s(()=>[l(w,{type:"index",width:"50",label:"#"}),l(w,{prop:"timestamp",label:"时间",width:"180"}),l(w,{prop:"level",label:"等级",width:"100"},{default:s(({row:o})=>[l(Y,{type:F(o.level),size:"small"},{default:s(()=>[_(d(o.level),1)]),_:2},1032,["type"])]),_:1}),l(w,{prop:"source",label:"来源",width:"150"}),l(w,{prop:"message",label:"消息","min-width":"400"},{default:s(({row:o})=>[t("div",Je,d(o.message),1)]),_:1}),l(w,{label:"操作",width:"120",fixed:"right"},{default:s(({row:o})=>[l(c,{size:"small",onClick:rt=>T(o),type:"primary"},{default:s(()=>[l(n,null,{default:s(()=>[l(v(pe))]),_:1}),e[16]||(e[16]=_(" 详情 "))]),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),!L.value&&m.value.length===0?(V(),k("div",qe,[l(X,{description:"暂无日志数据"})])):O("",!0)])),[[ee,L.value]]),t("div",Ke,[l(Z,{"current-page":y.value,"page-size":I.value,"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:f},null,8,["current-page","page-size","total"])]),l(j,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=o=>R.value=o),title:"日志详情",width:"700px","close-on-click-modal":!1},{footer:s(()=>[l(c,{onClick:e[3]||(e[3]=o=>R.value=!1)},{default:s(()=>e[23]||(e[23]=[_("关闭")])),_:1,__:[23]}),l(c,{type:"danger",onClick:e[4]||(e[4]=o=>W(u.value))},{default:s(()=>e[24]||(e[24]=[_("删除")])),_:1,__:[24]})]),default:s(()=>[u.value?(V(),k("div",Qe,[t("div",Ge,[e[17]||(e[17]=t("span",{class:"detail-label"},"时间：",-1)),t("span",He,d(u.value.timestamp),1)]),t("div",Pe,[e[18]||(e[18]=t("span",{class:"detail-label"},"等级：",-1)),l(Y,{type:F(u.value.level)},{default:s(()=>[_(d(u.value.level),1)]),_:1},8,["type"])]),t("div",Xe,[e[19]||(e[19]=t("span",{class:"detail-label"},"来源：",-1)),t("span",Ze,d(u.value.source),1)]),t("div",et,[e[20]||(e[20]=t("span",{class:"detail-label"},"消息：",-1)),t("div",tt,d(u.value.message),1)]),u.value.stack?(V(),k("div",lt,[e[21]||(e[21]=t("span",{class:"detail-label"},"堆栈：",-1)),t("pre",st,d(u.value.stack),1)])):O("",!0),u.value.meta?(V(),k("div",at,[e[22]||(e[22]=t("span",{class:"detail-label"},"元数据：",-1)),t("pre",ot,d(JSON.stringify(u.value.meta,null,2)),1)])):O("",!0)])):O("",!0)]),_:1},8,["modelValue"]),l(j,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=o=>h.value=o),title:"确认操作",width:"400px"},{footer:s(()=>[t("span",it,[l(c,{onClick:e[6]||(e[6]=o=>h.value=!1)},{default:s(()=>e[25]||(e[25]=[_("取消")])),_:1,__:[25]}),l(c,{type:"danger",onClick:U.value},{default:s(()=>e[26]||(e[26]=[_("确认")])),_:1,__:[26]},8,["onClick"])])]),default:s(()=>[t("div",nt,[t("p",null,d(S.value),1)])]),_:1},8,["modelValue"])])}}}),gt=fe(dt,[["__scopeId","data-v-181bba9c"]]);export{gt as default};
