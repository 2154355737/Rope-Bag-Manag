import{a3 as T,V as I,H as r,E as A}from"../chunks/element-plus-hGoKm610.js";import{s as i}from"../chunks/settings-D5ezoeM_.js";import{x as P,r as Q,X as w,j as R,y as v,Q as l,I as n,A as s,al as m,M as b,u as z,z as x}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as q}from"../assets/index-D3Kp6etV.js";import"../chunks/utils-Dq7h7Pqt.js";const F={class:"system-settings"},j={class:"settings-content"},D={class:"setting-section"},H={class:"setting-section"},W={class:"mode-description"},X={key:0},G={key:1,class:"warning-text"},J={class:"setting-section"},K={class:"setting-section"},L={class:"setting-section"},O={class:"setting-section"},Y={class:"setting-actions"},Z=P({__name:"ThemeSettings",setup($){const k=Q(!1),a=w({theme:{},system_mode:"Normal",feature_flags:{},backend_config:{proxy_address:"",api_timeout:30,max_upload_size:100},backup_settings:{enable_auto_backup:!1,backup_interval_hours:24,backup_location:"./backups",max_backup_files:10},global_announcement:{enabled:!1,title:"",content:"",type_:"Info",start_time:"",end_time:"",priority:5}});async function S(){try{const d=await i.getThemeSettings();if(d.code===0&&d.data){const o=w({});o.primary_color=d.data.primary_color,o.secondary_color=d.data.secondary_color,o.dark_mode=d.data.dark_mode,o.font_size=d.data.font_size,o.language=d.data.language,a.theme=o}const e=await i.getSetting("system_mode");e.code===0&&e.data&&(a.system_mode=e.data.value);const u=[i.getSetting("enable_registration"),i.getSetting("enable_community"),i.getSetting("enable_upload"),i.getSetting("enable_comments")];(await Promise.all(u)).forEach(o=>{if(o.code===0&&o.data){const _=o.data.key,c=o.data.value==="true";_ in a.feature_flags&&(a.feature_flags[_]=c)}})}catch(d){console.error("加载设置失败:",d),r.error("加载设置失败")}}async function B(){k.value=!0;try{const d=await i.updateThemeSettings({primary_color:a.theme.primary_color||"#409EFF",secondary_color:a.theme.secondary_color||"#67C23A",dark_mode:a.theme.dark_mode||!1,font_size:a.theme.font_size||"14px",language:a.theme.language||"zh-CN"});if(d.code===0){const e=[i.updateSetting("system_mode",a.system_mode),i.updateSetting("enable_registration",a.feature_flags.enable_registration),i.updateSetting("enable_community",a.feature_flags.enable_community),i.updateSetting("enable_upload",a.feature_flags.enable_upload),i.updateSetting("enable_comments",a.feature_flags.enable_comments)];await Promise.all(e),r.success("设置保存成功")}else r.error(d.message||"保存失败")}catch(d){console.error("保存设置失败:",d),r.error("保存设置失败")}finally{k.value=!1}}function C(){A.confirm("确定要重置所有设置吗？这将恢复默认配置。","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const d=await i.resetSettings();d.code===0?(r.success("设置已重置"),S()):r.error(d.message||"重置失败")}catch(d){console.error("重置设置失败:",d),r.error("重置设置失败")}}).catch(()=>{})}function E(){r.info("测试功能开发中...")}return R(()=>{S()}),(d,e)=>{const u=m("el-option"),g=m("el-select"),o=m("el-form-item"),_=m("el-form"),c=m("el-radio"),M=m("el-radio-group"),U=m("el-icon"),p=m("el-switch"),V=m("el-input"),f=m("el-input-number"),y=m("el-button"),N=m("el-card");return x(),v("div",F,[l(N,{class:"settings-card"},{header:n(()=>e[20]||(e[20]=[s("div",{class:"settings-header"},[s("h2",null,"系统设置"),s("p",null,"管理系统配置、主题、功能开关等设置")],-1)])),default:n(()=>[s("div",j,[s("div",D,[e[21]||(e[21]=s("h3",null,"主题设置",-1)),l(_,{model:a.theme,"label-width":"120px"},{default:n(()=>[l(o,{label:"资源社区主题"},{default:n(()=>[l(g,{modelValue:a.theme.community_theme,"onUpdate:modelValue":e[0]||(e[0]=t=>a.theme.community_theme=t),placeholder:"选择社区主题"},{default:n(()=>[l(u,{label:"浅色主题",value:"light"}),l(u,{label:"深色主题",value:"dark"}),l(u,{label:"蓝色主题",value:"blue"}),l(u,{label:"绿色主题",value:"green"}),l(u,{label:"紫色主题",value:"purple"}),l(u,{label:"橙色主题",value:"orange"}),l(u,{label:"红色主题",value:"red"})]),_:1},8,["modelValue"])]),_:1}),l(o,{label:"后台管理主题"},{default:n(()=>[l(g,{modelValue:a.theme.admin_theme,"onUpdate:modelValue":e[1]||(e[1]=t=>a.theme.admin_theme=t),placeholder:"选择管理主题"},{default:n(()=>[l(u,{label:"浅色主题",value:"light"}),l(u,{label:"深色主题",value:"dark"}),l(u,{label:"蓝色主题",value:"blue"}),l(u,{label:"绿色主题",value:"green"}),l(u,{label:"紫色主题",value:"purple"}),l(u,{label:"橙色主题",value:"orange"}),l(u,{label:"红色主题",value:"red"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),s("div",H,[e[26]||(e[26]=s("h3",null,"系统模式",-1)),l(_,{model:a,"label-width":"120px"},{default:n(()=>[l(o,{label:"系统模式"},{default:n(()=>[l(M,{modelValue:a.system_mode,"onUpdate:modelValue":e[2]||(e[2]=t=>a.system_mode=t)},{default:n(()=>[l(c,{label:"Normal"},{default:n(()=>e[22]||(e[22]=[b("正常运行")])),_:1,__:[22]}),l(c,{label:"Maintenance"},{default:n(()=>e[23]||(e[23]=[b("维护中")])),_:1,__:[23]})]),_:1},8,["modelValue"]),s("div",W,[a.system_mode==="Normal"?(x(),v("p",X,[l(U,null,{default:n(()=>[l(z(T))]),_:1}),e[24]||(e[24]=b(" 正常运行模式：所有功能正常开放，用户可以正常使用所有功能 "))])):(x(),v("p",G,[l(U,null,{default:n(()=>[l(z(I))]),_:1}),e[25]||(e[25]=b(" 维护模式：仅管理员可登录，用户注册、上传等功能将被禁用 "))]))])]),_:1})]),_:1},8,["model"])]),s("div",J,[e[32]||(e[32]=s("h3",null,"功能开关",-1)),l(_,{model:a.feature_flags,"label-width":"120px"},{default:n(()=>[l(o,{label:"用户注册"},{default:n(()=>[l(p,{modelValue:a.feature_flags.enable_registration,"onUpdate:modelValue":e[3]||(e[3]=t=>a.feature_flags.enable_registration=t)},null,8,["modelValue"]),e[27]||(e[27]=s("span",{class:"feature-desc"},"允许新用户注册账号",-1))]),_:1,__:[27]}),l(o,{label:"资源社区"},{default:n(()=>[l(p,{modelValue:a.feature_flags.enable_community,"onUpdate:modelValue":e[4]||(e[4]=t=>a.feature_flags.enable_community=t)},null,8,["modelValue"]),e[28]||(e[28]=s("span",{class:"feature-desc"},"开放资源社区功能",-1))]),_:1,__:[28]}),l(o,{label:"用户上传"},{default:n(()=>[l(p,{modelValue:a.feature_flags.enable_upload,"onUpdate:modelValue":e[5]||(e[5]=t=>a.feature_flags.enable_upload=t)},null,8,["modelValue"]),e[29]||(e[29]=s("span",{class:"feature-desc"},"允许用户上传资源",-1))]),_:1,__:[29]}),l(o,{label:"用户评论"},{default:n(()=>[l(p,{modelValue:a.feature_flags.enable_comments,"onUpdate:modelValue":e[6]||(e[6]=t=>a.feature_flags.enable_comments=t)},null,8,["modelValue"]),e[30]||(e[30]=s("span",{class:"feature-desc"},"允许用户发表评论",-1))]),_:1,__:[30]}),l(o,{label:"QQ绑定"},{default:n(()=>[l(p,{modelValue:a.feature_flags.enable_qq_binding,"onUpdate:modelValue":e[7]||(e[7]=t=>a.feature_flags.enable_qq_binding=t)},null,8,["modelValue"]),e[31]||(e[31]=s("span",{class:"feature-desc"},"允许用户绑定QQ账号",-1))]),_:1,__:[31]})]),_:1},8,["model"])]),s("div",K,[e[35]||(e[35]=s("h3",null,"后端配置",-1)),l(_,{model:a.backend_config,"label-width":"120px"},{default:n(()=>[l(o,{label:"代理地址"},{default:n(()=>[l(V,{modelValue:a.backend_config.proxy_address,"onUpdate:modelValue":e[8]||(e[8]=t=>a.backend_config.proxy_address=t),placeholder:"设置后台代理地址"},null,8,["modelValue"])]),_:1}),l(o,{label:"API超时时间"},{default:n(()=>[l(f,{modelValue:a.backend_config.api_timeout,"onUpdate:modelValue":e[9]||(e[9]=t=>a.backend_config.api_timeout=t),min:1,max:300,placeholder:"秒"},null,8,["modelValue"]),e[33]||(e[33]=s("span",{class:"config-desc"},"API请求超时时间（秒）",-1))]),_:1,__:[33]}),l(o,{label:"最大上传大小"},{default:n(()=>[l(f,{modelValue:a.backend_config.max_upload_size,"onUpdate:modelValue":e[10]||(e[10]=t=>a.backend_config.max_upload_size=t),min:1,max:1e3,placeholder:"MB"},null,8,["modelValue"]),e[34]||(e[34]=s("span",{class:"config-desc"},"最大上传文件大小（MB）",-1))]),_:1,__:[34]})]),_:1},8,["model"])]),s("div",L,[e[39]||(e[39]=s("h3",null,"数据库备份",-1)),l(_,{model:a.backup_settings,"label-width":"120px"},{default:n(()=>[l(o,{label:"自动备份"},{default:n(()=>[l(p,{modelValue:a.backup_settings.enable_auto_backup,"onUpdate:modelValue":e[11]||(e[11]=t=>a.backup_settings.enable_auto_backup=t)},null,8,["modelValue"]),e[36]||(e[36]=s("span",{class:"backup-desc"},"启用自动备份功能",-1))]),_:1,__:[36]}),l(o,{label:"备份间隔"},{default:n(()=>[l(f,{modelValue:a.backup_settings.backup_interval_hours,"onUpdate:modelValue":e[12]||(e[12]=t=>a.backup_settings.backup_interval_hours=t),min:1,max:168,placeholder:"小时",disabled:!a.backup_settings.enable_auto_backup},null,8,["modelValue","disabled"]),e[37]||(e[37]=s("span",{class:"backup-desc"},"备份间隔时间（小时）",-1))]),_:1,__:[37]}),l(o,{label:"备份位置"},{default:n(()=>[l(V,{modelValue:a.backup_settings.backup_location,"onUpdate:modelValue":e[13]||(e[13]=t=>a.backup_settings.backup_location=t),placeholder:"备份文件存储路径",disabled:!a.backup_settings.enable_auto_backup},null,8,["modelValue","disabled"])]),_:1}),l(o,{label:"最大备份文件"},{default:n(()=>[l(f,{modelValue:a.backup_settings.max_backup_files,"onUpdate:modelValue":e[14]||(e[14]=t=>a.backup_settings.max_backup_files=t),min:1,max:100,placeholder:"个",disabled:!a.backup_settings.enable_auto_backup},null,8,["modelValue","disabled"]),e[38]||(e[38]=s("span",{class:"backup-desc"},"保留的最大备份文件数量",-1))]),_:1,__:[38]})]),_:1},8,["model"])]),s("div",O,[e[42]||(e[42]=s("h3",null,"全局公告",-1)),l(_,{model:a.global_announcement,"label-width":"120px"},{default:n(()=>[l(o,{label:"启用公告"},{default:n(()=>[l(p,{modelValue:a.global_announcement.enabled,"onUpdate:modelValue":e[15]||(e[15]=t=>a.global_announcement.enabled=t)},null,8,["modelValue"]),e[40]||(e[40]=s("span",{class:"announcement-desc"},"在资源社区显示全局公告",-1))]),_:1,__:[40]}),l(o,{label:"公告标题"},{default:n(()=>[l(V,{modelValue:a.global_announcement.title,"onUpdate:modelValue":e[16]||(e[16]=t=>a.global_announcement.title=t),placeholder:"公告标题",disabled:!a.global_announcement.enabled},null,8,["modelValue","disabled"])]),_:1}),l(o,{label:"公告内容"},{default:n(()=>[l(V,{modelValue:a.global_announcement.content,"onUpdate:modelValue":e[17]||(e[17]=t=>a.global_announcement.content=t),type:"textarea",rows:4,placeholder:"公告内容",disabled:!a.global_announcement.enabled},null,8,["modelValue","disabled"])]),_:1}),l(o,{label:"公告类型"},{default:n(()=>[l(g,{modelValue:a.global_announcement.type_,"onUpdate:modelValue":e[18]||(e[18]=t=>a.global_announcement.type_=t),placeholder:"选择公告类型",disabled:!a.global_announcement.enabled},{default:n(()=>[l(u,{label:"信息",value:"Info"}),l(u,{label:"警告",value:"Warning"}),l(u,{label:"错误",value:"Error"}),l(u,{label:"成功",value:"Success"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(o,{label:"优先级"},{default:n(()=>[l(f,{modelValue:a.global_announcement.priority,"onUpdate:modelValue":e[19]||(e[19]=t=>a.global_announcement.priority=t),min:1,max:10,placeholder:"1-10",disabled:!a.global_announcement.enabled},null,8,["modelValue","disabled"]),e[41]||(e[41]=s("span",{class:"announcement-desc"},"公告显示优先级（1-10）",-1))]),_:1,__:[41]})]),_:1},8,["model"])]),s("div",Y,[l(y,{type:"primary",onClick:B,loading:k.value},{default:n(()=>e[43]||(e[43]=[b(" 保存设置 ")])),_:1,__:[43]},8,["loading"]),l(y,{onClick:C},{default:n(()=>e[44]||(e[44]=[b("重置设置")])),_:1,__:[44]}),l(y,{onClick:E},{default:n(()=>e[45]||(e[45]=[b("测试设置")])),_:1,__:[45]})])])]),_:1})])}}}),ne=q(Z,[["__scopeId","data-v-ebec5be8"]]);export{ne as default};
