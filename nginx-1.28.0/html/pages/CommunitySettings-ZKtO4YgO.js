import{k as T,c as z,ad as A,p as G,a6 as H,ae as I,D as J,i as K,K as m,E as F}from"../chunks/element-plus-Cc1YNc_4.js";import{s as O}from"../chunks/settings-CQEJtwx0.js";import{x as X,r as q,X as j,j as L,y as B,A as s,Q as e,I as o,u as g,al as u,M as f,K as P,O as h,z as N}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as W}from"../assets/index-B_N-aWSj.js";import"../chunks/utils-Dq7h7Pqt.js";const Y={class:"admin-page community-settings"},Z={class:"page-header"},$={class:"header-content"},ee={class:"header-left"},te={class:"header-icon"},le={class:"header-actions"},oe={class:"settings-content"},se={class:"card-header"},ae={class:"card-header"},ne={class:"card-header"},re={class:"card-header"},ie={class:"preview-section"},ue={class:"preview-item"},de={class:"preview-item"},_e={class:"preview-item"},pe={key:0,class:"preview-item"},me={class:"announcement-preview"},ge={class:"preview-item"},fe={class:"card-header"},ce=X({__name:"CommunitySettings",setup(be){const U=q(!1),v=q(!1),y=q(),t=j({site_title:"",site_subtitle:"",site_description:"",welcome_message:"",announcement:"",footer_text:"",contact_email:"",github_link:"",qq_group:"",wechat_group:"",hero_title:"绳包管理器",hero_subtitle:"专业的资源管理与分享平台",homepage_sections:["hero_section","stats_section","popular_tags","recent_resources","community_posts","announcements"],resources_per_page:12,posts_per_page:10,default_sort:"latest"}),r=j({site_title:"",site_subtitle:"",site_description:"",welcome_message:"",announcement:"",footer_text:"",contact_email:"",github_link:"",qq_group:"",wechat_group:"",hero_title:"",hero_subtitle:"",homepage_sections:[],resources_per_page:12,posts_per_page:10,default_sort:"latest"}),k={site_title:[{required:!0,message:"请输入网站标题",trigger:"blur"},{min:1,max:50,message:"标题长度应在1-50个字符之间",trigger:"blur"}],site_subtitle:[{required:!0,message:"请输入网站副标题",trigger:"blur"},{min:1,max:100,message:"副标题长度应在1-100个字符之间",trigger:"blur"}],site_description:[{required:!0,message:"请输入网站描述",trigger:"blur"},{min:1,max:200,message:"描述长度应在1-200个字符之间",trigger:"blur"}],welcome_message:[{required:!0,message:"请输入欢迎消息",trigger:"blur"},{min:1,max:500,message:"欢迎消息长度应在1-500个字符之间",trigger:"blur"}],contact_email:[{required:!0,message:"请输入联系邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],footer_text:[{required:!0,message:"请输入页脚文本",trigger:"blur"},{min:1,max:100,message:"页脚文本长度应在1-100个字符之间",trigger:"blur"}]},Q=async()=>{U.value=!0;try{const a=await O.getCommunitySettings();a.code===0&&a.data?(Object.assign(t,a.data),Object.assign(r,a.data)):m.error(a.message||"加载设置失败")}catch(a){console.error("加载社区设置出错:",a),m.error("加载设置时发生错误")}finally{U.value=!1}},E=async()=>{if(y.value){try{await y.value.validate()}catch{m.warning("请检查表单输入");return}v.value=!0;try{const a={};if(t.site_title!==r.site_title&&(a.site_title=t.site_title),t.site_subtitle!==r.site_subtitle&&(a.site_subtitle=t.site_subtitle),t.site_description!==r.site_description&&(a.site_description=t.site_description),t.welcome_message!==r.welcome_message&&(a.welcome_message=t.welcome_message),t.announcement!==r.announcement&&(a.announcement=t.announcement||""),t.footer_text!==r.footer_text&&(a.footer_text=t.footer_text),t.contact_email!==r.contact_email&&(a.contact_email=t.contact_email),t.github_link!==r.github_link&&(a.github_link=t.github_link||""),t.qq_group!==r.qq_group&&(a.qq_group=t.qq_group||""),t.wechat_group!==r.wechat_group&&(a.wechat_group=t.wechat_group||""),t.hero_title!==r.hero_title&&(a.hero_title=t.hero_title),t.hero_subtitle!==r.hero_subtitle&&(a.hero_subtitle=t.hero_subtitle),JSON.stringify(t.homepage_sections)!==JSON.stringify(r.homepage_sections)&&(a.homepage_sections=t.homepage_sections),t.resources_per_page!==r.resources_per_page&&(a.resources_per_page=t.resources_per_page),t.posts_per_page!==r.posts_per_page&&(a.posts_per_page=t.posts_per_page),t.default_sort!==r.default_sort&&(a.default_sort=t.default_sort),Object.keys(a).length===0){m.info("没有需要更新的设置");return}const l=await O.updateCommunitySettings(a);l.code===0?(m.success("社区设置保存成功"),Object.assign(r,t)):m.error(l.message||"保存设置失败")}catch(a){console.error("保存社区设置出错:",a),m.error("保存设置时发生错误")}finally{v.value=!1}}},M=async()=>{try{await F.confirm("确定要重置所有设置到原始状态吗？","重置确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Object.assign(t,r),m.success("设置已重置")}catch{}};return L(()=>{Q()}),(a,l)=>{const p=u("el-icon"),S=u("el-button"),d=u("el-input"),i=u("el-form-item"),_=u("el-col"),b=u("el-row"),V=u("el-form"),w=u("el-card"),c=u("el-checkbox"),D=u("el-checkbox-group"),C=u("el-input-number"),x=u("el-option"),R=u("el-select");return N(),B("div",Y,[s("div",Z,[s("div",$,[s("div",ee,[s("div",te,[e(p,{size:32},{default:o(()=>[e(g(T))]),_:1})]),l[16]||(l[16]=s("div",{class:"header-info"},[s("h1",{class:"page-title"},"社区设置"),s("p",{class:"page-subtitle"},"管理社区主页的显示内容和基本信息")],-1))]),s("div",le,[e(S,{type:"primary",onClick:E,loading:v.value},{default:o(()=>[e(p,null,{default:o(()=>[e(g(z))]),_:1}),l[17]||(l[17]=f(" 保存设置 "))]),_:1,__:[17]},8,["loading"]),e(S,{onClick:M,disabled:v.value},{default:o(()=>[e(p,null,{default:o(()=>[e(g(A))]),_:1}),l[18]||(l[18]=f(" 重置 "))]),_:1,__:[18]},8,["disabled"])])])]),s("div",oe,[e(w,{shadow:"never"},{header:o(()=>[s("div",se,[e(p,null,{default:o(()=>[e(g(G))]),_:1}),l[19]||(l[19]=s("span",null,"基本信息",-1))])]),default:o(()=>[e(V,{ref_key:"formRef",ref:y,model:t,rules:k,"label-width":"120px","label-position":"left"},{default:o(()=>[e(b,{gutter:24},{default:o(()=>[e(_,{span:12},{default:o(()=>[e(i,{label:"网站标题",prop:"site_title"},{default:o(()=>[e(d,{modelValue:t.site_title,"onUpdate:modelValue":l[0]||(l[0]=n=>t.site_title=n),placeholder:"请输入网站标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:o(()=>[e(i,{label:"网站副标题",prop:"site_subtitle"},{default:o(()=>[e(d,{modelValue:t.site_subtitle,"onUpdate:modelValue":l[1]||(l[1]=n=>t.site_subtitle=n),placeholder:"请输入网站副标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"网站描述",prop:"site_description"},{default:o(()=>[e(d,{modelValue:t.site_description,"onUpdate:modelValue":l[2]||(l[2]=n=>t.site_description=n),type:"textarea",rows:3,placeholder:"请输入网站描述","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]),_:1}),e(i,{label:"欢迎消息",prop:"welcome_message"},{default:o(()=>[e(d,{modelValue:t.welcome_message,"onUpdate:modelValue":l[3]||(l[3]=n=>t.welcome_message=n),type:"textarea",rows:4,placeholder:"请输入欢迎消息","show-word-limit":"",maxlength:"500"},null,8,["modelValue"])]),_:1}),e(i,{label:"网站公告"},{default:o(()=>[e(d,{modelValue:t.announcement,"onUpdate:modelValue":l[4]||(l[4]=n=>t.announcement=n),type:"textarea",rows:3,placeholder:"请输入网站公告（留空则不显示公告）","show-word-limit":"",maxlength:"300"},null,8,["modelValue"]),l[20]||(l[20]=s("div",{class:"form-tip"}," 公告将在社区主页顶部显示，留空则隐藏公告栏 ",-1))]),_:1,__:[20]})]),_:1},8,["model"])]),_:1}),e(w,{shadow:"never",style:{"margin-top":"20px"}},{header:o(()=>[s("div",ae,[e(p,null,{default:o(()=>[e(g(H))]),_:1}),l[21]||(l[21]=s("span",null,"联系方式",-1))])]),default:o(()=>[e(V,{model:t,rules:k,"label-width":"120px","label-position":"left"},{default:o(()=>[e(b,{gutter:24},{default:o(()=>[e(_,{span:12},{default:o(()=>[e(i,{label:"联系邮箱",prop:"contact_email"},{default:o(()=>[e(d,{modelValue:t.contact_email,"onUpdate:modelValue":l[5]||(l[5]=n=>t.contact_email=n),placeholder:"请输入联系邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:o(()=>[e(i,{label:"GitHub 链接"},{default:o(()=>[e(d,{modelValue:t.github_link,"onUpdate:modelValue":l[6]||(l[6]=n=>t.github_link=n),placeholder:"请输入GitHub项目链接（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:24},{default:o(()=>[e(_,{span:12},{default:o(()=>[e(i,{label:"QQ 群"},{default:o(()=>[e(d,{modelValue:t.qq_group,"onUpdate:modelValue":l[7]||(l[7]=n=>t.qq_group=n),placeholder:"请输入QQ群号（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:o(()=>[e(i,{label:"微信群"},{default:o(()=>[e(d,{modelValue:t.wechat_group,"onUpdate:modelValue":l[8]||(l[8]=n=>t.wechat_group=n),placeholder:"请输入微信群信息（可选）",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(w,{shadow:"never",style:{"margin-top":"20px"}},{header:o(()=>[s("div",ne,[e(p,null,{default:o(()=>[e(g(I))]),_:1}),l[22]||(l[22]=s("span",null,"页脚设置",-1))])]),default:o(()=>[e(V,{model:t,rules:k,"label-width":"120px","label-position":"left"},{default:o(()=>[e(i,{label:"页脚文本",prop:"footer_text"},{default:o(()=>[e(d,{modelValue:t.footer_text,"onUpdate:modelValue":l[9]||(l[9]=n=>t.footer_text=n),type:"textarea",rows:2,placeholder:"请输入页脚文本","show-word-limit":"",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(w,{shadow:"never",style:{"margin-top":"20px"}},{header:o(()=>[s("div",re,[e(p,null,{default:o(()=>[e(g(J))]),_:1}),l[23]||(l[23]=s("span",null,"设置预览",-1))])]),default:o(()=>[s("div",ie,[s("div",ue,[l[24]||(l[24]=s("label",null,"网站标题：",-1)),s("span",null,h(t.site_title||"未设置"),1)]),s("div",de,[l[25]||(l[25]=s("label",null,"网站副标题：",-1)),s("span",null,h(t.site_subtitle||"未设置"),1)]),s("div",_e,[l[26]||(l[26]=s("label",null,"网站描述：",-1)),s("span",null,h(t.site_description||"未设置"),1)]),t.announcement?(N(),B("div",pe,[l[27]||(l[27]=s("label",null,"网站公告：",-1)),s("span",me,h(t.announcement),1)])):P("",!0),s("div",ge,[l[28]||(l[28]=s("label",null,"联系邮箱：",-1)),s("span",null,h(t.contact_email||"未设置"),1)])])]),_:1}),e(w,{shadow:"never",style:{"margin-top":"20px"}},{header:o(()=>[s("div",fe,[e(p,null,{default:o(()=>[e(g(K))]),_:1}),l[29]||(l[29]=s("span",null,"主页显示配置",-1))])]),default:o(()=>[e(V,{model:t,"label-width":"120px","label-position":"left"},{default:o(()=>[e(b,{gutter:24},{default:o(()=>[e(_,{span:12},{default:o(()=>[e(i,{label:"首页主标题"},{default:o(()=>[e(d,{modelValue:t.hero_title,"onUpdate:modelValue":l[10]||(l[10]=n=>t.hero_title=n),placeholder:"请输入首页主标题",clearable:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:o(()=>[e(i,{label:"首页副标题"},{default:o(()=>[e(d,{modelValue:t.hero_subtitle,"onUpdate:modelValue":l[11]||(l[11]=n=>t.hero_subtitle=n),placeholder:"请输入首页副标题",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"主页布局选项"},{default:o(()=>[e(D,{modelValue:t.homepage_sections,"onUpdate:modelValue":l[12]||(l[12]=n=>t.homepage_sections=n)},{default:o(()=>[e(c,{label:"hero_section"},{default:o(()=>l[30]||(l[30]=[f("显示轮播横幅")])),_:1,__:[30]}),e(c,{label:"stats_section"},{default:o(()=>l[31]||(l[31]=[f("显示统计数据")])),_:1,__:[31]}),e(c,{label:"popular_tags"},{default:o(()=>l[32]||(l[32]=[f("显示热门标签")])),_:1,__:[32]}),e(c,{label:"recent_resources"},{default:o(()=>l[33]||(l[33]=[f("显示最新资源")])),_:1,__:[33]}),e(c,{label:"community_posts"},{default:o(()=>l[34]||(l[34]=[f("显示社区帖子")])),_:1,__:[34]}),e(c,{label:"announcements"},{default:o(()=>l[35]||(l[35]=[f("显示公告栏")])),_:1,__:[35]})]),_:1},8,["modelValue"]),l[36]||(l[36]=s("div",{class:"form-tip"}," 选择在首页显示的内容模块 ",-1))]),_:1,__:[36]}),e(b,{gutter:24},{default:o(()=>[e(_,{span:12},{default:o(()=>[e(i,{label:"每页资源数量"},{default:o(()=>[e(C,{modelValue:t.resources_per_page,"onUpdate:modelValue":l[13]||(l[13]=n=>t.resources_per_page=n),min:6,max:50,step:6,placeholder:"每页显示的资源数量"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:o(()=>[e(i,{label:"每页帖子数量"},{default:o(()=>[e(C,{modelValue:t.posts_per_page,"onUpdate:modelValue":l[14]||(l[14]=n=>t.posts_per_page=n),min:5,max:30,step:5,placeholder:"每页显示的帖子数量"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"默认排序方式"},{default:o(()=>[e(R,{modelValue:t.default_sort,"onUpdate:modelValue":l[15]||(l[15]=n=>t.default_sort=n),placeholder:"选择默认排序方式"},{default:o(()=>[e(x,{label:"最新上传",value:"latest"}),e(x,{label:"最多下载",value:"downloads"}),e(x,{label:"最多评论",value:"comments"}),e(x,{label:"评分最高",value:"rating"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})])])}}}),ye=W(ce,[["__scopeId","data-v-77707a49"]]);export{ye as default};
