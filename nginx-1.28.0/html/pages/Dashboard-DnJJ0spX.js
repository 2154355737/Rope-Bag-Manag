import{x as ls,r,j as Q,c as q,y as I,A as s,O as l,Q as e,I as i,u as n,al as x,M as f,D as L,P as J,a6 as cs,H as ds,L as rs,ax as us,z as D}from"../chunks/vue-vendor-BleHOoLr.js";import{u as U,b as H,l as z,k as Y,Q as C,j as B,R as _s,O as M,S as vs,T as G,H as ms}from"../chunks/element-plus-hGoKm610.js";import{f as fs,_ as hs}from"../assets/index-C28i2SJl.js";import{u as K}from"../chunks/users-D39iNwN1.js";import{a as N}from"../chunks/admin-BTTWAptb.js";import{l as W}from"../chunks/logs-C0nPxV-n.js";import"../chunks/utils-Dq7h7Pqt.js";const ps={class:"welcome-section"},gs={class:"welcome-content"},ys={class:"welcome-text"},ws={class:"welcome-title"},bs={class:"greeting"},ks={class:"username"},Ds={class:"welcome-stats"},zs={class:"stat-item"},Cs={class:"stat-item"},Ms={class:"stat-item"},Ss={class:"welcome-illustration"},As={class:"illustration-circle"},$s={class:"stats-grid"},Ts={class:"stat-card users"},Rs={class:"stat-header"},Is={class:"stat-icon"},xs={class:"stat-trend positive"},Ls={class:"stat-content"},Us={class:"stat-number"},Hs={class:"stat-description"},Bs={class:"stat-card packages"},Ns={class:"stat-header"},Ps={class:"stat-icon"},Os={class:"stat-trend positive"},Es={class:"stat-content"},Fs={class:"stat-number"},Vs={class:"stat-description"},js={class:"stat-card logs"},Qs={class:"stat-header"},qs={class:"stat-icon"},Js={class:"stat-trend neutral"},Ys={class:"stat-content"},Gs={class:"stat-number"},Ks={class:"stat-description"},Ws={class:"stat-card system"},Xs={class:"stat-header"},Zs={class:"stat-icon"},st={class:"stat-trend positive"},tt={class:"stat-content"},et={class:"stat-number"},at={class:"stat-description"},ot={class:"quick-actions"},it={class:"section-title"},nt={class:"actions-grid"},lt={class:"action-icon"},ct={class:"action-arrow"},dt={class:"action-icon"},rt={class:"action-arrow"},ut={class:"action-icon"},_t={class:"action-arrow"},vt={class:"action-icon"},mt={class:"action-arrow"},ft={class:"system-status"},ht={class:"section-title"},pt={class:"status-grid"},gt={class:"status-card"},yt={class:"status-header"},wt={class:"status-icon"},bt={class:"status-value"},kt={class:"status-progress"},Dt={class:"status-card"},zt={class:"status-header"},Ct={class:"status-icon"},Mt={class:"status-value"},St={class:"status-progress"},At={class:"status-card"},$t={class:"status-header"},Tt={class:"status-icon"},Rt={class:"status-value"},It={class:"status-indicator"},xt={class:"latency"},Lt={class:"status-card"},Ut={class:"status-header"},Ht={class:"status-icon"},Bt={class:"status-value"},Nt={class:"status-description"},Pt={class:"service-status"},Ot={class:"service-item"},Et={class:"service-item"},Ft={class:"recent-activities"},Vt={class:"section-title"},jt={class:"activities-list"},Qt={class:"activity-content"},qt={class:"activity-title"},Jt={class:"activity-time"},Yt=ls({__name:"Dashboard",setup(Gt){const X=us(),S=r(0),A=r(0),h=r(0),P=r(0),O=r(0),$=r(0),p=r("正常"),g=r(""),y=r(45),w=r(62),_=r("正常"),T=r("35ms"),E=r("系统稳定运行中"),F=r(!1),Z=r(0),ss=r(null),v=r({database:"正常",file_system:"正常",memory:"正常"}),V=r([]);function ts(a){let t="Document",o="system";switch(a.action_type){case"Login":case"Register":case"Logout":t="User",o="user";break;case"Upload":case"Download":t="Box",o="package";break;case"Comment":t="ChatDotRound",o="system";break;case"Admin":t="Setting",o="warning";break}return{id:a.id,type:o,icon:t,title:a.details||`${a.action_type} 操作`,time:es(a.created_at),status:"完成"}}function es(a){const t=new Date,o=new Date(a),c=t.getTime()-o.getTime(),u=Math.floor(c/(1e3*60)),d=Math.floor(c/(1e3*60*60)),m=Math.floor(c/(1e3*60*60*24));return u<60?`${u}分钟前`:d<24?`${d}小时前`:`${m}天前`}async function as(){try{try{const a=await N.healthCheck();if(a.code===0&&a.data){ss.value=a.data,v.value={database:a.data.services.database,file_system:a.data.services.file_system,memory:a.data.services.memory},p.value=a.data.status;const t=new Date(a.data.timestamp);t.setSeconds(t.getSeconds()-(a.data?.uptime??0));const c=Math.floor((new Date().getTime()-t.getTime())/1e3),u=Math.floor(c/(60*60*24)),d=Math.floor(c%(60*60*24)/(60*60)),m=Math.floor(c%(60*60)/60);g.value=`${u}天 ${d}小时 ${m}分钟`}}catch(a){console.warn("健康检查API未实现，使用默认数据",a);const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),1),c=Math.floor((t.getTime()-o.getTime())/1e3),u=Math.floor(c/(60*60*24)),d=Math.floor(c%(60*60*24)/(60*60)),m=Math.floor(c%(60*60)/60);g.value=`${u}天 ${d}小时 ${m}分钟`,E.value="系统运行中",p.value="Running",v.value={database:"正常",file_system:"正常",memory:"正常"},y.value=Math.floor(Math.random()*30)+40,w.value=Math.floor(Math.random()*30)+50}}catch(a){console.error("获取系统健康状态失败:",a),p.value="未知"}}async function os(){try{const a=await fs.getUserActions({page:1,page_size:5});a.code===0&&a.data&&a.data.actions&&(V.value=a.data.actions.map(ts))}catch(a){console.error("获取用户行为记录失败:",a)}}async function b(){try{F.value=!0;const a=await K.getUsers();if(a.code===0&&a.data){const c=a.data.list||[];S.value=c.length,P.value=c.filter(u=>u.role!=="admin").length}const t=await N.getStats();t.code===0&&t.data&&(A.value=t.data.total_packages||0,O.value=t.data.active_users||0,Z.value=t.data.total_comments||0,h.value=t.data.total_comments||0,$.value=t.data.new_packages_today||0);const o=await W.getLogs({page:1,pageSize:1});if(o.code===0&&o.data){h.value=o.data.total;const c=new Date;c.setHours(0,0,0,0);const u=await W.getLogs({page:1,pageSize:100});u.code===0&&u.data&&u.data.list&&($.value=u.data.list.filter(d=>new Date(d.timestamp)>=c).length)}await as(),await os()}catch(a){console.error("加载仪表盘数据失败:",a),ms.error("加载仪表盘数据失败")}finally{F.value=!1}}function R(){const a=Date.now();N.getStats().then(()=>{const t=Date.now()-a;T.value=`${t}ms`,t<100?_.value="正常":t<500?_.value="一般":_.value="延迟较高"}).catch(()=>{K.getUsers().then(()=>{const t=Date.now()-a;T.value=`${t}ms`,_.value="正常"}).catch(()=>{_.value="连接失败"})})}Q(()=>{b(),setInterval(()=>{b()},3e4),setInterval(()=>{R()},1e4),R()});const is=q(()=>{const a=new Date().getHours();return a<6?"夜深了":a<12?"早上好":a<18?"下午好":"晚上好"}),ns=q(()=>{const a=localStorage.getItem("userInfo");if(a)try{return JSON.parse(a).username||"管理员"}catch{return"管理员"}return"管理员"});function k(a){X.push(a)}function j(a){return a<50?"#67C23A":a<80?"#E6A23C":"#F56C6C"}return Q(()=>{b(),setInterval(()=>{},6e4),setInterval(()=>{R()},1e4),setInterval(()=>{b()},3e4)}),(a,t)=>{const o=x("el-icon"),c=x("el-progress"),u=x("el-tag");return D(),I(J,null,[s("div",ps,[s("div",gs,[s("div",ys,[s("h1",ws,[s("span",bs,l(is.value),1),s("span",ks,l(ns.value),1)]),t[4]||(t[4]=s("p",{class:"welcome-subtitle"},"欢迎使用绳包管理系统",-1)),s("div",Ds,[s("div",zs,[e(o,null,{default:i(()=>[e(n(U))]),_:1}),s("span",null,l(S.value)+" 个用户",1)]),s("div",Cs,[e(o,null,{default:i(()=>[e(n(H))]),_:1}),s("span",null,l(A.value)+" 个绳包",1)]),s("div",Ms,[e(o,null,{default:i(()=>[e(n(z))]),_:1}),s("span",null,l(h.value)+" 条日志",1)])])]),s("div",Ss,[s("div",As,[e(o,{size:48},{default:i(()=>[e(n(Y))]),_:1})])])])]),s("div",$s,[s("div",Ts,[s("div",Rs,[s("div",Is,[e(o,{size:24},{default:i(()=>[e(n(U))]),_:1})]),s("div",xs,[e(o,null,{default:i(()=>[e(n(C))]),_:1}),t[5]||(t[5]=s("span",null,"+12%",-1))])]),s("div",Ls,[s("div",Us,l(S.value),1),t[6]||(t[6]=s("div",{class:"stat-label"},"总用户数",-1)),s("div",Hs,"活跃用户 "+l(P.value)+" 人",1)])]),s("div",Bs,[s("div",Ns,[s("div",Ps,[e(o,{size:24},{default:i(()=>[e(n(H))]),_:1})]),s("div",Os,[e(o,null,{default:i(()=>[e(n(C))]),_:1}),t[7]||(t[7]=s("span",null,"+8%",-1))])]),s("div",Es,[s("div",Fs,l(A.value),1),t[8]||(t[8]=s("div",{class:"stat-label"},"绳包总数",-1)),s("div",Vs,"可用绳包 "+l(O.value)+" 个",1)])]),s("div",js,[s("div",Qs,[s("div",qs,[e(o,{size:24},{default:i(()=>[e(n(z))]),_:1})]),s("div",Js,[e(o,null,{default:i(()=>[e(n(C))]),_:1}),t[9]||(t[9]=s("span",null,"+5%",-1))])]),s("div",Ys,[s("div",Gs,l(h.value),1),t[10]||(t[10]=s("div",{class:"stat-label"},"系统日志",-1)),s("div",Ks,"今日新增 "+l($.value)+" 条",1)])]),s("div",Ws,[s("div",Xs,[s("div",Zs,[e(o,{size:24},{default:i(()=>[e(n(B))]),_:1})]),s("div",st,[e(o,null,{default:i(()=>[e(n(C))]),_:1}),t[11]||(t[11]=s("span",null,"正常",-1))])]),s("div",tt,[s("div",et,l(p.value),1),t[12]||(t[12]=s("div",{class:"stat-label"},"系统状态",-1)),s("div",at,"运行时间 "+l(g.value),1)])])]),s("div",ot,[s("h2",it,[e(o,null,{default:i(()=>[e(n(_s))]),_:1}),t[13]||(t[13]=f(" 快速操作 "))]),s("div",nt,[s("div",{class:"action-card",onClick:t[0]||(t[0]=d=>k("/users"))},[s("div",lt,[e(o,{size:32},{default:i(()=>[e(n(U))]),_:1})]),t[14]||(t[14]=s("div",{class:"action-content"},[s("h3",{class:"action-title"},"用户管理"),s("p",{class:"action-desc"},"管理系统用户和权限")],-1)),s("div",ct,[e(o,null,{default:i(()=>[e(n(M))]),_:1})])]),s("div",{class:"action-card",onClick:t[1]||(t[1]=d=>k("/packages"))},[s("div",dt,[e(o,{size:32},{default:i(()=>[e(n(H))]),_:1})]),t[15]||(t[15]=s("div",{class:"action-content"},[s("h3",{class:"action-title"},"资源管理"),s("p",{class:"action-desc"},"管理绳包资源和社区内容")],-1)),s("div",rt,[e(o,null,{default:i(()=>[e(n(M))]),_:1})])]),s("div",{class:"action-card",onClick:t[2]||(t[2]=d=>k("/logs"))},[s("div",ut,[e(o,{size:32},{default:i(()=>[e(n(z))]),_:1})]),t[16]||(t[16]=s("div",{class:"action-content"},[s("h3",{class:"action-title"},"日志查看"),s("p",{class:"action-desc"},"查看系统运行日志")],-1)),s("div",_t,[e(o,null,{default:i(()=>[e(n(M))]),_:1})])]),s("div",{class:"action-card",onClick:t[3]||(t[3]=d=>k("/stats"))},[s("div",vt,[e(o,{size:32},{default:i(()=>[e(n(Y))]),_:1})]),t[17]||(t[17]=s("div",{class:"action-content"},[s("h3",{class:"action-title"},"统计信息"),s("p",{class:"action-desc"},"查看系统统计数据")],-1)),s("div",mt,[e(o,null,{default:i(()=>[e(n(M))]),_:1})])])])]),s("div",ft,[s("h2",ht,[e(o,null,{default:i(()=>[e(n(B))]),_:1}),t[18]||(t[18]=f(" 系统状态 "))]),s("div",pt,[s("div",gt,[s("div",yt,[s("div",wt,[e(o,{size:20},{default:i(()=>[e(n(B))]),_:1})]),t[19]||(t[19]=s("div",{class:"status-label"},"CPU使用率",-1))]),s("div",bt,l(y.value)+"%",1),s("div",kt,[e(c,{percentage:y.value,color:j(y.value)},null,8,["percentage","color"])])]),s("div",Dt,[s("div",zt,[s("div",Ct,[e(o,{size:20},{default:i(()=>[e(n(z))]),_:1})]),t[20]||(t[20]=s("div",{class:"status-label"},"内存使用率",-1))]),s("div",Mt,l(w.value)+"%",1),s("div",St,[e(c,{percentage:w.value,color:j(w.value)},null,8,["percentage","color"])])]),s("div",At,[s("div",$t,[s("div",Tt,[e(o,{size:20},{default:i(()=>[e(n(vs))]),_:1})]),t[21]||(t[21]=s("div",{class:"status-label"},"网络状态",-1))]),s("div",Rt,l(_.value),1),s("div",It,[s("div",{class:L(["indicator-dot",_.value==="正常"?"online":"offline"])},null,2),s("span",xt,"延迟: "+l(T.value),1)])]),s("div",Lt,[s("div",Ut,[s("div",Ht,[e(o,{size:20},{default:i(()=>[e(n(G))]),_:1})]),t[22]||(t[22]=s("div",{class:"status-label"},"运行时间",-1))]),s("div",Bt,l(g.value),1),s("div",Nt,l(E.value),1),s("div",Pt,[s("div",Ot,[t[23]||(t[23]=s("span",{class:"service-name"},"数据库:",-1)),e(u,{size:"small",type:v.value.database==="正常"?"success":"danger"},{default:i(()=>[f(l(v.value.database),1)]),_:1},8,["type"])]),s("div",Et,[t[24]||(t[24]=s("span",{class:"service-name"},"文件系统:",-1)),e(u,{size:"small",type:v.value.file_system==="正常"?"success":"danger"},{default:i(()=>[f(l(v.value.file_system),1)]),_:1},8,["type"])])])])])]),s("div",Ft,[s("h2",Vt,[e(o,null,{default:i(()=>[e(n(G))]),_:1}),t[25]||(t[25]=f(" 最近活动 "))]),s("div",jt,[(D(!0),I(J,null,cs(V.value,d=>(D(),I("div",{key:d.id,class:"activity-item"},[s("div",{class:L(["activity-icon",d.type])},[e(o,{size:16},{default:i(()=>[(D(),ds(rs(d.icon)))]),_:2},1024)],2),s("div",Qt,[s("div",qt,l(d.title),1),s("div",Jt,l(d.time),1)]),s("div",{class:L(["activity-status",d.status])},l(d.status),3)]))),128))])])],64)}}}),ae=hs(Yt,[["__scopeId","data-v-72847733"]]);export{ae as default};
