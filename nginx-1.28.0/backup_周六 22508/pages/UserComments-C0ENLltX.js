import{x as W,r as g,X as F,c as Z,j as ee,y as c,A as o,Q as t,I as s,M as i,O as v,al as r,u as y,a4 as te,J as ae,ar as le,K as V,P as se,a6 as oe,D as ne,H as re,z as u}from"../chunks/vue-vendor-BleHOoLr.js";import{Q as T,U as ie,l as de,v as ue,ai as ce,G as p,E as me}from"../chunks/element-plus-BqgU8HW0.js";import{c as M}from"../chunks/comments-CosgVoYG.js";import{g as _e,_ as pe}from"../assets/index-BZGS9eVU.js";import"../chunks/utils-Dq7h7Pqt.js";const fe={class:"user-comments-page"},ge={class:"page-header"},ve={class:"header-content"},ye={class:"header-stats"},he={key:0,class:"empty-state"},Ce={key:1,class:"comments-list"},ke={class:"comment-header"},we={class:"comment-info"},ze={class:"comment-time"},xe={key:0,class:"comment-resource"},De={class:"comment-actions"},Ve={class:"comment-content"},be={class:"content-text"},Se={class:"comment-stats"},Ue={class:"stat-item"},Ee={key:0,class:"stat-item"},Ye={key:2,class:"pagination-wrapper"},Fe={class:"dialog-footer"},Me=W({__name:"UserComments",setup($e){const b=g(null),w=g(!1),S=g(!1),h=g(!1),$=_e(),z=g([]),U=g(null),E=g(null),f=F({page:1,pageSize:10}),n=F({status:"",resource_name:"",start_date:"",end_date:""}),C=F({content:""}),L={content:[{required:!0,message:"请输入评论内容",trigger:"blur"},{min:5,max:500,message:"评论内容长度在 5 到 500 个字符之间",trigger:"blur"}]},Y=Z(()=>z.value.length),m=async()=>{if($?.id){w.value=!0;try{const l={page:f.page,size:f.pageSize,...n};Object.keys(l).forEach(d=>{(l[d]===""||l[d]===null)&&delete l[d]});const e=await M.getUserComments($.id,l);e.code===0?z.value=e.data?.list||[]:p.error(e.message||"加载评论失败")}catch(l){console.error("加载评论列表失败:",l),p.error("加载评论列表失败")}finally{w.value=!1}}},R=l=>{l&&l.length===2?(n.start_date=l[0],n.end_date=l[1]):(n.start_date="",n.end_date="")},I=()=>{n.status="",n.resource_name="",n.start_date="",n.end_date="",E.value=null,f.page=1,m()},j=l=>{U.value=l,C.content=l.content,h.value=!0},H=async()=>{if(!(!b.value||!U.value))try{await b.value.validate(),S.value=!0;const l=await M.updateComment(U.value.id,{content:C.content});l.code===0?(p.success("评论更新成功"),h.value=!1,m()):p.error(l.message||"更新失败")}catch(l){console.error("更新评论失败:",l),p.error("更新失败")}finally{S.value=!1}},K=async l=>{try{await me.confirm("确定要删除这条评论吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await M.deleteComment(l.id);e.code===0?(p.success("删除成功"),m()):p.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除评论失败:",e),p.error("删除失败"))}},O=l=>{const e=new Date(l),d=new Date;return d.getTime()-e.getTime()<864e5&&e.getDate()===d.getDate()?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e.getFullYear()===d.getFullYear()?e.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})};return ee(()=>{m()}),(l,e)=>{const d=r("el-tag"),x=r("el-option"),P=r("el-select"),k=r("el-form-item"),B=r("el-input"),Q=r("el-date-picker"),_=r("el-button"),N=r("el-card"),q=r("el-empty"),D=r("el-icon"),G=r("el-pagination"),J=r("el-dialog"),X=le("loading");return u(),c("div",fe,[o("div",ge,[o("div",ve,[e[9]||(e[9]=o("h2",null,"我的评论",-1)),o("div",ye,[t(d,{type:"success",size:"large"},{default:s(()=>[i("共 "+v(Y.value)+" 条评论",1)]),_:1})])])]),t(N,{shadow:"hover",class:"filter-card"},{default:s(()=>[t(y(T),{model:n,inline:!0,class:"search-form"},{default:s(()=>[t(k,{label:"状态筛选:"},{default:s(()=>[t(P,{modelValue:n.status,"onUpdate:modelValue":e[0]||(e[0]=a=>n.status=a),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:s(()=>[t(x,{label:"全部",value:""}),t(x,{label:"正常",value:"Active"}),t(x,{label:"已隐藏",value:"Hidden"})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"资源筛选:"},{default:s(()=>[t(B,{modelValue:n.resource_name,"onUpdate:modelValue":e[1]||(e[1]=a=>n.resource_name=a),placeholder:"输入资源名称",clearable:"",style:{width:"200px"},onKeyup:te(m,["enter"])},null,8,["modelValue"])]),_:1}),t(k,{label:"时间范围:"},{default:s(()=>[t(Q,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:R},null,8,["modelValue"])]),_:1}),t(k,null,{default:s(()=>[t(_,{type:"primary",icon:"Search",onClick:m},{default:s(()=>e[10]||(e[10]=[i("搜索")])),_:1,__:[10]}),t(_,{icon:"Refresh",onClick:I},{default:s(()=>e[11]||(e[11]=[i("重置")])),_:1,__:[11]})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{shadow:"hover",class:"comments-card"},{default:s(()=>[ae((u(),c("div",null,[z.value.length===0&&!w.value?(u(),c("div",he,[t(q,{description:"还没有发表任何评论"},{default:s(()=>[t(_,{type:"primary",onClick:e[3]||(e[3]=a=>l.$router.push("/home"))},{default:s(()=>e[12]||(e[12]=[i(" 去浏览资源 ")])),_:1,__:[12]})]),_:1})])):(u(),c("div",Ce,[(u(!0),c(se,null,oe(z.value,a=>(u(),c("div",{key:a.id,class:ne(["comment-item",{"hidden-comment":a.status==="Hidden"}])},[o("div",ke,[o("div",we,[t(d,{type:a.status==="Active"?"success":"warning",size:"small"},{default:s(()=>[i(v(a.status==="Active"?"正常":"已隐藏"),1)]),_:2},1032,["type"]),o("span",ze,[t(D,null,{default:s(()=>[t(y(ie))]),_:1}),i(" "+v(O(a.created_at)),1)]),a.target_title?(u(),c("span",xe,[t(D,null,{default:s(()=>[t(y(de))]),_:1}),e[13]||(e[13]=o("span",{class:"resource-label"},"所属资源：",-1)),t(_,{type:"text",size:"small",onClick:A=>l.$router.push(`/resource/${a.target_id}`),class:"resource-link"},{default:s(()=>[i(v(a.target_title),1)]),_:2},1032,["onClick"])])):V("",!0)]),o("div",De,[a.status==="Active"?(u(),re(_,{key:0,type:"text",size:"small",icon:"Edit",onClick:A=>j(a)},{default:s(()=>e[14]||(e[14]=[i(" 编辑 ")])),_:2,__:[14]},1032,["onClick"])):V("",!0),t(_,{type:"text",size:"small",icon:"Delete",onClick:A=>K(a),class:"delete-btn"},{default:s(()=>e[15]||(e[15]=[i(" 删除 ")])),_:2,__:[15]},1032,["onClick"])])]),o("div",Ve,[o("div",be,v(a.content),1)]),o("div",Se,[o("div",Ue,[t(D,null,{default:s(()=>[t(y(ue))]),_:1}),o("span",null,v(a.likes||0)+" 赞",1)]),a.dislikes?(u(),c("div",Ee,[t(D,null,{default:s(()=>[t(y(ce))]),_:1}),o("span",null,v(a.dislikes||0)+" 踩",1)])):V("",!0)])],2))),128))])),Y.value>0?(u(),c("div",Ye,[t(G,{"current-page":f.page,"onUpdate:currentPage":e[4]||(e[4]=a=>f.page=a),"page-size":f.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>f.pageSize=a),"page-sizes":[10,20,50],total:Y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m,onCurrentChange:m},null,8,["current-page","page-size","total"])])):V("",!0)])),[[X,w.value]])]),_:1}),t(J,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),title:"编辑评论",width:"600px","close-on-click-modal":!1},{footer:s(()=>[o("div",Fe,[t(_,{onClick:e[7]||(e[7]=a=>h.value=!1)},{default:s(()=>e[16]||(e[16]=[i("取消")])),_:1,__:[16]}),t(_,{type:"primary",onClick:H,loading:S.value},{default:s(()=>e[17]||(e[17]=[i(" 保存修改 ")])),_:1,__:[17]},8,["loading"])])]),default:s(()=>[t(y(T),{model:C,rules:L,ref_key:"editFormRef",ref:b,"label-width":"80px"},{default:s(()=>[t(k,{label:"评论内容",prop:"content"},{default:s(()=>[t(B,{modelValue:C.content,"onUpdate:modelValue":e[6]||(e[6]=a=>C.content=a),type:"textarea",rows:6,placeholder:"请输入评论内容","show-word-limit":"",maxlength:"500"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Re=pe(Me,[["__scopeId","data-v-06469140"]]);export{Re as default};
