import{x as pe,r as u,X as _e,c as me,j as ve,y as d,A as s,J as fe,K as g,Q as l,H as p,I as o,M as c,u as k,al as i,a4 as ge,P as w,a6 as x,O as _,ar as ye,ax as he,z as n}from"../chunks/vue-vendor-BleHOoLr.js";import{M as be,q as Ve,N as Ce,i as ke,v as we,G as S,E as xe}from"../chunks/element-plus-BqgU8HW0.js";import{_ as Pe}from"../assets/index-C1pGffEW.js";import{c as ze}from"../chunks/categories-aIRLoEza.js";import{g as De,c as Te}from"../chunks/posts-DaDdFN3I.js";import{g as Ue,a as Se}from"../chunks/tags-CJkNv3PN.js";import{u as Be}from"../chunks/auth-DzV_mgVk.js";import{f as Me}from"../chunks/format-B9owEeWI.js";import"../chunks/utils-Dq7h7Pqt.js";const Ae={class:"posts-container"},Fe={class:"page-header"},Ee={class:"header-actions"},Ne={class:"filter-section"},$e={class:"filter-row"},Ie={class:"search-box"},Re={class:"filter-actions"},Ye={key:0,class:"popular-tags"},qe={class:"posts-list"},He={key:0,class:"empty-state"},Ke={key:1,class:"posts-grid"},Le=["onClick"],je={class:"post-header"},Qe={class:"post-meta"},Ge={class:"author"},Je={class:"time"},Oe={class:"post-status"},Xe={class:"post-content"},We={class:"post-title"},Ze={class:"post-excerpt"},et={class:"post-footer"},tt={class:"post-stats"},at={class:"stat-item"},lt={class:"stat-item"},ot={class:"stat-item"},st={key:0,class:"pagination-wrapper"},nt={class:"dialog-footer"},rt=pe({__name:"Posts",setup(ut){const K=a=>Me(a,"YYYY-MM-DD HH:mm"),L=he(),j=Be(),P=u(!1),B=u(!1),M=u([]),A=u([]),F=u([]),Y=u([]),E=u(0),m=u(1),z=u(10),D=u(""),N=u(),$=u(),v=u(!1),y=u(),r=_e({title:"",content:"",category_id:void 0,tags:[],status:"Draft"}),Q={title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:1,max:200,message:"标题长度在 1 到 200 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{min:10,message:"内容至少 10 个字符",trigger:"blur"}]},G=me(()=>j.isLoggedIn),h=async()=>{P.value=!0;try{const a={page:m.value,page_size:z.value,search:D.value||void 0,category_id:N.value,status:$.value},t=await De(a);t.code===0&&t.data&&(M.value=t.data.list,E.value=t.data.total)}catch(a){console.error("加载帖子失败:",a),S.error("加载帖子失败")}finally{P.value=!1}},J=async()=>{try{const a=await ze.getCategories();a.code===0&&a.data&&(A.value=a.data?.list||a.data||[])}catch(a){console.error("加载分类失败:",a)}},O=async()=>{try{const a=await Ue();a.code===0&&a.data&&(F.value=a.data)}catch(a){console.error("加载热门标签失败:",a)}},X=async()=>{try{const a=await Se();a.code===0&&a.data&&(Y.value=a.data)}catch(a){console.error("加载所有标签失败:",a)}},b=()=>{m.value=1,h()},W=a=>{z.value=a,m.value=1,h()},Z=a=>{m.value=a,h()},ee=a=>{D.value=a,b()},te=a=>{L.push(`/posts/${a}`)},ae=a=>a.length>100?a.substring(0,100)+"...":a,le=async()=>{if(y.value)try{await y.value.validate(),B.value=!0;const a=await Te(r);a.code===0?(S.success("帖子发布成功"),v.value=!1,q(),h()):S.error(a.msg||"发布失败")}catch(a){console.error("发布帖子失败:",a),S.error("发布帖子失败")}finally{B.value=!1}},oe=()=>{xe.confirm("确定要取消发布吗？未保存的内容将丢失。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v.value=!1,q()})},q=()=>{r.title="",r.content="",r.category_id=void 0,r.tags=[],r.status="Draft",y.value&&y.value.resetFields()};return ve(()=>{h(),J(),O(),X()}),(a,t)=>{const V=i("el-icon"),I=i("el-button"),R=i("el-input"),f=i("el-option"),T=i("el-select"),U=i("el-tag"),se=i("el-empty"),ne=i("el-pagination"),C=i("el-form-item"),H=i("el-radio"),re=i("el-radio-group"),ue=i("el-form"),ie=i("el-dialog"),de=ye("loading");return n(),d("div",Ae,[s("div",Fe,[t[14]||(t[14]=s("div",{class:"header-content"},[s("h1",{class:"page-title"},"社区帖子"),s("p",{class:"page-description"},"分享你的想法，与社区成员交流")],-1)),s("div",Ee,[G.value?(n(),p(I,{key:0,type:"primary",onClick:t[0]||(t[0]=e=>v.value=!0)},{default:o(()=>[l(V,null,{default:o(()=>[l(k(be))]),_:1}),t[13]||(t[13]=c(" 发布帖子 "))]),_:1,__:[13]})):g("",!0)])]),s("div",Ne,[s("div",$e,[s("div",Ie,[l(R,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=e=>D.value=e),placeholder:"搜索帖子...",clearable:"",onKeyup:ge(b,["enter"]),onClear:b},{prefix:o(()=>[l(V,null,{default:o(()=>[l(k(Ve))]),_:1})]),_:1},8,["modelValue"])]),s("div",Re,[l(T,{modelValue:N.value,"onUpdate:modelValue":t[2]||(t[2]=e=>N.value=e),placeholder:"选择分类",clearable:"",onChange:b},{default:o(()=>[(n(!0),d(w,null,x(A.value,e=>(n(),p(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(T,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=e=>$.value=e),placeholder:"状态",clearable:"",onChange:b},{default:o(()=>[l(f,{label:"已发布",value:"Published"}),l(f,{label:"草稿",value:"Draft"}),l(f,{label:"已归档",value:"Archived"})]),_:1},8,["modelValue"])])]),F.value.length>0?(n(),d("div",Ye,[t[15]||(t[15]=s("span",{class:"tags-label"},"热门标签：",-1)),(n(!0),d(w,null,x(F.value,e=>(n(),p(U,{key:e.id,color:e.color,class:"tag-item",onClick:ce=>ee(e.name)},{default:o(()=>[c(_(e.name),1)]),_:2},1032,["color","onClick"]))),128))])):g("",!0)]),fe((n(),d("div",qe,[M.value.length===0&&!P.value?(n(),d("div",He,[l(se,{description:"暂无帖子"})])):(n(),d("div",Ke,[(n(!0),d(w,null,x(M.value,e=>(n(),d("div",{key:e.id,class:"post-card",onClick:ce=>te(e.id)},[s("div",je,[s("div",Qe,[s("span",Ge,_(e.author_name),1),s("span",Je,_(K(e.created_at)),1)]),s("div",Oe,[e.is_pinned?(n(),p(U,{key:0,type:"warning",size:"small"},{default:o(()=>t[16]||(t[16]=[c("置顶")])),_:1,__:[16]})):g("",!0),e.is_featured?(n(),p(U,{key:1,type:"success",size:"small"},{default:o(()=>t[17]||(t[17]=[c("精选")])),_:1,__:[17]})):g("",!0),e.status==="Draft"?(n(),p(U,{key:2,type:"info",size:"small"},{default:o(()=>t[18]||(t[18]=[c("草稿")])),_:1,__:[18]})):g("",!0)])]),s("div",Xe,[s("h3",We,_(e.title),1),s("p",Ze,_(ae(e.content)),1)]),s("div",et,[s("div",tt,[s("span",at,[l(V,null,{default:o(()=>[l(k(Ce))]),_:1}),c(" "+_(e.view_count),1)]),s("span",lt,[l(V,null,{default:o(()=>[l(k(ke))]),_:1}),c(" "+_(e.comment_count),1)]),s("span",ot,[l(V,null,{default:o(()=>[l(k(we))]),_:1}),c(" "+_(e.like_count),1)])])])],8,Le))),128))]))])),[[de,P.value]]),E.value>0?(n(),d("div",st,[l(ne,{"current-page":m.value,"onUpdate:currentPage":t[4]||(t[4]=e=>m.value=e),"page-size":z.value,"onUpdate:pageSize":t[5]||(t[5]=e=>z.value=e),"page-sizes":[10,20,50],total:E.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:Z},null,8,["current-page","page-size","total"])])):g("",!0),l(ie,{modelValue:v.value,"onUpdate:modelValue":t[12]||(t[12]=e=>v.value=e),title:"发布新帖子",width:"60%","before-close":oe},{footer:o(()=>[s("span",nt,[l(I,{onClick:t[11]||(t[11]=e=>v.value=!1)},{default:o(()=>t[21]||(t[21]=[c("取消")])),_:1,__:[21]}),l(I,{type:"primary",onClick:le,loading:B.value},{default:o(()=>t[22]||(t[22]=[c(" 发布 ")])),_:1,__:[22]},8,["loading"])])]),default:o(()=>[l(ue,{ref_key:"createFormRef",ref:y,model:r,rules:Q,"label-width":"80px"},{default:o(()=>[l(C,{label:"标题",prop:"title"},{default:o(()=>[l(R,{modelValue:r.title,"onUpdate:modelValue":t[6]||(t[6]=e=>r.title=e),placeholder:"请输入帖子标题"},null,8,["modelValue"])]),_:1}),l(C,{label:"分类",prop:"category_id"},{default:o(()=>[l(T,{modelValue:r.category_id,"onUpdate:modelValue":t[7]||(t[7]=e=>r.category_id=e),placeholder:"选择分类",clearable:""},{default:o(()=>[(n(!0),d(w,null,x(A.value,e=>(n(),p(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(C,{label:"标签"},{default:o(()=>[l(T,{modelValue:r.tags,"onUpdate:modelValue":t[8]||(t[8]=e=>r.tags=e),multiple:"",filterable:"","allow-create":"",placeholder:"选择或创建标签"},{default:o(()=>[(n(!0),d(w,null,x(Y.value,e=>(n(),p(f,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(C,{label:"内容",prop:"content"},{default:o(()=>[l(R,{modelValue:r.content,"onUpdate:modelValue":t[9]||(t[9]=e=>r.content=e),type:"textarea",rows:8,placeholder:"请输入帖子内容"},null,8,["modelValue"])]),_:1}),l(C,{label:"状态"},{default:o(()=>[l(re,{modelValue:r.status,"onUpdate:modelValue":t[10]||(t[10]=e=>r.status=e)},{default:o(()=>[l(H,{value:"Draft"},{default:o(()=>t[19]||(t[19]=[c("草稿")])),_:1,__:[19]}),l(H,{value:"Published"},{default:o(()=>t[20]||(t[20]=[c("发布")])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),yt=Pe(rt,[["__scopeId","data-v-507fda9a"]]);export{yt as default};
