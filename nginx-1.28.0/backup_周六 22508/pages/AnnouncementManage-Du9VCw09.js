import{e as ke,M as Ae,l as xe,c as Q,V as ze,C as De,q as Ue,_ as Ye,K as G,N as Me,Y as Se,G as i,E as $}from"../chunks/element-plus-BqgU8HW0.js";import{a as $e,u as J,c as Ee,d as He,b as X,e as Ie}from"../chunks/announcements-CdsuAn1X.js";import{x as Te,r as m,X as Le,c as E,j as qe,y as N,A as a,K as Z,Q as t,I as s,u as f,al as p,M as r,O as d,J as Be,ar as Ne,H as Pe,z as H}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as je}from"../assets/index-BYq8Q9FJ.js";import"../chunks/utils-Dq7h7Pqt.js";const Oe={class:"admin-page announcement-manage"},Re={class:"page-header"},We={class:"header-content"},Fe={class:"header-left"},Ke={class:"header-icon"},Qe={class:"header-actions"},Ge={class:"stats-section"},Je={class:"stats-grid"},Xe={class:"stat-card"},Ze={class:"stat-icon"},et={class:"stat-content"},tt={class:"stat-number"},lt={class:"stat-card"},at={class:"stat-icon"},nt={class:"stat-content"},st={class:"stat-number"},ot={class:"stat-card"},it={class:"stat-icon"},dt={class:"stat-content"},ut={class:"stat-number"},rt={class:"stat-card"},ct={class:"stat-icon"},mt={class:"stat-content"},pt={class:"stat-number"},_t={class:"search-section"},ft={class:"search-left"},vt={class:"search-right"},gt={class:"table-section"},bt={class:"announcement-title"},yt={class:"title-text"},ht={class:"announcement-content"},Vt={class:"content-text"},wt={class:"pagination-section"},Ct={key:0,class:"batch-actions"},kt={class:"selected-count"},At={key:0,class:"announcement-detail"},xt={class:"detail-item"},zt={class:"detail-item"},Dt={class:"detail-item"},Ut={class:"content-box"},Yt={class:"detail-item"},Mt={class:"detail-item"},St={class:"detail-item"},$t={class:"detail-item"},Et={class:"detail-item"},Ht=Te({__name:"AnnouncementManage",setup(It){const I=m(!1),T=m(!1),h=m([]),c=m([]),k=m(1),z=m(20),ee=m(0),V=m(!1),D=m(!1),_=m(null),w=m(!1),L=m(),u=Le({id:null,title:"",content:"",type_:"Info",priority:5,enabled:!0,start_time:"",end_time:""}),te={title:[{required:!0,message:"请输入公告标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],type_:[{required:!0,message:"请选择公告类型",trigger:"change"}],priority:[{required:!0,message:"请设置优先级",trigger:"blur"}],start_time:[{required:!0,message:"请选择开始时间",trigger:"change"}]},U=m(""),Y=m(""),M=m(""),le=E(()=>h.value.filter(l=>l.enabled).length),ae=E(()=>h.value.filter(l=>l.priority===1).length),ne=E(()=>h.value.filter(l=>l.end_time).length),P=E(()=>{let l=h.value;if(U.value){const e=U.value.toLowerCase();l=l.filter(o=>o.title.toLowerCase().includes(e)||o.content.toLowerCase().includes(e))}return Y.value&&(l=l.filter(e=>e.type_===Y.value)),M.value==="enabled"?l=l.filter(e=>e.enabled):M.value==="disabled"&&(l=l.filter(e=>!e.enabled)),l});async function C(){I.value=!0;try{const l={page:k.value,size:z.value},e=await $e(l);e&&e.code===0&&(h.value=e.data.list||[],ee.value=e.data.total||0)}catch(l){console.error("加载公告失败:",l),i.error("加载公告失败")}finally{I.value=!1}}function se(){w.value=!1,ge(),V.value=!0}function oe(l){w.value=!0,Object.assign(u,l),V.value=!0}function ie(l){_.value=l,D.value=!0}async function de(){if(L.value)try{await L.value.validate(),T.value=!0;const l={...u},e=w.value?l.id!==null?await J(l.id,l):void 0:await Ee(l);e&&e.code===0?(i.success(w.value?"公告更新成功":"公告发布成功"),V.value=!1,C()):i.error(e?.message||"操作失败")}catch(l){console.error("保存公告失败:",l),i.error("保存失败")}finally{T.value=!1}}async function ue(l){try{await $.confirm("确定要删除这条公告吗？","确认删除"),(await He(l.id)).code===0&&(i.success("公告已删除"),C())}catch(e){e!=="cancel"&&i.error("删除失败")}}async function re(l){l.statusLoading=!0;try{(await J(l.id,{enabled:l.enabled})).code===0?i.success(l.enabled?"公告已启用":"公告已禁用"):(l.enabled=!l.enabled,i.error("状态更新失败"))}catch{l.enabled=!l.enabled,i.error("状态更新失败")}finally{l.statusLoading=!1}}async function ce(){if(c.value.length===0){i.warning("请选择要启用的公告");return}try{await $.confirm(`确定要启用选中的 ${c.value.length} 条公告吗？`,"确认操作");const l=c.value.map(o=>o.id),e=await X(l,!0);e.code===0?(i.success("批量启用成功"),C()):i.error(e?.message||"操作失败")}catch(l){l!=="cancel"&&i.error("操作失败")}}async function me(){if(c.value.length===0){i.warning("请选择要禁用的公告");return}try{await $.confirm(`确定要禁用选中的 ${c.value.length} 条公告吗？`,"确认操作");const l=c.value.map(o=>o.id),e=await X(l,!1);e.code===0?(i.success("批量禁用成功"),C()):i.error(e?.message||"操作失败")}catch(l){l!=="cancel"&&i.error("操作失败")}}async function pe(){if(c.value.length===0){i.warning("请选择要删除的公告");return}try{await $.confirm(`确定要删除选中的 ${c.value.length} 条公告吗？`,"确认删除");const l=c.value.map(o=>o.id),e=await Ie(l);e.code===0?(i.success("批量删除成功"),C()):i.error(e?.message||"删除失败")}catch(l){l!=="cancel"&&i.error("删除失败")}}function _e(l){c.value=l}function fe(l){z.value=l,k.value=1}function ve(l){k.value=l}function ge(){Object.assign(u,{id:null,title:"",content:"",type_:"Info",priority:5,enabled:!0,start_time:"",end_time:""})}function j(l){return{Info:"info",Warning:"warning",Error:"danger",Success:"success"}[l]||"info"}function O(l){return{Info:"信息",Warning:"警告",Error:"错误",Success:"成功"}[l]||l}function R(l){return l>=8?"danger":l>=6?"warning":l>=4?"primary":"info"}function be(l,e){return l?l.length>e?l.substring(0,e)+"...":l:""}function S(l){return l?new Date(l).toLocaleString():"-"}return qe(()=>{C()}),(l,e)=>{const o=p("el-icon"),g=p("el-button"),q=p("el-input"),v=p("el-option"),B=p("el-select"),b=p("el-table-column"),A=p("el-tag"),W=p("el-switch"),ye=p("el-table"),he=p("el-pagination"),y=p("el-form-item"),Ve=p("el-input-number"),F=p("el-date-picker"),we=p("el-form"),K=p("el-dialog"),Ce=Ne("loading");return H(),N("div",Oe,[a("div",Re,[a("div",We,[a("div",Fe,[a("div",Ke,[t(o,{size:32},{default:s(()=>[t(f(ke))]),_:1})]),e[16]||(e[16]=a("div",{class:"header-info"},[a("h1",{class:"page-title"},"公告管理"),a("p",{class:"page-subtitle"},"管理系统公告，包括发布、编辑、删除和状态管理")],-1))]),a("div",Qe,[t(g,{type:"primary",onClick:se},{default:s(()=>[t(o,null,{default:s(()=>[t(f(Ae))]),_:1}),e[17]||(e[17]=r(" 发布公告 "))]),_:1,__:[17]})])])]),a("div",Ge,[a("div",Je,[a("div",Xe,[a("div",Ze,[t(o,{size:24},{default:s(()=>[t(f(xe))]),_:1})]),a("div",et,[a("div",tt,d(h.value.length),1),e[18]||(e[18]=a("div",{class:"stat-label"},"总公告数",-1))])]),a("div",lt,[a("div",at,[t(o,{size:24},{default:s(()=>[t(f(Q))]),_:1})]),a("div",nt,[a("div",st,d(le.value),1),e[19]||(e[19]=a("div",{class:"stat-label"},"已启用",-1))])]),a("div",ot,[a("div",it,[t(o,{size:24},{default:s(()=>[t(f(ze))]),_:1})]),a("div",dt,[a("div",ut,d(ae.value),1),e[20]||(e[20]=a("div",{class:"stat-label"},"紧急公告",-1))])]),a("div",rt,[a("div",ct,[t(o,{size:24},{default:s(()=>[t(f(De))]),_:1})]),a("div",mt,[a("div",pt,d(ne.value),1),e[21]||(e[21]=a("div",{class:"stat-label"},"定时公告",-1))])])])]),a("div",_t,[a("div",ft,[t(q,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=n=>U.value=n),placeholder:"搜索公告...",clearable:"",style:{width:"250px"}},{prefix:s(()=>[t(o,null,{default:s(()=>[t(f(Ue))]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=n=>Y.value=n),placeholder:"选择类型",clearable:"",style:{width:"150px"}},{default:s(()=>[t(v,{label:"全部",value:""}),t(v,{label:"系统公告",value:"System"}),t(v,{label:"活动公告",value:"Event"}),t(v,{label:"维护公告",value:"Maintenance"}),t(v,{label:"更新公告",value:"Update"})]),_:1},8,["modelValue"]),t(B,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=n=>M.value=n),placeholder:"状态筛选",clearable:"",style:{width:"150px"}},{default:s(()=>[t(v,{label:"全部",value:""}),t(v,{label:"已启用",value:"enabled"}),t(v,{label:"已禁用",value:"disabled"})]),_:1},8,["modelValue"])]),a("div",vt,[t(g,{type:"success",onClick:ce,disabled:!c.value.length},{default:s(()=>[t(o,null,{default:s(()=>[t(f(Q))]),_:1}),e[22]||(e[22]=r(" 批量启用 "))]),_:1,__:[22]},8,["disabled"]),t(g,{type:"warning",onClick:me,disabled:!c.value.length},{default:s(()=>[t(o,null,{default:s(()=>[t(f(Ye))]),_:1}),e[23]||(e[23]=r(" 批量禁用 "))]),_:1,__:[23]},8,["disabled"]),t(g,{type:"danger",onClick:pe,disabled:!c.value.length},{default:s(()=>[t(o,null,{default:s(()=>[t(f(G))]),_:1}),e[24]||(e[24]=r(" 批量删除 "))]),_:1,__:[24]},8,["disabled"])])]),a("div",gt,[Be((H(),Pe(ye,{data:P.value,style:{width:"100%"},"header-cell-style":{background:"var(--bg-secondary)",color:"var(--text-primary)"},"row-style":{background:"var(--bg-card)"},border:"",stripe:"",onSelectionChange:_e},{default:s(()=>[t(b,{type:"selection",width:"55"}),t(b,{prop:"id",label:"ID",width:"80"}),t(b,{prop:"title",label:"标题","min-width":"200"},{default:s(({row:n})=>[a("div",bt,[a("span",yt,d(n.title),1),t(A,{type:R(n.priority),size:"small",class:"priority-tag"},{default:s(()=>[r(" P"+d(n.priority),1)]),_:2},1032,["type"])])]),_:1}),t(b,{prop:"content",label:"内容","min-width":"300"},{default:s(({row:n})=>[a("div",ht,[a("p",Vt,d(be(n.content,100)),1)])]),_:1}),t(b,{prop:"type_",label:"类型",width:"100"},{default:s(({row:n})=>[t(A,{type:j(n.type_)},{default:s(()=>[r(d(O(n.type_)),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"enabled",label:"状态",width:"100"},{default:s(({row:n})=>[t(W,{modelValue:n.enabled,"onUpdate:modelValue":x=>n.enabled=x,onChange:x=>re(n),loading:n.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),t(b,{prop:"start_time",label:"开始时间",width:"180"},{default:s(({row:n})=>[r(d(S(n.start_time)),1)]),_:1}),t(b,{prop:"end_time",label:"结束时间",width:"180"},{default:s(({row:n})=>[r(d(n.end_time?S(n.end_time):"永久"),1)]),_:1}),t(b,{label:"操作",width:"200",fixed:"right"},{default:s(({row:n})=>[t(g,{size:"small",onClick:x=>ie(n)},{default:s(()=>[t(o,null,{default:s(()=>[t(f(Me))]),_:1}),e[25]||(e[25]=r(" 查看 "))]),_:2,__:[25]},1032,["onClick"]),t(g,{size:"small",type:"primary",onClick:x=>oe(n)},{default:s(()=>[t(o,null,{default:s(()=>[t(f(Se))]),_:1}),e[26]||(e[26]=r(" 编辑 "))]),_:2,__:[26]},1032,["onClick"]),t(g,{size:"small",type:"danger",onClick:x=>ue(n)},{default:s(()=>[t(o,null,{default:s(()=>[t(f(G))]),_:1}),e[27]||(e[27]=r(" 删除 "))]),_:2,__:[27]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ce,I.value]]),a("div",wt,[t(he,{"current-page":k.value,"onUpdate:currentPage":e[3]||(e[3]=n=>k.value=n),"page-size":z.value,"onUpdate:pageSize":e[4]||(e[4]=n=>z.value=n),"page-sizes":[10,20,50,100],total:P.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:fe,onCurrentChange:ve},null,8,["current-page","page-size","total"])])]),c.value.length>0?(H(),N("div",Ct,[a("span",kt,"已选择 "+d(c.value.length)+" 条公告",1)])):Z("",!0),t(K,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=n=>V.value=n),title:w.value?"编辑公告":"发布公告",width:"800px"},{footer:s(()=>[t(g,{onClick:e[12]||(e[12]=n=>V.value=!1)},{default:s(()=>e[30]||(e[30]=[r("取消")])),_:1,__:[30]}),t(g,{type:"primary",onClick:de,loading:T.value},{default:s(()=>[r(d(w.value?"更新":"发布"),1)]),_:1},8,["loading"])]),default:s(()=>[t(we,{model:u,rules:te,ref_key:"formRef",ref:L,"label-width":"100px"},{default:s(()=>[t(y,{label:"公告标题",prop:"title"},{default:s(()=>[t(q,{modelValue:u.title,"onUpdate:modelValue":e[5]||(e[5]=n=>u.title=n),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(y,{label:"公告内容",prop:"content"},{default:s(()=>[t(q,{modelValue:u.content,"onUpdate:modelValue":e[6]||(e[6]=n=>u.content=n),type:"textarea",rows:6,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),t(y,{label:"公告类型",prop:"type_"},{default:s(()=>[t(B,{modelValue:u.type_,"onUpdate:modelValue":e[7]||(e[7]=n=>u.type_=n),placeholder:"选择公告类型"},{default:s(()=>[t(v,{label:"信息",value:"Info"}),t(v,{label:"警告",value:"Warning"}),t(v,{label:"错误",value:"Error"}),t(v,{label:"成功",value:"Success"})]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"优先级",prop:"priority"},{default:s(()=>[t(Ve,{modelValue:u.priority,"onUpdate:modelValue":e[8]||(e[8]=n=>u.priority=n),min:1,max:10,placeholder:"1-10"},null,8,["modelValue"]),e[28]||(e[28]=a("span",{class:"priority-desc"},"优先级越高，显示越靠前",-1))]),_:1,__:[28]}),t(y,{label:"启用状态"},{default:s(()=>[t(W,{modelValue:u.enabled,"onUpdate:modelValue":e[9]||(e[9]=n=>u.enabled=n)},null,8,["modelValue"])]),_:1}),t(y,{label:"开始时间",prop:"start_time"},{default:s(()=>[t(F,{modelValue:u.start_time,"onUpdate:modelValue":e[10]||(e[10]=n=>u.start_time=n),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(y,{label:"结束时间"},{default:s(()=>[t(F,{modelValue:u.end_time,"onUpdate:modelValue":e[11]||(e[11]=n=>u.end_time=n),type:"datetime",placeholder:"选择结束时间（可选）",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"]),e[29]||(e[29]=a("span",{class:"end-time-desc"},"留空表示永久有效",-1))]),_:1,__:[29]})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(K,{modelValue:D.value,"onUpdate:modelValue":e[15]||(e[15]=n=>D.value=n),title:"公告详情",width:"600px"},{footer:s(()=>[t(g,{onClick:e[14]||(e[14]=n=>D.value=!1)},{default:s(()=>e[39]||(e[39]=[r("关闭")])),_:1,__:[39]})]),default:s(()=>[_.value?(H(),N("div",At,[a("div",xt,[e[31]||(e[31]=a("label",null,"公告ID:",-1)),a("span",null,d(_.value.id),1)]),a("div",zt,[e[32]||(e[32]=a("label",null,"标题:",-1)),a("span",null,d(_.value.title),1)]),a("div",Dt,[e[33]||(e[33]=a("label",null,"内容:",-1)),a("div",Ut,d(_.value.content),1)]),a("div",Yt,[e[34]||(e[34]=a("label",null,"类型:",-1)),t(A,{type:j(_.value.type_)},{default:s(()=>[r(d(O(_.value.type_)),1)]),_:1},8,["type"])]),a("div",Mt,[e[35]||(e[35]=a("label",null,"优先级:",-1)),t(A,{type:R(_.value.priority)},{default:s(()=>[r(" P"+d(_.value.priority),1)]),_:1},8,["type"])]),a("div",St,[e[36]||(e[36]=a("label",null,"状态:",-1)),t(A,{type:_.value.enabled?"success":"info"},{default:s(()=>[r(d(_.value.enabled?"启用":"禁用"),1)]),_:1},8,["type"])]),a("div",$t,[e[37]||(e[37]=a("label",null,"开始时间:",-1)),a("span",null,d(S(_.value.start_time)),1)]),a("div",Et,[e[38]||(e[38]=a("label",null,"结束时间:",-1)),a("span",null,d(_.value.end_time?S(_.value.end_time):"永久"),1)])])):Z("",!0)]),_:1},8,["modelValue"])])}}}),Pt=je(Ht,[["__scopeId","data-v-5a79cd40"]]);export{Pt as default};
