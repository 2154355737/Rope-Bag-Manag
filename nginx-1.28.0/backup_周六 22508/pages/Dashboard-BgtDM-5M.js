import{l as q,i as I,f as M,v as G,ad as H,S as J,G as E}from"../chunks/element-plus-BqgU8HW0.js";import{g as Q,_ as U}from"../assets/index-BYq8Q9FJ.js";import{p as X}from"../chunks/packages-D1bca-EI.js";import{u as z}from"../chunks/users-B3_-qbGS.js";import{x as K,r as p,X as W,j as Y,y as d,A as s,Q as o,O as c,I as a,al as h,u as _,M as v,J as P,ar as Z,P as T,a6 as F,H as w,D as tt,z as l}from"../chunks/vue-vendor-BleHOoLr.js";import"../chunks/utils-Dq7h7Pqt.js";const st={class:"user-dashboard"},et={class:"welcome-section"},ot={class:"stat-content"},at={class:"stat-icon"},nt={class:"stat-info"},lt={class:"stat-number"},rt={class:"stat-content"},it={class:"stat-icon"},dt={class:"stat-info"},ct={class:"stat-number"},ut={class:"stat-content"},_t={class:"stat-icon"},vt={class:"stat-info"},ft={class:"stat-number"},mt={class:"stat-content"},pt={class:"stat-icon"},yt={class:"stat-info"},ht={class:"stat-number"},gt={class:"quick-actions"},wt={class:"card-header"},kt={class:"recent-activity"},Ct={key:0,class:"no-activity"},$t={key:1,class:"activity-list"},Dt={class:"activity-icon"},bt={class:"activity-content"},Mt={class:"activity-text"},Rt={class:"activity-time"},St={class:"card-header"},At={key:0,class:"no-resources"},It={key:1,class:"resources-grid"},Et=["onClick"],zt={class:"resource-info"},Pt={class:"resource-name"},Tt={class:"resource-meta"},Ft={class:"resource-downloads"},Bt=K({__name:"Dashboard",setup(jt){const f=p(Q()),u=W({myResources:0,myComments:0,totalDownloads:0}),k=p(!1),C=p(!1),$=p([]),D=p(!1),g=p([]),b=p(!1),B=async()=>{try{try{const e=await z.getMyResources({page:1,pageSize:1});e.code===0&&(u.myResources=e.data?.total||0)}catch(e){console.warn("获取资源统计失败，使用默认值:",e),u.myResources=0}try{const e=await z.getMyComments({page:1,size:1});e.code===0&&(u.myComments=e.data?.total||0)}catch(e){console.warn("获取评论统计失败，使用默认值:",e),u.myComments=0}}catch(e){console.error("加载统计数据失败:",e),u.myResources=0,u.myComments=0}},R=async()=>{D.value=!0;try{await new Promise(e=>setTimeout(e,500)),$.value=[{id:1,type:"upload",description:"上传了新资源: 示例绳包",created_at:new Date().toISOString()},{id:2,type:"comment",description:"评论了资源: 另一个绳包",created_at:new Date(Date.now()-864e5).toISOString()}]}catch(e){console.error("加载最近活动失败:",e)}finally{D.value=!1}},j=async()=>{b.value=!0;try{const e=await X.getPackages({page:1,pageSize:6,search:f.value?.username});e.code===0&&(g.value=e.data?.list||[],u.totalDownloads=g.value.reduce((t,i)=>t+(i.download_count||0),0))}catch(e){console.error("加载我的资源失败:",e)}finally{b.value=!1}},x=async()=>{if(!C.value){k.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),C.value=!0,E.success("签到成功，获得积分+1"),f.value&&(f.value.star=(f.value.star||0)+1)}catch{E.error("签到失败")}finally{k.value=!1}}},V=e=>{const t=new Date(e),r=new Date().getTime()-t.getTime();return r<6e4?"刚刚":r<36e5?`${Math.floor(r/6e4)}分钟前`:r<864e5?`${Math.floor(r/36e5)}小时前`:`${Math.floor(r/864e5)}天前`},L=e=>({Active:"status-active",Pending:"status-pending",Rejected:"status-rejected",Inactive:"status-inactive"})[e]||"",N=e=>({Active:"已发布",Pending:"审核中",Rejected:"已拒绝",Inactive:"已下架"})[e]||e;return Y(()=>{B(),R(),j()}),(e,t)=>{const i=h("el-icon"),r=h("el-card"),y=h("el-col"),S=h("el-row"),m=h("el-button"),O=h("el-empty"),A=Z("loading");return l(),d("div",st,[s("div",et,[t[5]||(t[5]=s("h2",null,"用户中心",-1)),s("p",null,"欢迎回来，"+c(f.value?.nickname||f.value?.username||"用户")+"！",1)]),o(S,{gutter:20,class:"stats-cards"},{default:a(()=>[o(y,{span:6},{default:a(()=>[o(r,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",ot,[s("div",at,[o(i,{color:"#409EFF"},{default:a(()=>[o(_(q))]),_:1})]),s("div",nt,[s("div",lt,c(u.myResources),1),t[6]||(t[6]=s("div",{class:"stat-label"},"我的资源",-1))])])]),_:1})]),_:1}),o(y,{span:6},{default:a(()=>[o(r,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",rt,[s("div",it,[o(i,{color:"#67C23A"},{default:a(()=>[o(_(I))]),_:1})]),s("div",dt,[s("div",ct,c(u.myComments),1),t[7]||(t[7]=s("div",{class:"stat-label"},"我的评论",-1))])])]),_:1})]),_:1}),o(y,{span:6},{default:a(()=>[o(r,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",ut,[s("div",_t,[o(i,{color:"#E6A23C"},{default:a(()=>[o(_(M))]),_:1})]),s("div",vt,[s("div",ft,c(u.totalDownloads),1),t[8]||(t[8]=s("div",{class:"stat-label"},"下载次数",-1))])])]),_:1})]),_:1}),o(y,{span:6},{default:a(()=>[o(r,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",mt,[s("div",pt,[o(i,{color:"#F56C6C"},{default:a(()=>[o(_(G))]),_:1})]),s("div",yt,[s("div",ht,c(f.value?.star||0),1),t[9]||(t[9]=s("div",{class:"stat-label"},"积分",-1))])])]),_:1})]),_:1})]),_:1}),o(S,{gutter:20,class:"content-row"},{default:a(()=>[o(y,{span:12},{default:a(()=>[o(r,{shadow:"hover",class:"action-card"},{header:a(()=>t[10]||(t[10]=[s("div",{class:"card-header"},[s("span",null,"快捷操作")],-1)])),default:a(()=>[s("div",gt,[o(m,{type:"primary",icon:"Plus",onClick:t[0]||(t[0]=n=>e.$router.push("/user/resources"))},{default:a(()=>t[11]||(t[11]=[v(" 上传资源 ")])),_:1,__:[11]}),o(m,{type:"success",icon:"Edit",onClick:t[1]||(t[1]=n=>e.$router.push("/user/profile"))},{default:a(()=>t[12]||(t[12]=[v(" 编辑资料 ")])),_:1,__:[12]}),o(m,{type:"info",icon:"View",onClick:t[2]||(t[2]=n=>e.$router.push("/home"))},{default:a(()=>t[13]||(t[13]=[v(" 浏览资源 ")])),_:1,__:[13]}),o(m,{type:"warning",icon:"Bell",onClick:x,loading:k.value},{default:a(()=>[v(c(C.value?"已签到":"每日签到"),1)]),_:1},8,["loading"])])]),_:1})]),_:1}),o(y,{span:12},{default:a(()=>[o(r,{shadow:"hover",class:"activity-card"},{header:a(()=>[s("div",wt,[t[15]||(t[15]=s("span",null,"最近活动",-1)),o(m,{text:"",type:"primary",size:"small",onClick:R},{default:a(()=>t[14]||(t[14]=[v(" 刷新 ")])),_:1,__:[14]})])]),default:a(()=>[P((l(),d("div",kt,[$.value.length===0?(l(),d("div",Ct," 暂无最近活动 ")):(l(),d("div",$t,[(l(!0),d(T,null,F($.value,n=>(l(),d("div",{key:n.id,class:"activity-item"},[s("div",Dt,[n.type==="upload"?(l(),w(i,{key:0,color:"#409EFF"},{default:a(()=>[o(_(H))]),_:1})):n.type==="comment"?(l(),w(i,{key:1,color:"#67C23A"},{default:a(()=>[o(_(I))]),_:1})):n.type==="download"?(l(),w(i,{key:2,color:"#E6A23C"},{default:a(()=>[o(_(M))]),_:1})):(l(),w(i,{key:3,color:"#909399"},{default:a(()=>[o(_(J))]),_:1}))]),s("div",bt,[s("div",Mt,c(n.description),1),s("div",Rt,c(V(n.created_at)),1)])]))),128))]))])),[[A,D.value]])]),_:1})]),_:1})]),_:1}),o(r,{shadow:"hover",class:"resources-overview"},{header:a(()=>[s("div",St,[t[17]||(t[17]=s("span",null,"我的资源",-1)),o(m,{text:"",type:"primary",size:"small",onClick:t[3]||(t[3]=n=>e.$router.push("/user/resources"))},{default:a(()=>t[16]||(t[16]=[v(" 查看全部 ")])),_:1,__:[16]})])]),default:a(()=>[P((l(),d("div",null,[g.value.length===0?(l(),d("div",At,[o(O,{description:"还没有上传任何资源"},{default:a(()=>[o(m,{type:"primary",onClick:t[4]||(t[4]=n=>e.$router.push("/user/resources"))},{default:a(()=>t[18]||(t[18]=[v(" 立即上传 ")])),_:1,__:[18]})]),_:1})])):(l(),d("div",It,[(l(!0),d(T,null,F(g.value.slice(0,6),n=>(l(),d("div",{key:n.id,class:"resource-item",onClick:xt=>e.$router.push(`/resource/${n.id}`)},[s("div",zt,[s("div",Pt,c(n.name),1),s("div",Tt,[s("span",{class:tt(["resource-status",L(n.status)])},c(N(n.status)),3),s("span",Ft,[o(i,null,{default:a(()=>[o(_(M))]),_:1}),v(" "+c(n.download_count),1)])])])],8,Et))),128))]))])),[[A,b.value]])]),_:1})])}}}),Ht=U(Bt,[["__scopeId","data-v-2d64f4c1"]]);export{Ht as default};
