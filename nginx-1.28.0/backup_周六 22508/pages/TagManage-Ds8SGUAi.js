import{b as j,a as q,c as G,u as K,d as L}from"../chunks/tags-CJkNv3PN.js";import{G as s,E as Q}from"../chunks/element-plus-BqgU8HW0.js";import{x as S,r as i,j as H,y as M,Q as l,I as o,al as p,K as J,C as O,M as c,A,z as F}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as W}from"../assets/index-C1pGffEW.js";import"../chunks/utils-Dq7h7Pqt.js";const X={class:"tag-manage"},Y={class:"header"},Z={class:"header-buttons"},ee=S({__name:"TagManage",setup(ae){const w=i([]),V=i(""),T=i(!1),v=async()=>{T.value=!0;try{console.log("🔍 [TagManage] 开始加载标签, search:",V.value);const a=V.value?await j({search:V.value}):await q();console.log("🔍 [TagManage] API响应:",a);const e=a.data||a;if(console.log("🔍 [TagManage] 实际API数据:",e),e.code===0&&e.data){const r=Array.isArray(e.data)?e.data:e.data.list||[];console.log("🔍 [TagManage] 解析后的标签列表:",r),w.value=r,r.length===0&&console.warn("⚠️ [TagManage] 标签列表为空")}else console.error("❌ [TagManage] API返回错误:",e),s.error(e.msg||"获取标签失败")}catch(a){console.error("❌ [TagManage] 请求异常:",a),s.error("获取标签失败")}finally{T.value=!1}};H(()=>{v()});const U=()=>{console.log("🔄 [TagManage] 手动刷新标签"),v()},b=i(!1),n=i({name:"",description:"",color:""}),d=i(),C={name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:2,max:20,message:"标签名称长度在 2 到 20 个字符",trigger:"blur"}],color:[{validator:(a,e,r)=>{!e||e.trim()===""||/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(e)?r():r(new Error("请输入有效的颜色值，如 #409EFF"))},trigger:"blur"}]},E=()=>{n.value={name:"",description:"",color:""},b.value=!0,d.value&&d.value.clearValidate()},D=()=>{b.value=!1,n.value={name:"",description:"",color:""},d.value&&(d.value.resetFields(),d.value.clearValidate())},I=async()=>{if(d.value){try{await d.value.validate()}catch{return}try{const a={...n.value};(!a.color||a.color.trim()==="")&&(a.color=void 0);const e=await G(a);e.code===0?(s.success("创建成功"),b.value=!1,v(),n.value={name:"",description:"",color:""},d.value.resetFields()):s.error(e.msg||"创建失败")}catch(a){console.error("创建标签失败",a),a.response?.status===400&&a.response?.data?.msg?s.error(a.response.data.msg):a.response?.data?.msg?s.error(a.response.data.msg):s.error("创建失败")}}},y=i(!1),u=i({}),g=i(),R=a=>{u.value={...a},y.value=!0,g.value&&g.value.clearValidate()},$=()=>{y.value=!1,g.value&&g.value.clearValidate()},z=async()=>{if(g.value){try{await g.value.validate()}catch{return}try{const{id:a,...e}=u.value;(!e.color||e.color.trim()==="")&&(e.color=void 0);const r=await K(a,e);r.code===0?(s.success("更新成功"),y.value=!1,v()):s.error(r.msg||"更新失败")}catch(a){console.error("更新标签失败",a),a.response?.status===400&&a.response?.data?.msg?s.error(a.response.data.msg):a.response?.data?.msg?s.error(a.response.data.msg):s.error("更新失败")}}},B=a=>{Q.confirm(`确定删除标签 "${a.name}" ?`,"提示",{type:"warning"}).then(async()=>{const e=await L(a.id);e.code===0?(s.success("删除成功"),v()):s.error(e.msg||"删除失败")}).catch(()=>{})};return(a,e)=>{const r=p("el-input"),m=p("el-button"),f=p("el-table-column"),N=p("el-table"),h=p("el-card"),_=p("el-form-item"),x=p("el-form"),k=p("el-dialog");return F(),M("div",X,[l(h,null,{header:o(()=>[A("div",Y,[l(r,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),placeholder:"搜索标签",clearable:"",style:{"max-width":"220px"},onChange:v},null,8,["modelValue"]),A("div",Z,[l(m,{onClick:U},{default:o(()=>e[9]||(e[9]=[c("刷新")])),_:1,__:[9]}),l(m,{type:"primary",onClick:E},{default:o(()=>e[10]||(e[10]=[c("新增标签")])),_:1,__:[10]})])])]),default:o(()=>[l(N,{data:w.value,style:{width:"100%"},loading:T.value},{default:o(()=>[l(f,{prop:"id",label:"ID",width:"80"}),l(f,{prop:"name",label:"名称"}),l(f,{prop:"description",label:"描述"}),l(f,{prop:"color",label:"颜色",width:"120"},{default:o(({row:t})=>[t.color?(F(),M("div",{key:0,style:O({background:t.color,width:"24px",height:"24px",borderRadius:"4px"})},null,4)):J("",!0)]),_:1}),l(f,{prop:"use_count",label:"使用次数",width:"120"}),l(f,{prop:"created_at",label:"创建时间"}),l(f,{label:"操作",width:"180"},{default:o(({row:t})=>[l(m,{size:"small",onClick:P=>R(t)},{default:o(()=>e[11]||(e[11]=[c("编辑")])),_:2,__:[11]},1032,["onClick"]),l(m,{size:"small",type:"danger",onClick:P=>B(t)},{default:o(()=>e[12]||(e[12]=[c("删除")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])]),_:1}),l(k,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),title:"新增标签"},{footer:o(()=>[l(m,{onClick:D},{default:o(()=>e[13]||(e[13]=[c("取消")])),_:1,__:[13]}),l(m,{type:"primary",onClick:I},{default:o(()=>e[14]||(e[14]=[c("确定")])),_:1,__:[14]})]),default:o(()=>[l(x,{ref_key:"addFormRef",ref:d,model:n.value,rules:C,"label-width":"80px"},{default:o(()=>[l(_,{label:"名称",prop:"name"},{default:o(()=>[l(r,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.name=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"描述",prop:"description"},{default:o(()=>[l(r,{modelValue:n.value.description,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.description=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"颜色",prop:"color"},{default:o(()=>[l(r,{modelValue:n.value.color,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.color=t),placeholder:"#409EFF"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(k,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=t=>y.value=t),title:"编辑标签"},{footer:o(()=>[l(m,{onClick:$},{default:o(()=>e[15]||(e[15]=[c("取消")])),_:1,__:[15]}),l(m,{type:"primary",onClick:z},{default:o(()=>e[16]||(e[16]=[c("保存")])),_:1,__:[16]})]),default:o(()=>[l(x,{ref_key:"editFormRef",ref:g,model:u.value,rules:C,"label-width":"80px"},{default:o(()=>[l(_,{label:"名称",prop:"name"},{default:o(()=>[l(r,{modelValue:u.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.name=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"描述",prop:"description"},{default:o(()=>[l(r,{modelValue:u.value.description,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.description=t)},null,8,["modelValue"])]),_:1}),l(_,{label:"颜色",prop:"color"},{default:o(()=>[l(r,{modelValue:u.value.color,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.color=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ne=W(ee,[["__scopeId","data-v-32a8d3d8"]]);export{ne as default};
