import{x as R,r as u,X as Q,y as U,A as s,Q as a,I as g,al as c,M as b,O as V,V as I,ax as P,z as B}from"../chunks/vue-vendor-BleHOoLr.js";import{_ as E}from"../assets/index-BYq8Q9FJ.js";import{a as y}from"../chunks/auth-BOd3B2lg.js";import{G as n}from"../chunks/element-plus-BqgU8HW0.js";import"../chunks/utils-Dq7h7Pqt.js";const F={class:"register-desktop"},M={class:"register-container"},N={class:"register-form-section"},S={class:"form-container"},A={class:"form-group"},h={class:"form-group"},D={class:"form-group"},G={class:"form-group"},L={class:"form-group"},O={class:"form-group"},T={class:"form-group",style:{display:"flex",gap:"8px","align-items":"center"}},X={style:{flex:"1"}},$={class:"login-link-container",style:{"text-align":"center","margin-top":"16px"}},j=R({__name:"Register",setup(H){const v=P(),p=u(),d=u(!1),r=Q({username:"",password:"",confirmPassword:"",nickname:"",qq_number:"",email:"",code:""}),q={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(l,e,t)=>{e!==r.password?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}],nickname:[],qq_number:[{pattern:/^[1-9][0-9]{4,11}$/,message:"请输入有效的QQ号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},m=u(!1),i=u(0);let _=null;function k(){i.value=60,_=setInterval(()=>{i.value--,i.value<=0&&clearInterval(_)},1e3)}async function x(){if(!r.email){n.warning("请先输入邮箱");return}m.value=!0;try{const l=await y.sendRegisterCode({email:r.email});l.code===0?(n.success("验证码已发送"),k()):n.error(l.message||"发送失败")}catch(l){console.error("发送验证码失败:",l),n.error("发送验证码失败，请稍后重试")}finally{m.value=!1}}async function w(){if(p.value)try{await p.value.validate(),d.value=!0;const l=await y.register({username:r.username,password:r.password,nickname:r.nickname||null,qq_number:r.qq_number||null,email:r.email,verification_code:r.code});l.code===0?(n.success("注册成功！"),v.push("/login")):n.error(l.message||"注册失败")}catch(l){console.error("注册失败:",l),l.response&&l.response.data&&l.response.data.message?n.error(l.response.data.message):l.message?n.error(l.message):n.error("注册失败，请重试")}finally{d.value=!1}}function z(){v.push("/login")}return(l,e)=>{const t=c("el-input"),f=c("el-button"),C=c("el-form");return B(),U("div",F,[s("div",M,[s("div",N,[s("div",S,[e[15]||(e[15]=s("div",{class:"form-header"},[s("h2",{class:"form-title"},"注册账号"),s("p",{class:"form-subtitle"},"请填写以下信息完成注册")],-1)),a(C,{ref_key:"registerFormRef",ref:p,model:r,rules:q,class:"register-form",onSubmit:I(w,["prevent"])},{default:g(()=>[s("div",A,[e[7]||(e[7]=s("label",{class:"form-label"},"用户名",-1)),a(t,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=o=>r.username=o),placeholder:"请输入用户名",size:"large",clearable:""},null,8,["modelValue"])]),s("div",h,[e[8]||(e[8]=s("label",{class:"form-label"},"密码",-1)),a(t,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=o=>r.password=o),type:"password",placeholder:"请输入密码",size:"large","show-password":"",clearable:""},null,8,["modelValue"])]),s("div",D,[e[9]||(e[9]=s("label",{class:"form-label"},"确认密码",-1)),a(t,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=o=>r.confirmPassword=o),type:"password",placeholder:"请再次输入密码",size:"large","show-password":"",clearable:""},null,8,["modelValue"])]),s("div",G,[e[10]||(e[10]=s("label",{class:"form-label"},"昵称（可选）",-1)),a(t,{modelValue:r.nickname,"onUpdate:modelValue":e[3]||(e[3]=o=>r.nickname=o),placeholder:"请输入昵称（可选）",size:"large",clearable:""},null,8,["modelValue"])]),s("div",L,[e[11]||(e[11]=s("label",{class:"form-label"},"QQ账号（可选）",-1)),a(t,{modelValue:r.qq_number,"onUpdate:modelValue":e[4]||(e[4]=o=>r.qq_number=o),placeholder:"请输入QQ号（可选）",size:"large",clearable:""},null,8,["modelValue"])]),s("div",O,[e[12]||(e[12]=s("label",{class:"form-label"},"邮箱",-1)),a(t,{modelValue:r.email,"onUpdate:modelValue":e[5]||(e[5]=o=>r.email=o),placeholder:"请输入邮箱",size:"large",clearable:""},null,8,["modelValue"])]),s("div",T,[s("div",X,[e[13]||(e[13]=s("label",{class:"form-label"},"验证码",-1)),a(t,{modelValue:r.code,"onUpdate:modelValue":e[6]||(e[6]=o=>r.code=o),placeholder:"请输入验证码",size:"large",clearable:""},null,8,["modelValue"])]),a(f,{type:"primary",disabled:i.value>0||m.value,onClick:x},{default:g(()=>[b(V(i.value>0?i.value+"s":m.value?"发送中":"获取验证码"),1)]),_:1},8,["disabled"])]),a(f,{type:"primary",size:"large",class:"register-btn",loading:d.value,onClick:w},{default:g(()=>[b(V(d.value?"注册中...":"注册"),1)]),_:1},8,["loading"])]),_:1},8,["model"]),s("div",$,[a(f,{type:"info",link:"",onClick:z},{default:g(()=>e[14]||(e[14]=[b("已有账号？去登录")])),_:1,__:[14]})])])])])])}}}),ee=E(j,[["__scopeId","data-v-da1dbc40"]]);export{ee as default};
