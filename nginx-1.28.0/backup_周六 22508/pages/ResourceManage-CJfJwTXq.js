import{x as he,r as g,X as T,c as X,j as we,y as R,A as s,Q as t,H as M,K as w,I as a,M as r,al as u,u as y,O as i,a4 as ye,J as be,ar as ke,z as v}from"../chunks/vue-vendor-BleHOoLr.js";import{U as Ce,a5 as W,ag as Z,l as xe,Q as ee,G as m,E as Re}from"../chunks/element-plus-BqgU8HW0.js";import{p as S}from"../chunks/packages-DTyrg_aq.js";import{_ as Ve}from"../assets/index-BZGS9eVU.js";import"../chunks/utils-Dq7h7Pqt.js";const ze={class:"elder-resource-manage"},Me={class:"page-header"},Se={class:"header-content"},De={class:"header-actions"},je={class:"stat-content"},Be={class:"stat-icon"},Fe={class:"stat-info"},Pe={class:"stat-number"},Ue={class:"stat-content"},$e={class:"stat-icon"},Ae={class:"stat-info"},Ee={class:"stat-number"},Ye={class:"stat-content"},Ne={class:"stat-icon"},Te={class:"stat-info"},Ie={class:"stat-number"},Ke={class:"stat-content"},Le={class:"stat-icon"},qe={class:"stat-info"},Ge={class:"stat-number"},Oe={class:"batch-actions"},Qe={class:"selection-info"},He={class:"action-buttons"},Je={class:"resource-name-cell"},Xe={class:"name"},We={class:"author"},Ze={key:0},et={key:1,class:"text-muted"},tt={class:"table-actions"},st={class:"pagination-wrapper"},at={key:0,class:"resource-detail"},lt={class:"detail-section"},ot={class:"detail-grid"},nt={class:"detail-item"},it={class:"value"},dt={class:"detail-item"},rt={class:"value"},ut={class:"detail-item"},ct={class:"value"},_t={class:"detail-item"},vt={class:"detail-section"},pt={class:"description-content"},mt={class:"detail-section"},ft={class:"file-info"},gt={class:"file-link"},ht={key:0,class:"file-size"},wt={class:"value"},yt={key:0,class:"detail-section"},bt={class:"review-comment"},kt={key:0},Ct={class:"review-resource-info"},xt={class:"resource-summary"},Rt={class:"dialog-footer"},Vt=he({__name:"ResourceManage",setup(zt){const P=g(null),U=g(!1),$=g(!1),D=g(!1),A=g(!1),z=g(!1),b=g([]),d=g(null),k=g([]),E=g(null),C=T({page:1,pageSize:20}),c=T({status:"",search:"",start_date:"",end_date:""}),h=T({status:"approved",comment:""}),te={status:[{required:!0,message:"请选择审核结果",trigger:"change"}]},se=X(()=>b.value.length),j=X(()=>{const l=b.value.filter(_=>_.status==="Pending").length,e=b.value.filter(_=>_.status==="Active").length,n=b.value.filter(_=>_.status==="Rejected").length,p=b.value.length;return{pending:l,approved:e,rejected:n,total:p}}),f=async()=>{U.value=!0;try{const l={page:C.page,pageSize:C.pageSize,...c};Object.keys(l).forEach(n=>{(l[n]===""||l[n]===null)&&delete l[n]});const e=c.status?await S.getPackages(l):await S.getPendingResources(l);e.code===0?b.value=e.data?.list||[]:m.error(e.message||"加载资源列表失败")}catch(l){console.error("加载资源列表失败:",l),m.error("加载资源列表失败")}finally{U.value=!1}},ae=l=>{l&&l.length===2?(c.start_date=l[0],c.end_date=l[1]):(c.start_date="",c.end_date="")},le=()=>{c.status="",c.search="",c.start_date="",c.end_date="",E.value=null,C.page=1,f()},oe=l=>{k.value=l},I=()=>{k.value=[]},ne=l=>{d.value=l,A.value=!0},ie=l=>{d.value=l,h.status="approved",h.comment="",z.value=!0},K=async(l,e)=>{try{const n=await S.reviewResource(l.id,{status:e});n.code===0?(m.success(e==="approved"?"审核通过":"审核拒绝"),f()):m.error(n.message||"审核失败")}catch(n){console.error("快速审核失败:",n),m.error("审核失败")}},L=async l=>{if(k.value.length===0){m.warning("请先选择要审核的资源");return}try{await Re.confirm(`确定要${l==="approved"?"批量通过":"批量拒绝"}选中的 ${k.value.length} 个资源吗？`,"确认批量审核",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.value=!0;const e=k.value.map(n=>S.reviewResource(n.id,{status:l}));await Promise.all(e),m.success(`批量${l==="approved"?"通过":"拒绝"}成功`),I(),f()}catch(e){e!=="cancel"&&(console.error("批量审核失败:",e),m.error("批量审核失败"))}finally{D.value=!1}},de=async()=>{if(!(!P.value||!d.value))try{await P.value.validate(),$.value=!0;const l=await S.reviewResource(d.value.id,h);l.code===0?(m.success("审核完成"),z.value=!1,f()):m.error(l.message||"审核失败")}catch(l){console.error("提交审核失败:",l),m.error("审核失败")}finally{$.value=!1}},q=l=>({Active:"success",Pending:"warning",Rejected:"danger",Inactive:"info"})[l]||"info",G=l=>({Active:"已通过",Pending:"待审核",Rejected:"已拒绝",Inactive:"已下架"})[l]||l,Y=l=>new Date(l).toLocaleDateString("zh-CN"),re=l=>{if(l===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],p=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,p)).toFixed(2))+" "+n[p]};return we(()=>{f()}),(l,e)=>{const n=u("el-button"),p=u("el-icon"),_=u("el-card"),B=u("el-col"),ue=u("el-row"),F=u("el-option"),ce=u("el-select"),V=u("el-form-item"),O=u("el-input"),_e=u("el-date-picker"),x=u("el-table-column"),Q=u("el-tag"),ve=u("el-table"),pe=u("el-pagination"),me=u("el-link"),H=u("el-dialog"),J=u("el-radio"),fe=u("el-radio-group"),ge=ke("loading");return v(),R("div",ze,[s("div",Me,[s("div",Se,[e[13]||(e[13]=s("h2",null,"资源审核管理",-1)),s("div",De,[t(n,{type:"primary",icon:"Refresh",onClick:f},{default:a(()=>e[12]||(e[12]=[r(" 刷新列表 ")])),_:1,__:[12]})])])]),t(ue,{gutter:20,class:"stats-row"},{default:a(()=>[t(B,{span:6},{default:a(()=>[t(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",je,[s("div",Be,[t(p,{color:"#E6A23C"},{default:a(()=>[t(y(Ce))]),_:1})]),s("div",Fe,[s("div",Pe,i(j.value.pending),1),e[14]||(e[14]=s("div",{class:"stat-label"},"待审核",-1))])])]),_:1})]),_:1}),t(B,{span:6},{default:a(()=>[t(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",Ue,[s("div",$e,[t(p,{color:"#67C23A"},{default:a(()=>[t(y(W))]),_:1})]),s("div",Ae,[s("div",Ee,i(j.value.approved),1),e[15]||(e[15]=s("div",{class:"stat-label"},"已通过",-1))])])]),_:1})]),_:1}),t(B,{span:6},{default:a(()=>[t(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",Ye,[s("div",Ne,[t(p,{color:"#F56C6C"},{default:a(()=>[t(y(Z))]),_:1})]),s("div",Te,[s("div",Ie,i(j.value.rejected),1),e[16]||(e[16]=s("div",{class:"stat-label"},"已拒绝",-1))])])]),_:1})]),_:1}),t(B,{span:6},{default:a(()=>[t(_,{shadow:"hover",class:"stat-card"},{default:a(()=>[s("div",Ke,[s("div",Le,[t(p,{color:"#409EFF"},{default:a(()=>[t(y(xe))]),_:1})]),s("div",qe,[s("div",Ge,i(j.value.total),1),e[17]||(e[17]=s("div",{class:"stat-label"},"总资源数",-1))])])]),_:1})]),_:1})]),_:1}),t(_,{shadow:"hover",class:"filter-card"},{default:a(()=>[t(y(ee),{model:c,inline:!0,class:"search-form"},{default:a(()=>[t(V,{label:"审核状态:"},{default:a(()=>[t(ce,{modelValue:c.status,"onUpdate:modelValue":e[0]||(e[0]=o=>c.status=o),placeholder:"全部状态",clearable:"",style:{width:"140px"}},{default:a(()=>[t(F,{label:"全部",value:""}),t(F,{label:"待审核",value:"Pending"}),t(F,{label:"已通过",value:"Active"}),t(F,{label:"已拒绝",value:"Rejected"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"资源名称:"},{default:a(()=>[t(O,{modelValue:c.search,"onUpdate:modelValue":e[1]||(e[1]=o=>c.search=o),placeholder:"输入资源名称",clearable:"",style:{width:"200px"},onKeyup:ye(f,["enter"])},null,8,["modelValue"])]),_:1}),t(V,{label:"提交时间:"},{default:a(()=>[t(_e,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=o=>E.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ae},null,8,["modelValue"])]),_:1}),t(V,null,{default:a(()=>[t(n,{type:"primary",icon:"Search",onClick:f},{default:a(()=>e[18]||(e[18]=[r("搜索")])),_:1,__:[18]}),t(n,{icon:"Refresh",onClick:le},{default:a(()=>e[19]||(e[19]=[r("重置")])),_:1,__:[19]})]),_:1})]),_:1},8,["model"])]),_:1}),k.value.length>0?(v(),M(_,{key:0,shadow:"hover",class:"batch-card"},{default:a(()=>[s("div",Oe,[s("span",Qe,"已选择 "+i(k.value.length)+" 个资源",1),s("div",He,[t(n,{type:"success",icon:"Select",onClick:e[3]||(e[3]=o=>L("approved")),loading:D.value},{default:a(()=>e[20]||(e[20]=[r(" 批量通过 ")])),_:1,__:[20]},8,["loading"]),t(n,{type:"danger",icon:"CloseBold",onClick:e[4]||(e[4]=o=>L("rejected")),loading:D.value},{default:a(()=>e[21]||(e[21]=[r(" 批量拒绝 ")])),_:1,__:[21]},8,["loading"]),t(n,{onClick:I},{default:a(()=>e[22]||(e[22]=[r("取消选择")])),_:1,__:[22]})])])]),_:1})):w("",!0),t(_,{shadow:"hover",class:"resource-list-card"},{default:a(()=>[be((v(),M(ve,{data:b.value,onSelectionChange:oe,"row-key":"id"},{default:a(()=>[t(x,{type:"selection",width:"55"}),t(x,{prop:"name",label:"资源名称","min-width":"200"},{default:a(({row:o})=>[s("div",Je,[s("div",Xe,i(o.name),1),s("div",We,"作者: "+i(o.author),1)])]),_:1}),t(x,{prop:"version",label:"版本",width:"100"},{default:a(({row:o})=>[s("span",null,i(o.version||"未设置"),1)]),_:1}),t(x,{prop:"status",label:"状态",width:"100"},{default:a(({row:o})=>[t(Q,{type:q(o.status),size:"small"},{default:a(()=>[r(i(G(o.status)),1)]),_:2},1032,["type"])]),_:1}),t(x,{prop:"created_at",label:"提交时间",width:"120"},{default:a(({row:o})=>[r(i(Y(o.created_at)),1)]),_:1}),t(x,{prop:"reviewed_at",label:"审核时间",width:"120"},{default:a(({row:o})=>[o.reviewed_at?(v(),R("span",Ze,i(Y(o.reviewed_at)),1)):(v(),R("span",et,"未审核"))]),_:1}),t(x,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o})=>[s("div",tt,[t(n,{type:"text",size:"small",onClick:N=>ne(o),icon:"View"},{default:a(()=>e[23]||(e[23]=[r(" 查看 ")])),_:2,__:[23]},1032,["onClick"]),o.status==="Pending"?(v(),M(n,{key:0,type:"text",size:"small",onClick:N=>ie(o),icon:"Edit"},{default:a(()=>e[24]||(e[24]=[r(" 审核 ")])),_:2,__:[24]},1032,["onClick"])):w("",!0),o.status==="Pending"?(v(),M(n,{key:1,type:"text",size:"small",onClick:N=>K(o,"approved"),class:"approve-btn"},{default:a(()=>e[25]||(e[25]=[r(" 通过 ")])),_:2,__:[25]},1032,["onClick"])):w("",!0),o.status==="Pending"?(v(),M(n,{key:2,type:"text",size:"small",onClick:N=>K(o,"rejected"),class:"reject-btn"},{default:a(()=>e[26]||(e[26]=[r(" 拒绝 ")])),_:2,__:[26]},1032,["onClick"])):w("",!0)])]),_:1})]),_:1},8,["data"])),[[ge,U.value]]),s("div",st,[t(pe,{"current-page":C.page,"onUpdate:currentPage":e[5]||(e[5]=o=>C.page=o),"page-size":C.pageSize,"onUpdate:pageSize":e[6]||(e[6]=o=>C.pageSize=o),"page-sizes":[10,20,50,100],total:se.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),t(H,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=o=>A.value=o),title:"资源详情",width:"700px"},{default:a(()=>[d.value?(v(),R("div",at,[s("div",lt,[e[31]||(e[31]=s("h4",null,"基本信息",-1)),s("div",ot,[s("div",nt,[e[27]||(e[27]=s("span",{class:"label"},"资源名称:",-1)),s("span",it,i(d.value.name),1)]),s("div",dt,[e[28]||(e[28]=s("span",{class:"label"},"作者:",-1)),s("span",rt,i(d.value.author),1)]),s("div",ut,[e[29]||(e[29]=s("span",{class:"label"},"版本:",-1)),s("span",ct,i(d.value.version||"未设置"),1)]),s("div",_t,[e[30]||(e[30]=s("span",{class:"label"},"状态:",-1)),t(Q,{type:q(d.value.status)},{default:a(()=>[r(i(G(d.value.status)),1)]),_:1},8,["type"])])])]),s("div",vt,[e[32]||(e[32]=s("h4",null,"描述信息",-1)),s("div",pt,i(d.value.description||"暂无描述"),1)]),s("div",mt,[e[35]||(e[35]=s("h4",null,"文件信息",-1)),s("div",ft,[s("div",gt,[e[33]||(e[33]=s("span",{class:"label"},"下载链接:",-1)),t(me,{href:d.value.file_url,target:"_blank",type:"primary"},{default:a(()=>[r(i(d.value.file_url),1)]),_:1},8,["href"])]),d.value.file_size?(v(),R("div",ht,[e[34]||(e[34]=s("span",{class:"label"},"文件大小:",-1)),s("span",wt,i(re(d.value.file_size)),1)])):w("",!0)])]),d.value.review_comment?(v(),R("div",yt,[e[36]||(e[36]=s("h4",null,"审核意见",-1)),s("div",bt,i(d.value.review_comment),1)])):w("",!0)])):w("",!0)]),_:1},8,["modelValue"]),t(H,{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=o=>z.value=o),title:"资源审核",width:"600px","close-on-click-modal":!1},{footer:a(()=>[s("div",Rt,[t(n,{onClick:e[10]||(e[10]=o=>z.value=!1)},{default:a(()=>e[39]||(e[39]=[r("取消")])),_:1,__:[39]}),t(n,{type:"primary",onClick:de,loading:$.value},{default:a(()=>e[40]||(e[40]=[r(" 提交审核 ")])),_:1,__:[40]},8,["loading"])])]),default:a(()=>[d.value?(v(),R("div",kt,[s("div",Ct,[s("h4",null,i(d.value.name),1),s("p",xt," 作者: "+i(d.value.author)+" | 版本: "+i(d.value.version||"未设置")+" | 提交时间: "+i(Y(d.value.created_at)),1)]),t(y(ee),{model:h,rules:te,ref_key:"reviewFormRef",ref:P,"label-width":"80px"},{default:a(()=>[t(V,{label:"审核结果",prop:"status"},{default:a(()=>[t(fe,{modelValue:h.status,"onUpdate:modelValue":e[8]||(e[8]=o=>h.status=o)},{default:a(()=>[t(J,{label:"approved"},{default:a(()=>[t(p,{color:"#67C23A"},{default:a(()=>[t(y(W))]),_:1}),e[37]||(e[37]=r(" 通过 "))]),_:1,__:[37]}),t(J,{label:"rejected"},{default:a(()=>[t(p,{color:"#F56C6C"},{default:a(()=>[t(y(Z))]),_:1}),e[38]||(e[38]=r(" 拒绝 "))]),_:1,__:[38]})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"审核意见",prop:"comment"},{default:a(()=>[t(O,{modelValue:h.comment,"onUpdate:modelValue":e[9]||(e[9]=o=>h.comment=o),type:"textarea",rows:4,placeholder:"请输入审核意见（可选）","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):w("",!0)]),_:1},8,["modelValue"])])}}}),Ft=Ve(Vt,[["__scopeId","data-v-186e54a4"]]);export{Ft as default};
