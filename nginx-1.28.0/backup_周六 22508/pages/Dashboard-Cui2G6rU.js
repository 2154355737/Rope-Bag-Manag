import{x as ae,r as f,X as N,j as le,y as _,A as s,Q as t,O as n,I as o,al as c,u as y,M as d,J as q,ar as ne,K as H,P as L,a6 as O,V as Q,H as G,z as r}from"../chunks/vue-vendor-BleHOoLr.js";import{U as ie,l as de,a5 as P,i as re,ag as ue,Q as ce,G as w}from"../chunks/element-plus-BqgU8HW0.js";import{g as _e,_ as ve}from"../assets/index-BZGS9eVU.js";import{p as C}from"../chunks/packages-DTyrg_aq.js";import{c as pe}from"../chunks/comments-CosgVoYG.js";import"../chunks/utils-Dq7h7Pqt.js";const me={class:"elder-dashboard"},fe={class:"welcome-section"},ge={class:"stat-content"},ye={class:"stat-icon"},we={class:"stat-info"},he={class:"stat-number"},ke={class:"stat-content"},Re={class:"stat-icon"},Ce={class:"stat-info"},be={class:"stat-number"},$e={class:"stat-content"},Ve={class:"stat-icon"},De={class:"stat-info"},ze={class:"stat-number"},Se={class:"stat-content"},Fe={class:"stat-icon"},Me={class:"stat-info"},xe={class:"stat-number"},Pe={class:"quick-actions"},Ae={class:"card-header"},Ee={class:"pending-resources"},Ie={key:0,class:"no-pending"},Ue={key:1,class:"pending-list"},Te=["onClick"],je={class:"resource-info"},Be={class:"resource-name"},Ne={class:"resource-meta"},qe={class:"resource-author"},He={class:"resource-time"},Le={class:"review-actions"},Oe={key:0,class:"show-more"},Qe={class:"card-header"},Ge={key:0,class:"no-history"},Je={key:1,class:"history-list"},Ke={class:"history-icon"},Xe={class:"history-content"},We={class:"history-text"},Ye={class:"history-time"},Ze={class:"history-status"},es={key:0},ss={class:"resource-detail"},ts={class:"detail-item"},os={class:"value"},as={class:"detail-item"},ls={class:"value"},ns={class:"detail-item"},is={class:"detail-item"},ds={class:"description"},rs={class:"dialog-footer"},us=ae({__name:"Dashboard",setup(cs){const V=f(null),k=f(_e()),D=f(!1),z=f(!1),S=f(!1),R=f(!1),b=f([]),F=f([]),m=f(null),v=N({pendingResources:0,myResources:0,reviewedResources:0,myComments:0}),g=N({status:"approved",comment:""}),J={status:[{required:!0,message:"请选择审核结果",trigger:"change"}]},M=async()=>{try{const a=await C.getPendingResources({page:1,pageSize:1});a.code===0&&(v.pendingResources=a.data?.total||0);const e=await C.getPackages({page:1,pageSize:1,search:k.value?.username});if(e.code===0&&(v.myResources=e.data?.total||0),k.value?.id){const i=await pe.getUserComments(k.value.id,{page:1,size:1});i.code===0&&(v.myComments=i.data?.total||0)}v.reviewedResources=Math.floor(Math.random()*50)+10}catch(a){console.error("加载统计数据失败:",a)}},$=async()=>{D.value=!0;try{const a=await C.getPendingResources({page:1,pageSize:10});a.code===0&&(b.value=a.data?.list||[],v.pendingResources=a.data?.total||0)}catch(a){console.error("加载待审核资源失败:",a),w.error("加载待审核资源失败")}finally{D.value=!1}},x=async()=>{z.value=!0;try{await new Promise(a=>setTimeout(a,500)),F.value=[{id:1,name:"示例绳包1",status:"approved",reviewed_at:new Date().toISOString()},{id:2,name:"示例绳包2",status:"rejected",reviewed_at:new Date(Date.now()-864e5).toISOString()}]}catch(a){console.error("加载审核历史失败:",a)}finally{z.value=!1}},K=a=>{m.value=a,g.status="approved",g.comment="",R.value=!0},A=async(a,e)=>{try{const i=await C.reviewResource(a.id,{status:e});i.code===0?(w.success(e==="approved"?"审核通过":"审核拒绝"),$(),M()):w.error(i.message||"审核失败")}catch(i){console.error("快速审核失败:",i),w.error("审核失败")}},X=async()=>{if(!(!V.value||!m.value))try{await V.value.validate(),S.value=!0;const a=await C.reviewResource(m.value.id,g);a.code===0?(w.success("审核完成"),R.value=!1,$(),M(),x()):w.error(a.message||"审核失败")}catch(a){console.error("提交审核失败:",a),w.error("审核失败")}finally{S.value=!1}},E=a=>{const e=new Date(a),u=new Date().getTime()-e.getTime();return u<6e4?"刚刚":u<36e5?`${Math.floor(u/6e4)}分钟前`:u<864e5?`${Math.floor(u/36e5)}小时前`:`${Math.floor(u/864e5)}天前`};return le(()=>{M(),$(),x()}),(a,e)=>{const i=c("el-icon"),u=c("el-card"),h=c("el-col"),I=c("el-row"),W=c("el-badge"),p=c("el-button"),Y=c("el-empty"),Z=c("el-tag"),ee=c("el-link"),U=c("el-radio"),se=c("el-radio-group"),T=c("el-form-item"),te=c("el-input"),oe=c("el-dialog"),j=ne("loading");return r(),_("div",me,[s("div",fe,[e[9]||(e[9]=s("h2",null,"元老后台",-1)),s("p",null,"欢迎回来，"+n(k.value?.nickname||k.value?.username||"元老")+"！您拥有资源审核等管理权限。",1)]),t(I,{gutter:20,class:"stats-cards"},{default:o(()=>[t(h,{span:6},{default:o(()=>[t(u,{shadow:"hover",class:"stat-card"},{default:o(()=>[s("div",ge,[s("div",ye,[t(i,{color:"#E6A23C"},{default:o(()=>[t(y(ie))]),_:1})]),s("div",we,[s("div",he,n(v.pendingResources),1),e[10]||(e[10]=s("div",{class:"stat-label"},"待审核资源",-1))])])]),_:1})]),_:1}),t(h,{span:6},{default:o(()=>[t(u,{shadow:"hover",class:"stat-card"},{default:o(()=>[s("div",ke,[s("div",Re,[t(i,{color:"#409EFF"},{default:o(()=>[t(y(de))]),_:1})]),s("div",Ce,[s("div",be,n(v.myResources),1),e[11]||(e[11]=s("div",{class:"stat-label"},"我的资源",-1))])])]),_:1})]),_:1}),t(h,{span:6},{default:o(()=>[t(u,{shadow:"hover",class:"stat-card"},{default:o(()=>[s("div",$e,[s("div",Ve,[t(i,{color:"#67C23A"},{default:o(()=>[t(y(P))]),_:1})]),s("div",De,[s("div",ze,n(v.reviewedResources),1),e[12]||(e[12]=s("div",{class:"stat-label"},"已审核资源",-1))])])]),_:1})]),_:1}),t(h,{span:6},{default:o(()=>[t(u,{shadow:"hover",class:"stat-card"},{default:o(()=>[s("div",Se,[s("div",Fe,[t(i,{color:"#F56C6C"},{default:o(()=>[t(y(re))]),_:1})]),s("div",Me,[s("div",xe,n(v.myComments),1),e[13]||(e[13]=s("div",{class:"stat-label"},"我的评论",-1))])])]),_:1})]),_:1})]),_:1}),t(I,{gutter:20,class:"content-row"},{default:o(()=>[t(h,{span:12},{default:o(()=>[t(u,{shadow:"hover",class:"action-card"},{header:o(()=>e[14]||(e[14]=[s("div",{class:"card-header"},[s("span",null,"管理操作")],-1)])),default:o(()=>[s("div",Pe,[t(p,{type:"warning",icon:"Clock",onClick:e[0]||(e[0]=l=>a.$router.push("/elder/resources"))},{default:o(()=>[e[15]||(e[15]=d(" 资源审核 ")),t(W,{value:v.pendingResources,hidden:v.pendingResources===0,class:"item"},null,8,["value","hidden"])]),_:1,__:[15]}),t(p,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=l=>a.$router.push("/elder/my-resources"))},{default:o(()=>e[16]||(e[16]=[d(" 上传资源 ")])),_:1,__:[16]}),t(p,{type:"success",icon:"Edit",onClick:e[2]||(e[2]=l=>a.$router.push("/elder/profile"))},{default:o(()=>e[17]||(e[17]=[d(" 编辑资料 ")])),_:1,__:[17]}),t(p,{type:"info",icon:"ChatDotRound",onClick:e[3]||(e[3]=l=>a.$router.push("/elder/comments"))},{default:o(()=>e[18]||(e[18]=[d(" 我的评论 ")])),_:1,__:[18]})])]),_:1})]),_:1}),t(h,{span:12},{default:o(()=>[t(u,{shadow:"hover",class:"pending-card"},{header:o(()=>[s("div",Ae,[e[20]||(e[20]=s("span",null,"待审核资源",-1)),t(p,{text:"",type:"primary",size:"small",onClick:$},{default:o(()=>e[19]||(e[19]=[d(" 刷新 ")])),_:1,__:[19]})])]),default:o(()=>[q((r(),_("div",Ee,[b.value.length===0?(r(),_("div",Ie,[t(i,null,{default:o(()=>[t(y(P))]),_:1}),e[21]||(e[21]=s("span",null,"暂无待审核资源",-1))])):(r(),_("div",Ue,[(r(!0),_(L,null,O(b.value.slice(0,5),l=>(r(),_("div",{key:l.id,class:"pending-item",onClick:B=>K(l)},[s("div",je,[s("div",Be,n(l.name),1),s("div",Ne,[s("span",qe,"作者: "+n(l.author),1),s("span",He,n(E(l.created_at)),1)])]),s("div",Le,[t(p,{type:"success",size:"small",onClick:Q(B=>A(l,"approved"),["stop"])},{default:o(()=>e[22]||(e[22]=[d(" 通过 ")])),_:2,__:[22]},1032,["onClick"]),t(p,{type:"danger",size:"small",onClick:Q(B=>A(l,"rejected"),["stop"])},{default:o(()=>e[23]||(e[23]=[d(" 拒绝 ")])),_:2,__:[23]},1032,["onClick"])])],8,Te))),128)),b.value.length>5?(r(),_("div",Oe,[t(p,{text:"",type:"primary",onClick:e[4]||(e[4]=l=>a.$router.push("/elder/resources"))},{default:o(()=>[d(" 查看全部 "+n(v.pendingResources)+" 个待审核资源 ",1)]),_:1})])):H("",!0)]))])),[[j,D.value]])]),_:1})]),_:1})]),_:1}),t(u,{shadow:"hover",class:"review-history"},{header:o(()=>[s("div",Qe,[e[25]||(e[25]=s("span",null,"最近审核记录",-1)),t(p,{text:"",type:"primary",size:"small",onClick:x},{default:o(()=>e[24]||(e[24]=[d(" 查看更多 ")])),_:1,__:[24]})])]),default:o(()=>[q((r(),_("div",null,[F.value.length===0?(r(),_("div",Ge,[t(Y,{description:"暂无审核记录"})])):(r(),_("div",Je,[(r(!0),_(L,null,O(F.value.slice(0,8),l=>(r(),_("div",{key:l.id,class:"history-item"},[s("div",Ke,[l.status==="approved"?(r(),G(i,{key:0,color:"#67C23A"},{default:o(()=>[t(y(P))]),_:1})):(r(),G(i,{key:1,color:"#F56C6C"},{default:o(()=>[t(y(ue))]),_:1}))]),s("div",Xe,[s("div",We,n(l.status==="approved"?"通过":"拒绝")+'了资源 "'+n(l.name)+'" ',1),s("div",Ye,n(E(l.reviewed_at)),1)]),s("div",Ze,[t(Z,{type:l.status==="approved"?"success":"danger",size:"small"},{default:o(()=>[d(n(l.status==="approved"?"已通过":"已拒绝"),1)]),_:2},1032,["type"])])]))),128))]))])),[[j,z.value]])]),_:1}),t(oe,{modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=l=>R.value=l),title:"资源审核",width:"600px","close-on-click-modal":!1},{footer:o(()=>[s("div",rs,[t(p,{onClick:e[7]||(e[7]=l=>R.value=!1)},{default:o(()=>e[32]||(e[32]=[d("取消")])),_:1,__:[32]}),t(p,{type:"primary",onClick:X,loading:S.value},{default:o(()=>e[33]||(e[33]=[d(" 提交审核 ")])),_:1,__:[33]},8,["loading"])])]),default:o(()=>[m.value?(r(),_("div",es,[s("div",ss,[s("h4",null,n(m.value.name),1),s("div",ts,[e[26]||(e[26]=s("span",{class:"label"},"作者:",-1)),s("span",os,n(m.value.author),1)]),s("div",as,[e[27]||(e[27]=s("span",{class:"label"},"版本:",-1)),s("span",ls,n(m.value.version||"未设置"),1)]),s("div",ns,[e[28]||(e[28]=s("span",{class:"label"},"文件链接:",-1)),t(ee,{href:m.value.file_url,target:"_blank",type:"primary"},{default:o(()=>[d(n(m.value.file_url),1)]),_:1},8,["href"])]),s("div",is,[e[29]||(e[29]=s("span",{class:"label"},"描述:",-1)),s("div",ds,n(m.value.description||"暂无描述"),1)])]),t(y(ce),{model:g,rules:J,ref_key:"reviewFormRef",ref:V,"label-width":"80px"},{default:o(()=>[t(T,{label:"审核结果",prop:"status"},{default:o(()=>[t(se,{modelValue:g.status,"onUpdate:modelValue":e[5]||(e[5]=l=>g.status=l)},{default:o(()=>[t(U,{label:"approved"},{default:o(()=>e[30]||(e[30]=[d("通过")])),_:1,__:[30]}),t(U,{label:"rejected"},{default:o(()=>e[31]||(e[31]=[d("拒绝")])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"审核意见",prop:"comment"},{default:o(()=>[t(te,{modelValue:g.comment,"onUpdate:modelValue":e[6]||(e[6]=l=>g.comment=l),type:"textarea",rows:4,placeholder:"请输入审核意见（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):H("",!0)]),_:1},8,["modelValue"])])}}}),ys=ve(us,[["__scopeId","data-v-e06f1c48"]]);export{ys as default};
