import{h as L,_ as Q}from"../assets/index-BZGS9eVU.js";import{h as $,K as W,ab as Z,c as ee,V as te,u as se,q as le,X as ae,G as C}from"../chunks/element-plus-BqgU8HW0.js";import{x as oe,r as c,X as B,j as ne,y as f,A as t,J as ie,Q as s,I as o,u as m,al as _,M as k,O as i,ar as de,H as re,K as U,P as ce,a6 as ue,C as _e,z as p}from"../chunks/vue-vendor-BleHOoLr.js";import"../chunks/utils-Dq7h7Pqt.js";const ve={class:"admin-page user-action-log"},me={class:"page-header"},pe={class:"header-content"},fe={class:"header-left"},ge={class:"header-icon"},be={class:"header-actions"},he={class:"stats-section"},ye={class:"stats-grid"},Ve={class:"stat-card"},Ce={class:"stat-icon"},ke={class:"stat-content"},ze={class:"stat-number"},De={class:"stat-card"},Ae={class:"stat-icon"},Ue={class:"stat-content"},we={class:"stat-number"},Le={class:"stat-card"},Se={class:"stat-icon"},xe={class:"stat-content"},Me={class:"stat-number"},Ie={class:"stat-card"},Ye={class:"stat-icon"},Ne={class:"stat-content"},Fe={class:"stat-number"},He={class:"search-section"},Be={class:"search-left"},Pe={class:"search-right"},Re={class:"content-section log-list-container"},Te={class:"log-list"},je={class:"log-level"},Ee={class:"log-time"},Ke={class:"log-message"},Oe={key:0,class:"log-error"},Xe={class:"pagination-section"},qe={key:0,class:"action-detail"},Ge={class:"detail-item"},Je={class:"detail-item"},Qe={class:"detail-item"},$e={class:"detail-item"},We={class:"detail-item"},Ze={class:"detail-item"},et={class:"detail-item"},tt={class:"description-box"},st={key:0,class:"detail-item"},lt={class:"error-box"},at={class:"confirm-content"},ot={class:"dialog-footer"},nt=oe({__name:"UserActionLog",setup(it){const z=c(!1),g=c([]);c([]);const h=c(1),D=c(20),w=c(0);c(!1),c(null);const S=c(!1),u=c(null),y=c(!1),x=c(""),M=c(()=>{}),v=B({total_actions:0,success_actions:0,failed_actions:0,active_users:0}),n=B({action_type:"",user_id:"",success:"",date_range:[]});async function V(){z.value=!0;try{const l={page:h.value,page_size:D.value};n.action_type&&(l.action_type=n.action_type),n.user_id&&(l.user_id=Number(n.user_id)),n.success!==""&&(l.success=n.success),n.date_range&&n.date_range.length===2&&(l.start_time=n.date_range[0],l.end_time=n.date_range[1]);const e=await L.getUserActions(l);e.code===0&&e.data&&(g.value=(e.data.actions||[]).map(r=>({...r,description:r.details||"",timestamp:new Date(r.created_at).getTime()/1e3,success:!0,error_message:void 0})),w.value=e.data.total||0,P())}catch(l){console.error("加载行为记录失败:",l),C.error("加载行为记录失败")}finally{z.value=!1}}function P(){v.total_actions=w.value,v.success_actions=g.value.filter(l=>l.success).length,v.failed_actions=g.value.filter(l=>!l.success).length,v.active_users=new Set(g.value.map(l=>l.user_id)).size}function I(){h.value=1,V()}function R(){Object.assign(n,{action_type:"",user_id:"",success:"",date_range:[]}),I()}function T(l){D.value=l,V()}function j(l){h.value=l,V()}async function E(){x.value="确定要清空所有行为记录吗？此操作不可恢复！",M.value=async()=>{try{const l={page:1,page_size:1e3},e=await L.getUserActions(l);if(e.code===0&&e.data&&e.data.actions.length>0){const r=e.data.actions.map(d=>d.id);(await L.batchDeleteUserActions(r)).code===0?(C.success("所有行为记录已清空"),V()):C.error("清空记录失败")}else C.info("没有记录可清空")}catch(l){console.error("清空记录失败:",l),C.error("清空记录失败")}finally{y.value=!1}},y.value=!0}function Y(l){return{Login:"登录",Logout:"登出",Register:"注册",Upload:"上传",Download:"下载",Comment:"评论",Like:"点赞",Share:"分享",Settings:"设置",Admin:"管理操作"}[l]||l}function N(l){return new Date(l*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return ne(()=>{V()}),(l,e)=>{const r=_("el-icon"),b=_("el-button"),d=_("el-option"),F=_("el-select"),A=_("el-form-item"),K=_("el-input"),O=_("el-date-picker"),X=_("el-form"),q=_("el-empty"),G=_("el-pagination"),H=_("el-dialog"),J=de("loading");return p(),f("div",ve,[t("div",me,[t("div",pe,[t("div",fe,[t("div",ge,[s(r,{size:32},{default:o(()=>[s(m($))]),_:1})]),e[9]||(e[9]=t("div",{class:"header-info"},[t("h1",{class:"page-title"},"用户行为记录"),t("p",{class:"page-subtitle"},"查看和管理用户的所有行为活动记录")],-1))]),t("div",be,[s(b,{type:"danger",onClick:E},{default:o(()=>[s(r,null,{default:o(()=>[s(m(W))]),_:1}),e[10]||(e[10]=k(" 清空日志 "))]),_:1,__:[10]})])])]),t("div",he,[t("div",ye,[t("div",Ve,[t("div",Ce,[s(r,{size:24},{default:o(()=>[s(m(Z))]),_:1})]),t("div",ke,[t("div",ze,i(v.total_actions),1),e[11]||(e[11]=t("div",{class:"stat-label"},"总行为数",-1))])]),t("div",De,[t("div",Ae,[s(r,{size:24},{default:o(()=>[s(m(ee))]),_:1})]),t("div",Ue,[t("div",we,i(v.success_actions),1),e[12]||(e[12]=t("div",{class:"stat-label"},"成功操作",-1))])]),t("div",Le,[t("div",Se,[s(r,{size:24},{default:o(()=>[s(m(te))]),_:1})]),t("div",xe,[t("div",Me,i(v.failed_actions),1),e[13]||(e[13]=t("div",{class:"stat-label"},"失败操作",-1))])]),t("div",Ie,[t("div",Ye,[s(r,{size:24},{default:o(()=>[s(m(se))]),_:1})]),t("div",Ne,[t("div",Fe,i(v.active_users),1),e[14]||(e[14]=t("div",{class:"stat-label"},"活跃用户",-1))])])])]),t("div",He,[t("div",Be,[s(X,{inline:!0,model:n,class:"filter-form"},{default:o(()=>[s(A,{label:"行为类型"},{default:o(()=>[s(F,{modelValue:n.action_type,"onUpdate:modelValue":e[0]||(e[0]=a=>n.action_type=a),placeholder:"选择行为类型",clearable:""},{default:o(()=>[s(d,{label:"全部",value:""}),s(d,{label:"登录",value:"Login"}),s(d,{label:"登出",value:"Logout"}),s(d,{label:"注册",value:"Register"}),s(d,{label:"上传",value:"Upload"}),s(d,{label:"下载",value:"Download"}),s(d,{label:"评论",value:"Comment"}),s(d,{label:"点赞",value:"Like"}),s(d,{label:"分享",value:"Share"}),s(d,{label:"设置",value:"Settings"}),s(d,{label:"管理操作",value:"Admin"})]),_:1},8,["modelValue"])]),_:1}),s(A,{label:"用户ID"},{default:o(()=>[s(K,{modelValue:n.user_id,"onUpdate:modelValue":e[1]||(e[1]=a=>n.user_id=a),placeholder:"输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),s(A,{label:"操作结果"},{default:o(()=>[s(F,{modelValue:n.success,"onUpdate:modelValue":e[2]||(e[2]=a=>n.success=a),placeholder:"选择结果",clearable:""},{default:o(()=>[s(d,{label:"全部",value:""}),s(d,{label:"成功",value:!0}),s(d,{label:"失败",value:!1})]),_:1},8,["modelValue"])]),_:1}),s(A,{label:"时间范围"},{default:o(()=>[s(O,{modelValue:n.date_range,"onUpdate:modelValue":e[3]||(e[3]=a=>n.date_range=a),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),t("div",Pe,[s(b,{type:"primary",onClick:I},{default:o(()=>[s(r,null,{default:o(()=>[s(m(le))]),_:1}),e[15]||(e[15]=k(" 筛选 "))]),_:1,__:[15]}),s(b,{onClick:R},{default:o(()=>[s(r,null,{default:o(()=>[s(m(ae))]),_:1}),e[16]||(e[16]=k(" 重置 "))]),_:1,__:[16]})])]),ie((p(),f("div",Re,[t("div",Te,[(p(!0),f(ce,null,ue(g.value,(a,dt)=>(p(),f("div",{key:a.id,class:"log-item"},[t("div",je,i(Y(a.action_type)),1),t("div",Ee,i(N(a.timestamp)),1),t("div",Ke,i(a.description),1),a.error_message?(p(),f("div",Oe,i(a.error_message),1)):U("",!0)]))),128))]),g.value.length===0&&!z.value?(p(),re(q,{key:0,description:"暂无记录"})):U("",!0)])),[[J,z.value]]),t("div",Xe,[s(G,{"current-page":h.value,"onUpdate:currentPage":e[4]||(e[4]=a=>h.value=a),"page-size":D.value,"onUpdate:pageSize":e[5]||(e[5]=a=>D.value=a),"page-sizes":[10,20,50,100],total:w.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:j},null,8,["current-page","page-size","total"])]),s(H,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=a=>S.value=a),title:"行为详情",width:"600px","close-on-click-modal":!1},{default:o(()=>[u.value?(p(),f("div",qe,[t("div",Ge,[e[17]||(e[17]=t("label",null,"ID:",-1)),t("span",null,i(u.value.id),1)]),t("div",Je,[e[18]||(e[18]=t("label",null,"用户ID:",-1)),t("span",null,i(u.value.user_id),1)]),t("div",Qe,[e[19]||(e[19]=t("label",null,"行为类型:",-1)),t("span",null,i(Y(u.value.action_type)),1)]),t("div",$e,[e[20]||(e[20]=t("label",null,"时间:",-1)),t("span",null,i(N(u.value.timestamp)),1)]),t("div",We,[e[21]||(e[21]=t("label",null,"IP地址:",-1)),t("span",null,i(u.value.ip_address||"N/A"),1)]),t("div",Ze,[e[22]||(e[22]=t("label",null,"成功状态:",-1)),t("span",{style:_e({color:u.value.success?"#67C23A":"#F56C6C"})},i(u.value.success?"成功":"失败"),5)]),t("div",et,[e[23]||(e[23]=t("label",null,"描述:",-1)),t("div",tt,i(u.value.description),1)]),u.value.error_message?(p(),f("div",st,[e[24]||(e[24]=t("label",null,"错误信息:",-1)),t("div",lt,i(u.value.error_message),1)])):U("",!0)])):U("",!0)]),_:1},8,["modelValue"]),s(H,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),title:"确认操作",width:"400px"},{footer:o(()=>[t("span",ot,[s(b,{onClick:e[7]||(e[7]=a=>y.value=!1)},{default:o(()=>e[25]||(e[25]=[k("取消")])),_:1,__:[25]}),s(b,{type:"danger",onClick:M.value},{default:o(()=>e[26]||(e[26]=[k("确认")])),_:1,__:[26]},8,["onClick"])])]),default:o(()=>[t("div",at,[t("p",null,i(x.value),1)])]),_:1},8,["modelValue"])])}}}),vt=Q(nt,[["__scopeId","data-v-5193fae8"]]);export{vt as default};
