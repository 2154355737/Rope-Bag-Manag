import{k as N,_ as ge}from"../assets/index-C1pGffEW.js";import{G as C}from"../chunks/element-plus-BqgU8HW0.js";import{x as me,r as v,X as O,w as H,j as fe,S as be,y as D,A as t,Q as a,I as s,al as r,K as U,O as i,M as _,J as ye,ar as he,H as we,z as h}from"../chunks/vue-vendor-BleHOoLr.js";import"../chunks/utils-Dq7h7Pqt.js";const Ce={class:"admin-page resource-record"},De={class:"page-header"},Re={class:"header-content"},ke={class:"header-left"},Ve={class:"header-icon"},xe={class:"header-actions"},Se={class:"refresh-controls"},Ie={key:0,class:"refresh-info"},Ue={class:"stats-section"},ze={class:"stats-grid"},Ae={class:"stat-card"},Le={class:"stat-icon"},Pe={class:"stat-content"},Te={class:"stat-number"},Be={class:"stat-card"},Me={class:"stat-icon"},Ye={class:"stat-content"},Ee={class:"stat-number"},Fe={class:"stat-card"},Ne={class:"stat-icon"},Oe={class:"stat-content"},He={class:"stat-number"},je={class:"stat-card"},Je={class:"stat-icon"},$e={class:"stat-content"},Ge={class:"stat-number"},Ke={class:"search-section"},Qe={class:"search-left"},Xe={class:"search-right"},qe={class:"table-section"},We={class:"pagination-section"},Ze={key:0,class:"record-detail"},et={class:"detail-item"},tt={class:"detail-item"},at={class:"detail-item"},ot={class:"detail-item"},lt={class:"detail-item"},st={class:"detail-item"},nt={class:"detail-item"},rt={key:0,class:"detail-item"},it={class:"data-box old-data-box"},dt={key:1,class:"detail-item"},ut={class:"data-box new-data-box"},ct=me({__name:"ResourceRecord",setup(_t){const R=v(!1),g=v([]);v([]);const w=v(1),k=v(20),z=v(0),V=v(!1),d=v(null),c=O({total_records:0,create_count:0,update_count:0,delete_count:0}),l=O({resource_type:"",action:"",user_id:"",date_range:[]}),x=v(!1),L=v(30);let f=null;async function b(){R.value=!0;try{const o={page:w.value,pageSize:k.value,resource_type:l.resource_type||void 0,action:l.action||void 0,user_id:l.user_id?parseInt(l.user_id):void 0};l.date_range&&l.date_range.length===2&&(o.start_date=S(l.date_range[0]),o.end_date=S(l.date_range[1])),console.log("加载资源记录，参数:",o);const e=await N.getResourceRecords(o);e.code===0&&e.data?(g.value=e.data.list||[],z.value=e.data.total||0,c.total_records=z.value,j(),console.log("加载到资源记录:",g.value.length)):(console.error("加载资源记录返回错误:",e.message),C.error(e.message||"加载资源记录失败"))}catch(o){console.error("加载资源记录失败:",o),C.error("加载资源记录失败")}finally{R.value=!1}}function S(o){return o?o.toISOString().slice(0,19).replace("T"," "):""}function j(){g.value&&g.value.length>0&&(c.create_count=g.value.filter(o=>o.action==="Create").length,c.update_count=g.value.filter(o=>o.action==="Update").length,c.delete_count=g.value.filter(o=>o.action==="Delete").length,J())}async function J(){try{const o={};l.date_range&&l.date_range.length===2&&(o.start_date=S(l.date_range[0]),o.end_date=S(l.date_range[1])),l.resource_type&&(o.resource_type=l.resource_type),l.user_id&&(o.user_id=parseInt(l.user_id)),console.log("加载资源操作统计，参数:",o);const e=await N.getResourceActionStats(o);e.code===0&&e.data?(c.create_count=e.data.create_count||0,c.update_count=e.data.update_count||0,c.delete_count=e.data.delete_count||0):console.error("加载统计数据返回错误:",e.message)}catch(o){console.error("加载统计数据失败:",o)}}function P(o){if(!o)return"";try{const e=typeof o=="object"?o:JSON.parse(o);return JSON.stringify(e,null,2)}catch{return String(o)}}function T(o){return o?typeof o=="number"?new Date(o*1e3).toLocaleString():o:""}function A(){w.value=1,b()}function $(){Object.assign(l,{resource_type:"",action:"",user_id:"",date_range:[]}),A()}function G(o){k.value=o,b()}function K(o){w.value=o,b()}function Q(o){d.value=o,V.value=!0}function X(){try{if(g.value.length===0){C.warning("没有记录可导出");return}C.info("当前版本不支持自动导出，请使用浏览器保存功能手动导出数据")}catch(o){console.error("导出记录失败:",o),C.error("导出失败")}}function q(){b()}function B(o){return{Package:"绳包",User:"用户",Category:"分类",Comment:"评论",Settings:"设置",Backup:"备份",Announcement:"公告",Resource:"资源",Log:"日志",Role:"角色",Permission:"权限",File:"文件",Tag:"标签",Image:"图片",Video:"视频",Audio:"音频",Document:"文档"}[o]||o}function M(o){return{Package:"primary",User:"success",Category:"warning",Comment:"info",Settings:"danger",Backup:"info",Announcement:"warning",Resource:"primary",Log:"info",Role:"success",Permission:"danger",File:"primary",Tag:"warning",Image:"primary",Video:"success",Audio:"warning",Document:"info"}[o]||"info"}function Y(o){return{Create:"创建",Update:"更新",Delete:"删除",Download:"下载",Upload:"上传",Star:"标星",Ban:"封禁",StatusChange:"状态变更",Import:"导入",Export:"导出",Approve:"审核通过",Reject:"拒绝",Restore:"恢复",Move:"移动",Copy:"复制",Share:"分享",Like:"点赞",Dislike:"点踩",Comment:"评论",Reply:"回复"}[o]||o}function E(o){return{Create:"success",Update:"warning",Delete:"danger",Download:"info",Upload:"primary",Star:"warning",Ban:"danger",StatusChange:"warning",Import:"primary",Export:"info",Approve:"success",Reject:"danger",Restore:"success",Move:"warning",Copy:"info",Share:"primary",Like:"success",Dislike:"danger",Comment:"info",Reply:"info"}[o]||"info"}return H([()=>l.resource_type,()=>l.action,()=>l.user_id,()=>l.date_range],()=>{A()},{deep:!0}),fe(()=>{b()}),H(x,o=>{o?f=window.setInterval(()=>{b()},L.value*1e3):f!==null&&(clearInterval(f),f=null)}),be(()=>{f!==null&&clearInterval(f)}),(o,e)=>{const W=r("List"),p=r("el-icon"),Z=r("el-switch"),ee=r("Refresh"),y=r("el-button"),te=r("Document"),ae=r("Plus"),oe=r("Edit"),le=r("Delete"),u=r("el-option"),F=r("el-select"),se=r("el-input"),ne=r("el-date-picker"),re=r("Search"),ie=r("RefreshRight"),de=r("Download"),m=r("el-table-column"),I=r("el-tag"),ue=r("View"),ce=r("el-table"),_e=r("el-pagination"),pe=r("el-dialog"),ve=he("loading");return h(),D("div",Ce,[t("div",De,[t("div",Re,[t("div",ke,[t("div",Ve,[a(p,{size:32},{default:s(()=>[a(W)]),_:1})]),e[9]||(e[9]=t("div",{class:"header-info"},[t("h1",{class:"page-title"},"资源记录"),t("p",{class:"page-subtitle"},"记录系统中所有资源的创建、修改、删除等操作历史")],-1))]),t("div",xe,[t("div",Se,[a(Z,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=n=>x.value=n),"active-text":"自动刷新","inactive-text":"手动刷新",style:{"margin-right":"10px"}},null,8,["modelValue"]),x.value?(h(),D("span",Ie,"每 "+i(L.value)+"s 刷新",1)):U("",!0),a(y,{onClick:q,loading:R.value},{default:s(()=>[a(p,null,{default:s(()=>[a(ee)]),_:1}),e[10]||(e[10]=_(" 立即刷新 "))]),_:1,__:[10]},8,["loading"])])])])]),t("div",Ue,[t("div",ze,[t("div",Ae,[t("div",Le,[a(p,{size:24},{default:s(()=>[a(te)]),_:1})]),t("div",Pe,[t("div",Te,i(c.total_records),1),e[11]||(e[11]=t("div",{class:"stat-label"},"总记录数",-1))])]),t("div",Be,[t("div",Me,[a(p,{size:24},{default:s(()=>[a(ae)]),_:1})]),t("div",Ye,[t("div",Ee,i(c.create_count),1),e[12]||(e[12]=t("div",{class:"stat-label"},"创建操作",-1))])]),t("div",Fe,[t("div",Ne,[a(p,{size:24},{default:s(()=>[a(oe)]),_:1})]),t("div",Oe,[t("div",He,i(c.update_count),1),e[13]||(e[13]=t("div",{class:"stat-label"},"更新操作",-1))])]),t("div",je,[t("div",Je,[a(p,{size:24},{default:s(()=>[a(le)]),_:1})]),t("div",$e,[t("div",Ge,i(c.delete_count),1),e[14]||(e[14]=t("div",{class:"stat-label"},"删除操作",-1))])])])]),t("div",Ke,[t("div",Qe,[a(F,{modelValue:l.resource_type,"onUpdate:modelValue":e[1]||(e[1]=n=>l.resource_type=n),placeholder:"资源类型",clearable:"",style:{width:"150px"}},{default:s(()=>[a(u,{label:"全部",value:""}),a(u,{label:"绳包",value:"Package"}),a(u,{label:"用户",value:"User"}),a(u,{label:"分类",value:"Category"}),a(u,{label:"评论",value:"Comment"}),a(u,{label:"设置",value:"Settings"})]),_:1},8,["modelValue"]),a(F,{modelValue:l.action,"onUpdate:modelValue":e[2]||(e[2]=n=>l.action=n),placeholder:"操作类型",clearable:"",style:{width:"150px"}},{default:s(()=>[a(u,{label:"全部",value:""}),a(u,{label:"创建",value:"Create"}),a(u,{label:"更新",value:"Update"}),a(u,{label:"删除",value:"Delete"}),a(u,{label:"下载",value:"Download"}),a(u,{label:"上传",value:"Upload"}),a(u,{label:"标星",value:"Star"}),a(u,{label:"封禁",value:"Ban"})]),_:1},8,["modelValue"]),a(se,{modelValue:l.user_id,"onUpdate:modelValue":e[3]||(e[3]=n=>l.user_id=n),placeholder:"输入用户ID",clearable:"",style:{width:"150px"}},null,8,["modelValue"]),a(ne,{modelValue:l.date_range,"onUpdate:modelValue":e[4]||(e[4]=n=>l.date_range=n),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),t("div",Xe,[a(y,{type:"primary",onClick:A},{default:s(()=>[a(p,null,{default:s(()=>[a(re)]),_:1}),e[15]||(e[15]=_(" 筛选 "))]),_:1,__:[15]}),a(y,{onClick:$},{default:s(()=>[a(p,null,{default:s(()=>[a(ie)]),_:1}),e[16]||(e[16]=_(" 重置 "))]),_:1,__:[16]}),a(y,{type:"success",onClick:X},{default:s(()=>[a(p,null,{default:s(()=>[a(de)]),_:1}),e[17]||(e[17]=_(" 导出记录 "))]),_:1,__:[17]})])]),t("div",qe,[ye((h(),we(ce,{data:g.value,style:{width:"100%"},"header-cell-style":{background:"var(--bg-secondary)",color:"var(--text-primary)"},"row-style":{background:"var(--bg-card)"},border:"",stripe:""},{default:s(()=>[a(m,{prop:"id",label:"ID",width:"80"}),a(m,{prop:"resource_type",label:"资源类型",width:"120"},{default:s(({row:n})=>[a(I,{type:M(n.resource_type)},{default:s(()=>[_(i(B(n.resource_type)),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"resource_id",label:"资源ID",width:"100"}),a(m,{prop:"action",label:"操作类型",width:"100"},{default:s(({row:n})=>[a(I,{type:E(n.action)},{default:s(()=>[_(i(Y(n.action)),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"user_id",label:"操作用户",width:"100"}),a(m,{prop:"details",label:"操作详情","min-width":"250","show-overflow-tooltip":""}),a(m,{prop:"created_at",label:"操作时间",width:"180"},{default:s(({row:n})=>[_(i(T(n.created_at)),1)]),_:1}),a(m,{label:"操作",width:"120",fixed:"right"},{default:s(({row:n})=>[a(y,{size:"small",onClick:pt=>Q(n)},{default:s(()=>[a(p,null,{default:s(()=>[a(ue)]),_:1}),e[18]||(e[18]=_(" 查看 "))]),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,R.value]]),t("div",We,[a(_e,{"current-page":w.value,"onUpdate:currentPage":e[5]||(e[5]=n=>w.value=n),"page-size":k.value,"onUpdate:pageSize":e[6]||(e[6]=n=>k.value=n),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),a(pe,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=n=>V.value=n),title:"记录详情",width:"800px"},{footer:s(()=>[a(y,{onClick:e[7]||(e[7]=n=>V.value=!1)},{default:s(()=>e[28]||(e[28]=[_("关闭")])),_:1,__:[28]})]),default:s(()=>[d.value?(h(),D("div",Ze,[t("div",et,[e[19]||(e[19]=t("label",null,"记录ID:",-1)),t("span",null,i(d.value.id),1)]),t("div",tt,[e[20]||(e[20]=t("label",null,"资源类型:",-1)),a(I,{type:M(d.value.resource_type)},{default:s(()=>[_(i(B(d.value.resource_type)),1)]),_:1},8,["type"])]),t("div",at,[e[21]||(e[21]=t("label",null,"资源ID:",-1)),t("span",null,i(d.value.resource_id),1)]),t("div",ot,[e[22]||(e[22]=t("label",null,"操作用户:",-1)),t("span",null,i(d.value.user_id),1)]),t("div",lt,[e[23]||(e[23]=t("label",null,"操作类型:",-1)),a(I,{type:E(d.value.action)},{default:s(()=>[_(i(Y(d.value.action)),1)]),_:1},8,["type"])]),t("div",st,[e[24]||(e[24]=t("label",null,"操作时间:",-1)),t("span",null,i(T(d.value.timestamp)),1)]),t("div",nt,[e[25]||(e[25]=t("label",null,"IP地址:",-1)),t("span",null,i(d.value.ip_address),1)]),d.value.old_data?(h(),D("div",rt,[e[26]||(e[26]=t("label",null,"旧数据:",-1)),t("div",it,[t("pre",null,i(P(d.value.old_data)),1)])])):U("",!0),d.value.new_data?(h(),D("div",dt,[e[27]||(e[27]=t("label",null,"新数据:",-1)),t("div",ut,[t("pre",null,i(P(d.value.new_data)),1)])])):U("",!0)])):U("",!0)]),_:1},8,["modelValue"])])}}}),bt=ge(ct,[["__scopeId","data-v-efb77eb5"]]);export{bt as default};
