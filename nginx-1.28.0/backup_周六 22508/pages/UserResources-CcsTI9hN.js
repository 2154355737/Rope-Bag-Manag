import{x as Ue,r as b,X as F,c as P,j as xe,y as V,A as n,Q as t,I as a,M as p,al as d,u as g,O as c,a4 as ee,J as Re,ar as ze,K as D,P as E,a6 as $,H as R,z as u}from"../chunks/vue-vendor-BleHOoLr.js";import{l as Ae,a5 as Ie,U as te,f as le,Q,ah as Se,v as Fe,G as m,E as Pe}from"../chunks/element-plus-BqgU8HW0.js";import{p as G}from"../chunks/packages-D1bca-EI.js";import{g as De,_ as Ee}from"../assets/index-BYq8Q9FJ.js";import{u as $e}from"../chunks/users-B3_-qbGS.js";import{c as Me}from"../chunks/categories-CDxQep1u.js";import{c as Be}from"../chunks/posts-s6Ksrwn6.js";import"../chunks/utils-Dq7h7Pqt.js";const Te={class:"user-resource-manage"},je={class:"page-header"},Ne={class:"header-content"},Ke={class:"stat-content"},Le={class:"stat-icon"},qe={class:"stat-info"},Oe={class:"stat-number"},Qe={class:"stat-content"},Ge={class:"stat-icon"},He={class:"stat-info"},Je={class:"stat-number"},Xe={class:"stat-content"},We={class:"stat-icon"},Ye={class:"stat-info"},Ze={class:"stat-number"},et={class:"stat-content"},tt={class:"stat-icon"},lt={class:"stat-info"},at={class:"stat-number"},ot={key:0,class:"empty-state"},st={key:1,class:"resource-grid"},nt={class:"resource-header"},dt=["onClick"],rt={class:"resource-info"},it={class:"info-item"},ut={class:"value"},pt={class:"info-item"},ct={class:"value"},mt={class:"info-item"},_t={class:"resource-description"},ft={class:"resource-stats"},gt={class:"stat-item"},vt={class:"stat-item"},yt={class:"stat-item"},bt={key:2,class:"pagination-wrapper"},Vt={class:"tags-container"},wt={class:"dialog-footer"},kt={class:"dialog-footer"},ht=Ue({__name:"UserResources",setup(Ct){const M=b(null),B=b(null),I=b(!1),T=b(!1),j=b(!1),h=b(!1),z=b(!1),H=De(),C=b([]),A=b([]),N=b(null),w=F({page:1,pageSize:12,total:0}),k=F({status:"",search:""}),s=F({type:"package",name:"",author:H?.username||"",version:"",description:"",category_id:void 0,file_url:"",tags:[],tagsInput:""}),r=F({name:"",version:"",description:"",category_id:void 0,file_url:""}),J={name:[{required:!0,message:"è¯·è¾“å…¥æ ‡é¢˜",trigger:"blur"},{min:2,max:50,message:"æ ‡é¢˜é•¿åº¦åœ¨ 2 åˆ° 50 ä¸ªå­—ç¬¦ä¹‹é—´",trigger:"blur"}],author:[{required:!0,message:"è¯·è¾“å…¥ä½œè€…åç§°",trigger:"blur"}],description:[{required:!0,message:"è¯·è¾“å…¥å†…å®¹",trigger:"blur"},{min:10,max:500,message:"å†…å®¹é•¿åº¦åœ¨ 10 åˆ° 500 ä¸ªå­—ç¬¦ä¹‹é—´",trigger:"blur"}],file_url:[{pattern:/^https?:\/\/.+/,message:"è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€",trigger:"blur"}]},K=P(()=>C.value.length),ae=P(()=>C.value.filter(o=>o.status==="Active").length),oe=P(()=>C.value.filter(o=>o.status==="Pending").length),se=P(()=>C.value.reduce((o,e)=>o+e.download_count,0)),v=async()=>{I.value=!0;try{const o={page:w.page,pageSize:w.pageSize,status:k.status||void 0};console.log("ðŸ“¤ åŠ è½½ç”¨æˆ·èµ„æºå‚æ•°:",o);const e=await $e.getMyResources(o);e.code===0?(console.log("âœ… ç”¨æˆ·èµ„æºåŠ è½½æˆåŠŸ:",e.data),C.value=e.data?.list||[],w.total=e.data?.total||0):(console.warn("âŒ ç”¨æˆ·èµ„æºåŠ è½½å¤±è´¥:",e),m.error(e.message||"åŠ è½½èµ„æºå¤±è´¥"))}catch(o){console.error("ðŸš« åŠ è½½èµ„æºåˆ—è¡¨å¤±è´¥:",o),m.error("åŠ è½½èµ„æºåˆ—è¡¨å¤±è´¥")}finally{I.value=!1}},ne=()=>{k.status="",k.search="",w.page=1,v()},de=(o,e)=>{switch(o){case"edit":re(e);break;case"view":window.open(`/resource/${e.id}`,"_blank");break;case"delete":me(e);break}},re=o=>{N.value=o,r.name=o.name,r.version=o.version||"",r.description=o.description||"",r.category_id=o.category_id||void 0,r.file_url=o.file_url,z.value=!0},ie=()=>{const o=s.tagsInput?.trim();o&&o.length>0&&!s.tags.includes(o)&&(s.tags.push(o),s.tagsInput="")},ue=o=>{const e=s.tags.indexOf(o);e>-1&&s.tags.splice(e,1)},pe=async()=>{if(M.value)try{if(s.type==="package"&&!s.file_url){m.error("è¯·å¡«å†™æ–‡ä»¶é“¾æŽ¥");return}if(await M.value.validate(),T.value=!0,s.type==="package"){const o=s.category_id?A.value.find(y=>y.id===s.category_id)?.name:void 0,e={title:s.name,description:s.description,category:o,tags:s.tags,file_url:s.file_url||""};console.log("ðŸ“¤ æ™®é€šç”¨æˆ·æäº¤èµ„æºæ•°æ®:",e);const _=await G.userSubmitResource(e);_.code===0?(m.success("èµ„æºä¸Šä¼ æˆåŠŸï¼Œç­‰å¾…å®¡æ ¸"),h.value=!1,X(),v()):m.error(_.message||"ä¸Šä¼ å¤±è´¥")}else{const o=await Be({title:s.name,content:s.description,category_id:s.category_id,tags:s.tags,status:"Published"});o.code===0?(m.success("å¸–å­å‘å¸ƒæˆåŠŸ"),h.value=!1,X(),v()):m.error(o.msg||"å‘å¸ƒå¤±è´¥")}}catch(o){console.error("æäº¤å¤±è´¥:",o),m.error(s.type==="package"?"ä¸Šä¼ å¤±è´¥":"å‘å¸ƒå¤±è´¥")}finally{T.value=!1}},ce=async()=>{if(!(!B.value||!N.value))try{await B.value.validate(),j.value=!0;const o=await G.updatePackage(N.value.id,r);o.code===0?(m.success("èµ„æºæ›´æ–°æˆåŠŸ"),z.value=!1,v()):m.error(o.message||"æ›´æ–°å¤±è´¥")}catch(o){console.error("æ›´æ–°èµ„æºå¤±è´¥:",o),m.error("æ›´æ–°å¤±è´¥")}finally{j.value=!1}},me=async o=>{try{await Pe.confirm(`ç¡®å®šè¦åˆ é™¤èµ„æº "${o.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,"ç¡®è®¤åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const e=await G.deletePackage(o.id);e.code===0?(m.success("åˆ é™¤æˆåŠŸ"),v()):m.error(e.message||"åˆ é™¤å¤±è´¥")}catch(e){e!=="cancel"&&(console.error("åˆ é™¤èµ„æºå¤±è´¥:",e),m.error("åˆ é™¤å¤±è´¥"))}},X=()=>{Object.assign(s,{type:"package",name:"",author:H?.username||"",version:"",description:"",category_id:void 0,file_url:"",tags:[],tagsInput:""})},_e=o=>({Active:"success",Pending:"warning",Rejected:"danger",Inactive:"info"})[o]||"info",fe=o=>({Active:"å·²å‘å¸ƒ",Pending:"å®¡æ ¸ä¸­",Rejected:"å·²æ‹’ç»",Inactive:"å·²ä¸‹æž¶"})[o]||o,ge=o=>new Date(o).toLocaleDateString("zh-CN"),ve=async()=>{try{console.log("æ­£åœ¨åŠ è½½åˆ†ç±»æ•°æ®...");const o=await Me.getCategories();console.log("åˆ†ç±»APIå“åº”:",o),o.code===0&&o.data?(A.value=Array.isArray(o.data)?o.data:o.data.list||[],console.log("åŠ è½½åˆ°çš„åˆ†ç±»:",A.value)):console.error("åˆ†ç±»APIè¿”å›žé”™è¯¯:",o)}catch(o){console.error("åŠ è½½åˆ†ç±»å¤±è´¥:",o)}};return xe(()=>{ve(),v()}),(o,e)=>{const _=d("el-button"),y=d("el-icon"),x=d("el-card"),S=d("el-col"),ye=d("el-row"),U=d("el-option"),L=d("el-select"),i=d("el-form-item"),f=d("el-input"),be=d("el-empty"),q=d("el-dropdown-item"),Ve=d("el-dropdown-menu"),we=d("el-dropdown"),W=d("el-tag"),ke=d("el-pagination"),Y=d("el-radio"),he=d("el-radio-group"),Z=d("el-dialog"),Ce=ze("loading");return u(),V("div",Te,[n("div",je,[n("div",Ne,[e[24]||(e[24]=n("h2",null,"æˆ‘çš„å†…å®¹",-1)),t(_,{type:"primary",icon:"Plus",onClick:e[0]||(e[0]=l=>h.value=!0)},{default:a(()=>e[23]||(e[23]=[p(" æäº¤å†…å®¹ ")])),_:1,__:[23]})])]),t(ye,{gutter:20,class:"stats-row"},{default:a(()=>[t(S,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card"},{default:a(()=>[n("div",Ke,[n("div",Le,[t(y,{color:"#409EFF"},{default:a(()=>[t(g(Ae))]),_:1})]),n("div",qe,[n("div",Oe,c(K.value),1),e[25]||(e[25]=n("div",{class:"stat-label"},"æ€»å†…å®¹æ•°",-1))])])]),_:1})]),_:1}),t(S,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card"},{default:a(()=>[n("div",Qe,[n("div",Ge,[t(y,{color:"#67C23A"},{default:a(()=>[t(g(Ie))]),_:1})]),n("div",He,[n("div",Je,c(ae.value),1),e[26]||(e[26]=n("div",{class:"stat-label"},"å·²å‘å¸ƒ",-1))])])]),_:1})]),_:1}),t(S,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card"},{default:a(()=>[n("div",Xe,[n("div",We,[t(y,{color:"#E6A23C"},{default:a(()=>[t(g(te))]),_:1})]),n("div",Ye,[n("div",Ze,c(oe.value),1),e[27]||(e[27]=n("div",{class:"stat-label"},"å®¡æ ¸ä¸­",-1))])])]),_:1})]),_:1}),t(S,{span:6},{default:a(()=>[t(x,{shadow:"hover",class:"stat-card"},{default:a(()=>[n("div",et,[n("div",tt,[t(y,{color:"#F56C6C"},{default:a(()=>[t(g(le))]),_:1})]),n("div",lt,[n("div",at,c(se.value),1),e[28]||(e[28]=n("div",{class:"stat-label"},"æ€»ä¸‹è½½é‡",-1))])])]),_:1})]),_:1})]),_:1}),t(x,{shadow:"hover",class:"filter-card"},{default:a(()=>[t(g(Q),{model:k,inline:!0,class:"search-form"},{default:a(()=>[t(i,{label:"çŠ¶æ€ç­›é€‰:"},{default:a(()=>[t(L,{modelValue:k.status,"onUpdate:modelValue":e[1]||(e[1]=l=>k.status=l),placeholder:"å…¨éƒ¨çŠ¶æ€",clearable:"",style:{width:"120px"}},{default:a(()=>[t(U,{label:"å…¨éƒ¨",value:""}),t(U,{label:"å·²å‘å¸ƒ",value:"Active"}),t(U,{label:"å®¡æ ¸ä¸­",value:"Pending"}),t(U,{label:"å·²æ‹’ç»",value:"Rejected"}),t(U,{label:"å·²ä¸‹æž¶",value:"Inactive"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"æœç´¢:"},{default:a(()=>[t(f,{modelValue:k.search,"onUpdate:modelValue":e[2]||(e[2]=l=>k.search=l),placeholder:"è¾“å…¥èµ„æºåç§°",clearable:"",style:{width:"200px"},onKeyup:ee(v,["enter"])},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(_,{type:"primary",icon:"Search",onClick:v},{default:a(()=>e[29]||(e[29]=[p("æœç´¢")])),_:1,__:[29]}),t(_,{icon:"Refresh",onClick:ne},{default:a(()=>e[30]||(e[30]=[p("é‡ç½®")])),_:1,__:[30]})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{shadow:"hover",class:"resource-list-card"},{default:a(()=>[Re((u(),V("div",null,[C.value.length===0&&!I.value?(u(),V("div",ot,[t(be,{description:"è¿˜æ²¡æœ‰æäº¤ä»»ä½•å†…å®¹"},{default:a(()=>[t(_,{type:"primary",onClick:e[3]||(e[3]=l=>h.value=!0)},{default:a(()=>e[31]||(e[31]=[p(" ç«‹å³æäº¤ ")])),_:1,__:[31]})]),_:1})])):(u(),V("div",st,[(u(!0),V(E,null,$(C.value,l=>(u(),V("div",{key:l.id,class:"resource-card"},[n("div",nt,[n("div",{class:"resource-title",onClick:O=>o.$router.push(`/resource/${l.id}`)},c(l.name),9,dt),t(we,{onCommand:O=>de(O,l)},{dropdown:a(()=>[t(Ve,null,{default:a(()=>[t(q,{command:"edit"},{default:a(()=>e[32]||(e[32]=[p("ç¼–è¾‘")])),_:1,__:[32]}),t(q,{command:"view"},{default:a(()=>e[33]||(e[33]=[p("æŸ¥çœ‹")])),_:1,__:[33]}),t(q,{command:"delete",divided:""},{default:a(()=>e[34]||(e[34]=[p("åˆ é™¤")])),_:1,__:[34]})]),_:1})]),default:a(()=>[t(_,{type:"text",size:"small"},{default:a(()=>[t(y,null,{default:a(()=>[t(g(Se))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),n("div",rt,[n("div",it,[e[35]||(e[35]=n("span",{class:"label"},"ä½œè€…:",-1)),n("span",ut,c(l.author),1)]),n("div",pt,[e[36]||(e[36]=n("span",{class:"label"},"ç‰ˆæœ¬:",-1)),n("span",ct,c(l.version||"æœªè®¾ç½®"),1)]),n("div",mt,[e[37]||(e[37]=n("span",{class:"label"},"çŠ¶æ€:",-1)),t(W,{type:_e(l.status),size:"small"},{default:a(()=>[p(c(fe(l.status)),1)]),_:2},1032,["type"])])]),n("div",_t,c(l.description||"æš‚æ— æè¿°"),1),n("div",ft,[n("div",gt,[t(y,null,{default:a(()=>[t(g(le))]),_:1}),n("span",null,c(l.download_count),1)]),n("div",vt,[t(y,null,{default:a(()=>[t(g(Fe))]),_:1}),n("span",null,c(l.like_count||0),1)]),n("div",yt,[t(y,null,{default:a(()=>[t(g(te))]),_:1}),n("span",null,c(ge(l.created_at)),1)])])]))),128))])),K.value>0?(u(),V("div",bt,[t(ke,{"current-page":w.page,"onUpdate:currentPage":e[4]||(e[4]=l=>w.page=l),"page-size":w.pageSize,"onUpdate:pageSize":e[5]||(e[5]=l=>w.pageSize=l),"page-sizes":[10,20,50],total:K.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])):D("",!0)])),[[Ce,I.value]])]),_:1}),t(Z,{modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=l=>h.value=l),title:"æäº¤å†…å®¹",width:"600px","close-on-click-modal":!1},{footer:a(()=>[n("div",wt,[t(_,{onClick:e[14]||(e[14]=l=>h.value=!1)},{default:a(()=>e[40]||(e[40]=[p("å–æ¶ˆ")])),_:1,__:[40]}),t(_,{type:"primary",onClick:pe,loading:T.value},{default:a(()=>[p(c(s.type==="package"?"æäº¤èµ„æº":"å‘å¸ƒå¸–å­"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(g(Q),{model:s,rules:J,ref_key:"uploadFormRef",ref:M,"label-width":"80px"},{default:a(()=>[t(i,{label:"å†…å®¹ç±»åž‹"},{default:a(()=>[t(he,{modelValue:s.type,"onUpdate:modelValue":e[6]||(e[6]=l=>s.type=l)},{default:a(()=>[t(Y,{label:"package"},{default:a(()=>e[38]||(e[38]=[p("èµ„æº")])),_:1,__:[38]}),t(Y,{label:"post"},{default:a(()=>e[39]||(e[39]=[p("å¸–å­")])),_:1,__:[39]})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:s.type==="package"?"èµ„æºåç§°":"å¸–å­æ ‡é¢˜",prop:"name"},{default:a(()=>[t(f,{modelValue:s.name,"onUpdate:modelValue":e[7]||(e[7]=l=>s.name=l),placeholder:s.type==="package"?"è¯·è¾“å…¥èµ„æºåç§°":"è¯·è¾“å…¥å¸–å­æ ‡é¢˜"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s.type==="package"?(u(),R(i,{key:0,label:"ä½œè€…",prop:"author"},{default:a(()=>[t(f,{modelValue:s.author,"onUpdate:modelValue":e[8]||(e[8]=l=>s.author=l),placeholder:"å½“å‰ç”¨æˆ·",disabled:""},null,8,["modelValue"])]),_:1})):D("",!0),s.type==="package"?(u(),R(i,{key:1,label:"ç‰ˆæœ¬",prop:"version"},{default:a(()=>[t(f,{modelValue:s.version,"onUpdate:modelValue":e[9]||(e[9]=l=>s.version=l),placeholder:"è¯·è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1})):D("",!0),t(i,{label:s.type==="package"?"èµ„æºåˆ†ç±»":"å¸–å­åˆ†ç±»",prop:"category_id"},{default:a(()=>[t(L,{modelValue:s.category_id,"onUpdate:modelValue":e[10]||(e[10]=l=>s.category_id=l),placeholder:s.type==="package"?"è¯·é€‰æ‹©èµ„æºåˆ†ç±»":"è¯·é€‰æ‹©å¸–å­åˆ†ç±»",style:{width:"100%"}},{default:a(()=>[(u(!0),V(E,null,$(A.value,l=>(u(),R(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(i,{label:s.type==="package"?"èµ„æºæè¿°":"å¸–å­å†…å®¹",prop:"description"},{default:a(()=>[t(f,{modelValue:s.description,"onUpdate:modelValue":e[11]||(e[11]=l=>s.description=l),type:"textarea",rows:4,placeholder:s.type==="package"?"è¯·è¾“å…¥èµ„æºæè¿°":"è¯·è¾“å…¥å¸–å­å†…å®¹"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(i,{label:"æ ‡ç­¾"},{default:a(()=>[t(f,{modelValue:s.tagsInput,"onUpdate:modelValue":e[12]||(e[12]=l=>s.tagsInput=l),placeholder:"è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”",onKeyup:ee(ie,["enter"]),clearable:""},null,8,["modelValue"]),n("div",Vt,[(u(!0),V(E,null,$(s.tags,l=>(u(),R(W,{key:l,closable:"",onClose:O=>ue(l),effect:"light"},{default:a(()=>[p(c(l),1)]),_:2},1032,["onClose"]))),128))])]),_:1}),s.type==="package"?(u(),R(i,{key:2,label:"æ–‡ä»¶é“¾æŽ¥",prop:"file_url"},{default:a(()=>[t(f,{modelValue:s.file_url,"onUpdate:modelValue":e[13]||(e[13]=l=>s.file_url=l),placeholder:"è¯·è¾“å…¥æ–‡ä»¶ä¸‹è½½é“¾æŽ¥"},null,8,["modelValue"])]),_:1})):D("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(Z,{modelValue:z.value,"onUpdate:modelValue":e[22]||(e[22]=l=>z.value=l),title:"ç¼–è¾‘èµ„æº",width:"600px","close-on-click-modal":!1},{footer:a(()=>[n("div",kt,[t(_,{onClick:e[21]||(e[21]=l=>z.value=!1)},{default:a(()=>e[41]||(e[41]=[p("å–æ¶ˆ")])),_:1,__:[41]}),t(_,{type:"primary",onClick:ce,loading:j.value},{default:a(()=>e[42]||(e[42]=[p(" ä¿å­˜ä¿®æ”¹ ")])),_:1,__:[42]},8,["loading"])])]),default:a(()=>[t(g(Q),{model:r,rules:J,ref_key:"editFormRef",ref:B,"label-width":"80px"},{default:a(()=>[t(i,{label:"èµ„æºåç§°",prop:"name"},{default:a(()=>[t(f,{modelValue:r.name,"onUpdate:modelValue":e[16]||(e[16]=l=>r.name=l),placeholder:"è¯·è¾“å…¥èµ„æºåç§°"},null,8,["modelValue"])]),_:1}),t(i,{label:"ç‰ˆæœ¬",prop:"version"},{default:a(()=>[t(f,{modelValue:r.version,"onUpdate:modelValue":e[17]||(e[17]=l=>r.version=l),placeholder:"è¯·è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1}),t(i,{label:"åˆ†ç±»",prop:"category_id"},{default:a(()=>[t(L,{modelValue:r.category_id,"onUpdate:modelValue":e[18]||(e[18]=l=>r.category_id=l),placeholder:"è¯·é€‰æ‹©åˆ†ç±»",style:{width:"100%"}},{default:a(()=>[(u(!0),V(E,null,$(A.value,l=>(u(),R(U,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"èµ„æºæè¿°",prop:"description"},{default:a(()=>[t(f,{modelValue:r.description,"onUpdate:modelValue":e[19]||(e[19]=l=>r.description=l),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥èµ„æºæè¿°"},null,8,["modelValue"])]),_:1}),t(i,{label:"æ–‡ä»¶é“¾æŽ¥",prop:"file_url"},{default:a(()=>[t(f,{modelValue:r.file_url,"onUpdate:modelValue":e[20]||(e[20]=l=>r.file_url=l),placeholder:"è¯·è¾“å…¥æ–‡ä»¶ä¸‹è½½é“¾æŽ¥"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Pt=Ee(ht,[["__scopeId","data-v-cc1b0933"]]);export{Pt as default};
